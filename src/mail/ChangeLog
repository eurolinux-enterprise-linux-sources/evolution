2009-05-06  Jeff Cai <jeff.cai@sun.com>

	** Fix for bug #524497
	* em-composer-utils.c: (guess_account):
	Change the order getting an account

	The original order is:
	1. The account in 'To' of the message.
	2. The account of the message source.
	3. The account of the folder source.

	The new order is:
	1. The account of the folder source.
	2. The account of the message source.
	3. The account in "To' of the message

2009-04-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #572348

	* em-filter-rule.c: (part_combobox_changed):
	* em-filter-source-element.c: (source_changed):
	Fix breakage of filter options.

2009-04-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #579550

	* mail-session.c: (main_get_filter_driver):
	Do not mark messages recognized as junk Seen, to let user notice new
	messages in a junk folder.

2009-04-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #579635

	* message-list.c: (regen_list_exec): Do not keep last junked messages
	in a message list for folders not showing junks.

2009-04-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #579306

	* em-folder-utils.c: (em_folder_utils_delete_folder):
	Do not free uninitialized variable.

2009-04-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #563954

	* message-list.c: (regen_list_exec): Sort UIDs before
	using them to obtain proper order when without sorting.

2009-04-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #552583

	* mail-config.c: (mc_get_account_by), (get_source_url_string),
	(get_transport_url_string), (mail_config_get_account_by_source_url),
	(mail_config_get_account_by_transport_url):
	Let the provider compare urls.

2009-04-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #572348

	* mail-config.glade:
	* mail-dialogs.glade:
	* em-composer-prefs.h:
	* em-composer-prefs.c:
	* em-subscribe-editor.c:
	* em-filter-editor.c:
	* em-filter-rule.c:
	* em-filter-source-element.c:
	* em-mailer-prefs.h:
	* em-mailer-prefs.c:
	* message-tag-followup.h:
	* message-tag-followup.c:
	Remove deprecated Gtk+ symbols.

2009-04-15  Chenthill Palanisamy  <pchenthill@novell.com>

	* mail/mail-ops.c: Corrected a typo error.

2009-04-13  Chenthill Palanisamy  <pchenthill@novell.com>

	Fixes #467659 (bnc)
	* mail/mail-mt.c:
	* mail/mail-ops.c: Set the description for send mail
	operation.

2009-04-13  Chenthill Palanisamy  <pchenthill@novell.com>

	Fixes #471083 (bnc)
	* mail/em-folder-utils.c:
	* mail/mail-folder-cache.c:
	* mail/mail-folder-cache.h: Do not allow deleting
	system folders.

2008-04-04  Tobias Mueller  <tobiasmue@gnome.org>

	** Fix for bug #569765

	* message-list.c: Don't keep the selected message in the message 
	list if it is removed from the folder.
	Patch by Matt McCutchen <matt@mattmccutchen.net>

2009-04-02  Milan Crha  <mcrha@redhat.com>

	* em-folder-tree.c: (em_folder_tree_get_selected_folder):
	Do not ask for a folder when no folder selected.

2009-03-31  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	** Fix for bug #576921

	* mail/em-mailer-prefs.h: Remove needless GtkListStore objects.

2009-03-28  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	** Fix for bug #576921

	* mail/em-mailer-prefs.h: Remove needless GtkListStore objects.
	* mail/em-mailer-prefs.c: Use dispose instead of finalize.
	(em_mailer_prefs_dispose): Unref header_list_store.
	(init_junk_tree), (init_label_tree): Returns gboolean value instead
	of GtkListStore object. Unref GtkListStore right after
	gtk_tree_view_set_model.

2009-03-28  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	** Fix for bug #576845

	* em-mailr-prefs.c: (init_junk_tree):
	Call jh_tree_refill instead of label_tree_refill.

2009-03-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #552583

	* mail-config.c: (only_username), (mail_config_account_url_equal):
	Compare only user names, without a domain part, if such exists.

2009-03-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #504767

	* em-folder-utils.h: (em_folder_utils_create_folder):
	* em-folder-utils.c: (em_folder_utils_create_folder):
	* em-folder-selector.c: (emfs_response):
	Inherit modality from a parent's window, if any.
	* em-folder-browser.c: (emfb_folder_create):
	* em-folder-tree.c: (emft_popup_new_folder):
	* mail-component.c: (create_item):
	Propagate changes in function prototype.

2009-03-08  David Planella  <david.planella@gmail.com>

	Added Catalan translation of the Evolution welcome e-mail

	* default/Makefile.am: Added Catalan (ca) to the list of
	subdirectories
	* default/ca/Inbox: Added Catalan translation by David Planella
	* default/ca/Makefile.am: Created Makefile template

2009-03-04  Milan Crha  <mcrha@redhat.com>

	* mail-ops.c: (empty_trash_exec): Do not unref NULL object.

2009-03-02  Matt McCutchen  <matt@mattmccutchen.net>

	* evolution/mail/em-folder-view.c:
	* evolution/mail/em-utils.c:
	* evolution/mail/em-utils.h:
	* evolution/mail/em-popup.c:
	Revert evolution revision 37063 (workaround for bug 563867). 
	
	** Part of the fix for bug #549838

2009-02-26  Andre Klapper  <a9016009@gmx.de>

	* message-tag-followup-c:
	Remove deprecated gtk_combo_set_case_sensitive() call as FALSE
	IS already the default value for the case-sensitive property.

2009-02-25  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #572268

	* em-subscribe-editor.c: (sub_fill_level):
	Do not duplicate "Loading..." node when adding to existing node.

2009-02-25  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #563212

	* em-utils.c: (try_open_e_book_cb), (try_open_e_book),
	(is_local), (em_utils_in_addressbook), (em_utils_contact_photo):
	Ensure empty GError before filling it. Check if group is local based
	on its base_uri. Adapt to new e_book_cancel behaviour.

2009-02-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #572543

	* em-popup.c: (emp_standard_menu_factory):
	Always look for alternative apps for application/octet-stream.

2009-02-11  Andre Klapper  <a9016009@gmx.de>

	* em-folder-browser.c:
	* em-migrate.c:
	Substitute some deprecated gtk+ functions.

2009-02-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #569700

	* em-format-html.c: (emfh_gethttp):
	Stop reading from a network when operation was canceled.

2009-02-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #333716

	* em-format-html.c: (emfh_gethttp):
	Do not store incomplete or broken files in a cache.

2009-02-10  Milan Crha  <mcrha@redhat.com>

	* em-format-html-display.c: (efhd_format_secure):
	Format signature/encryption information nicer.

2009-02-09  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #555888

	* mail-config.glade:
	* em-network-prefs.h: (struct _EMNetworkPrefs):
	* em-network-prefs.c: (emnp_parse_ignore_hosts),
	(emnp_load_sys_settings), (notify_proxy_type_changed),
	(em_network_prefs_construct):
	Do not overwrite user settings with system proxy settings.
	Register signals at the end, when all widgets are read.
	Hide socks settings, it is not used at the moment.

	* em-utils.h: (em_utils_get_proxy_uri):
	* em-utils.c: (em_utils_get_proxy_uri), (emu_proxy_setup):
	* em-format-html.c: (emfh_gethttp):
	Use proxy configurable within Evolution.

2009-02-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #548623

	* mail-config.glade:
	* em-network-prefs.h:
	* em-network-prefs.c: (emnp_set_sensitiveness),
	(emnp_load_sys_settings), (notify_proxy_type_changed),
	(em_network_prefs_construct), (emnp_set_markups):
	No auto-proxy at the moment.

2009-02-05  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #554458

	* em-format.c: (em_format_describe_part):
	Make content type from a mime type first.

2009-02-04  Gilles Dartiguelongue  <gdartigu@svn.gnome.org>

	** Fix for bug #568176
	
	* em-migrate.c: (em_migrate_setup_progress_dialog),
	(em_migrate_close_progress_dialog), (em_migrate_set_folder_name),
	(em_migrate_local_folders_1_4), (migrate_to_db):
	Make the migration dialog look better.

2009-02-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #569986

	* mail/em-format-html-print.c: Handle printers while doing attachment
	bar rendering.
	* mail/em-format-html.c:
	* mail/em-format.c:
	* mail/em-format.h:

2009-02-02  Matt McCutchen 2  <matt@mattmccutchen.net>

	** Fix for bug #567935

	* em-folder-tree.c (emft_popup_uvfolder): Don't use an uninitialized 
	variable.

2009-02-01  Matthew Barnes  <mbarnes@redhat.com>

	* em-event.c:
	* em-event.h:
	* em-migrate.c:
	Fix compiler warnings.

2009-02-01  Johnny Jacob  <jjohnny@novell.com>

	* em-event.h (struct _EMEventTargetFolderBrowser): Added.
	* em-event.c (em_event_target_new_folder_browser): Added.
	(EEventHookTargetMask emeh_folder_browser_masks): Added.
	* em-folder-browser.c (emfb_init): New e-plugin Hook point.

2009-01-30  Srinivasa Ragavan  <sragavan@novell.com>

	* message-list.c: (regen_list_exec): Fix compiler warnings

2009-01-29  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c: (efhd_update_bar),
	(efhd_message_update_bar): Show attachment bar at all times. Seems
	like the contents are missing at times.

2009-01-29  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format.c: (em_format_format_text): Handle empty messages well.

2009-01-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #546637

	* em-folder-view.c: (emfv_popup_source): Ensure uid for source view
	also.

2009-01-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #562449

	* em-folder-view.c: (em_folder_view_mark_selected),
	(emfv_delete_msg_response): Don't emit for vfolders.

2009-01-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #567654

	* message-list.c: (regen_list_exec): Don't free the reffable string.

2009-01-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #561628

	* em-format-html-print.c: (efhp_class_init):
	Initialize 'parent_class' with its parent, not with itself.

2009-01-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #204891

	* filtertypes.xml:
	* em-composer-utils.h: (em_utils_forward_message_raw):
	* em-composer-utils.c: (emu_forward_raw_done),
	(em_utils_forward_message_raw):
	* mail-session.c: (ms_forward_to), (class_init):
	Implement "forward-to" rule for message filters.

2009-01-13  Felix Riemann  <friemann@svn.gnome.org>

	** Fix for bug #563867

	* em-folder-view.c (emp_uri_popup_link_copy):
	* em-popup.c (emp_uri_popup_link_open):
	* em-utils.c (em_utils_url_unescape_amp):
	* em-utils.h:
	Unescape "&amp;" when passing the link to browsers. 

2009-01-12  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #566653

	* mail-folder-cache.c: (folder_changed): Fix a leaked info

2009-01-11  Matthew Barnes  <mbarnes@redhat.com>

	* em-config.c:
	* em-menu.c:
	Remove unneeded #include <libgnome/gnome-url.h>

	* em-folder-view.c (emfv_format_link_clicked):
	* em-popup.c (emp_uri_popup_link_open):
	Call e_show_uri() instead of gnome_url_show().

2009-10-10  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view.c:
	* importers/mail-importer.c:
	Remove unneeded #include <libgnome/gnome-util.h>.

2009-01-10  Matthew Barnes  <mbarnes@redhat.com>

	* mail-autofilter.c:
	Remove unneeded #include <libgnomeui/gnome-app.h>.
	Remove unneeded #include <libgnomeui/gnome-app-helper.h>.

2009-01-10  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #567280

	* message-tag-followup.c:
	Remove unneeded #include <libgnomeui/gnome-pixmap.h>.

2009-01-10  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #567285

	* mail-autofilter.c:
	Remove unneeded #include <libgnomeui/gnome-popup-menu.h>.

2009-01-09  Takao Fujiwara  <takao.fujiwara@sun.com>

	Reviewed by Matthew Barnes  <mbarnes@redhat.com>

	* Fix for bug #566011

	* mail-component.c (mail_component_class_init):
	Include <glib/gi18n-lib.h> instead of <glib/gi18n.h> and
	add bindtextdomain().

2009-01-08  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #565376

	* vfoldertypes.xml:
	* searchtypes.xml: Merge some search types together.
	* em-vfolder-context.c: (vfolder_new_element): More elements.
	* em-filter-folder-element.h: (struct _EMFilterFolderElement):
	* em-filter-folder-element.c: (xml_encode), (xml_decode),
	(folder_selected), (get_widget), (format_sexp):
	Support storing folder uri in a camel's way.

	* em-format-html-display.c: (efhd_use_component):
	Compiler warning fix.

2008-12-29  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #565857

	* e-searching-tokenizer.c (searcher_next_token):
	The HTMLTokenizer now expects a newly-allocated string from its
	next_token() method, so duplicate the returned string.  This fixes
	a memory leak whereby previously, some implementations of next_token()
	did return a newly-allocated string, some did not.  Those that did
	leaked those strings.

2008-12-22  Sankar P  <psankar@novell.com>

	** Part of fix for bug #559153

	* em-migrate.c (update_progress_in_main_thread), (migrate_folders),
	(count_folders), (migrate_folders_to_db_thread), (migrate_to_db),
	(em_migrate):
	Migration Improvements

2008-12-22  Norman Wang  <zhichao.wang@sun.com>

   ** Fix for bug #558337

   * mail/em-subscribe-editor.c: Create a wrapper class MailMsgListNode of
   _zsubscribe_msg message. The MailMsgListNode class is the subclass of
   EDListNode class. So the _zsubscribe_msg can be added into the EDList.

2008-12-16  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #552583

	* mail-config.c: (mail_config_get_account_by_source_url),
	(mail_config_get_account_by_transport_url): Do not leak.

2008-12-15  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #564007

	* em-format.c: (emf_inlinepgp_encrypted): Guess the decrypted
	part mime type if not known from the decryptor, thus show the
	content really inline, if possible.

2008-12-15  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #563669

	* em-account-editor.c: (emae_option_checkspin):
	Use zero GtkSpinButton's PageSize, as Gtk+ requires.

2008-12-15  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c: Fix a impllicit warning

2008-12-15  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #552583

	* mail-config.c: (mail_config_get_account_by_transport_url): Free the
	right url.

2008-12-15  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for #546637

	* message-list.c: (message_list_finalise), (regen_list_exec),
	(regen_list_done): Don't loose uids.

2008-12-15  Srinivasa Ragavan  <sragavan@novell.com>


	* em-format-html-display.c: (efhd_bonobo_unknown),
	(efhd_find_handler), (efhd_bonobo_object),
	(efhd_check_server_prop), (efhd_use_component),
	(efhd_format_attachment): Restore the code for BONOBO components need
	by the vcard inline viewer.

2008-12-15  Srinivasa Ragavan  <sragavan@novell.com>

	* em-account-editor.c: (emae_option_checkspin):
	* em-folder-tree.c: (emft_popup_uvfolder), (emft_popup): Add the
	unread vfolder hack.

2008-12-15  Lucian Langa  <lucilanga@gnome.org>

	** Fixes bug #564519

	* mail-send-recv.c: (build_dialog):
	Count also deleted unsent messages when displaying SMTP server

2008-12-13  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #564351 (patch by Tal Benavidor)

	* em-icon-stream.c:
	Fix single-header include issue for GdkPixbuf.

2008-12-10  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #552357

	* e-searching-tokenizer.c: (e_searching_tokenizer_begin):
	Function prototype changed.

2008-12-10  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #563870

	* vfoldertypes.xml:
	* filtertypes.xml:
	* searchtypes.xml: Use dynamic filter option.
	* message-list.c: Drop unused header include.

2008-12-09  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #552583

	* mail-config.c: (mail_config_get_account_by_source_url),
	(mail_config_get_account_by_transport_url): Extending Sankar's fix
	of account checking logic a bit, to be more consistent.

2008-12-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #563369

	* em-folder-properties.c: (emfp_dialog_got_folder_quota):
	* em-folder-tree-model.c: (em_folder_tree_model_set_folder_info):
	* mail-component.c: (view_changed): Translate "Templates" folder name.

2008-12-09  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #563669

	* mail-config.glade:
	Use zero GtkSpinButton's PageSize, as Gtk+ requires.

2008-12-08  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #337082

	* em-folder-tree.c: (emft_tree_row_expanded): Do not set we finished
	with loading until we are really done with it. The previous behavior
	can cause duplicate nodes in tree for subscribed folders.

2008-12-08  Sankar P  <psankar@novell.com>

	** Fixes bug #552583

	* mail/mail-config.c: (mail_config_get_account_by_source_url)
	(mail_config_get_account_by_transport_url):
	Fix the errors in the account checking logic.

2008-12-04  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #552583

	* mail-config.c (mail_config_get_account_by_source_url),
	(mail_config_get_account_by_transport_url):
	For the purpose of matching a URL to an EAccount, only compare
	the protocol, user, host and port and disregard the rest.

2008-11-23  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #552850

	* evolution-mail.schemas.in:
	Prefer the term "side bar" over "folder tree".

2008-11-19  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #555276

	* mail/mail-vfolder.c: Don't load vfolder as subfolder.

2008-11-13  Bharath Acharya  <abharath@novell.com>

	* em-folder-view.c: (emfv_setting_notify):
	* em-format-html.c: (efh_format_headers): Do not display the default 
	headers when all the headers are disabled in Mail preferences.

2008-11-12  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #524377

	* mail-config.glade:
	* evolution-mail.schemas.in:
	* em-composer-prefs.c: (em_composer_prefs_construct):
	* mail-config.c: (gconf_outlook_filenames_changed), (mail_config_init):
	Declare, be able to change and listen to changes on new key,
	'/apps/evolution/mail/composer/outlook_filenames' to encode file names
	header in camel based on the RFC 2047, instead of the correct RFC 2231.

2008-11-07  Matthew Barnes  <mbarnes@redhat.com>

	** Fix for bug #552583

	* mail-config.c: (mail_config_get_account_by_source_url): 
	Instead of preserving the authmech attribute in the two URLs 
	being compared, strip the attributes out of both URLs and just do 
	a simple string comparison.  We're just trying to match a URL to 
	an account here.  The authentication method shouldn't be relevant.

2008-11-07  Bharath Acharya  <abharath@novell.com>

	** Fix for BNC bug #437226

	* em-format-html.c (efh_format_headers): Regression caused by r35319.
	Check for the condition only after the while loop.
	
2008-11-05  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #559371

	* em-composer-prefs.c (spell_language_save), (spell_setup):
	Simplify the logic by using e_load_spell_languages() and
	e_save_spell_languages().

2008-11-04  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #386036

	* vfoldertypes.xml:
	* filtertypes.xml: Added new option "Sender or Recipients" which
	filters on From/To/Cc/Bcc headers.

2008-11-02  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #559042

	* mail-config.glade:
	Remove extra space in translated string.

2008-11-02  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #557613

	* em-utils.c (try_open_e_book):
	Wait for try_open_e_book_cb() to run before freeing the EFlag.
	It will run regardless of whether the EBook operation completes.

2008-10-31  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #558726 (patch by Frederic van Starbmann)

	* em-format-html.c (emfh_multipart_related_check):
	Fix a potential format string crash.

2008-10-31  Sankar P  <psankar@novell.com>

	** Patch by Bharath Acharya <abharath@novell.com> 

	* em-folder-tree.c (emft_popup):
	Disable delete and rename on 
	right click menu for the system folders 

2008-10-22  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c:
	* mail-send-recv.h:
	Just some minor code polishing.

2008-10-21  Sankar P  <psankar@novell.com>

	* em-folder-view.c (emfv_spin):
	Re-factor spinner usage	

2008-10-20  Patrick Ohly  <Patrick.Ohly@gmx.de>

	* mail-component.h: Fixed a build break.

2008-10-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #438155

	* message-list.h: (struct _MessageList):
	* message-list.c: (message_list_init), (message_list_finalise),
	(regen_list_done), (regen_list_free), (ml_regen_timeout),
	(mail_regen_cancel): Guard access to the 'regen' list with a lock.

2008-10-17  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #555276

	* mail/mail-vfolder.c: Don't load a vfolder as a sub folder.

2008-10-17  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #364542

	* em-utils.c: (struct TryOpenEBookStruct), (try_open_e_book_cb),
	(try_open_e_book), (em_utils_in_addressbook), (em_utils_contact_photo):
	Stop when camel operation has been canceled. Also check for
	cancellation when opening EBook, thus the UI (preview) will
	not freeze with slow address books.

2008-10-07  Bharath Acharya  <abharath@novell.com>

	** Fix for bug #555203

	* mail-session.c: (get_password): Use the url value in cases where the 
	account goes NULL. Fixes the issue of Exchange not sending mails, 
	because it does not have a valid transport url to use.

2008-10-05  Sankar P  <psankar@novell.com>

	** Fix for bug #554349

	* mail/em-folder-browser.c:
	Expand threads and select messages,
	if user has given select-all.

2008-10-01  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #554418

	* em-utils.c: (em_utils_snoop_type):
	* em-popup.c: (emp_standard_menu_factory):
	Guess mime_type based on the filename only.

2008-10-01  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #554458

	* em-popup.c: (emp_standard_menu_factory):
	Use content-type to call of g_app_info_get_all_for_type.

2008-10-01  Sankar P  <psankar@novell.com>

License Changes

	* em-composer-utils.c:

2008-09-30  Philip Withnall  <philip@tecnocode.co.uk>

	** Fix for bug #545045

	* mail-send-recv.c (build_dialog): Don't show SMTP in the
	Send/Receive dialogue if there are no unsent mails.

2008-09-30  Sankar P  <psankar@novell.com>

License Changes

	* mail-ops.c:

2008-09-30  Sankar P  <psankar@novell.com>

	* mail/message-list.c:
	Remove unnecessary FIXME. 
	normalized columns are for internal manipulation.

2008-09-30  Sankar P  <psankar@novell.com>

	** Committed on behalf of Hans Petter Jansson  <hpj@novell.com>

	** Fix for bug #554107

	* message-list.c (get_trimmed_subject), (ml_tree_value_at):
	* message-list.etspec:
	* message-list.h:
	Add "Subject - Trimmed" column which enables to read 
	mailing list mails in a better way.

2008-09-29  Gabor Kelemen  <kelemeng@gnome.hu>

	* mail-config.glade: Mark some forgotten strings for translation. Fixes bug #553067

2008-09-29  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #530716

	* mail-session.c: (user_message_response), (user_message_exec),
	(user_message_response_free): Differentiate between response
	with valid message pointer and with one already freed.

2008-09-29  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #530691

	* em-folder-utils.c: (emfu_delete_rec), (emfu_delete_done),
	(emfu_delete_folders), (emfu_delete_response),
	(em_folder_utils_delete_folder):
	* mail-ops.h: (mail_remove_folder):
	* mail-ops.c: (mail_remove_folder), (struct _remove_folder_msg),
	(remove_folder_desc), (remove_folder_rec), (remove_folder_exec),
	(remove_folder_done), (remove_folder_free):
	Remove folders in its own thread, not in main thread.

2008-09-29  Sankar P  <psankar@novell.com>

License Changes

	* em-filter-i18n.h:
	* em-utils.c:
	* importers/mail-importer.c:
	* mail-config.c:
	* message-list.c:

2008-09-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #552583 (Suggested by Sebastian Keller)

	* mail-session.c: (get_password):
	Do not hide auth_mech from the URL.

2008-09-25  Philip Withnall  <philip@tecnocode.co.uk>

	** Fix for bug #552551

	* em-folder-browser.c (emfb_search_search_activated): Add a NULL
	check for search_word before calling strcmp.

2008-09-25  Sankar P  <psankar@novell.com>

License Changes

	* mail-folder-cache.c:

2008-09-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #313225

	* message-list.c: (struct states_pixmaps), (ml_tree_value_at),
	(message_list_create_extras): Show meeting icon in 'Attachment'
	column on messages with '$has_cal' user flag set.

2008-09-24  Sankar P  <psankar@novell.com>

License Changes

	* em-folder-browser.c:

2008-09-24  Philip Withnall  <philip@tecnocode.co.uk>

	** Fixes bug #553479

	* em-migrate.c (migrate_to_db):
	* evolution-mail.schemas.in: String capitalisation improvements.

2008-09-23  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #553273

	* em-composer-utils.c: (em_utils_handle_receipt):
	* em-folder-view.c: (emfv_delete_msg_response):
	Always end e_error_run/e_error_new calls with NULL parameter.

2008-09-22  Luca Ferretti  <elle.uca@libero.it>

	* default/Makefile.am:
	* default/it/Inbox:
	* default/it/Makefile.am:
	Added Italian translation for default email message.

2008-09-22  Petr Kovar  <pknbe@volny.cz>

	* default/cs/Inbox: Added Czech translation of default email
	message by Jiri Eischmann.
	* default/cs/Makefile.am: Ditto.
	* default/Makefile.am: Ditto.

2008-09-21  Wadim Dziedzic  <wdziedzic@aviary.pl>

	* default/pl/Inbox: Updated Polish translation

2008-09-19  Gintautas Miliauskas  <gintas@akl.lt>

	* default/lt/Inbox: Updated Lithuanian translation.

2008-09-19  Sankar P  <psankar@novell.com>

License Changes

	* em-folder-tree-model.c:
	* em-folder-tree.c:
	* em-folder-view.c:
	* em-format-html-display.c:
	* em-format-html.c:
	* em-migrate.c:
	* mail-component.c:

2008-09-17  Gabor Kelemen  <kelemeng@gnome.hu>

	* default/hu/Makefile.am: Add this too

2008-09-17  Gabor Kelemen  <kelemeng@gnome.hu>

	* default/hu/Inbox: Default welcome mail translation added.
	* default/Makefile.am: Added hu

2008-09-16  Goran Rakić  <grakic@devbase.net>

        * default/Makefile.am:
        * default/sr/*, default/sr@latin/*: Added Serbian welcome message translation.

2008-09-16  Sankar P  <psankar@novell.com>

License Changes

	* em-account-editor.c:
	* em-account-prefs.c:
	* em-format.c:
	* em-message-browser.c:
	* em-popup.c:
	* em-subscribe-editor.c:
	* importers/pine-importer.c:
	* mail-mt.c:
	* mail-send-recv.c:

2008-09-16  Wouter Bolsterlee  <wbolster@svn.gnome.org>

	* default/nl/Inbox: Updated Dutch translation by Tino Meinen.

2008-09-16  Ilkka Tuohela <hile@iki.fi>

	* default/fi/Inbox: Updated Finnish default mailbox.

2008-09-16  Claude Paroz  <claude@2xlibre.net>

	* default/fr/Inbox: Updated French translation.

2008-09-15  Daniel Nylander <po@danielnylander.se>

	* default/sv/Inbox: Updated Swedish translation.

2008-06-22  Sankar P <psankar@novell.com>

	* Committed on behalf of Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #539536

	* em-format.c: (struct default_headers):
	* em-format-html.c: (efh_format_headers):
	* em-format-html.c: (default_headers):
	Add "Face" header to default headers and allow it to be hidden.

2008-09-14  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #504767

	* em-folder-tree.c: (emft_expand_node):
	Expand also parent nodes, if necessary.

2008-09-14  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #551915

	* em-junk-hook.c: (struct manage_error_idle_data), (free_mei),
	(manage_error_idle), (manage_error):
	Manage error on idle, to call gtk functions in the main thread.

2008-09-12  Sankar P  <psankar@novell.com>

License Changes

	* em-icon-stream.c:
	* em-mailer-prefs.c:
	* em-mailer-prefs.h:
	* em-network-prefs.c:
	* em-network-prefs.h:
	* importers/evolution-mbox-importer.c:

2008-09-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #534039

	* mail-vfolder.c: (vfolder_load_storage): Load store to mail component
	first, to have all notifications registered in time of adding rules.
	* mail-folder-cache.c: (real_flush_updates): Dropped unnecessary and
	offending code causing infinite loops when deleting search folder.

2008-09-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #493298

	* em-format-html-display.c: (efhd_image): Do not try to access widget
	of the pury when the operation has been cancelled.

2008-11-03  Ashish Shrivastava  <shashish@novell.com>

	** Support for Non-intrusive error in calendar.

	* mail-component.c: Remove common code between
	  mailer and calendar and moved to
	  e-util/e-non-intrusive-error-dialog.c

2008-09-08  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #328216

	* mail-send-recv.h: (mail_autoreceive_init):
	* mail-send-recv.c: (mail_autoreceive_init):
	* mail-component.c: (mail_component_init): Pass 'session' as parameter
	to the 'mail_autoreceive_init' to not create two MailComponents.
	* mail-component.c: (impl_finalize): Do not free pointer twice.
	* mail-component.c: (impl_finalize), (impl_quit): Call shutdown in time
	of quit to shutdown camel, which will store changes in 'camel-cert.db'.

2008-09-05  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-folder-cache.c (real_flush_updates): Fix infinite loop on
	deleting vfolders.

2008-09-04  Sankar P  <psankar@novell.com>

License Changes

	* em-composer-prefs.c:
	* em-event.c:
	* em-folder-properties.c:
	* em-folder-selection-button.c:
	* em-vfolder-rule.c:
	* em-vfolder-rule.h:
	* mail-config.h:
	* mail-session.c:

2008-09-02  Sankar P  <psankar@novell.com>

License Changes

	* e-searching-tokenizer.c:
	* em-account-editor.h:
	* em-composer-prefs.h:
	* em-config.c:
	* em-config.h:
	* em-filter-context.c:
	* em-filter-editor.c:
	* em-filter-rule.c:
	* em-filter-source-element.c:
	* em-filter-source-element.h:
	* em-folder-tree-model.h:
	* em-folder-utils.c:
	* em-folder-utils.h:
	* em-folder-view.h:
	* em-format-hook.c:
	* em-format-html-print.h:
	* em-format-quote.h:
	* em-icon-stream.h:
	* em-inline-filter.c:
	* em-junk-hook.c:
	* em-menu.c:
	* em-migrate.h:
	* em-stripsig-filter.h:
	* em-sync-stream.c:
	* em-utils.h:
	* em-vfolder-editor.h:
	* importers/elm-importer.c:
	* mail-autofilter.c:
	* mail-autofilter.h:
	* mail-component-factory.c:
	* mail-component.h:
	* mail-config-factory.h:
	* mail-crypto.c:
	* mail-crypto.h:
	* mail-folder-cache.h:
	* mail-mt.h:
	* mail-ops.h:
	* mail-send-recv.h:
	* mail-session.h:
	* mail-signature-editor.c:
	* mail-tools.c:
	* mail-tools.h:
	* mail-vfolder.c:
	* mail-vfolder.h:
	* message-list.h:

2008-09-01  Matthew Barnes  <mbarnes@redhat.com>

	* em-composer-utils.c (edit_message):
	Don't mix declarations and code.

2008-09-01  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #543135

	* em-format-html-display.c: (efhd_format_optional):
	Write error message to the right stream.
	* message-list.c: (mail_regen_list), (regen_list_done): Do not try
	to set information message to the message list when it's not visible.

2008-09-01  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #534039

	* mail-folder-cache.c: (real_flush_updates): Make sure search folder's
	unread count will be tracked properly in a tree even before the folder
	is opened in the UI. (The previous patch for this bug made this issue.)

2008-09-01  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #549661

	* em-folder-tree.c: (emft_drop_async__exec): Use
	em_utils_selection_get_urilist() for DND_DROP_TYPE_TEXT_URI_LIST (and
	not em_utils_selection_get_mailbox()).

2008-08-31  Matthew Barnes  <mbarnes@redhat.com>

	** Fix bug #544430

	* em-folder-properties.c (emfp_get_folder_item):
	Better formed translatable strings for quota usage.

2008-08-30  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/mail-component.c: Disable flag upsync. I need to implement it
	more intelligently.

2008-08-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #509647

	* em-folder-utils.c: (emft_copy_folders__exec):
	* mail-ops.c: (fetch_mail_exec), (send_queue_exec):
	Do not expunge folder when something goes wrong.

2008-08-27  Philip Withnall  <philip@tecnocode.co.uk>

	** Fix for bug #534762

	* evolution-mail.schemas.in:
	* mail-config.glade: Change "addressbook" to "address book" in
	translatable strings.

2008-08-27  Sankar P  <psankar@novell.com>

License Changes

	* e-searching-tokenizer.h:
	* em-account-prefs.h:
	* em-composer-utils.h:
	* em-event.h:
	* em-filter-context.h:
	* em-filter-editor.h:
	* em-filter-folder-element.c:
	* em-filter-folder-element.h:
	* em-filter-rule.h:
	* em-folder-browser.h:
	* em-folder-properties.h:
	* em-folder-selection-button.h:
	* em-folder-selection.c:
	* em-folder-selection.h:
	* em-folder-selector.c:
	* em-folder-selector.h:
	* em-folder-tree.h:
	* em-format-hook.h:
	* em-format-html-display.h:
	* em-format-html-print.c:
	* em-format-html.h:
	* em-format-quote.c:
	* em-format.h:
	* em-html-stream.c:
	* em-html-stream.h:
	* em-inline-filter.h:
	* em-junk-hook.h:
	* em-menu.h:
	* em-message-browser.h:
	* em-popup.h:
	* em-search-context.c:
	* em-search-context.h:
	* em-stripsig-filter.c:
	* em-subscribe-editor.h:
	* em-sync-stream.h:
	* em-vfolder-context.c:
	* em-vfolder-context.h:
	* em-vfolder-editor.c:
	* importers/mail-importer.h:
	* mail-config-factory.c:
	* mail-signature-editor.h:
	* mail-types.h:
	* message-tag-editor.c:
	* message-tag-editor.h:
	* message-tag-followup.c:
	* message-tag-followup.h:

2008-08-20  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #546926

	* mail-session.c (mail_session_shutdown):
	New function simply calls camel_shutdown().

	* mail-component.c (impl_finalize):
	Call mail_session_shutdown().

2008-08-18  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #508732

	* mail-component.c (impl_createView):
	Add a "select_item" argument for crash recovery, which we forward
	to EMFolderBrowser as a "suppress_message_selection" flag.

	* em-folder-browser.c (emfb_set_folder):
	Suppress automatic message selection if we are recovering from a
	crash.

2008-08-16  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #513363

	* default/C/Inbox:
	Remove the outdated "New Features" list, and well as the incorrect
	"Evolution team" email address.

2008-08-14  Sebastien Bacher  <seb128@ubuntu.com>

	** Fix for bug #547805

	* em-popup.c: (emp_standard_menu_factory): 
	don't filter applications using g_app_info_should_show()

2008-08-13  Moritz Mertinkat  <moritz@mertinkat.net>

	* em-format-html.c: Added meaningful user agent for HTTP requests
	used to load remote images. The original part (CamelHttpStream/1.0)
	has been kept for backward compatibility.

2008-08-12  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #519292

	* message-list.c: (read_boolean_with_default),
	(message_list_construct): Read 'thread_expand' and 'thread_latest'
	safely with TRUE as default if key doesn't exist.

2008-08-11  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #546892

	* em-folder-browser.c:
	* em-format-html-display.c:
	* mail-send-recv.c:
	* message-tag-followup.c:
	Prefer gtk_image_new_from_icon_name() over e_icon_factory_get_image().

	* mail-send-recv.c:
	* message-tag-followup.c:
	Prefer gtk_window_set_icon_name() over gtk_window_set_icon_list().

	* mail-mt.c:
	e_activity_handler_cancelable_operation_started() no longer takes a
	GdkPixbuf.  It was ignoring the pixbuf anyway ever since we added a
	spinner icon.

2008-08-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #519292

	* message-list.c: (load_tree_expand_all): Drop function.
	* message-list.c: (regen_list_done): Rather use desired expanded state
	value when creating the tree instead of the default model's value for
	this to have 'expand/collapse all' commands work better and quicker.

2008-08-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #352695

	* message-list.c: (struct _MessageListPrivate), (save_tree_state),
	(load_tree_state), (on_model_row_changed), (message_list_init),
	(message_list_construct), (struct _regen_list_msg), (regen_list_done),
	(regen_list_free), (mail_regen_list): Be able to recognize whether
	there has been any change on any row in a list and save expanded
	state only in case there was any change. Also use in-memory storing
	of the expanded state in case we do not want to rewrite full view
	It's for searches only, and it's not stored between sessions.

2008-08-11  Srinivasa Ragavan  <sragavan@novell.com>

	** Part fix for bug #529743

	* searchtypes.xml: Support Subject or Recipients contain search.

2008-08-11  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/message-list.c: Don't use uninitialized exception. It leads to
	freeing uninitialized memory.

2008-08-07  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #546788

	* em-folder-view.c: "/commands/ViewNormal" isn't actually used. It is
	probably a leftover from a previous way of setting the formatting
	style. It can be removed. Related cleanups.

2008-08-06  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #546668

	* em-format-html.c: Drop a (pointless) define used only once.
	* em-format-html-display.c: Drop one unused define.

2008-08-07  Matthew Barnes  <mbarnes@redhat.com>

	* em-format.c (emf_format_secure):
	* em-format-html-display.c (efhd_xpkcs7mime_add_cert_table):
	Use CamelDList instead of EDList.

2008-08-06  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #249844

	* em-event.h: (struct _EMEventTargetCustomIcon): Declare 'folder_name'
	as const char * to let compiler happy; no copy of the pointer anyway.
	* mail-component.c: (impl__get_userCreatableItems):
	Do not let compiler claim.

2008-08-05  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/message-list.c: Fix a performance issue, where we can just go
	by the presence than the exact count.

2008-08-04  Matthew Barnes  <mbarnes@redhat.com>

	* em-migrate.c (migrate_to_db):
	* em-network-prefs.c (notify_proxy_type_changed),
	(widget_entry_changed_cb):
	* em-subscribe-editor.c (sub_fill_level), (sub_queue_fill_level),
	(sub_row_expanded):
	* mail-vfolder.c:
	Use G_STRLOC or G_STRFUNC instead of deprecated
	G_GNUC_PRETTY_FUNCTION.

2008-08-04  Paul Bolle <pebolle@tiscali.nl>

	** Fix for bug #543058

	* em-folder-properties.c (emfp_dialog_got_folder_quota):
	* mail-component.c (view_changed): Replace three occurrences of
	INBOX in the GUI code with Inbox. INBOX is a written in all caps
	because that is the way it is used in the IMAP protocol. There's
	little reason to use it in the GUI. Inbox is properly capitalized and
	can be localized too.

2008-08-04  Paul Bolle  <pebolle@tiscali.nl>

	** Further fix for bug #539268

	* em-format.c (em_format_describe_part): Do not append description 
	if it is just an empty string.

2008-08-04  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #249844

	* em-folder-tree.c (render_display_name):
	* mail-component.c (impl__get_userCreatableItems):
	Use C_() macro instead of Q_() macro. 
	Use fully qualified names for "New" submenu entries. 

2008-08-04  Paul Bolle  <pebolle@tiscali.nl>

	** Fixes bug #537088

	* em-format-html.c: (efh_format_headers): Break out of the loop rather
	that return from this function when running into an empty From: or
	Sender: header.

2008-08-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #514006

	* apps-evolution-mail-notification.schemas.in:
	Quote literal values.

2008-08-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #544859

	* evolution-mail.schemas.in:
	Clarify description of "sync_interval" key.

2008-08-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #545820

	* mail-ops.c (save_messages_desc): Fix a typo. (Nicolas Kaiser)

2008-07-31  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #545436

	* mail/message-list.c: Check the info before accessing it.

2008-07-30  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #500389

	* em-account-editor.c: (emae_option_options_changed),
	(emae_option_options), (emae_receive_options_extra_item):
	New ability to define Options (ComboBox) in provider's options.

2008-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-folder-tree.c: Kill a compilation warning.

2008-07-28  Lucian Langa  <lucilanga@gnome.org>

	* mail/mail-config.glade:
	Corrected string "Prompt on sending HTML.."

2008-07-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #543532

	* em-folder-tree-model.c: (em_folder_tree_model_remove_store_info):
	Let free memory when we are done with it, not before.

2008-07-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #256540

	* mail-dialogs.glade: (message_security_dialog):
	Do not use GtkNotebook with only one tab.

2008-07-28  Lucian Langa  <lucilanga@gnome.org>

	* mail/mail-config.glade:
	** See bug #504417: Preferences windows
	cut off

2008-07-28 Jeff Cai <jeff.cai@sun.com> 

	* em-migrate.c: (migrate_to_db):
	* em-network-prefs.c: (notify_proxy_type_changed),
	(widget_entry_changed_cb):
    Use G_GNUC_PRETTY_FUNCTION instead of __PRETTY__FUNCTION

2008-07-27  Lucian Langa <lucilanga@gnome.org>

	* mail/em-event.h (struct _EMEventTargetCustomIcon):
	* mail/em-event.c (em_event_target_new_custom_icon):
	* mail/em-folder-tree.c (render_pixbuf):
	** See bug #544969: Added the hook for folder
	custom icon.

2008-07-28  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #543411

	* mail/em-folder-tree-model.c: Dont load known folders.
	* mail/em-folder-tree.c: Move iter to the last entry.

2008-07-25  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-folder-browser.c: Make show unread/etc work well.

2008-07-24  Sankar P  <psankar@novell.com>

	* em-folder-browser.c (get_view_query):
	Search by Labels.

2008-07-24  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-folder-browser.c: Revert Sankar's search hacks.

2008-07-22  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #544022

	* e-searching-tokenizer.c: (dump_trie):
	Define function only when required. (Compiler warning cleanup.)

2008-07-21  Tor Lillqvist  <tml@novell.com>

	* em-migrate.c: Rearrange G_OS_WIN32 ifdefs a bit, as we need to
	compile more of this file to support upgrade attempts from 2.12
	and later.
	(migrate_folders): Guard against camel_store_get_folder()
	returning NULL, which happened at least for me. It was for a
	partially broken GroupWise folder structure on disk, so that is a
	case of garbage in--garbage out I guess, but it can't hurt to be
	careful...

2008-07-21  Bharath Acharya  <abharath@novell.com>

	Fixed some compiler warnings for Templates specific hunk.

	* em-composer-utils.c: (edit_message):

2008-07-20  Bharath Acharya  <abharath@novell.com>

	** Fix for bug #200147
	Added basic Template support

	* em-composer-utils.c (edit_message), (em_utils_edit_message): Modified 
	to suit it better for plugins to use it. And added support for template 
	placeholders to be replaced in the messages.
	* em-composer-utils.h:
	* em-folder-tree.c (is_special_local_folder):
	* em-folder-utils.c (emfu_is_special_local_folder):
	* em-folder-view.c (em_folder_view_open_selected):
	* em-utils.c (em_utils_folder_is_templates):
	* em-utils.h:
	* mail-component.c:
	* mail-component.h:

2008-07-16  Sankar P  <psankar@novell.com>

	Pushing disk summary changes from the madagascar branch

	* em-folder-browser.c (get_view_query):
	* em-folder-view.c (emfv_enable_menus):
	* mail-ops.c (refresh_folder_exec):
	* message-list.c (regen_list_exec):

2008-07-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #269152

	* em-format-quote.c: (emfq_format_header):
	* em-format-html.c: (efh_format_headers):
	Use X-MimeOLE as Mailer header when there's nothing better available.

2008-07-09  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #228725

	* message-list.c: (mail_regen_list): Update empty message on regen.

2008-07-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #207802 (Patch suggested by Veerapuram Varadhan.)

	* message-list.c: (struct search_child_struct), (search_child_cb),
	(is_tree_widget_children), (ml_tree_drag_motion): Do not allow drop
	messages to the same message list as is the source. Also do not
	allow drop over message list if it doesn't have set a folder.

2008-07-03  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #541365

	* message-list.c: (message_list_get_uids), (message_list_get_selected):
	Do not call 'camel_folder_sort_uids' when we do not have folder or uid.

2008-07-02  Jeffrey Stedfast  <fejj@novell.com>

	Sort the uids so that moving/copying messages preserves mailbox
	ordering rather than jumbled randomness.

	* message-list.c (message_list_get_uids): Sort the uids.
	(message_list_get_selected): Same.

2008-06-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #540160

	* message-list.h: (struct _MessageList):
	* message-list.c: (message_list_init), (on_cursor_activated_cmd),
	(on_selection_changed_cmd): Remember whether we come from none/multi
	select to single select and properly update the preview.
	(Reverting patch for bug #337160 and doing that with other approach.)

2008-06-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #537275

	* em-html-stream.c: (emhs_cleanup): Close GtkHTMLStream on cancel.
	* em-html-stream.c: (emhs_gtkhtml_destroy): Set the cancel.
	* em-sync-stream.c: (emss_process_message):
	Do not pass data to the child structure if we were canceled.

2008-06-21  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #539268

	* em-format.c: (em_format_describe_part): do not use both filename
	and description if these are identical.

2008-06-21  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #538741

	* em-format-html.c: (efh_format_header):
	Strip preceding tabs from Date headers too.

2008-06-21  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #537725

	* em-composer-utils.c (save_draft_done):
	Set the autosaved flag so we don't get pestered with a save dialog
	if the user then decides to close the composer window.

2008-06-20  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #534039

	* em-folder-tree-model.h: (em_folder_tree_model_signal_block):
	* em-folder-tree-model.c: (em_folder_tree_model_signal_block):
	Removed obsolete function.
	* mail-vfolder.c: (vfolder_load_storage):
	Add storage to the tree model when everything is loaded, thus
	everything will be shown when enabling the Search Folders on demand.
	Also ensure the Search Folders to be enabled next start.
	* mail-vfolder.c: (mail_vfolder_add_uri), (mail_vfolder_delete_uri):
	Track folders even when Search Folders disabled, to have them
	known when enabling Search Folders on demand.

2008-06-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #382783

	* em-filter-rule.c: (do_grab_focus_cb), (more_parts), (get_widget):
	Grab focus of new rule part on adding and scroll to the bottom too.

2008-06-18  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #423395

	* em-format-html.c: (efh_init), (efh_text_plain), (efh_text_enriched),
	(efh_text_html), (efh_message_deliverystatus): Put the anchor where
	the message body begins and let GtkHTML know the anchor name to place
	the cursor there in caret mode on the first focus.

2008-06-18  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #532472

	* mail-config.c (mail_config_get_account_by_transport_url):
	Strip the account URL (via CAMEL_URL_HIDE_ALL) before comparing
	it to the already-stripped 'transport_url', to avoid unnecessary
	password prompts.

2008-06-16  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #467892

	* message-list.h: (struct _MessageList), (message_list_ensure_message):
	* message-list.c: (message_list_init), (message_list_finalise),
	(message_list_ensure_message), (regen_list_exec), (regen_list_done):
	Be able to set a message uid to keep in a list after regeneration.
	* em-folder-view.c: (em_folder_view_open_selected):
	Inherit search criteria and ensure keeping the selected message
	in the view even it may not belong to the filter anymore.

2008-06-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #337160

	* message-list.c: (on_cursor_activated_cmd): Do not pretend the row
	with a cursor is selected when it isn't. Also take care of multiselect.
	* message-list.c: (on_selection_changed_cmd):
	Do not pretend the row with a cursor is selected when it isn't.

2008-06-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #538002

	* em-folder-tree.c: (emft_drop_target): Do not allow dropping messages
	on folders with CAMEL_FOLDER_NOSELECT flag set.

2008-06-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #314467

	* em-account-editor.c: (emae_url_set_hostport):
	Reset port when setting host name without it.

2008-06-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #535791

	* mail-config.glade:
	* em-composer-prefs.c: (em_composer_prefs_construct):
	New UI option to let uset choose whether start typing at the bottom
	of the document or not on replying.
	* em-utils.h: (em_utils_message_to_html):
	* em-utils.c: (em_utils_message_to_html):
	* em-composer-utils.c: (forward_non_attached), (composer_set_body):
	Take care of /apps/evolution/mail/composer/reply_start_bottom.

2008-06-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #201011

	* em-filter-editor.c: (em_filter_editor_construct):
	Show Enabled column in the editor, because we support it here.
	* mail-session.c: (main_get_filter_driver): Skip disabled rules.

2008-06-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #536772

	* em-folder-browser.c: (EMFolderViewEnable emfb_enable_map):
	Disable Folder menu items consistently with a popup menu over folder.

2008-06-06  Matthew Barnes  <mbarnes@redhat.com>

	* evolution-mail.schemas.in: Fix a typo.

2008-06-05  Matthew Barnes  <mbarnes@redhat.com>

	* message-tag-followup.c:
	Never undefine DISABLE_DEPRECATED macros in source code.
	Yes, it will break the build if it's defined.  That's the point!

2008-06-02  Jacob Brown  <jeblinux@gmail.com>

	** Fix for bug #529464

	* em-format-html-display.c: (efhd_format_optional): Do not use "handle"

2008-06-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #535749

	* message-list.c: (regen_list_exec): Use better condition whether
	keep cursor_uid in the message list or not on regeneration.

2008-06-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #531836

	* em-folder-view.c:  Added bonobo accel key for Ctrl+D, Del to keep
	working on deleted mails, but not the toolbar/menu

2008-06-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #525966

	* em-composer-utils.c: (composer_set_no_change):
	New helper function to set composers state properly to "no change".
	* em-composer-utils.c: (em_utils_compose_new_message),
	(em_utils_compose_new_message_with_mailto), (em_utils_post_to_folder),
	(em_utils_post_to_url), (edit_message), (forward_attached),
	(forward_non_attached), (em_utils_redirect_message),
	(em_utils_reply_to_message), (post_reply_to_message):
	Use the above helper function.
	* em-composer-utils.c: (reply_get_composer), (composer_set_body):
	Do not drop undo in the editor multiple times, do that only once.

2008-06-02  Lucian Langa  <lucilanga@gnome.org>

	** Fix for bug #535689

	* mail-send-recv.c: (build_dialog): Transmit
	gd data to hook's event target data

2008-06-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #534312

	* em-composer-utils.c: (create_new_composer),
	(em_utils_compose_new_message), (struct forward_attached_data),
	(real_update_forwarded_flag), (update_forwarded_flags_cb),
	(composer_destroy_fad_cb), (setup_forward_attached_callbacks),
	(forward_attached), (forward_attached_cb), (em_utils_forward_attached),
	(forward_non_attached), (forward_quoted), (em_utils_forward_message):
	Set new CAMEL_MESSAGE_FORWARDED flag on forwarded messages.
	* message-list.c: (ml_value_to_string), (message_list_create_extras),
	(ml_tree_value_at), (create_composite_cell), (struct states_pixmaps):
	Draw mail-forward icon on forwarded messages.

2008-05-30  Lucian Langa  <lucilanga@gnome.org>

	** Fix for bug #535670

	* em-format-quote.c: (type_builtin_table):
	Add x-evolution/evolution-feed-rss as internal mime
	for evolution-rss artiles.
	* em-format.c: (em_format_is_attachment): prevent
	evolution-rss articles being formatted as attachments.

2008-05-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #317755

	* mail-send-recv.c: (refresh_folders_exec):
	* mail-ops.c: (refresh_folder_desc):
	Also sync with a server when refreshing folder.
	* evolution-mail.schemas.in:
	* mail-config.h: (mail_config_get_sync_timeout):
	* mail-config.c: (mail_config_get_sync_timeout):
	Use int value of /apps/evolution/mail/sync_interval where is set
	how often propagate local changes to server.
	* mail-component.c: (struct _MailComponentPrivate), (impl_dispose),
	(mc_sync_store_done), (mc_sync_store), (call_mail_sync),
	(mail_component_init): Upload local changes to server on some interval.
	* mail-component.c: (impl_quit):
	Do not quit until we are done with mail sync.

2008-05-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #322553

	* mail-config.h: (mail_config_scripts_disabled):
	* mail-config.c: (struct MailConfig), (mail_config_init),
	(mail_config_scripts_disabled): New helper function.
	* em-composer-prefs.c: (sig_load_preview):
	Write to html stream at least one character.
	* em-composer-prefs.c: (em_composer_prefs_construct): Disable
	signature's Add Script button when not approved running scripts.
	* mail-config.c: (mail_config_get_gconf_client): Ensure init.
	* mail-config.c: (mail_config_signature_run_script): Do not run
	script when disabled in /desktop/gnome/lockdown/disable_command_line.

2008-05-23  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #534476

	* em-utils.c (em_utils_snoop_type):
	* em-popup.c (emp_standard_menu_factory):
	Remove the special check for "winmail.dat".  GIO correctly
	identifies it as "application/ms-tnef".

2008-05-23  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-mt.c: (mail_msg_check_error): Convert the the warning to a
	message.

2008-05-22  Matthew Barnes  <mbarnes@redhat.com>

	* em-format-html.c (efh_message_external):
	Fix a typo in checking for an empty 'mode' string.

	* message-list.c (subtree_size):
	Remove this function.  Looks like it hasn't been used in years.

2008-05-22  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #534360

	* em-account-prefs.h:
	* em-filter-editor.c:
	* em-filter-editor.h:
	* em-folder-selector.h:
	* em-format-html-display.c:
	* em-mailer-prefs.c:
	* em-mailer-prefs.h:
	* em-utils.c:
	* em-vfolder-editor.c:
	* em-vfolder-editor.h:
	* em-vfolder-rule.c:
	* mail-vfolder.c:
	* meessage-tag-editor.h:
	* message-list.h:
	* message-tag-followup.h:
	Migrate from deprecated GtkObject symbols to GObject equivalents.

2008-05-19  Matthew Barnes  <mbarnes@redhat.com>

	* message-list.c (regen_list_done):
	Use a bit more direct English when informing the user of no messages
	in the currently selected folder.

2008-05-19  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #533465, patch from Ritesh Khadgaray

	* em-account-editor.c (emae_url_set_hostport):
	Strip whitespace from user-entered hostname.

2008-05-19  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-folder-view.c: Make non junk learn work again.

2008-05-16  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #514383

	* mail.error.xml: Remove the "ask-mark-read" error.

2008-05-14  Jeffrey Stedfast  <fejj@novell.com>

	Needed so that IMAP4 can allow users to configure cache
	expiration per-folder.

	* em-folder-properties.c (emfp_get_folder_item): Add support for
	CAMEL_ARG_INT and CAMEL_ARG_DBL.
	(emfp_commit): Same.

2008-05-14  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #463040, Patch by Milan Crha

	* em-folder-browser.c (emfb_list_message_selectedi), (emfb_set_folder):
	Forget former selected uid as soon as we know we moved to other.

2008-05-09  Sankar P  <psankar@novell.com>

	** Fix for bug #531519

	* em-format-html-display.c: (efhd_message_update_bar):
	Evolution crashes on print-preview.

	** Committed on behalf of Srinivasa Ragavan <sragavan@novell.com>

2008-05-06  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #424744

	* em-composer-prefs.c:
	* em-format-html.c:
	* em-format-quote.c:
	* em-mailer-prefs.c:
	Use camel-iconv.c instead of e-iconv.h (now deprecated).

2008-05-06  Matthew Barnes  <mbarnes@redhat.com>

	* mail-component.c (mail_component_show_logger):
	Use the GtkCellRendererText's "markup" property for error messages.

2008-05-05  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #531426

	* em-format-html.c (efh_format_headers):
	Display face header images at 48x48 instead of 64x64.
	Patch from Roland Clobus.

2008-05-04  Matthew Barnes  <mbarnes@redhat.com>

	* mail-component.c (mail_component_show_logger):
	Fix up the Debug Logs window a bit:
	- Add a Close button.
	- Fix some spacing issues (HIG compliance).
	- Just show the log level icon.  Add a tooltip for the icon showing
	  a description of the log level (Error/Warning/Debug).  Also, avoid
	  using e-icon-factory.  Set the GtkCellRendererPixbuf's "stock-id"
	  and "stock-size" properties instead.
	- Use GConfBridge to track the user's log level preference.

2008-04-30  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #528288

	* em-folder-browser.c: (emfb_init), (em_folder_browser_show_wide):
	Ensure minimum size for preview and message list.
	* em-folder-browser.c: (get_view_query):
	Distinguish between no filter and custom filter.
	* message-list.c: (regen_list_done):
	Set info message to tree when no message shown in a list.

2008-04-30  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #530245

	* searchtypes.xml: Let searches work with labels again.

2008-04-30  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #467892

	* em-folder-view.c: (em_folder_view_open_selected):
	Do not inherit search filters when opening messages in new window.
	* message-list.c: (regen_list_exec):
	If we are called from folder_changed even, then keep the actually
	selected message so it will not disappear when user reads it and
	it doesn't belong to actual filter anymore.

2008-04-30  Shuai Liu  <shuai.liu@sun.com>

	** Fix for bug #530672
	Evolution crashes when viewing pgp-signed message

	* em-format-html-display.c: Modify the array of smime_sign_colour 
	from 4 to 5 to ensure the input by data-server is right

2008-04-29  Milan Crha  <mcrha@redhat.com>

	* em-utils.c: (em_utils_snoop_type):
	Fixes compiler warning (unused variable).

2008-04-29  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #511337

	* em-format-html.h: (EMFormatHTMLState), (struct _EMFormatHTML):
	* em-format-html.c: (efh_init), (efh_format_done),
	(efh_format_timeout): Track state of the object to recognize
	whether rendering new content or doing nothing.
	* em-format-html-display.c: (efhd_can_process_attachment),
	(efhd_attachment_show), (efhd_attachment_popup),
	(efhd_attachment_image), (efhd_attachment_button):
	Do nothing when EMFormatHTML object's state is RENDERING,
	the puri object instance is not valid anyway.

2008-04-28  Johan Euphrosine  <proppy@aminche.com>

	** Fix for bug #529247

	* em-format-html.h (struct _EMFormatHTML): Add header_colour.

	* em-format-html-display.c (efhd_gtkhtml_realise): Use bg style
	properties for body_colour, fg for header_colour, darken for
	frame_colour, bg for content_colour.

	* em-format-html.c (efh_init), (efh_format_exec), (efh_init),
	(efh_text_plain), (efh_text_enriched), (efh_text_html),
	(efh_message_deliverystatus): Use header_colour for text color of
	the message header, body_colour for background color of the
	message header, text_colour for text color of the message content,
	base_colour for background color of the message content.

2008-04-28  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-utils.c: Avoid crash while detecting mime types.

2008-04-28  Srinivasa Ragavan  <sragavan@novell.com>

	* mail/em-format-html.c: Fix the Mailer header display

2008-04-25  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #273041

	* mail.error.xml: (junk-check-error), (junk-report-error),
	(junk-not-report-error): New error messages added.
	* em-junk-hook.h: (struct _EMJunkHookTarget), (em_junk_error_quark):
	* em-junk-hook.c: (manage_error), (em_junk_check_junk),
	(em_junk_report_junk), (em_junk_report_non_junk):
	Allow propagation of the error from the plugin in the hook target.

2008-04-23  Milan Crha  <mcrha@redhat.com>

	* em-format-html-display.c: (efhd_update_bar):
	Compiler warning fix.

2008-04-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #529375

	* evolution-mail.schemas.in:
	* mail-config.glade:
	* em-utils.h: (em_utils_in_addressbook):
	* em-utils.c: (em_utils_in_addressbook):
	* em-format-html.c: (emfh_gethttp):
	* mail-session.c: (lookup_addressbook):
	* mail-config.h: (mail_config_get_lookup_book_local_only):
	* mail-config.c: (struct MailConfig), (mail_config_init),
	(mail_config_get_lookup_book_local_only):
	* em-mailer-prefs.h: (struct _EMMailerPrefs):
	* em-mailer-prefs.c: (junk_book_lookup_button_toggled),
	(em_mailer_prefs_construct): Add new option
	/apps/evolution/mail/junk/lookup_addressbook_local_only
	to determine whether check for address in a local address book only.

2008-04-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #529179

	* em-folder-browser.c: (struct _EMFolderBrowserPrivate),
	(labels_changed_idle_cb), (gconf_labels_changed), (emfb_destroy):
	Rebuild search menu rather on idle, then immediately after the change
	in gconf, because other parts may not have this change propagated yet.

2008-04-22  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #458505

	* mail-config.glade:
	One space between "Sender" and "Photograph".

2008-04-22  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #529462

	* evolution-mail.schemas.in:
	Fix wording of "custom_header" GConf key description.

2008-04-22  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #494171

	* mail-send-recv.c (build_dialog):
	Make the "Send & Receive Mail" window dimensions persistent.

	* evolution-mail.schemas.in:
	Add keys for storing "Send & Receive Mail" window dimensions:
		/apps/evolution/mail/send_recv_height
		/apps/evolution/mail/send_recv_maximized
		/apps/evolution/mail/send_recv_width
	Note the "maximized" key is required by GConfBridge but is not
	actually used since the window cannot be maximized.

2008-04-22  Matthew Barnes  <mbarnes@redhat.com>

	* em-composer-prefs.c:
	gconf-bridge.h moved to e-util.

2008-04-21  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #323402

	* em-folder-tree.c: (folder_tree_new):
	* evolution-mail.schemas.in: Be able to disable ellipsizing of folder
	names with hidden option /apps/evolution/mail/display/no_folder_dots.

2008-04-20  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #334444

	* em-format-html-display.c: (efhd_attachment_button),
	(efhd_update_bar), (efhd_message_update_bar),
	(efhd_message_add_bar):
	* em-format-html.c: (efh_format_exec):

2008-04-17  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #526739

	* Makefile.am:
	* em-vfs-stream.h:
	* em-vfs-stream.c: Removed from project, not used anywhere.
	* em-menu.c:
	* em-config.c: Do not include gnome-vfs.
	* mail-ops.c: (save_messages_exec), (save_part_exec):
	Changes related to Data Server change of CamelStreamVFS.
	* em-format.c: (em_format_describe_part):
	* em-format-html-display.c: (efhd_bonobo_object), (efhd_find_handler),
	(efhd_use_component), (efhd_bonobo_unknown), (efhd_check_server_prop),
	(efhd_format_attachment): Drop use of deprecated gnome-vfs functions.
	* em-utils.c: (em_utils_snoop_type): Use gio to guess the mime_type.
	* em-popup.c: (emp_apps_open_in), (emp_apps_popup_free),
	(emp_standard_menu_factory): Use gio to fill popup and launch app.

2008-04-16  Shuai Liu  <shuai.liu@sun.com>

	** Fix for bug #528358

	* em-utils.c: (em_utils_save_messages): Use message subject as default
	filename when attempting to 'save message'. 

2008-04-14  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #270406

	* em-folder-properties.c: (struct _prop_data), (emfp_free),
	(add_numbered_row), (emfp_get_folder_item),
	(emfp_dialog_got_folder_quota), (emfp_dialog_got_folder):
	Retrieve quota information for a folder and show it in a dialog.
	* mail-ops.h: (mail_get_folder_quota):
	* mail-ops.c: (struct _get_quota_msg), (get_quota_desc),
	(get_quota_exec), (get_quota_done), (get_quota_free),
	(MailMsgInfo get_quota_info), (mail_get_folder_quota):
	New operation to get folder's quota information.

2008-04-13  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-browser.c:
	Add an icon for Folder->New.

2008-04-10  Matthew Barnes  <mbarnes@redhat.com>

	* mail-config.glade:
	Revert my previous change.  Glade was more destructive toward the
	file than I realized.  But I think I fixed the core issue that was
	causing Glade 3 to crash: there were two widgets named "omenuCharset".
	Now the one in Composer Preferences is named "omenuCharset1".

2008-04-10  Sankar P  <psankar@novell.com>

	* em-composer-prefs.c: (em_composer_prefs_construct):
	Change the name of the variable we look for in 
	the glade file.

	Also add some if conditions to avoid certain crash.

	** See bug #527327

2008-04-09  Matthew Barnes  <mbarnes@redhat.com>

	* mail-config.glade:
	Loaded this file into Glade 3.5 and saved it.  Doing so appears
	to have fixed whatever corruption was causing previous Glade 3
	releases to choke on it.

2008-04-08  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #523413

	* em-composer-utils.c (save_draft_done):
	Check the composer window's visibility to determine whether to
	destroy the window.  See the corresponding composer/ChangeLog
	entry to get the full story.

	* em-composer-utils.c (em_utils_composer_save_draft_cb):
	Remove the 'quit' parameter.

2008-04-07  Takao Fujiwara  <takao.fujiwara@sun.com>

	reviewed by: Milan Crha

	** Fix for bug #408579

	* mail.error.xml:
	  Changed '&quot;' to '\"' to work with intltool.

2008-04-06  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #335891

	* em-composer-prefs.c (em_composer_prefs_construct):
	Desensitize the signature editing interface if the "signatures"
	GConf key is not writable.

2008-04-05  Matthew Barnes  <mbarnes@redhat.com>

	* em-composer-prefs.c:
	Fix a corner case that I missed in my last commit.

2008-04-05  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #526152, plus some tangential code cleanup.

	* Makefile.am:
	Remove all the IDL crud for GnomeSpell.

	* em-composer-prefs.c:
	* evolution-mail.schemas.in:
	* mail-config.c:
	Define our own GConf keys for active spell checking languages
	and the underline color for misspelled words, instead of relying
	on GnomeSpell's GConf keys.  The new keys are:
	/apps/evolution/mail/composer/spell_color	(string)
	/apps/evolution/mail/composer/spell_languages	(list of strings)

	* em-composer-prefs.c:
	* em-composer-prefs.h:
	Cleanup the logic a bit to improve readability.

	* mail-config.c:
	Cleanup the GConf notification logic:
	- We don't need the notification IDs for GConf keys we're watching.
	- Minimize the repetition of GConf keys to reduce the risk of typos.
	- Reduce the number of notification callback functions.

	* Spell.idl:
	Remove this file; we don't use GnomeSpell anymore.

2008-04-04  Jeffrey Stedfast  <fejj@novell.com>

	* em-format-quote.c (emfq_format_header): Same as below.

	* em-format-html.c (efh_format_header): Need to unfold some
	headers. Also simplified figuring out the label.
	(efh_format_headers): Cleaned up some code.

2008-04-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #264456

	* mail-component.c: (view_changed):
	Do not count deleted junk messages when doesn't show deleted messages.

2008-04-03  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #350308

	* em-format-html-display.c: (efhd_gtkhtml_realise): Make colors only
	darker, not lighter. Use black in case someone has too dark theme.

2008-04-02  Matthew Barnes  <mbarnes@redhat.com>

	* em-composer-prefs (sig_edit_cb), (em_composer_prefs_new_signature):
	Adapt to new Bonobo-less signature editor.

	* mail-signature-editor.c:
	* mail-signature-editor.h:
	Rewrite the signature editor as a subclass of GtkhtmlEditor.
	Eliminates Bonobo from the equation.

	* em-composer-utils.c (composer_get_message),
	(em_utils_composer_send_cb), (save_draft_done),
	(em_utils_composer_save_draft_cb), (create_new_composer),
	(em_utils_compose_new_message),
	(em_utils_compose_new_message_with_mailto), (em_utils_post_to_folder),
	(em_utils_post_to_url), (edit_message), (forward_attached),
	(forward_non_attached), (reply_get_composer), (composer_set_body),
	(em_utils_reply_to_message), (post_reply_to_message):
	Adapt to new Bonobo-less composer.

	* mail-component-factory.c:
	Composer is no longer needs a Bonobo factory.

	* mail-config.c:
	Fix style pattern for EMsgComposer widgets.

2008-04-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #271863

	* mail-component.c: (view_changed):
	Do not count deleted junked messages to total number of messages
	with unchecked "Hide Deleted Messages" option.

2008-04-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #525508, spotted by Thomas M.

	* message-list.c (ml_tree_value_at):
	Fix a leaking CamelURL in the COL_LOCATION case.

2008-04-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #525510, patch from Thomas M.

	* message-list.c (ml_tree_value_at):
	Mark "On This Computer" for translation.

2008-03-29  Matthew Barnes  <mbarnes@redhat.com>

	* em-network-prefs.c (em_network_prefs_finalise),
	(em_network_prefs_destroy), (emnp_parse_ignore_hosts):
	Fix some unused variable warnings.

2008-03-27  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #523271

	* em-popup.c (emp_standard_menu_factory):
	Lowercase the MIME type before passing it to
	gnome_vfs_mime_get_all_applications().

2008-03-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #522178

	* mail-folder-cache.c: (folder_changed): Put back hack with
	checking time of new message in the folder based with last
	time of new mail as it was before patch in bug #492702.

2008-03-27  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #519292

	* message-list.h: (message_list_set_expand_all):
	* message-list.c: (message_list_set_expand_all):
	Remove unused confusing function.
	* message-list.c: (regen_list_done):
	Use numbers instead of gboolean value.

2008-03-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #502826 (original patch by nickspoon0)

	* mail-config.glade:
	* em-composer-prefs.c: (attach_style_reply_new_order),
	(attach_style_info_reply), (em_composer_prefs_construct):
	Reword and reorder Reply Style items in the Preferences.

2008-03-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #488175

	* message-list.c: (ml_tree_value_at):
	Colorize follow-up messages same as with due-by flag.

2008-03-25  Veerapuram Varadhan  <vvaradhan@novell.com>

	** Added configurable Proxy settings for Evolution.

	* GNOME_Evolution_Mail.server.in.in:
	* Makefile.am:
	* em-network-prefs.c: (em_network_prefs_get_type),
	(em_network_prefs_class_init), (em_network_prefs_init),
	(em_network_prefs_finalise), (em_network_prefs_destroy),
	(toggle_button_toggled), (toggle_button_init), (emnp_widget_glade),
	(emnp_set_sensitiveness), (emnp_parse_ignore_hosts),
	(emnp_load_sys_settings), (notify_proxy_type_changed),
	(widget_entry_changed_cb), (emnp_free), (emnp_set_markups),
	(em_network_prefs_construct), (em_network_prefs_new):
	* em-network-prefs.h:
	* mail-component-factory.c: (factory):
	* mail-config-factory.c: (mail_config_control_factory_cb):
	* mail-config.glade:

2008-03-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #511978

	* mail-config.glade: Resolve mnemonics clash on Junk tab.

2008-03-19  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view.h:
	* em-message-browser.h:
	* em-message-browser.c:
	Code cleanup, no logic changes.

2008-03-18  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #519154

	* mail-component.c: (view_changed):
	Do not localize folder name used in window title.

2008-03-18  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #506359

	* mail-component.c: (mail_component_show_logger):
	Add Translators' comments.

2008-03-17  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #514744

	* em-folder-tree-model.c: (em_folder_tree_model_load_state):
	Check also for proper root node and use default if not the right one.

2008-03-13  Milan Crha  <mcrha@redhat.com>

	* em-folder-tree.c:
	* em-format-html.c: Fix an implicit function declaration.

2008-03-13  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #515786

	* em-migrate.c: (em_migrate), (em_update_sa_junk_setting_2_23):
	Fix misspelled SpamAssassin word.

2008-03-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #273177

	* em-utils.h: (em_utils_add_vcard):
	* em-utils.c: (emu_add_address_or_vcard),
	(em_utils_add_address), (em_utils_add_vcard):
	New function to add whole vCard to addressbook.
	* em-popup.c: (emp_add_vcard), (emp_standard_menu_factory):
	Add popup menu item to vcard attachments.

2008-03-12  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes breakage caused by bug #513951

	* mail-autofilter.c (filter_gui_add_from_message),
	(mail_filter_rename_uri), (mail_filter_delete_uri):
	* mail-tools.c (mail_tool_get_local_movemail_path):
	* mail-vfolder.c (mail_vfolder_delete_uri), (mail_vfolder_rename_uri),
	(store_folder_deleted), (store_folder_renamed),
	(vfolder_load_storage), (vfolder_revert),
	(em_vfolder_editor_response), (edit_rule_response),
	(new_rule_clicked):
	* em-folder-browser.c (emfb_search_search_activated):
	* em-folder-tree.c (em_folder_tree_new):
	* mail-ops.c (uid_cachename_hack), (empty_trash_exec):
	* em-folder-view.c (emfv_setup_view_instance):
	* em-utils.c (em_filter_editor_response), (em_utils_edit_filters):
	* importers/mail-importer.c (import_folders_rec):
	* mail-folder-cache.c (rename_folders):
	* em-format-html.c (em_format_html_get_type):
	* mail-session.c (main_get_filter_driver):
	* mail-config.c (gconf_mime_types_changed), (uri_to_evname),
	(mail_config_folder_to_cachename), (get_new_signature_filename):
	Adapt to new meaning of mail_component_peek_base_directory().

	* mail-component.c (mail_component_init):
	Add back initialization of priv->base_directory.  Accidentally
	removed it somehow in last commit.

2008-03-11  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #513951

	* mail-config.c (gconf_mime_types_changed):
	Adapt to new meaning of xxx_component_peek_base_directory().

	* mail-component.c:
	Use e_get_user_data_dir() instead of constructing the full path.

2008-03-06  Tobias Mueller  <muelli@auftrags-killer.org>

	** Fix for bug #520745

	* mail/em-format.c: Fix format-string vulnerability
	Patch by Tor Lillqvist <tml@iki.fi>

2008-03-03  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-tree.c (emft_drop_async__done):
	Re-fix bug #351672 since my patch for bug #362638 accidentally
	reverted the original solution.

2008-03-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for BNC bug #282466

	* em-icon-stream.c: (em_icon_stream_get_image),
	(em_icon_stream_is_resized): Handle CIDs of broken cases too.

2008-03-03  Changwoo Ryu  <cwryu@debian.org>

	* default/Makefile.am:
	* default/ko/*: Add Korean welcome message translation.

2008-03-02  Srinivasa Ragavan  <sragavan@novell.com>

	* evolution-mail.schemas.in: Make Bogofilter the default junk plugin
	in Evolution.

2008-02-22  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #512776

	* Changes below prevents deadlock on start or send/receive.
	* mail-send-recv.c: (struct _refresh_folders_msg),
	(refresh_folders_exec), (refresh_folders_free),
	(receive_update_got_folderinfo): Do not look for active folders in
	main thread, rather do it in other thread and free folder info later.
	* mail-ops.h: (mail_get_folderinfo):
	* mail-ops.c: (struct _get_folderinfo_msg), (get_folderinfo_done),
	(get_folderinfo_free), (mail_get_folderinfo):
	* mail-folder-cache.h: (mail_note_store):
	* mail-folder-cache.c: (struct _update_data), (update_folders),
	(mail_note_store):
	* mail-component.c: (mc_add_store_done): 
	The 'done' function returns if we can free folder info or not.

2008-02-22  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for BNC #358697

	* em-folder-browser.c: (emfb_set_folder): Make sure the default search
	filter for sent/draft/outbox is "Recipients Contain"

2008-02-20  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #469292

	* em-format-quote.c: (emfq_format_clone): Add empty line only when top
	posting is enabled.

2008-02-19  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #516349

	* em-format-quote.c: (emfq_format_message):
	Do not force black text in quotation part of the message.

2008-02-18  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #515744

	* em-folder-view.c: (emfv_setup_view_instance):
	* mail-component.c: (impl_finalize):
	* message-list.c: (ml_tree_value_at):
	Memory leak fix.

2008-02-18  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #167638

	* mail-component.c: (impl_quit): Upstreamed Fejj's OpenSUSE patch for
	faster quitting.

2008-02-18  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bnc #153807

	* em-composer-utils.c: (em_utils_post_to_folder): Patch from OpenSUSE.

2008-02-16  Aidan Delaney  <a.j.delaney@brighton.ac.uk>

	** Fix for bug #516234

	* em-popup.c: (emp_apps_open_in): Removed a stray printf() statement. 

2008-02-15  Paul Bolle  <pebolle@tiscali.nl>

	** Fix for bug #515659

	* em-format-html.c: (em_format_html_set_mark_citations):
	Keep mark_citations and the CAMEL_MIME_FILTER_TOHTML_MARK_CITATION
	flag (part of text_html_flags) in sync.

2008-02-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #515054

	* em-folder-view.c: (emfv_popup_mark_junk), (emfv_popup_mark_nojunk):
	Also clear/set new CAMEL_MESSAGE_NOTJUNK flag.

2008-02-10  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #411576

	* evolution-mail.schemas.in: Add a key to decide if same fonts gotto
	be used in message list in vertical view column.
	* message-list.c: (create_composite_cell):

2008-02-10  Suman Manjunath  <msuman@novell.com>

	** Fix for bug #510642

	* evolution-mail.schemas.in: Improved a schema-description. 
	* mail-config.glade: Improved an error-message. 

2008-02-08  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #509741

	* mail-session.c (user_message_exec):
	Use the number of dialog buttons as a heuristic for whether to
	display a message in the status bar or immediately present the
	dialog to the user.

2008-01-29  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c:
	Replace G_GNUC_FUNCTION (deprecated) with G_STRFUNC.

2008-01-28  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #506948

	* em-folder-view.c: (url_unescape_amp), (emp_uri_popup_link_copy):
	Copy the unescaped url

2008-01-28  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #504062

	* message-list.c: (get_normalised_string): Store strings for addresses,
	 instead of collate keys.
	* message-list.etspec: Compare Subject as strings, not as collate.

2008-01-28  Andre Klapper  <a9016009@gmx.de>

	* em-filter-i18n.h: Added translator comments.
	* message-tag-followup.c: Added translator comments. 

2008-01-25  Johnny Jacob  <jjohnny@novell.com>

	** Fix for #467581.

	* em-folder-browser.c : Don't cancel all threads for a vfolder
	based search (all/account search). Introduced cameloperation for
	this and cancel it on clear.
	
2008-01-24  Milan Crha  <mcrha@redhat.com>

	** Partial fix for bug #395939

	* em-format.c: (emf_inlinepgp_signed):
	* em-format-html-display.c: (efhd_format_optional):
	* em-folder-view.c: (emfv_destroy):
	Memory leak fix.

2008-01-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #402487

	* em-folder-browser.c: (emfb_search_search_activated),
	(generate_viewoption_menu): Memory leak fix.

2008-01-24  Milan Crha  <mcrha@redhat.com>

	** Part of bug #511488

	* mail-vfolder.h:
	* mail-vfolder.c: (vfolder_loaded): Function dropped.
	* mail-vfolder.c: (vfolder_load_storage): Allow to call this function
	more than once, but do load the storage only once.
	* em-folder-utils.c: (emfu_popup_new_folder_response):
	* mail-vfolder.c: (vfolder_edit), (vfolder_gui_add_rule),
	(vfolder_gui_add_from_message), (vfolder_gui_add_from_address):
	* em-folder-browser.c: (emfb_search_menu_activated):
	* em-folder-view.c: (emp_uri_popup_vfolder_sender),
	(emp_uri_popup_vfolder_recipient), (vfolder_type_current):
	Ensure vfolder is running.

2008-01-24  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #511488

	* em-folder-tree-model.c: (em_folder_tree_model_signal_block):
	* em-folder-tree-model.h: Function to block folder-created function.
	* mail-vfolder.c: (vfolder_load_storage): Block the signal handler
	when loading.

2008-01-24  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #510779
	** Fix for bug #504103

	* em-mailer-prefs.c: (jh_tree_refill), (jh_add_cb), (jh_remove_cb),
	(init_junk_tree), (custom_junk_button_toggled),
	(em_mailer_prefs_construct): Added UI for the new junk preferences.
	* em-mailer-prefs.h:
	* evolution-mail.schemas.in: Add schema for junk header and address
	lookup.
	* mail-config.c: (gconf_jh_check_changed),
	(gconf_lookup_book_changed), (gconf_jh_headers_changed),
	(mail_config_init), (mail_config_reload_junk_headers),
	(mail_config_get_lookup_book):
	* mail-config.glade:
	* mail-config.h:
	* mail-session.c: (class_init), (lookup_addressbook),
	(mail_session_init), (mail_session_set_junk_headers):
	* mail-session.h:

2008-01-22  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #405777

	* em-folder-view.c: (emfv_setup_view_instance),
	(emfv_setting_notify): Don't break abstraction. Call the right derived
	class.

2008-01-20  Srinivasa Ragavan  <sragavan@novell.com>

	* message-list.etspec: Revert the last cursor remove commit. It breaks
	selections with CTRL. May be, cairofy the cursor.
	
2008-01-20  Srinivasa Ragavan  <sragavan@novell.com>

	* message-list.etspec: Remove the focus cursor on the message list.
	The message list now has a nice cairo rendered row. This looks very
	close to the GtkTreeView thing.

2008-01-16  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-browser.c:
	* message-list.c:
	Change of heart; decided we like the old "emblem-important" 
	icon better than "mail-mark-important" for the message list
	and "Show" combo box.

2008-01-16  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #509741

	* mail-session.c (user_message_exec):
	Fix a crash that occurs when prompted to accept a certificate.
	This is just a quick temporary fix; Srini and I have a more
	sophisticated solution in mind.

2008-01-16  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #509697

	* mail-vfolder.c: (vfolder_edit):
	Ensure search folders are running before calling anything from this.

2008-01-14  Kjartan Maraas  <kmaraas@gnome.org>

	* evolution-mail.schemas.in: Add missing punctuation.

2008-01-14  Gert Kulyk  <gkulyk@yahoo.de>

	** Fix for bug #350932

	* mail-config.glade: Enable the use of scrollable tabs in the 
	mail-preferences dialog. 

2008-01-14  Martin Meyer  <elreydetodo@gmail.com>

	** Fix for bug #496301

	* evolution-mail.schemas.in: Made the long description of a couple of 
	schemas more readable. 

2008-01-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #488213

	* em-icon-stream.c: (emis_fit):
	* em-format-html-display.c: (efhd_attachment_button):
	Use global function e_icon_factory_pixbuf_scale for scaling pixbufs.

2008-01-10  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #507067

	* em-format-html-display.c: (efhd_get_uri_puri):
	Leak fix and enhanced behavior to return more than one URI separated
	by new line character ('\n'), if possible.
	* em-folder-view.c: (emfv_uri_popup_free): Free item itself too,
	because since now we use new allocated items, not the static one.
	* em-folder-view.c: (emfv_free_em_popup), (emfv_append_menu),
	(emfv_format_popup_event): Merge menus for more URIs and for part too.

2008-01-10  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #211353

	* filtertypes.xml:
	* vfoldertypes.xml:
	* em-folder-view.c:
	* em-folder-browser.c:
	* em-mailer-prefs.h:
	* em-mailer-prefs.c:
	* mail-config.h:
	* mail-config.c:
	* mail-config.glade:
	* message-list.c:
	Label tags are now generated based on label name when creating, except
	of first 5 labels. New menu option "New Label" in popup menu over
	message list and editing of labels has been changed in Preferences.
	Also renaming tab in Preferences for "Labels", not "Colors", and the
	tab label too.
	mail-config-label... functions was moved to e-util/e-util-labels.c/.h.
	* message-list.etspec: Normalized columns has been moved by one
	when label column has been added.

2008-01-10  Srinivasa Ragavan  <sragavan@novell.com>

	** Most of the errors are now non-intrusive 

	* em-folder-utils.c: (emfu_copy_folder_selected),
	(emfu_delete_response), (em_folder_utils_delete_folder):
	* em-folder-view.c: (emfv_delete_msg_response):
	* em-utils.c: (em_utils_edit_filters),
	(em_utils_save_part_to_file), (em_utils_temp_save_part),
	(error_response), (em_utils_show_error_silent),
	(em_utils_show_info_silent):
	* em-utils.h:
	* mail-autofilter.c: (mail_filter_delete_uri):
	* mail-component.c: (mail_component_show_logger):
	* mail-mt.c: (mail_msg_free):
	* mail-session.c: (do_user_message):
	* mail-vfolder.c: (mail_vfolder_delete_uri), (vfolder_edit_rule):

2008-01-10  Sankar P  <psankar@novell.com>

	* em-format-html.c: (efh_format_headers):
	Decode the right thingy. Fixes a regression in
	decoding of face header introduced while migration of
	camel_* functions to g_* functions.

2008-01-08  Djihed Afifi <djihed@gmail.com>

	** Fix for bug #309432

	* em-format-html.c: Fix message headers for RTL languages.

2008-01-08  Colin Leroy  <colin@colino.net>

	** Fix for bug #499145

	* mail/em-composer-utils.c: Follow RFC 3798 to send return receipts.

2008-01-08  Bharath Acharya  <abharath@novell.com>

	** Fix for bug #474118

	* mail-ops.c: (prepare_offline_exec): Check for the right type of store
	and invoke appropriate functions. 

2008-01-07  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #300336

	* mail-vfolder.h: (vfolder_loaded):
	* mail-vfolder.c: (vfolder_loaded): New helper function.
	* em-folder-utils.c: (emfu_popup_new_folder_response):
	* mail-vfolder.c: (vfolder_gui_add_rule),
	(vfolder_gui_add_from_message), (vfolder_gui_add_from_address):
	* em-folder-browser.c: (emfb_search_menu_activated):
	* em-folder-view.c: (emp_uri_popup_vfolder_sender),
	(emp_uri_popup_vfolder_recipient), (vfolder_type_current):
	Ensure vfolder is running.
	* mail-component.c: (mc_startup): Do not start vfolder when
	disabled by option '/apps/evolution/mail/display/enable_vfolders'.
	* evolution-mail.schemas.in: Added schema for new option.
	* mail-config.glade:
	* em-mailer-prefs.h:
	* em-mailer-prefs.c: Added checkbox for "Enable Search Folders" option.

2008-01-06  Gilles Dartiguelongue  <gdartigu@svn.gnome.org>

	** Fix bug #497914

	* em-mailer-prefs.c: (emmp_header_is_valid):
	backport changes from the copy/pasted code in imap-headers
	plugin.

2008-01-06  Michael Monreal  <michael.monreal@gmx.net>

	** Fix for bug #492188

	* em-folder-browser.c:
	* em-folder-tree.c:
	* em-folder-view.c:
	* message-list.c:

	Use the new Tangoized icons instead of deprecated icons from 
	gnome-icon-theme.

2008-01-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #317823

	* em-format-html-display.c: (efhd_get_uri_puri):
	New helper function to dig up uri or puri from the GtkHtml.
	If the object is an image, then pass it as puri or uri, depends
	on the source of the image.
	* em-format-html-display.c: (efhd_html_button_press_event),
	(em_format_html_display_popup_menu): Using new helper function.

2008-01-02  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #364642

	* em-composer-prefs.h: (struct _EMComposerPrefs):
	* em-composer-prefs.c: (em_composer_prefs_construct):
	* mail-config.glade:
	* evolution-mail.schemas.in:
	(/apps/evolution/mail/composer/request_receipt):
	New option in Composer tab to preset Request Read Receipt in composer.

2008-01-02  Andre Klapper  <a9016009@gmx.de>

	* mail-config.glade:
	add mnemonic_widget for default junk plugin. see bug #476264.

2008-01-02  Srinivasa Ragavan  <sragavan@novell.com>

	* em-event.c: (eme_target_free):
	* em-event.h:
	* em-folder-tree-model.c: (em_folder_tree_model_get_folder_name):
	* em-folder-tree-model.h:
	* mail-folder-cache.c: (real_flush_updates): Send the folder name
	along with the new mail event.

2007-12-20  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #362638

	* mail-mt.h:
	Overhaul the message passing API:
	- Define a MailMsg type as the base message struct.
	- Define types for the various callback functions.
	- Add a priority value to each message (not yet used).
	- Add a reference count to each message.
	- Define a MailMsgInfo type for the virtual function table.
	- Record the size of message sub-types in MailMsgInfo.
	- New/changed functions:
	    mail_msg_new()   - Easier to use.
	    mail_msg_ref()   - Increase reference count.
	    mail_msg_unref() - Decrease reference count.
	    mail_msg_main_loop_push()    }
	    mail_msg_unordered_push()    } Submit MailMsgs to various
	    mail_msg_fast_ordered_push() } message-processing threads.
	    mail_msg_slow_ordered_push() }

	* mail-mt.c (mail_msg_new):
	Use GSlice for memory allocation.

	* mail-mt.c (mail_msg_ref), (mail_msg_unref):
	New functions increment/decrement a MailMsg's reference count.

	* mail-mt.c (mail_cancel_hood_add), (mail_cancel_hook_remove):
	Convert the 'cancel_hook_list' from an  EDList to a GHookList and
	modify the API accordingly.

	* mail-mt.c:
	Use GThreadPools instead of EThreads.
	Use GAsyncQueues instead of EMsgPorts.

	* em-composer-utils.c:
	* em-folder-browser.c:
	* em-folder-properties.c:
	* em-folder-tree.c:
	* em-folder-utils.c:
	* em-folder-view.c:
	* em-format-html-print.c:
	* em-format-html.c:
	* em-subscribe-editor.c:
	* em-sync-stream.c:
	* importers/elm-importer.c:
	* importers/mail-importer.c:
	* importers/pine-importer.c:
	* mail-component.c:
	* mail-folder-cache.c:
	* mail-mt.c:
	* mail-ops.c:
	* mail-ops.h:
	* mail-send-recv.c:
	* mail-session.c:
	* mail-vfolder.c:
	* message-list.c:
	Use the new MailMsg API for messages.

2007-12-18  Matthew Barnes  <mbarnes@redhat.com>

	* mail-mt.c (do_op_status): Fix another compiler warning.

2007-12-17  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-mt.c: (mail_msg_free), (mail_msg_check_error): Fix some compiler warnings.

2007-12-14  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #211353

	* message-list.etspec:
	* message-list.h:
	* message-list.c: Added new column to show labels.
	* filtertypes.xml:
	* vfoldertypes.xml:
	Code for label filters/search folders has been changed.
	* mail-config.glade:
	* em-folder-view.c: (emfv_set_label), (emfv_unset_label),
	(emfv_popup_label_clear), (emfv_popup_label_set),
	(emfv_popup_labels_get_state_for_tag), (emfv_popup):
	Labels popup submenu is now shown with checkboxes so one can set
	more than one label to the message and unset only one label from
	message. There has been added new function, because of this.
	* mail-config.h:
	* mail-config.c: New "interface" functions to work with labels.
	* em-mailer-prefs.h:
	* em-mailer-prefs.c: Editing labels in tree.
	* em-folder-browser.c:
	Labels in show menu reflect changes in preferences.


2007-12-17  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #430369 

	* mail-session.c: (mail_session_init): Init in the main gui thread.

2007-12-17  Srinivasa Ragavan  <sragavan@novell.com>

	** Non-intrusive errror reporting and basic logging support.

	* em-folder-browser.c: (emfb_help_debug): Invoke the debug menu.
	* evolution-mail.schemas.in: Schema for error timeout and level.
	* mail-component.c: (mail_component_init), (render_pixbuf),
	(render_level), (render_date), (append_logs), (spin_value_changed),
	(mail_component_show_logger): Handle the lifecycle of the logger.
	* mail-component.h: Api to show the logger.
	* mail-config.c: (gconf_error_time_changed),
	(gconf_error_level_changed), (mail_config_init),
	(mail_config_get_error_timeout), (mail_config_get_error_level): Load
	and get the error time and level.
	* mail-config.h:
	* mail-mt.c: (mail_msg_set_cancelable), (mail_msg_new),
	(end_event_callback), (mail_msg_free), (mail_msg_check_error),
	(operation_cancel), (do_op_status): Revamp the error handling.
	* mail-mt.h:
	* mail-ops.c: (send_queue_send), (mail_send_queue): Handle the send/receive 
	case of error reporting separately.
	* mail-send-recv.c: (free_send_info), (mail_send):

2007-12-15  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-tree-model.c (emft_model_unread_count_changed),
	(emfolder_tree_model_set_unread_count):
	Fix recently introduced compiler warnings.

2007-12-15  Milan Crha  <mcrha@redhat.com>
 
 	** Part of fix for bug #492702
 
 	* mail-config.h:
 	* mail-config.glade:
 	* evolution-mail.schemas.in:
 	* mail-folder-cache.h:
 	* mail-folder-cache.c:
 	* em-mailer-prefs.h:
 	* em-mailer-prefs.c: Moved bits of sound notification
 	on new messages to mail-notification plugin.
 	* em-migrate.c: (is_in_plugs_list),
 	(em_update_message_notify_settings_2_21), (em_migrate):
 	Migration code to move old options to new plugin options.
 
2007-12-14  Sankar P  <psankar@novell.com>

	* em-folder-tree-model.c: (emft_model_unread_count_changed),
	(em_folder_tree_model_init),
	(em_folder_tree_model_set_unread_count):
	* em-folder-tree.c: (em_folder_tree_construct):
	Moving some code from tree to model where it belongs.
	Fixes some CPU usage issue whenever (un)read count is updated.
	Hopefully no regresssions.

2007-12-13  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c:
	Fix an implicit function declaration.

2007-12-12  Alex "weej" Jones  <alex@weej.com>

	** Fix for bug #503111

	* mail-session.c: (mail_session_add_junk_plugin):
	Suppress "Loading %s as the default junk plugin" message.

2007-12-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #502318

	* em-format-html-display.c: (struct _EMFormatHTMLDisplayPrivate),
	(efhd_search_destroy), (em_format_html_get_search_dialog),
	(em_format_html_display_search), (em_format_html_display_search_with),
	(em_format_html_display_search_close), (efhd_complete):
	Track search dialog activity rather based on flag than on widget
	existence, because the pointer to that widget it still
	there (non-NULL) even after destroy of that widget.

2007-12-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #336074

	* mail-send-recv.c: (get_folders):
	Determine whether refresh folder from the store based on result of new
	store's function 'camel_store_can_refresh_folder'.

2007-12-10  Jeff Cai  <jeff.cai@sun.com>

	* em-folder-view.c: (emfv_setting_notify):
	If it is not FolderBrowser object, the pane size
	signal is not sent.
	Fix #501677

2007-12-07  Alex Kloss  <alexkloss@att.net>

	** Fix for bug #329706

	* em-utils.c (em_utils_prompt_user):
	Add mnemonic 'd' to 'Do not show...' checkbox
	* mail.error.xml:
	Remove redundant 'Send anyway' label
	Reorder buttons to 'Send','Cancel' as per HIG

2007-12-07  Akhil Laddha  <lakhil@novell.com>

	** Fix for bug #475508

	* em-folder-view.c:
	Changed the string for search folder and filter creation from
	message list to make it understandable.

2007-12-07  Denis Washington <denisw@svn.gnome.org>

	** Fix for bug #500561

	* em-folder-browser.c: Added icon for mark all messages as read menu 
	item.

2007-12-06  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #263236

	* em-folder-view.c: (emfv_delete_msg_response):
	Look for "Do not ask me again" check in alignment, so
	let it works properly.

2007-12-05  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-config.h: Fix a compiler warning.

2007-12-05  Srinivasa Ragavan  <sragavan@novell.com>

	** Added a preference to disable Magic Spacebar.

	* em-folder-browser.c: (html_scroll), (emfb_list_key_press): Check the cfg 
	  before invoking Magic Spacebar
	* em-mailer-prefs.c: (em_mailer_prefs_construct): Preference window handling
	* em-mailer-prefs.h:
	* evolution-mail.schemas.in:
	* mail-config.c: (gconf_magic_spacebar_changed),
	(mail_config_init), (mail_config_get_enable_magic_spacebar): Add it part of MC.
	* mail-config.glade: 
	* mail-config.h:

2007-12-04  David Turner  <cillian64@googlemail.com>

	** Fix for bug #347329

	* em-folder-selector.c: (em_folder_selector_create_new):
	Added a mnemonic to the 'Create' button of the 'New Folder' dialog

2007-12-04  Alex Kloss  <alexkloss@att.net>

	** Fix for bug #329578

	* em-account-editor.c: (emae_receive_options_item):
	Add mnemonic for "minutes" widget

2007-12-04  David Turner  <cillian64@googlemail.com>

	** Fix for bug #446029

	* em-format-html-display.c: (em_format_html_get_search_dialog):
	Fix for a mnemonic conflict in 'Find in Message' feature.

2007-12-04  Alex Kloss  <alexkloss@att.net>

	** Fix for bug #466503

	* mail-config.glade: Fix for a mnemonic conflict in 
	Preferences -> Mail Preferences -> Junk tab.

2007-12-04  David Turner  <cillian64@googlemail.com>

	** Part of fix for bug #466499

	* em-account-editor.c: (emae_option_toggle):
	Added support for mnemonics in config options from camel

2007-12-04  David Turner  <cillian64@googlemail.com>

	** Fix for bug #466497

	* mail-config.glade: Changed some mnemonics to stop l being used
	as a mnemonic key

2007-12-04  David Turner  <cillian64@googlemail.com>

	** Fix for bug #466241

	* mail-config.glade: Added a mnemonic to "Authentication type"
	in the recieving mail section of configuration

2007-12-03  Denis Washington  <denisw@svn.gnome.org>

	** Fix for bug #363644

	* mail-send-recv.c:
	Added a 6px padding around the scrolled window so that
	it's border doesn't look like a separator on the bottom.

2007-11-29  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #271551

	* evolution-mail.schemas.in:
	New key "/apps/evolution/mail/composer/current_folder".

2007-11-28  Matthew Barnes  <mbarnes@redhat.com>

	* mail-session.c:
	Fix an implicit function declaration caused by my last commit.

2007-11-27  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #495123

	* mail-session.c (mail_session_init):
	Pass the CamelSession to the EAccountComboBox class (ugly hack).

2007-11-26 Nicholas Miell <nmiell@gmail.com>

	** Fix for bug #216485
	Edit->Select thread menu fix and improvement.

	* em-folder-browser.c: (emfb_edit_select_subthread): new function,
	(emfb_enable_map, emfb_verbs) hook it up
	* message-list.c: (select_thread): new function based on
	thread_select_foreach, (thread_select_foreach): remove the logic
	now in select_thread, (message_list_select_thread): use
	select_thread, (subthread_select_foreach): new function,
	(message_list_select_subthread): new function
	* message-list.h: (message_list_select_subthread): add prototype

2007-11-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #494414

	* em-folder-selection-button.c: (set_contents): If used uri points
	to an account, then prepend account's name to folder name.

2007-11-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #494425

	* em-utils.c: (get_unique_file_names):
	New helper function to "assign" unique file name to each part.
	* em-utils.c: (em_utils_save_parts): Use new helper function.

2007-11-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #335931

	* message-list.c: (struct _regen_list_msg): New member last_row.
	* message-list.c: (regen_list_regen): Store last_row for later use.
	* message-list.c: (regen_list_regened): Restore row based on last_row
	when no uid was selected before.
	* message-list.c: (mail_regen_list): Init new last_row member.
	* em-folder-view.c: (emfv_select_next_message): New helper function
	to select messages in list.
	* em-folder-view.c: (emfv_popup_mark_junk), (emfv_popup_mark_nojunk),
	(emfv_popup_delete): Using new helper function, so get same behavior.

	* message-list.h: (struct _MessageList):
	* message-list.c: (on_cursor_activated_cmd): Removed cursor_row member.

2007-11-22  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #498551

	* em-folder-tree.c: (emft_get_folder_info__got):
	Remove placeholder node even for store if no children found.

2007-11-22  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #256899 by Chaya

	* mail-config.glade:
	* em-account-prefs.h: (struct _EMAccountPrefs):
	* em-account-prefs.c: (account_delete_clicked),
	(account_able_clicked), (account_able_toggled),
	(account_cursor_change), (em_account_prefs_construct):
	Remove "Disable/Enable" button from Mail Accounts preferences.

2007-11-20  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #480514

	* em-folder-browser.c: (get_view_query),
	(emfb_search_search_activated): Let work "Last 5 Days' Messages" and
	"Recent messages" filters in Sent folder too.

2007-11-20  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #493783

	* em-format-html.c: (efh_format_timeout): Do not erase old content
	when re-formatting same mail, so keep scroll position.

2007-11-18  Gilles Dartiguelongue  <gdartigu@svn.gnome.org>

	** Fix bug #495875

	* em-folder-tree.c:
	right click menu reordering

2007-11-14  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-tree.c (em_folder_tree_get_selected_folder_info):
	Call camel_folder_info_new() instead of g_new0().

2007-11-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #263236

	* mail.error.xml: Terminology cleanup.

2007-11-12  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #263236

	* mail.error.xml: New message "ask-delete-vfolder-msg".
	* em-folder-view.c: (emfv_delete_msg_response),
	(emfv_popup_delete): When deleting from vFolder, ask if really want
	to and warn about deleting in a real folder too.
	* evolution-mail.schemas.in: New option
	"/apps/evolution/mail/prompts/delete_in_vfolder" to not ask again.

2007-11-08  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-selector.h:
	Fix some typos in the GObject macros.

2007-11-06  Michael Monreal  <mmonreal@svn.gnome.org>

	** Fix for bug #492170

	* em-migrate.c:
	* evolution-mail.schemas.in:
	* mail-config.c:
	Replace the old color definitions with very similar colors from
	the Tango color palette.

2007-11-05  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #343011
	(restore collapse state of selected folder after start)

	* em-folder-tree.c: (emft_maybe_expand_row): Do not expand subtree of
	a node, only make it visible.
	* em-folder-tree-model.h: (em_folder_tree_model_get_expanded_uri),
	(em_folder_tree_model_set_expanded_uri):
	* em-folder-tree-model.c: (em_folder_tree_model_get_expanded_uri),
	(em_folder_tree_model_set_expanded_uri):
	Same as ..._get/_set_expanded, but using 'uri', instead of 'key'.
	* em-folder-tree-model.c: (emftm_uri_to_key): New helper function.
	* mail-component.c: (impl_createView): Restore collapsed state after
	selecting last selected folder, if necessary.

2007-11-05  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #488298

	* em-folder-view.c: (EMFolderViewEnable emfv_enable_map[]):
	Disable "MessageMarkAsNotJunk" if requested by context.
	* mail-folder-cache.c: (update_1folder): Do not count junked
	messages into "new" messages in drafts and out box.
	* em-popup.c: (em_popup_target_new_select): Disable "MarkAsJunk"
	and "MarnAsNotJunk" in drafts and out box.

2007-11-05  Michael Monreal  <mmonreal@svn.gnome.org>

	** Fix for bug #492102

	* em-folder-view.c: Use mail-mark-read icon.

2007-11-05  Milan Crha  <mcrha@redhat.com>

	* em-folder-view.c: (emfv_message_reply): Leak fix.

2007-11-05  Sankar P  <psankar@novell.com>

	* em-folder-tree.c:
	Change enum order. LAST should be the last.
	Regression from #446035
	
	** Fix for bug #493646

2007-10-31  Priit Laes  <plaes@svn.gnome.org>
	
	* em-format-html-display.c: Fix typo in documentation.
	* em-message-browser.c: Ditto.

2007-10-31  Priit Laes  <plaes@svn.gnome.org>

	* mail-component.c: (view_changed): Fix the ordering of the string
	components.

2007-10-30  Michael Monreal  <mmonreal@svn.gnome.org>

	** Fix for bug #446035

	* em-folder-tree.c: (render_pixbuf):
	Use the folder-saved-search icon for vfolders.

2007-10-26  Kjartan Maraas  <kmaraas@gnome.org>

	* e-searching-tokenizer.c: (build_trie), (searcher_new),
	(output_token), (output_match), (merge_subpending),
	(searcher_next_token):
	* em-account-editor.c: (em_account_editor_new), (emae_load_text),
	(emae_check_license), (emae_auto_detect), (smime_sign_key_select),
	(smime_encrypt_key_select), (emae_service_url_path_changed),
	(emae_ssl_changed), (emae_service_provider_changed),
	(emae_refresh_providers), (emae_refresh_authtype),
	(emae_setup_service), (emae_identity_page):
	* em-composer-utils.c: (em_utils_send_receipt),
	(generate_account_hash), (em_utils_camel_address_to_destination),
	(reply_get_composer):
	* em-config.c: (em_config_new):
	* em-event.c: (em_event_peek):
	* em-filter-rule.c: (get_widget):
	* em-folder-browser.c: (generate_viewoption_menu),
	(em_folder_browser_show_preview), (get_view_query),
	(vfolder_setup_do), (emfb_search_search_activated),
	(emfb_list_key_press), (emfb_list_built):
	* em-folder-view.c: (em_folder_view_new),
	(emfv_setup_view_instance), (emfv_popup_forward),
	(emp_uri_popup_vfolder_sender), (emp_uri_popup_vfolder_recipient),
	(emfv_enable_menus):
	* em-format-hook.c:
	* em-format-html-display.c: (efhd_attachment_optional):
	* em-format-html.c: (em_format_html_new),
	(em_format_html_add_pobject), (em_format_html_find_pobject),
	(em_format_html_find_pobject_func), (efh_text_enriched),
	(efh_multipart_related), (efh_format_address), (efh_format_header):
	* em-icon-stream.h:
	* em-inline-filter.c: (emif_add_part), (emif_scan):
	* em-junk-hook.c: (emjh_construct_group):
	* em-mailer-prefs.c: (junk_plugin_setup):
	* em-menu.c: (em_menu_new), (em_menu_target_new_select):
	* em-message-browser.c: (em_message_browser_new):
	* em-popup.c: (em_popup_new), (em_popup_target_new_select):
	* em-sync-stream.c:
	* em-utils.c: (em_utils_save_part_to_file), (tag_editor_response),
	(em_utils_read_messages_from_stream), (em_utils_get_proxy_uri),
	(em_utils_in_addressbook):
	* em-vfolder-rule.c: (validate):
	* importers/elm-importer.c:
	* importers/mail-importer.c: (import_mbox_import),
	(import_folders_rec):
	* importers/pine-importer.c:
	* mail-component.c: (setline_done):
	* mail-folder-cache.c: (flush_updates):
	* mail-mt.c: (mail_msg_new), (checkmem), (mail_msg_check_error),
	(mail_msg_cancel), (mail_msg_wait), (mail_msg_init),
	(do_op_status):
	* mail-send-recv.c: (receive_status), (receive_done),
	(refresh_folders_get):
	* mail-vfolder.c: (mail_vfolder_get_sources_local),
	(mail_vfolder_get_sources_remote), (context_rule_added),
	(store_folder_renamed):
	* message-list.c: (e_mail_address_new), (e_mail_address_compare),
	(get_normalised_string), (ml_search_forward), (ml_search_backward),
	(ml_search_path), (message_list_select_uid),
	(thread_select_foreach), (message_list_copy), (ml_duplicate_value),
	(ml_free_value), (ml_initialize_value), (ml_value_is_empty),
	(ml_value_to_string), (subtree_latest), (sanitize_recipients),
	(ml_tree_value_at), (ml_tree_sort_value_at),
	(message_list_init_images), (filter_date), (build_tree),
	(build_flat_diff), (regen_list_regen):

	Warning fixes:
	- NULL vs. 0 vs FALSE
	- ANSIfication of function declarations
	- Remove unused bits
	- use unsigned ints for 1-bit bitfields
	- invalid pointer type
	- mark a global var static
	- mixing code and declarations

2007-10-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #489027

	* evolution-mail.schemas.in: New hidden option 'thread_latest' to fall
	back to thread sorting like before 2007-05-17 (see below).
	* message-list.c: (struct _MessageListPrivate),
	(message_list_construct): New property 'thread_latest'.
	* message-list.c: (ml_tree_sort_value_at): Sort based on this property.

2007-10-24  Milan Crha <mcrha@redhat.com>

	** Fix for bug #467364 by Christian Kintner

	* evolution-mail.schemas.in: 
	* mail-config.glade: Evolution uses "Emoticon" instead of "Smiley".

2007-10-24  Andre Klapper <a9016009@gmx.de>

	** Fix for bug #261165

	* filtertypes.xml: added search on CC and BCC

2007-10-23  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #271734

	* mail-mt.c: (do_op_status): Show description of operation, if
	available, instead of empty string and end activity properly, if
	operation ended before/during activity start. 

2007-10-15  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view.c:
	Fix broken icon for View -> Zoom -> Normal Size.

2007-10-12  Michael Monreal <michael.monreal@gmail.com>

	** New inbox/outbox/sent icons (bug #479257)

	* mail/em-folder-tree.c, mail/mail-send-recv.c:
	Change icon references.

2007-10-11  Matthew Barnes  <mbarnes@redhat.com>

	* em-format.c (em_format_add_puri):
	Use G_GSIZE_FORMAT when printing a gsize/size_t to make compilers
	on all arches happy.

2007-10-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #323977

	* em-filter-rule.c: (get_widget):
	Use "Add Action" instead of plain "Add" for button label.

2007-10-11  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #329823

	* mail-component.h: (mail_indicate_new_mail):
	* mail-component.c: (mail_indicate_new_mail),
	(struct _MailComponentPrivate), (impl_dispose), (impl_createView):
	New function to indicate new mails on sidebar's button and storing
	component_view in priv struct for later use.
	* em-folder-view.c: (emfv_list_done_message_selected):
	* mail-folder-cache.c: (real_flush_updates):
	Indicate changes like for plugins for new mails.

2007-10-09  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #437579

	* e-searching-tokenizer.c:
	* em-folder-browser.c:
	* em-format-html.c:
	* em-format-view.c:
	* em-format.c:
	* em-mailer-prefs.c:
	* em-mailer-prefs.h:
	* mail-session.c:
	* mail-session.h:
	* mail-vfolder.c:
	* message-list.c:
	Fix various compiler warnings.  Patch from Milan Crha.

2007-10-09  Tobias Mueller  <muelli@auftrags-killer.org>

	** Fix for bug #482575

	* em-folder-view.c: Don't use "insert_image" icon.
	Patch by Michael Monreal <infernux@web.de>

2007-10-09  Bharath Acharya  <abharath@novell.com>

	** Fix for bug #484635

	* em-folder-tree-model.c: (em_folder_tree_model_remove_store_info): 
	Destroy functions in GHashTables to simplify memory management already 
	free the store info. So do no free it again in this function.

2007-10-09  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #477045

	* em-popup.c: (EPopupItem emp_standard_uri_popups[]): Use 'contact-new'
	icon name rather than 'edit-add' for "Add to address book" item.

2007-10-05  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #468736 

	* em-folder-view.c: (em_folder_view_print):
	* em-format.c: (merge_missing), (em_format_merge_handler):
	* em-format.h:

2007-10-04  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #477045

	* em-folder-tree.c:
	Use "document-properties" icon in pop-up menu.

2007-10-03  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #473903

	* mail-send-recv.c: (build_dialog), (receive_get_folder):
	Fixes serious warnings, rest is because of this fix.
	* em-event.c: (em_event_target_new_send_receive):
	* em-event.h: (struct _EMEventTargetSendReceive),
	(em_event_target_new_send_receive):
	Changed structure member and function prototype to reflect fixes.

2007-10-02  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #469657

	* em-composer-prefs.c:
	* em-folder-tree-model.c:
	* em-format.c:
	* em-format-html.c:
	* em-migrate.c:
	* em-subscribe-editor.c:
	* mail-component.c:
	* mail-send-recv.c:
	* message-list.c:
	* importers/elm-importer.c:
	Use destroy functions in GHashTables to simplify memory management.

2007-10-01  Sankar P  <psankar@novell.com>

	* em-format-html.c: (efh_format_headers):
	Display Face header value if contacts doesn't 
	have any image associated with them.
	Fixes bug mentioned in #481235 and not the 
	enhnacement request.

2007-09-27  Matthew Barnes  <mbarnes@redhat.com>

	* em-account-editor.c:
	* evolution-mail.schemas.in:
	* mail-config.glade:
	Use consistent terminology for mail messages (#480621).

2007-09-27  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #477045

	* em-format-html.c (efh_format_headers):
	* em-migrate.c (upgrade_passwords_1_2):
	Use GLib's Base64 API instead of Camel's.

2007-09-27  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	** Fix for bug #461195

	* mail-marshalers.list: Remove needless marshalers.

2007-09-27  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #477045

	* em-folder-tree.c:
	* em-folder-view.c:
	* em-popup.c:
	* mail-component.c:
	* mail-mt.c:
	* mail-send-recv.c:
	* message-list.c:
	Use standard icon names where applicable.

2007-09-21  Matthew Barnes  <mbarnes@redhat.com>

	* Makefile.am:
	Distribute README.async (#478704).

	* importers/Makefile.am:
	Remove references to evolution-outlook-importer.c and
	netscape-importer.c; we haven't shipped them for over two years
	(see ChangeLog entry for 2005-07-01).

2007-09-21  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #411125

	* message-list.etspec:
	Uses 'compare="collate"' instead of 'compare="string"' to handle UTF
	characters correctly.

2007-09-17  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #472865

	* em-composer-utils.c: (ask_confirm_for_unwanted_html_mail):
	Show dialog only when there is any recipient, not always.

2007-09-12  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #476040

	* em-folder-browser.c:
	* message-list.c:
	Use "mail-attachment" icon instead of "stock_attach".

2007-09-12  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #473514

	* em-filter-rule.c: (option_activate), (get_rule_part_widget):
	Allow rule part fill space if requested.

2007-09-12  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #231178

	* filtertypes.xml: Added 'label' filtertype to the list.

2007-09-07  Johnny Jacob  <jjohnny@novell.com>
 
	** Partial Fix for #467581.
	
 	* mail-component.c : (enable_folder_tree) : Get the right URIs for
	selected and current folders.
 	
2007-09-07  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #473903

	* em-folder-utils.c: (new_folder_created_cb),
	(emfu_popup_new_folder_response):
	* em-folder-tree.c: (get_last_child),
	(em_folder_tree_select_prev_path):
	* em-composer-utils.c: (composer_get_message):
	* em-format.c: (em_format_add_puri):
	* em-mailer-prefs.c: (junk_plugin_changed), (junk_plugin_setup):
	Fixes serious compiler warnings.

2007-09-06  Andre Klapper  <a9016009@gmx.de>

	* mail-config.c: (config_cache_labels):
	Don't translate empty label names.
	Fixes bug 363645. Thanks to Bastien Nocera.

2007-09-06  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #304993 (Novell Bugzilla)

	* em-folder-selector.c: (emfs_response): Do allow folder selection of
	created folders.
	* em-folder-utils.c: (new_folder_created_cb): Expand only if selection
	is not asked for.

2007-09-01  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view:
	Use modern icon names for "Junk" and "Not Junk".

2007-08-31  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #377763

	* em-icon-stream.c: (emis_fit): Do not scale under 1x1 pixel.

2007-08-31  Srinivasa Ragavan  <sragavan@novell.com>

	** Move away from g_assert to g_return* calls 

	* em-account-editor.c: (emae_auto_detect), (emae_queue_widgets):
	* em-filter-editor.c: (select_source):
	* em-filter-rule.c: (xml_encode):
	* em-folder-properties.c: (emfp_commit), (emfp_get_folder_item):
	* em-folder-tree-model.c: (folder_renamed):
	* em-folder-tree.c: (em_folder_tree_get_model_storeinfo):
	* em-folder-utils.c: (emfu_popup_new_folder_response):
	* em-folder-view.c: (emfv_setup_view_instance):
	* em-format-html-display.c: (efhd_attachment_optional):
	* em-format-html.c: (em_format_html_add_pobject),
	(efh_format_timeout):
	* em-format.c: (em_format_add_puri):
	* em-migrate.c: (emm_setup_initial):
	* em-sync-stream.c: (sync_op):
	* em-utils.c: (em_uri_to_camel):
	* em-vfolder-rule.c: (em_vfolder_rule_add_source),
	(em_vfolder_rule_find_source), (em_vfolder_rule_remove_source),
	(xml_encode):
	* mail-component.c: (view_control_activate_cb), (setline_done),
	(mail_component_get_folder), (mail_component_get_folder_uri):
	* mail-config-factory.c: (mail_config_control_factory_cb):
	* mail-config.c: (mail_config_get_accounts):
	* mail-folder-cache.c: (mail_note_store_remove), (mail_note_store):
	* mail-mt.c: (do_op_status):
	* mail-ops.c: (mail_append_mail), (mail_transfer_messages):
	* mail-send-recv.c: (free_send_data), (mail_send_receive),
	(mail_receive_uri):
	* mail-session.c: (alert_user):
	* mail-tools.c: (mail_tool_uri_to_folder):
	* mail-vfolder.c: (mail_vfolder_add_uri),
	(mail_vfolder_delete_uri), (mail_vfolder_rename_uri),
	(store_folder_renamed):
	* message-list.c: (get_message_uid), (get_message_info),
	(get_normalised_string), (ml_duplicate_value), (ml_free_value),
	(ml_initialize_value), (ml_value_is_empty), (ml_value_to_string),
	(subtree_unread), (subtree_size), (subtree_latest),
	(ml_tree_value_at), (ml_tree_sort_value_at),
	(ml_tree_set_value_at), (build_subtree), (add_node_diff),
	(remove_node_diff), (build_subtree_diff), (ml_getselected_cb),
	(message_list_thaw):

2007-08-30  Gavin Scott <gavindscott@yahoo.com>

	** Fixes bug #351672

	* em-folder-tree.c: Remove unneeded gtk_drag_finish call
	
2007-08-28  Wadim Dziedzic  <wadimd@svn.gnome.org>

	* default/Makefile.am: added Polish translation of welcome email
	* default/pl: 

2007-08-27  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html.c: Fix a typo build break.

2007-08-27  Johnny Jacob  <jjohnny@novell.com>

	** Fix for #467635.

	* evolution-mail.schemas.in : Changed string.
	
2007-08-27  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #431459

	* em-format-hook.c: (emfh_construct): Enable format plugins while
	loading only.

2007-08-27  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #364700

	* em-junk-hook.c: (em_junk_init): Load/Enable junk plugins while
	loading only.
	* mail-session.c: (mail_session_add_junk_plugin):

2007-08-27  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #256878 from Vincent Untz

	* em-format-html-display.c: Set the string for valid signatures.
	* em-format-html.c:

2007-08-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #414420 by Ed Catmur

	* em-folder-view.c: (struct _EMFolderViewPrivate),
	(emfv_destroy), (emfv_popup_mark_unread), (mst_free),
	(emfv_list_done_message_selected):
	Fix crasher on repeated destroy.

2007-08-24  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #385414 by makuchaku (Mayank)

	* em-format-html.c: (efh_format_source):
	Use ...PRESERVE_8BIT rather than ...ESCAPE_8BIT for message source.

2007-08-24  Bharath Acharya  <abharath@novell.com>

	** Fix for bug #464338

	* em-folder-browser.c: (emfb_folder_create): Fetches the CamelFolderInfo
	from the EMFolderTree.

2007-08-24  Li Yuan  <li.yuan@sun.com>

	* mail-config.glade:
	Fix for #262682. Add labelled-by relation between labels and
	entry.

2007-08-23  Sankar P  <psankar@novell.com>

	reviewed by: Andre Klapper <a9016009@gmx.de>

	* Fix for bug #468869

	* mail-config.glade:
	Mark strings for Translation.

2007-08-22  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #468303

	* em-mailer-prefs.c: (junk_plugin_setup): Add strings for i18n.

2007-08-21  Tobias Mueller  <tobiasmue@svn.gnome.org>

	** Another fix for bug #467382

	* em-folder-view.c: Changing position of emfb_enable_map to 
	be able to compile with -pedantic

2007-08-21  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #468734

	* em-mailer-prefs.c: (label_color_set): color-set signal has no rgba
	passed.

2007-08-20  Matthew Barnes  <mbarnes@redhat.com>

	* mail-component.c (enable_folder_tree):
	Alternate fix for bug #467599 (also bug #467883).

2007-08-20  Tobias Mueller  <tobiasmue@svn.gnome.org>

	** Fix for bug #467382

	* em-folder-browser.c: Changing position of emfb_enable_map to 
	be able to compile with -pedantic

2007-08-20  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #367760

	* em-utils.c: (em_filename_make_safe): Added '#' as non-safe character.
	* em-utils.c: (em_utils_save_part): Using em_filename_make_safe and
	creates filename similar to em_utils_save_parts.
	* em-utils.c: (em_utils_save_parts): Using em_filename_make_safe.

2007-08-20  Johnny Jacob  <jjohnny@novell.com>

	** Fix for bug #467599.
		
	* mail-component.c: (enable_folder_tree): No need to emit a
	folder_selected signal when no folder is selected. Plugged a
	memory leak.
			
2007-08-20  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #467165

	* em-folder-tree.c: (emft_tree_user_event): If the event is null, it
	may be a keyboard event. 

2007-08-16  Milan Crha  <mcrha@redhat.com>

	** Part of fix for bug #350539

	* em-format-quote.c: (emfq_format_headers), (emfq_text_plain):
	* em-format.c: (emf_multipart_alternative), (emf_inlinepgp_signed):
	* em-popup.c: (emp_part_popup_set_background):
	* em-format-html.c: (efh_text_plain), (efh_message_external),
	(efh_format_headers):
	Ensures non-NULL part.

2007-08-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #467198

	* mail-component.c: (enable_folder_tree): Initialize the camel
	exception.

2007-08-16  Johnny Jacob  <jjohnny@novell.com>

	** Fix for #364431.
	
	* em-subscribe-editor.c : (sub_editor_refresh) : Wait for thread
	to finish before refreshing.
	
2007-08-16  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #466548

	* em-composer-utils.c: (em_utils_composer_send_cb):
	e_msg_composer_get_preferred_account can return NULL, so test for it.

2007-08-13  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #352346

	* em-migrate.c (em_update_accounts_2_11), (em_migrate):
	Added function to change "spool" to "spooldir" for those
	spools which points on directories.

2007-08-13  Johnny Jacob  <jjohnny@novell.com>

	** Fix for #458498 from Lucky Wankhede <wlakke@novell.com>
	
	* evolution-mail.schemas.in : String fix.
	
2007-08-08  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-browser.c: (emfb_set_folder): Use the gconf key to
	unselect mail and preview.
	* evolution-mail.schemas.in: Add a new gconf key to have a safe view
	if the selected mail crashes.

2007-08-07  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #464312

	* em-folder-tree-model.c: (em_folder_tree_model_get_selected): If the
	selected uri is empty string, let it be NULL.
	* em-folder-tree.c: (emft_tree_selection_changed),
	(em_folder_tree_select_prev_path): If nothing is selected, remove
	message list and preview.
	* em-folder-view.c: (emfv_set_folder): Don't dup NULL
	* message-list.c: (message_list_set_folder): Don't dup NULL

2007-08-07  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #419690

	* message-list.c: (message_list_construct): FALSE isn't really equal 
	to NULL.

2007-08-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #463061

	* em-mailer-prefs.c: (em_mailer_prefs_construct): Set the signal
	handlers later than assigning values to radio groups.

2007-08-02  Tobias Mueller <muelli@auftrags-killer.org>

	* message-list.c: (regen_list_regened) Removed dead if 
	statement, fixes bug #387312
	
2007-08-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for expanding newly created folders from Lucky

	* em-folder-browser.c: (emfb_folder_create):
	* em-folder-selector.c: (emfs_response),
	(em_folder_selector_set_selected),
	(em_folder_selector_set_selected_list):
	* em-folder-tree.c: (em_folder_tree_set_selected_list),
	(emft_popup_new_folder), (em_folder_tree_set_selected):
	* em-folder-tree.h:
	* em-folder-utils.c: (new_folder_created_cb),
	(emfu_popup_new_folder_response), (em_folder_utils_create_folder):
	* em-folder-utils.h:
	* mail-component.c: (impl_createView), (create_item),
	(create_local_item_cb), (impl_requestCreateItem):

2007-07-31  Veerapuram Varadhan  <vvaradhan@novell.com>

	* em-format-html.c (efh_format_headers): Do not show the
	pretty-"on-behalf-of"-band for all messages that has Sender header
	set, instead rely on the custom X-Evolution-Mail-From-Delegate
	flag that will be added by each providers.
	
2007-07-30  Chenthill Palanisamy  <pchenthill@novell.com>

	* em-format-html.c: (efh_format_headers): Marked 
	a string for translation.
	
	Committing on behalf of Bharath Acharya <abharath@novell.com>	

2007-07-30  Chenthill Palanisamy  <pchenthill@novell.com>

	* em-format-html.c: (efh_format_headers): Displaying a message
	to the recipient of the mail informing him about delegated mails.
	The message is displayed for all mails containing the "Sender" field			       					 
	Committing on behalf of Bharath Acharya <abharath@novell.com>	

2007-07-29  Rob Bradford  <rob@robster.org.uk>

	** Potential fix for: #453668

	* mail-folder-cache.c: (folder_changed):
	Deal with the fact that camel_folder_get_message_info can return NULL
	and therefore don't try and dereference anything from that pointer.

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #459030

	* em-format-html.c (efh_format_address): Workaround broken N_ strings.

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-browser.c: (emfb_list_key_press): Fix a build break with
	Magic spaebar.

2007-07-24  Johnny Jacob  <jjohnny@novell.com>

	** Fix for bug #458894
	
	* em-account-prefs.c : (account_delete_clicked) : Test the
	validity of Iter and select the row accordingly.

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #453544 from hggdh

	* mail.error.xml:

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #428123 from Lucky

	* mail-config.glade:

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #332112 from Lucky

	* mail-send-recv.c: (receive_done):

2007-07-29  Johnny Jacob  <jjohnny@novell.com>

	** Fix for bug #237989

	* em-folder-browser.c : Adding more support for bkspace in magic
	space bar feature.
	* em-folder-tree.c (em_folder_tree_select_prev_path) :
	Added. Select the previous folder.

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #458820 from Cosimo Cecchi

	* em-mailer-prefs.c: (photo_toggle_changed),
	(em_mailer_prefs_construct):

2007-07-29  Srinivasa Ragavan  <sragavan@novell.com>

	* em-mailer-prefs.c: (em_mailer_prefs_construct): Fix a crash while
	starting preferences window.

2007-07-27  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #303937

	* message-list.c: (ml_tree_drag_data_received):
	Don't do anything when ml->folder is NULL.

2007-07-27  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	* em-utils.c: (em_utils_save_parts): Do not free const pointer.
	Plugged memory leak.

2007-07-26  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #273386

	* em-format-html.c: (efh_format_timeout):
	Clear preview and show text "Formatting message" at the beginning.

	* em-format-html-display.c: (efhd_attachment_show):
	Changed debug output to print also pointer address.
	* em-format.c: (emf_clear_puri_node):
	Added debug output to see which memory is going to be freed.
	* em-format-html.c: (efh_url_requested), (efh_format_headers):
	Warnings cleanup.

2007-07-26  Sankar P  <psankar@novell.com>

	* Committed on behalf of  Atos Origin Communication Systems 
	<support-syscom@osorigin.com>
	* em-composer-utils.c: (em_utils_send_receipt):
	- Fixes malformed body part headers for a MDN
	See bug #458275

2007-07-26  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	* em-folder-browser.c: (emfb_search_search_activated): Plugged memory
	leak.

2007-07-17  Sankar P  <psankar@novell.com>

	* em-format-html.c: (efh_format_headers):
	Decodes Face header and displays the image.

2007-07-16  Sankar P  <psankar@novell.com>

	* em-composer-prefs.c: (em_composer_prefs_construct):
	* em-composer-prefs.h:
	* mail-config.glade:
	Provide support for keeping your signature on top
	while replying.

2007-07-11  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c: (efhd_attachment_button): Take warning
	softly instead of a crash.

2007-07-09  Chenthill Palanisamy  <pchenthill@novell.com>

	reviewed by: Veerapuram Varadhan <vvaradhan@novell.com>

	* em-composer-utils.c: (em_utils_send_receipt): Added some flags so that
	the receipts work fine even if the account configured is not the default one.

	Committing on behalf of	Bharath Acharya <abharath@novell.com>
											     
2007-07-09  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view.c: (emfv_setup_view_instance)
	Abort if ETable specification file fails to load.

2007-06-22  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #307410

	* em-utils.[ch]: (em_utils_clear_get_password_canceled_accounts_flag):
	Added new function to clear previously set flag to default value.
	* mail-session.c: (get_password): Storing and using new flag within
	account's service structure.
	* mail-component.c: (impl_sendAndReceive):
	Always clear flag to default when user clicks UI component.

2007-07-09  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #271864 from Hiroyuki Ikezoe

	* mail-component.c: (view_changed):

2007-07-09  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Fix for bug #347782 from hggdh

	* em-format.c: (emf_multipart_encrypted),
	(emf_inlinepgp_encrypted):

2007-07-08  Johnny Jacob  <jjohnny@novell.com>

	* em-composer-utils.c : Added composer.presendcheck event. Fixes
	#334118.
	
2007-07-07  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #317281 from Michael P. Lepore 

	* filtertypes.xml: Add support to search/filter/vfolders on flag
	completion status
	* searchtypes.xml:
	* vfoldertypes.xml:

2007-07-07  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #312370 from B S Srinidhi

	* em-format-html.c: (emfh_gethttp):

2007-07-06  Matthew Barnes  <mbarnes@redhat.com>

	* em-format-html-print.c:
	Use new gtk_html_print_operation_run() function in GtkHTML.

2007-07-04  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Added the hook for plugging into Send/Receive dialog for the
	Evolution RSS plugin.

	* em-event.c: (em_event_target_new_send_receive):
	* em-event.h:
	* mail-send-recv.c: (build_dialog), (mail_send_receive):

2007-07-03  simon.zheng  <simon.zheng@sun.com>

	** Fix for bug #453294

	* em-utils.c: (em_utils_save_parts): Convert filename encoding 
	from UTF-8 to current locale before saving attachement.

2007-07-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #449811

	* em-folder-browser.c: (emfb_list_key_press): Magic space bar works
	only under non-caret mode.

2007-07-02  Wang Xin  <jedy.wang@sun.com>

	Fixes #450820.

	* em-format-quote.c: Add an empty new line at the beginning
	of the mail body when relpying a mail.

2007-06-25  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #352947

	* em-account-editor.c: (smime_sign_key_select),
	(smime_encrypt_key_select): EMAccountEditor isn't a GtkWidget.

2007-06-18  Srinivasa Ragavan  <sragavan@novell.com>
	
        ** Fix for bug #448223 from Gilles Dartiguelongue

	* em-folder-browser.c: (generate_viewoption_menu):

2007-06-18  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #445812 from Gilles Dartiguelongue

	* em-folder-view.c: (emfv_on_url_cb):
	* em-popup.c: (em_popup_target_new_uri):
	* em-popup.h:

2007-06-18  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #437935 from  Gilles Dartiguelongue  

	* em-folder-tree-model.c: (em_folder_tree_model_is_type_inbox):

2007-06-18  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #443659 from Vinod

	* em-account-prefs.c: (account_able_clicked),
	(account_able_toggled), (account_cursor_change):

2007-06-05  Milan Crha  <mcrha@redhat.com>

	** Fix for bug #330175
	
	* em-folder-view.c: (emfv_message_reply):
	Added helper function html_contains_nonwhitespace which returns TRUE
	if selected html text contains at least one non-space character.

2007-06-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Add support for the Magic Space Bar.

	* em-folder-browser.c: (html_scroll), (emfb_init),
	(emfb_list_key_press):
	* em-folder-tree.c: (emft_tree_user_event),
	(em_folder_tree_select_next_path):
	* em-folder-tree.h:

2007-06-15  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c:
	Use ellipsized GtkLabels instead of EClippedLabels (#447727).

2007-06-13  Sankar P  <psankar@novell.com>

	* em-folder-view.c:
	Fixes build break by including missing headers.
	See #442631

2007-06-12  Bastien Nocera  <hadess@hadess.net>

	* em-folder-view.c: (emfv_list_key_press):
	Add support for the XF86Reply and XF86MailForward multimedia
	keys (Closes: #442631)

2007-06-09  Matthew Barnes  <mbarnes@redhat.com>

	* Makefile.am:
	Fix a minor typo spotted by Gilles Dartiguelongue (#386503).

2007-06-05  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-view.c (emfv_on_url_cb):
	Duplicate a translated string since we free it later.

2007-06-05  Daniel Nylander <po@danielnylander.se>

	* default/Makefile.am: Added sv to SUBDIRS

2007-06-04  Matthew Barnes  <mbarnes@redhat.com>

	* mail-ops.h: Fix another implicit function declaration.

2007-05-28  Veerapuram Varadhan  <vvaradhan@novell.com>

	* em-folder-tree.c: (emft_popup_new_folder),
	(em_folder_tree_get_selected_folder_info): Do not fetch
	folder-info from backend - just use the data from the current
	folder tree.

2007-06-03  Srinivasa Ragavan  <sragavan@novell.com>

        ** Fix for version removal from Installed files from Gilles Dartiguelongue 

	* Makefile.am:

2007-06-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #438461 from Gilles Dartiguelongue  

	* mail-config.glade:

2007-06-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #443140 from Vinod

	* mail.error.xml:

2007-06-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #3355396 from Muktha  

	* em-account-editor.c:
	(em_account_editor_folder_selector_button_new):
	* mail-config.glade:

2007-06-03  Srinivasa Ragavan  <sragavan@novell.com>

	* evolution-mail.schemas.in.in: Default for photo to be false.

2007-05-12  Gilles Dartiguelongue  <dartigug@esiee.fr>

	** Compilation warnings cleanup

	* em-composer-utils.c: (composer_get_message):
	* em-event.c: (em_event_target_new_composer):
	* em-filter-folder-element.c: (xml_encode), (xml_decode):
	* em-filter-rule.c: (xml_encode), (load_set), (xml_decode):
	* em-filter-source-element.c: (xml_encode), (xml_decode), (clone):
	* em-folder-browser.c: (emfb_search_config_search),
	(emfb_folder_refresh):
	* em-folder-tree-model.c: (em_folder_tree_model_load_state),
	(find_xml_node), (em_folder_tree_model_get_expanded),
	(em_folder_tree_model_set_expanded), (expand_foreach_r),
	(em_folder_tree_model_expand_foreach),
	(em_folder_tree_model_is_type_inbox),
	(em_folder_tree_model_get_selected),
	(em_folder_tree_model_set_selected):
	* em-folder-tree.c: (tree_drag_data_get), (emft_drop_folder),
	(emft_drop_async_desc):
	* em-folder-view.c: (emfv_selection_get), (emfv_popup_delete),
	(emfv_message_reply), (emfv_on_url_cb):
	* em-format-hook.c: (emfh_construct_group), (emfh_construct):
	* em-format-html-display.c: (em_format_html_get_search_dialog),
	(efhd_html_link_clicked), (efhd_drag_data_get),
	(efhd_bonobo_object), (efhd_optional_button_show),
	(efhd_attachment_optional), (efhd_format_optional):
	* em-format-html.c: (efh_url_requested), (efh_text_plain),
	(efh_text_enriched), (efh_write_text_html),
	(efh_message_deliverystatus), (efh_format_address),
	(efh_format_header):
	* em-format-quote.c: (emfq_format_address), (emfq_format_source),
	(emfq_text_plain), (emfq_text_enriched), (emfq_text_html):
	* em-format.c: (em_format_format_content), (em_format_format_text),
	(emf_multipart_alternative), (emf_message_deliverystatus):
	* em-icon-stream.c: (emis_sync_write):
	* em-inline-filter.c: (emif_add_part), (emif_scan):
	* em-junk-hook.c: (emjh_construct_group), (emjh_construct):
	* em-mailer-prefs.c: (labels_changed), (emmp_header_add_header),
	(junk_plugin_changed), (junk_plugin_setup),
	(em_mailer_prefs_construct), (emmp_header_from_xmldoc),
	(em_mailer_prefs_header_from_xml), (em_mailer_prefs_header_to_xml):
	* em-mailer-prefs.h:
	* em-migrate.c: (xml_find_node), (upgrade_xml_uris),
	(upgrade_xml_uris_1_0), (load_accounts_1_0), (utf8_reencode),
	(upgrade_xml_1_2_rec), (upgrade_passwords_1_2), (is_mail_folder),
	(get_local_et_expanded), (get_local_store_uri),
	(upgrade_vfolder_sources_1_4),
	(em_migrate_folder_view_settings_1_4), (remove_system_searches),
	(emm_setup_initial):
	* em-utils.c: (em_utils_selection_get_mailbox),
	(em_utils_selection_get_message), (em_utils_selection_set_uidlist),
	(em_utils_selection_get_uidlist), (em_utils_selection_set_urilist),
	(em_utils_selection_get_urilist), (em_utils_part_to_html),
	(em_utils_message_to_html):
	* em-utils.h:
	* em-vfolder-rule.c: (xml_encode), (xml_decode),
	(select_source_with_changed):
	* importers/mail-importer.c: (import_mbox_import):
	* mail-component.c: (impl_createView), (status_check):
	* mail-config.c: (mail_config_signature_run_script):
	* mail-session.c: (mail_session_add_junk_plugin):
	* mail-signature-editor.c: (get_text), (menu_file_save_cb):
	* mail-tools.c: (mail_tool_get_local_movemail_path),
	(mail_tool_do_movemail):
	* message-list.c: (address_compare), (get_normalised_string),
	(message_list_setup_etree), (load_hide_state):
	* message-list.h:

2007-06-02  Ross Burton  <ross@openedhand.com>

	* mail-send-recv.c:
	Pass a CamelException when refreshing folders, removing the spew
	of warnings (#439957).

2007-06-02  Srinivasa Ragavan  <sragavan@novell.com>

	* em-utils.c: (em_utils_contact_photo): Removing few debug statements.

2007-06-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Outlook style reply option for bug #415770 from gicmo

	* em-composer-utils.c: (composer_set_body):
	* mail-config.glade:
	* mail-config.h:

2007-06-01  Karl Relton  <karllinuxtest.relton@ntlworld.com>

        ** Fix for bug #311512

	* mail-folder-cache.c (folder_changed): Check the added uids for
	messages which are not seen/deleted/junk and compare their
	received date with the timestamp of the last new-mail notification
	- if any are more recent than that, notify the user.

2007-06-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Adds support for Contact Image in the preview pane

	* em-folder-view.c: (emfv_message_selected_timeout),
	(emfv_setting_notify):
	* em-format-html.c: (efh_format_headers):
	* em-format.c: (emf_init):
	* em-format.h:
	* em-mailer-prefs.c: (em_mailer_prefs_construct):
	* em-mailer-prefs.h:
	* em-utils.c: (em_utils_in_addressbook), (em_utils_contact_photo):
	* em-utils.h:
	* evolution-mail.schemas.in.in:
	* mail-config.glade:

2007-05-31  Daniel Nylander <po@danielnylander.se>

	*default/sv : Added Swedish Welcome mail. 

2007-05-31  Jeff Cai <jeff.cai@sun.com>
	
	* em-folder-view.c (emfv_message_selected_timeout) : 
	use displayed_uid instead of selected_uid.
	Fix #441992

2007-05-28  Jules Colding  <colding@omesc.com>

	* em-utils.c (em_utils_selection_set_urilist): Fix file leak
	(em_utils_selection_get_urilist): Fix file leak

	* importers/evolution-outlook-importer.c (import_outlook_import): Fix file leak

	* importers/mail-importer.c (import_mbox_import): Impossible code branch commented

	* importers/netscape-importer.c (netscape_import_filters): Fix file leak
	(netscape_init_prefs): Fix file leak

2007-05-28  Srinivasa Ragavan  <sragavan@novell.com>

	* evolution-mail.schemas.in.in: Make thread expand default to true.
	The threads should be expanded by default. Bug in previous commit.

2007-05-25  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c:
	Revert the dialog_map() solution and use ellipsized labels.
	Also, only the label column in the GtkTable should expand and fill,
	and never show a horizontal scrollbar.  (#335241)

2007-05-19  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #439512

	* em-mailer-prefs.c: (junk_plugin_changed): Mark strings for
	translation.

2007-05-17  Srinivasa Ragavan  <sragavan@novell.com>

	** Improved GMail like thread sorting. Even expanded threads are
	promoted up the list.

	* message-list.c: (ml_tree_sort_value_at),
	(message_list_construct): Add a provision to sort mails based on the
	lastest date of the thread with out substituting the value for
	display. 

2007-05-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Added support to specify the default thread state for messages.

	* evolution-mail.schemas.in.in:
	* message-list.c: (message_list_construct):

2007-05-15  Srinivasa Ragavan  <sragavan@novell.com>

	** Improved options for offline support.

	* em-folder-view.c: (prepare_offline), (emfv_prepare_offline): Adds
	option for downloading for offline.
	* evolution-mail.schemas.in.in:
	* mail-component.c: (status_check): Adds a option for non-sync while
	going offline.
	* mail-ops.c: (prepare_offline_desc), (prepare_offline_do),
	(prepare_offline_done), (prepare_offline_free),
	(mail_store_prepare_offline):
	* mail.error.xml:

2007-05-13  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #334966 
	* mail-component.c: (view_changed), (view_changed_cb),
	(impl_createView), (impl_quit), (mail_component_init): When the quit
	is happening, never try to set the title.

2007-05-12  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #337616

	* Makefile.am: Add $(schema_DATA) to DISTCLEANFILES.

2007-05-11  Jules Colding  <colding@omesc.com>

	* mail-config.c (mail_config_signature_run_script): file descriptor leaks fixed

2007-05-11  Srinivasa Ragavan  <sragavan@novell.com>

	* GNOME_Evolution_Mail.server.in.in: Add Tango icons to preference
	window.

2007-05-11  Srinivasa Ragavan  <sragavan@novell.com>

	** Added support for Refresh folder and Flush Outbox functions.

	* em-folder-browser.c: (emfb_folder_refresh):
	* em-folder-tree.c: (emft_popup_refresh_folder),
	(emft_popup_flush_outbox), (emft_popup):
	* em-popup.c: (em_popup_target_new_folder):
	* em-popup.h:

2007-05-03  Sankar P  <psankar@novell.com>

	* em-folder-view.c: (emfv_activate):
	Do not restrict "Edit as New Message" to 
	Sent Folder alone.
	Fixes #205728

2007-05-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Added code to improve the new mail hook to provide the number of
	new mails received and if the folder is an INBOX.

	* em-event.c: (em_event_target_new_folder):
	* em-event.h:
	* em-folder-tree-model.c: (em_folder_tree_model_is_type_inbox):
	* em-folder-tree-model.h:
	* mail-folder-cache.c: (real_flush_updates), (update_1folder):

2007-04-20  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #426812

	* em-format-html-print.c:
	* em-format-html-print.h:
	* em-folder-view.c:
	* em-folder-view.h:
	Refactor the printing infrastructure.

2007-04-20  Srinivasa Ragavan  <sragavan@novell.com>

	* em-composer-prefs.c: (signature_key_press): Fix for bug #353662
	from  Baris Cicek.

2007-04-19  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #429422

	* mail-tools.c (mail_tool_get_local_movemail_path):
	* em-utils.c (em_utils_save_part_to_file):
	* em-migrate.c (cp_r), (em_migrate_folder),
	(em_migrate_pop_uid_caches_1_4), (em_migrate_folder_expand_state_1_4),
	(em_migrate_folder_view_settings), (em_migrate_imap_cmeta_1_4),
	(em_migrate_1_4), (emm_setup_initial), (em_migrate):
	* em-folder-tree-model.c (em_folder_tree_model_save_state):
	* mail-component.c (mail_component_init):
	Use g_mkdir_with_parents() instead of e_util_mkdir_hier().

	* mail-send-recv.c:
	Some cosmetic refactoring.

	* mail-send-recv.c (dialog_map):
	Use gtk_widget_set_size_request() instead of gtk_widget_set_usize().

	* mail-send-recv.c (build_dialog):
	e_gtk_button_new_with_icon() is dead; just do it manually.

	* em-format-html-display.c (efhd_bonobo_object):
	* em-format-html.c (efh_init):
	* message-list.c (message_list_init):
	Use g_object_ref_sink() instead of gtk_object_sink().

	* em-account-prefs.c (em_account_prefs_construct):
	Use g_object_ref() instead of gtk_widget_ref().
	Use g_object_unref() instead of gtk_widget_unref().

	* em-folder-view.c (emfv_setup_view):
	Use g_build_filename() instead of g_concat_dir_and_file().

2007-04-18  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #423766

	* em-format-html-display.c (attachments_save_all_clicked):
	Call em_utils_save_part() if there's only one attachment to save.

	* em-utils.c (em_utils_save_part):
	Refactor to use gtk_dialog_run() instead of a "response" callback.

	* em-utils.c (em_utils_save_parts):
	Refactor to use gtk_dialog_run() instead of a "response" callback.
	Use gtk_file_chooser_get_uri() to fetch the selected folder.

2007-04-11  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-view.c: (emfv_spin), (emfv_message_selected_timeout): Add
	a progress spinner widget in the preview while fetching messages.

2007-04-09  Hiroyuki Ikezoe  <poincare@ikezoe.net>

	** Fixes bug #343195 

	* em-folder-properties.c: (emfp_dialog_got_folder): Get total number
	of mails with CAMEL_FOLDER_TOTAL if the folder is junk folder.

2007-04-06  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #383953

	* em-folder-properties.c (emfp_get_folder_item):
	Show unread messages before total messages.

	* mail-component.c (view_changed):
	Show unread or selected messages before total messages.

2007-04-06  Matthew Barnes  <mbarnes@redhat.com>

	* message-list.c: More intelligent message selection.  (#332765)
	Patch from Christof Krüger

2007-04-06  Matthew Barnes  <mbarnes@redhat.com>

	* mail-session.c (main_system_beep): Unref 'session'.  (#424795)
	Patch from Karl Relton

2007-04-05  Matthew Barnes  <mbarnes@redhat.com>

	* mail-send-recv.c (refresh_folders_get):
	Provide a CamelException to camel_folder_refresh_info().

2007-04-04  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-tree.c (emft_model_row_changed):
	Update parent rows when a child row changes.  (#352713)
	Patch by René Stadler.

2007-04-03  Srinivasa Ragavan  <sragavan@novell.com>

	* em-migrate.c: (emm_setup_initial): Fix for evolution on crashing
	while setting up the first account.

2007-04-03  Matthew Barnes  <mbarnes@redhat.com>

	* em-event.h: Don't #include <composer/e-msg-composer.h> since we
	don't install that file.  Doing so prevents third-party applications
	like mail-notification from building. (#400241)

2007-04-03  Srinivasa Ragavan  <sragavan@novell.com>

	Reworked the SPAM plugins with more UI options and support for
	multiple plugins.

	* em-folder-view.c:
	* em-junk-hook.c: (emjh_construct_item), (emjh_construct):
	* em-junk-hook.h:
	* em-mailer-prefs.c: (junk_days_activate), (emmp_empty_junk_init),
	(junk_plugin_changed), (junk_plugin_setup),
	(create_combo_text_widget), (em_mailer_prefs_construct):
	* em-mailer-prefs.h:
	* evolution-mail.schemas.in.in:
	* mail-component.c: (impl_createView), (mc_quit_delete),
	(impl_quit):
	* mail-config.glade:
	* mail-session.c: (init), (mail_session_add_junk_plugin),
	(mail_session_get_junk_plugins):
	* mail-session.h:

2007-04-03  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #411331

	* em-folder-browser.c: (emfb_gui_folder_changed): Fix the message
	selection.

2007-04-03  Matthew Barnes  <mbarnes@redhat.com>

	* evolution-mail.schemas.in.in:
	Correctly capitalize SpamAssassin.  (#375577)
	Patch from Priit Laes.

2007-04-03  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-browser.c:
	* em-folder-view.c:
	* message-list.c:
	Load "emblem-important" instead of deprecated
	"stock_mail-priority-high" icon.  (#387619)
	Patch from Rodney Dawes.

2007-04-01  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #373117

	* em-composer-prefs.c:
	* em-composer-prefs.h:
	* em-mailer-prefs.c:
	* em-mailer-prefs.h:
	* mail-config.glade:
	Migrate from GnomeColorPicker to GtkColorButton.

2007-03-30  Matthew Barnes  <mbarnes@redhat.com>

	* em-format-html-display.c (icon_entry_changed_cb): Fix a typo.

2007-03-29  Matthew Barnes  <mbarnes@redhat.com>

	* em-utils.c:
	* mail-config.c:
	Evolution requires GLib 2.10 now; remove dead backward-compatibility
	code for GLib < 2.8 (#418971).

2007-03-29  Matthew Barnes  <mbarnes@redhat.com>

	* em-account-editor.c:
	* em-folder-view.c:
	* em-format-html-display.c:
	* em-format-html.c:
	* em-format.h:
	* em-mailer-prefs.c:
	* em-vfolder-rule.c:
	* mail-ops.c:
	* mail-send-recv.c:
	* message-list.c:
	Fix "incompatible pointer type" warnings (#360619).

2007-03-27  Matthew Barnes  <mbarnes@redhat.com>

	* em-mailer-prefs.c:
	* em-mailer-prefs.h:
	* mail-config.glade:
	Migrate from GnomeFontPicker to GtkFontButton (#373837).

2007-03-27  Matthew Barnes  <mbarnes@redhat.com>

	* em-folder-browser.c:
	* em-format.c:
	* em-popup.c:
	Don't mix declarations and code (#405495).

2007-03-20  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #419524

	* Include <glib/gi18n.h> instead of <libgnome/gnome-i18n.h>.

	* em-migrate.c (emm_setup_initial): Use g_get_language_names()
	instead of gnome_i18n_get_language_list().

2007-03-16  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes part of bug #360240

	* em-vfolder-rule.c (select_source_with_changed), (get_widget):
	* em-format-quote.c (emfq_format_source):
	* mail-ops.c (save_messages_save):
	* em-format.c (emf_init):
	* em-format-html-display (em_format_html_get_search_dialog),
	(em_format_html_display_seearch_with), (ehhd_resize),
	(efhd_attachment_optional), (efhd_format_optional):
	* em-folder-view.c (emfv_init):
	* message-list.c (ml_tree_value_at):
	Remove unused variables.

2007-03-12  Harish Krishnaswamy <kharish@novell.com>

	*default/C : Update Welcome mail. 

2007-02-27  Simon Zheng  <simon.zheng@sun.com>

	* Fixes #402727
	
	* em-folder-view.c: (em_folder_view_print),
	Remove setting default response id because 
	of print-preview button in print_unix_dialog
	aren't set GTK_CAN_DEFAULT flag.

2007-02-26  Sankar P  <psankar@novell.com>

	* Committed on behalf of 
	Raghavendran R <raghavguru7@gmail.com>

	* Fixes #256382

	* em-folder-view.c: (emfv_mail_next_unread),
	(emfv_mail_previous_unread):
	Mail grabs the focus when keyboard-shortcut 
	to move to next (un)read mail is used.

2007-02-23  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #356177

	* mail-session.c: Remove an unused EMutex.

2007-02-12  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #350253

	* em-format-html-print.h:
	Rename show_rupert field to show_icon.

	* em-format-html-print.c (efh_format_headers):
	Lookup the evolution icon by name.

2007-02-12  Kjartan Maraas  <kmaraas@gnome.org>

	* em-folder-browser.c: (emfb_search_search_activated):
	Add NULL check before calling strcmp(). Fixes a crash
	reported in bug #382155.

2007-02-12  Srinivasa Ragavan  <sragavan@novell.com>

	** Print migration updates from Ebby Wiselyn

	* em-folder-browser.c:
	* em-folder-view.c: (emfv_print_response), (em_folder_view_print):
	* em-format-html-print.c: (efhp_footer_cb), (emfhp_complete),
	(mail_draw_page):

2007-02-10  Duarte Loreto <happyguy_pt@hotmail.com>

	* default/pt/Inbox: Updated welcome message to 2.8 version

2007-02-08  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #400726

	* em-format-html-print.c: #include <e-util.e-print.h>

2007-02-07  Matthew Barnes  <mbarnes@redhat.com>

	** Fixes bug #359979, #384183

	* em-camel-stream.c (sync_op):
	* em-sync-stream.c (sync_op):
	* mail-session.c (alert_user):
	e_msgport_wait()'s behavior is now block-and-pop instead of
	block-and-peek.

2006-09-12  Ushveen Kaur <kushveen@novell.com>

	** Fixes bug #353921

	* em-format-html.c: (em_format_html_get_search_dialog): "Back"
	and "Forward" buttons changed to "Previous" and "Next"
	respectively.

2007-01-24  Wang Xin <jedy.wang@sun.com>

	* em-folder-browser.c: Fixes 397195.

2007-01-22  Raghavendran R <raghavguru7@gmail.com>

       * em-event.[c,h]: (em_event_target_new_composer):
          Creates and returns an event target (composer).
	
2007-01-22  Srinivasa Ragavan  <sragavan@novell.com>

	** GtkPrint migration patch from Ebby Wiselyn.

	* em-folder-view.c: (emfv_print_response), (em_folder_view_print):
	* em-format-html-print.c: (efhp_finalise), (efhp_footer_cb),
	(emfhp_complete), (mail_draw_page), (em_format_html_print_print),
	(em_format_html_print_message), (em_format_html_print_raw_message):
	* em-format-html-print.h:

2007-01-17  Srinivasa Ragavan  <sragavan@novell.com>

	** Downstream fix from OpenSUSE

	* message-list.c: Fix for compiler warning.

2006-01-08  Veerapuram Varadhan  <vvaradhan@novell.com>

	** Fixes 346728, 268412
	
	* mail/em-subscribe-editor.c: (sub_fill_level): When a folderinfo
	has no child but CAMEL_FOLDER_NOCHILDREN not set, create a place
	holder node, such that, on-expanding it, folders will be loaded on
	demand.  This saves quite-a-lot-of-memory and time when an account
	has lots of public-folders - viz., exchange/IMAP
	(sub_row_expanded): Check for the place-holder node and fire-up a
	pending.
	(sub_row_activated): Just expand and collapse the tree accordingly
	- rest will be taken care by sub_row_expanded()
	(sub_folderinfo_free): Once fillin is over, expand the node - iff
	node is non-null.

2006-12-22  Simon Zheng  <simon.zheng@sun.com>

	* mail/em-account-editor.c: (emae_setup_service):
	Fix the regression of bugzilla bug #352108.

2006-12-21  Nickolay V. Shmyrev  <nshmyrev@yandex.ru>

	* mail/em-format-html-display.c: (efhd_image_unallocate),
	(efhd_attachment_image):
	
	Disconnect handlers on image destroy. Fixes bug
	#340165.

2006-12-18  Sankar P  <psankar@novell.com>

	* mail-send-recv.c: (get_folders):
	Do not check for mails in all folders, for Exchange.
	Will be more than useful when you have a lot of folders.

2006-12-05  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-browser.c: (generate_viewoption_menu): Added icon/image to
	the quick search items.

2006-12-04  Matthew Barnes  <mbarnes@redhat.com>

	Fixes bug #382431

	* em-format.c: Fix implicit declaration of function
	'mail_config_get_message_limit'.

2006-12-04  Matthew Barnes  <mbarnes@redhat.com>

	Fixes bug #357970

	* em-folder-browser.c:
	* em-folder-view.c:
	Don't call deprecated GLib / GDK functions.

2006-12-03  Harish Krishnaswamy  <kharish@novell.com>

	* mail-component.c: (mc_startup): Do not attempt to
	prune GW proxies on startup as this handled by the plugin
	now.

2006-11-28 Daniel Gryniewicz <dang@gentoo.org>

	** Fix for bug #349966

	* em-utils.c: (emu_save_part_response), (em_utils_save_part),
	(emu_save_parts_response), (em_utils_save_parts),
	(emu_save_messages_response), (em_utils_save_messages):
	* evolution-mail.schemas.in.in:

2006-11-26  Srinivasa Ragavan  <sragavan@novell.com>

	* Fix for bug #337439 DoS attach with large emails

	* em-format-html-display.c: (efhd_class_init),
	(efhd_attachment_popup), (efhd_format_attachment),
	(efhd_optional_button_show), (efhd_resize),
	(efhd_attachment_optional), (efhd_format_optional):
	* em-format-html.c: (efh_text_plain), (efh_text_enriched),
	(efh_write_text_html), (efh_message_deliverystatus):
	* em-format-quote.c: (emfq_format_source), (emfq_text_plain),
	(emfq_text_enriched), (emfq_text_html):
	* em-format.c: (emf_init), (em_format_format_content),
	(em_format_format_text), (emf_message_deliverystatus):
	* em-format.h:
	* em-mailer-prefs.c: (mlimit_count_changed),
	(em_mailer_prefs_construct):
	* em-mailer-prefs.h:
	* em-utils.c: (em_utils_part_to_html), (em_utils_message_to_html):
	* evolution-mail.schemas.in.in:
	* mail-config.c: (gconf_mlimit_size_changed),
	(gconf_mlimit_changed), (mail_config_init),
	(mail_config_get_address_count), (mail_config_get_message_limit):
	* mail-config.glade:
	* mail-config.h:

2006-11-09  Francisco Javier F. Serrador  <serrador@openshine.com>

	* default/Makefile.am: Added "es" to SUBDIRS
	
2006-11-09  Francisco Javier F. Serrador  <serrador@openshine.com>

	* default/es/Inbox: Added Spanish welcome mail.
	* default/es/Makefile.am: Added Makefile

2006-11-09  Sankar P  <psankar@novell.com>

	* em-folder-browser.c: (emfb_view_hide_selected):
	* em-folder-view.c: (emfv_popup_delete):
	* mail.error.xml:
	Disable mail delete for proxy when there are not enough rights

2006-10-16  Tor Lillqvist  <tml@novell.com>

	Fix for #348212:

	* mail-mt.h: On Win32 we don't want to use the mail_thread_queued
	variable outside the libevolution-mail DLL, but instead access its
	value through a getter function.

	* mail-mt.c: Make mail_thread_queued static on Win32.
	(mail_win32_get_mail_thread_queued): New function that returns the
	value of mail_thread_queued.

2006-10-16  Chris Heath  <chris@heathens.co.nz>

	* mail-component.c (create_local_item_cb): Fix memory leak.
	Fixes bug #360815.

2005-10-16  Sankar P  <psankar@novell.com>

	* mail-ops.c: (em_filter_folder_element_describe)
	Changes the string displayed in the status bar.
	Fixes #320615

2006-10-16  Ushveen Kaur <kushveen@novell.com>

	** Fixes bug #308276

	* mail.error.xml : secondary for "vfolder-notunique" corrected.

2006-10-16  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Fix for bug #333864 and bug #351374 

	* em-format-html-display.c: (efhd_image_resized),
	(efhd_image_unallocate), (efhd_attachment_image): Make sure that the
	callback is removed when the puri is destroyed.

2006-09-30  Harish Krishnaswamy  <kharish@novell.com>

	* em-format-html-display.c: (em_format_html_get_search_dialog):
	Do not mark empty strings for translation. Fixes #357422.
	
2006-09-29  Daniel Gryniewicz  <dang@gentoo.org>

	* em-folder-view.c: ignore marked, empty selections when replying.
	Fixes bug #354650. (committed by Andre Klapper)

2006-09-29  Nick Sukharev  <nick@galaktika.ru>

	* mail/em-format-html.c: UUEncoded calendars will be displayed as 
	calendars, not as plain text. Fixes bug #352767.
	(committed by Andre Klapper)

2006-09-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #341932 Patch from Roozbeh Pournader
	
	* em-format-html.c: (efh_format_header): patch to enlarge
	the buffer for printing date.

2006-09-29  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes a lot of search issue.

	* em-folder-browser.c: (emfb_init), (em_folder_browser_show_wide),
	(vfolder_setup_desc), (emfb_search_search_activated),
	(emfb_edit_cut), (emfb_edit_select_all), (emfb_set_folder):

2006-09-28  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Pushing a downstream fix in SUSE.
	
	* message-list.c: (message_list_init), (message_list_destroy),
	(folder_changed), (regen_list_regened): Fix to indicate object destroy 
	* message-list.h: removed the old mechanism.

2006-09-18  Matthew Barnes  <mbarnes@redhat.com>

	Fixes #351332

	* em-folder-view.c:
	* em-format-html-display.c:
	Fix implicit function declarations.

2006-09-14  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #353920

	* em-folder-browser.c: (emfb_search_search_activated): Mark two
	messages for translation which have not been marked by accident.

2006-09-13  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #355294

	* em-folder-view.c: (emfv_popup_delete): Set the cursor on delete.

2006-09-09  Wouter Bolsterlee  <uws+gnome@xs4all.nl>

	* default/nl/Inbox: Dutch welcome message updated by
	Vincent van Adrighem and Wouter Bolsterlee.

2006-09-04  Nickolay V. Shmyrev <nshmyrev@yandex.ru>

	* mail-component.c: (impl_dispose)
	(view_changed_timeout_remove) (view_changed_timeout):
	Fixes a crash on exit-time issue. Resolves #334966
	
2006-08-29  Li Yuan <li.yuan@sun.com>

	* em-folder-browser.c: (em_folder_browser_show_preview):
	remove GNUC only macro.
	Fix for #353344.

2006-08-28  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #352982 and bug #336983
	
	* em-folder-view.c: (emfv_popup_delete), (emfv_select_all_text):
	Fixes the issue of thread jumping on delete and enables COPY menu item
	when clicking Select All Text.

2006-08-28  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html.c: (efh_format_address): Fix for a crash during
	displaying camel address group.

2006-08-28  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #353059

	* em-folder-browser.c: (generate_viewoption_menu): Added translated
	strings to search, which are already translated.

2006-08-27  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #352980

	* em-folder-view.c: (em_folder_view_get_popup_target): Disable deleted
	for deleted message, and dont allow to workaround DEL key to move to
	next message.

2006-08-26  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #336983
	
	* em-folder-view.c: (emfv_init), (emfv_on_html_button_released_cb):
	Enable/disable Edit->Copy on button release on html.

2006-08-24  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #352695

	* message-list.c: (regen_list_regened): Dont store the save state, if
	the search is in place.

2006-08-23  Srinivasa Ragavan  <sragavan@novell.com>

	* em-utils.c: Update the doc for em_utils_temp_save_part.

2006-08-02  Ushveen Kaur <kushveen@novell.com>

	** Fixes bug #347238

	* em-utils.h : Added a boolean variable to determine the readonly mode
	* em-utils.c (em_utils_temp_save_part) : Save in readonly mode or not.
	* em-popup.c (emp_apps_open_in) : set Read only for "open in"
	attachments.
	* em-format-html-display.c (efhd_drag_data_get) : Set 644 for dnd
	attachments.
	* mail-ops.c (save_part_save): 	File permissions changed to 644 
	while saving the attachment and drag and drop.

2006-08-22  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Fix for bug #350337

	* message-list.c: (ml_tree_value_at): Patch from Daniel Gryniewicz to
	check the null string.

2006-08-22  Andre Klapper  <a9016009@gmx.de>

	* default/C/Inbox: Update the Welcome mail.

2006-08-22  simon.zheng  <simon.zheng@sun.com>

	** Fixes for bug #352108

	* em-account-editor.c: (emae_service_url_path_changed),
	(emae_path_changed),
	(emae_setup_service):
	Replace widget GnomeFileEntry by GtkFileButton.

2006-08-21  Matthew Barnes  <mbarnes@redhat.com>
  	 
	* mail-send-recv.c:
	Silence Camel exception warning at startup - fixes bug 352248.

2006-08-21  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Fixes a lot of search issues including widget packing.

	* em-folder-browser.c: (generate_viewoption_menu),
	(viewoption_menu_generator), (emfb_realize), (emfb_init),
	(em_folder_browser_show_preview), (emfb_search_search_activated),
	(emfb_search_search_cleared), (emfb_list_key_press),
	(emfb_list_message_selected), (emfb_set_search_folder):
	* em-folder-view.c: (emfv_init), (emfv_message_search),
	(em_folder_view_get_popup_target), (emfv_setting_notify):
	* em-folder-view.h:
	* em-message-browser.c: (emmb_init):

2006-08-19  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #350884
	
	* message-list.c: (subtree_latest), (ml_tree_value_at): Sort thread
	based on the date of last message received.

2006-08-17  Kjartan Maraas  <kmaraas@gnome.org>

	* message-list.c: (create_composite_cell): Plug a leak.

2006-08-17  Kjartan Maraas  <kmaraas@gnome.org>

	* em-format-html.c: (efh_url_requested): Plug a leak.

2006-08-09  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-browser.c: (em_folder_browser_get_wide),
	(emfb_activate): Get the wide status from the priv struct when
	available already instead of gconf.
	* em-folder-browser.h: 
	* em-folder-view.c: (emfv_setup_view_instance): Get the wide status
	from the parent struct. It avoids a race, where it shows compressed
	headers in classic view and vice versa.

2006-08-09  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #348565

	* em-format-html-display.c (efhd_bar_resize) (efhd_add_bar): Check 
	the bar size, 	before setting the width. The width goes to zero, 
	when switching from classic to vertical view and vice versa.

2006-08-09  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #350411 #350476
	
	* em-mailer-prefs.c (notify_sound_changed): When prefs comes up,
	nothing is set in FILE chooser, so it returns NULL and bypass it.
	(em_mailer_prefs_construct): Get the file chooser widget before
	setting radio active.

2006-08-08  Harish Krishnaswamy  <kharish@novell.com>

	* em-folder-tree.c: Add header glib/gi18n.h to provide the missing
	symbol required by the previous commit. This was an ugly crasher
	on the release tarball candidate.
	
2006-08-07  Karsten Bräckelmann  <guenther@rudersport.de>

	* em-folder-tree.c (render_display_name): Marking vFolder names in
	the folder tree localizable. Fixes bug #330915 (Roozbeh Pournader).

2006-08-04  Johnny Jacob  <jjohnny@novell.com>

	* em-format-html-display.c : Added mnemonic for "Fi_nd" and
	"Fo_rward".
	* em-folder-browser.c : (get_view_query) : Added query for
	"messages masrked as important"
	
2006-08-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #335241

	* mail-send-recv.c: (dialog_map), (build_dialog): Let the send receive
	dialog grow to a fixed size, before we show the scroll bar. 

2006-07-26  Alessandro Decina <alessandro@nnva.org>

	** Fix for bug #348164
	
	* em-folder-browser.c: (emfb_class_init):
	Remove the unused G_TYPE_STRING parameter from the
	account_search_activated and account_search_cleared signals.

	* mail-component.c: (disable_folder_tree), (enable_folder_tree):
	Update the callbacks to match the new signature.

2006-07-28  Sankar P  <psankar@novell.com>

	* committed on behalf of Srinivasa Ragavan <sragavan@novell.com>
	* em-icon-stream.c: (emis_fit):
	We dont scale on height if the maxheight is zero
	Fixes 335431
		
2006-07-26  Veerapuram Varadhan  <vvaradhan@novell.com>

	** Fixes bgo bug #333821 and bnc bug 181851

	* mail-folder-cache.c: (ping_store_ping): Ping store only iff
	store is online and connected.
	
2006-07-26  Arvind <sa.phoenix@gmail.com>

	** Fix for bug #274276

	* em-folder-selection-button.c: (set_contents): Localizes the folder 
	names in the filter and while importing mail

2006-07-26  Andre Klapper  <a9016009@gmx.de>

	* em-folder-browser.c: correcting a grammar bug. Fixes bug #348674.

2006-07-24  Ushveen Kaur  <kushveen@novell.com>

	** Fixes Bug #341840
	
	* mail-error.xml: button label changed for dialog ask-mark-read.

2006-07-24  Sushma Rai  <rsushma@novell.com>

	* em-account-editor.c: (emae_option_entry) : activate the mnemonic for
	text box, add an extra paramenter to the function call.
	Fixes #332282.
	Patch submitted by "Vandana Shenoy .B <shvandana@novell.com>"

2006-07-24  Sushma Rai  <rsushma@novell.com>

	* em-subscribe-editor.c (_EMSubscribeEditor): Removed the members 
	subscribe_button and unsubscribe_button.
	(sub_do_subscribe)(sub_subscribe)(sub_editor_subscribe)
	(sub_editor_unsubscribe): Removed.
	(sub_selection_changed)(em_subscribe_editor_new): Removed the handling
	for the subscribe and unsubscribe buttons.

	* mail-dialogs.glade: Removed "Subscribe" and "Unsubscribe" buttons.
	Fixes #331509.

2006-07-22  Yuri Pankov <yuri.pankov@gmail.com>

	Reviewed by Harish Krishnaswamy <kharish@novell.com>

	* message-list.c: Add missing headers. Fixes #344744.

2006-07-22 Yuri Pankov <yuri.pankov@gmail.com>
	
	Reviewed by Harish Krishnaswamy <kharish@novell.com>

	* em-format-html-display.c: Add missing headers.
	* mail-vfolder.h: Add function prototypes.Fixes #347689.

2006-07-21  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #346316

	* em-folder-browser.c: (em_folder_browser_show_wide): Redraw the child
	widgets and pack it accordingly.

2006-07-20  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c: (efhd_attachment_bar_refresh): Modified
	the mnemonics for avoiding the conflict with search.

2006-07-19  Johnny Jacob  <jjohnny@novell.com>

	** Fix for bug #347993
	
	* em-folder-browser.c : Changed default scope of search to
	'Current Folder'

2006-07-14 Raghavendran R <raghavguru7@gmail.com>

	** Fix for bug #330355

	 * em-mailer-prefs.c:Mailer Preferences. New mail notification,
	"specify filename" was enabled for radNotifyNot and radNotifyBeep.
	Disable the button, when it wasnt for button.

2006-06-10 Shree Krishnan <shreekrishnan@gmail.com>

	** Fix for bug #338442
	* mail-config.glade: Set the mnemonic character for "Send message receipts" 

2006-07-18  Andre Klapper  <a9016009@gmx.de>

	* message-tags.glade: remove "*" from translation. Fixes bug #331147.

2006-07-14  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #336963

	* em-folder-browser.c: (emfb_init): Make the scrollbar automatic.

2006-22-06 Ushveen Kaur <kushveen@novell.com>

	** Fixes bug #335241

	* mail-send-recv.c: a scroll box added for the send recv popup dialog.

2006-07-14  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #335747

	* em-folder-browser.c: (emfb_mark_all_read): Prompt optionally while
	marking multiple messages.
	* evolution-mail.schemas.in.in: Added a schema for prompting while
	marking multiple messages.

2006-07-13  Andre Klapper  <a9016009@gmx.de>

	* mail-config.glade: remove empty strings from translation

2006-07-11  Karsten Bräckelmann  <guenther@rudersport.de>

	* em-folder-view.c: Change mnemonic for Mark as Unimportant, fixes
	bug #347246.

2006-07-11  Johnny Jacob  <johnnyjacob@gmail.com>

	Fixes #246235.
	* em-vfolder-rule.c (get_widget): Deleted the option menu and
	replaced with radio buttons.
	* mail-dialogs.glade: Removed option menu and added radio buttons

2006-07-11  Johnny Jacob  <johnnyjacob@gmail.com>

	** Fixes Bug # 324241

	* mail/em-composer-prefs.c (em_composer_prefs_construct): Changed
	signal handled for sig_edit and sig_delete from "pressed" to
	"clicked".

2006-07-11  Johnny Jacob  <jjohnny@novell.com> 

	** Patch by Not Zed  <NotZed@Ximian.com>
	** See bug #262003

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked): put
	the potentially long descriptions into a textbuffer so it's
	scrollable.

2006-07-07 Ushveen Kaur <kushveen@novell.com>

	Fixes bug #336963.
	* em-message-browser.c:
	set the scroll bar in the message display to automatic
	
2006-07-07  Andre Klapper  <a9016009@gmx.de>

	* em-format-html-display.c: Changing one mnemonic to avoid a
	mnemonic conflict with an upcoming patch by Jony.

2006-07-05  Andre Klapper  <a9016009@gmx.de>

	* em-format-html-display.c: Added mnemonic to string.
	Fixes bug #346645.

2006-06-30  Johnny Jacob <jjohnny@novell.com>
	* mail/em-folder-browser.h: Added search_activated signal
	* mail/em-folder-view.c: (emfv_init):
	* mail/em-format-html-display.c: (efhd_search_response),
	(efhd_search_response_back), (efhd_search_destroy),
	(efhd_search_case_toggled), (efhd_key_pressed),
	(clear_button_clicked_cb), (icon_entry_changed_cb),
	(em_format_html_get_search_dialog), (set_focus_cb),
	(em_format_html_display_search),
	(em_format_html_display_search_with),
	(em_format_html_display_search_close):
	* mail/em-format-html-display.h:
	* mail/mail-component.c: (disable_folder_tree),
	(enable_folder_tree), (impl_createView):
	* mail/mail-vfolder.c: (mail_vfolder_add_uri),
	(mail_vfolder_get_sources_local),
	(mail_vfolder_get_sources_remote), (store_folder_renamed):
	* mail/message-list.c: (ml_tree_value_at),
	(message_list_setup_etree):
	* mail/message-list.etspec:
	Added code for search ui.

2006-06-27  Matthew Barnes  <mbarnes@redhat.com>

	* evolution-mail.schemas.in.in:
	Changed type name "boolean" to "bool". Fixes bug #345677.

2006-06-27  Arvind_evo  <sa.phoenix@gmail.com>
		
	Fix for bug#260354 comment 35:
	* mail-component.c: set the window title to reflect the
	localized folder names

2006-06-21  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #344338
	
	* em-folder-browser.c: (emfb_edit_select_all): grab focus after
	Ctrl+A.

2006-06-19  Srinivasa Ragavan  <sragavan@novell.com>

	** Fix for bug #344580

	* message-list.c: (create_composite_cell),
	(composite_cell_set_strike_col), (message_list_set_folder): Strike out
	deleted mails, if set to visible

2006-06-14  Tor Lillqvist  <tml@novell.com>

	* em-account-editor.c (emae_check_complete): g_get_real_name()
	returns UTF-8 on Win32.

2006-06-13  Andre Klapper <a9016009@gmx.de>

	* mail.error.xml: changing string "Ximian Evolution" to "Evolution".
	Fixes bug #344298.

2006-06-13  Tor Lillqvist  <tml@novell.com>

	* em-format-html.c (efh_format_address): Fix build on Win32, where
	EVOLUTION_ICONSDIR is a function call.

2006-06-12  Srinivasa Ragavan  <sragavan@novell.com>

	* message-list.etspec: Corrected the sortable parameter of the message
	list correctly.

2006-06-29  Chris Heath <chris@heathens.co.nz>

	* message-list.c (message_list_finalise): Fix memory leak.
	Fixes bug #335423.

2006-06-07  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html.c: (efh_format_address): Fixed a minor bug, where the
	plus symbol appears if the limit equals the address shown.

2006-06-06  Harish Krishnaswamy  <kharish@novell.com>

	* evolution-mail.schemas.in.in: typo correction.
	Fixes #331694.

2006-06-02  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-view.c (emfv_setup_view_instance): Can't make camel
	calls from the main thread or we run the risk of deadlocking.

2006-06-02  Srinivasa Ragavan  <sragavan@novell.com>

	** Added support for Vertical View in evolution in addition to the
	existing classical view. It also supports a composite headers to be
	shown in a multilined column.

	* em-folder-browser.c (emfb_pane_realised),
	(emfb_pane_button_release_event, emfb_init),
	(em_folder_browser_show_preview, em_folder_browser_show_wide),
	(emfb_show_next, emfb_show_below, emfb_activate): Added code to
	handle the new wide mode in Evolution.

	* em-folder-view.c (emfv_setup_view_instance),
	(em_folder_view_setup_view_instance): Added code to handle the
	default view in the wide mode for normal and sent/draft folders.

	* evolution-mail.schemas.in.in: Added schema for hpane size,
	showing email in the composite headers and toggling wide more.
	
	* message-list.c (ml_duplicate_value, ml_free_value),
	(ml_initialize_value, ml_value_is_empty, ml_value_to_string),
	(sanitize_recipients, ml_tree_value_at, create_composite_cell),
	(message_list_create_extras): Added a new composite header
	render_composite_from/recipient which shows the headers in a
	multilined column.

	* message-list.etspec: Added three new columns, Recipent, Messages
	column for normal folders and Messages column for sent/draft
	folders.

2006-05-30  Li Yuan  <li.yuan@sun.com>

	Fix for #341381.

	* message-list.c (message_list_set_folder): We should lock
	e-tree-memory when we change it.

2006-05-30  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #332936

	* mail.error.xml: Used a new property called scroll that adds the
	multilines error messages into a viewport.

2006-05-25  Srinivasa Ragavan  <sragavan@novell.com>

	** Added remote shares save/load support across evolution.

	* em-utils.c (emu_file_check_local, emu_get_save_filesel),
	(emu_save_part_response, emu_save_parts_response),
	(emu_save_messages_response): Added code to save
	messages/attachments to remote shares.

	* mail-ops.c (save_messages_save, save_part_save): Same.

2006-05-25  Srinivasa Ragavan  <sragavan@novell.com>

	** fixes bug #342092

	* em-popup.c (emp_standard_menu_factory): Read the mime from the
	right file.

2006-05-25  Srinivasa Ragavan  <sragavan@novell.com>

	Added support for collapsible headers for To/Cc/Bcc fields.

	* em-folder-view.c (emfv_format_link_clicked, emfv_on_url_cb):

	* em-format-html-display.c (efhd_html_button_press_event),
	(efhd_html_link_clicked, efhd_html_on_url, efhd_format_clone):

	* em-format-html.c (efh_url_requested, efh_format_text_header),
	(efh_format_address, efh_format_header):

	* em-mailer-prefs.c (address_compress_count_changed),
	(toggle_button_init, em_mailer_prefs_construct):

	* evolution-mail.schemas.in.in:

	* mail-config.c (gconf_address_count_changed),
	(gconf_address_compress_changed, mail_config_init),
	(mail_config_get_labels, mail_config_get_address_count):

	* mail-config.glade:

2006-05-24  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #342676
	
	* message-list.c: (ml_duplicate_value), (ml_free_value),
	(ml_initialize_value), (ml_value_is_empty), (ml_value_to_string):
	* message-list.etspec: Fixed the column sorter right.

2006-05-04  Jeffrey Stedfast  <fejj@novell.com>

	* mail-component.c (mail_component_remove_store): Ref the store
	before removing the store from our hash and cache. Should fix
	Novell bug #166987.

2006-04-30  Shi Pu <shi.pu@sun.com>
 
	** Fixes bug #323853

	* em-composer-prefs.c (sig_edit_cb, sig_add_script_response):

	* em-mailer-prefs.c (notify_sound_changed)
	(em_mailer_prefs_construct):

	* em-mailer-prefs.h:

	* mail-config.glade: Replace GnomeFileEntry by
	GtkFileChooserButton.
 
2006-04-27  Rodney Dawes  <dobey@novell.com>

	* em-folder-tree.c (render_pixbuf): Use gnome-fs-trash-empty
	rather than stock_delete for the Trash folder icon

	* em-folder-view.c (emfv_popup_items[]): Don't set an icon for
	Undelete
	(emfv_message_pixmaps[]): Don't set an icon for Undelete and set
	the icon for deleting a message to gnome-fs-trash-empty, not
	stock_delete

	Fixes #339626

2006-04-26  Srinivasa Ragavan  <sragavan@novell.com>

	** Patch from Victor for adding a Sender header to message list.

	* message-list.c (ml_duplicate_value, ml_free_value),
	(ml_initialize_value, ml_value_is_empty, ml_value_to_string),
	(ml_tree_value_at): Handled the new column header.

	* message-list.etspec: Added a new column header to spec.

	* message-list.h: Added a new column

2006-04-26  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-view.c (emfv_setup_view_instance): Comparing the
	FolderInfo flags right, to make Mailbox to show From header in
	message list for groupwise servers.

2006-04-26  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #323402

	* em-folder-tree.c (folder_tree_new): Code for Ellipsizing folder
	tree. (Patch from Vincent Noel)

	* em-migrate.c: Adding side_bar_search to 

	* evolution-mail.schemas.in.in: Adding a schema for enabling/disabling
	side bar search. (Patch from Rakesh)

2006-04-24  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-session.c (get_password): Ask passphrase if the user is
	supposed to enter the same.

2006-04-22  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c (efhd_attachment_button),
	(efhd_format_attachment): Added code to create image cache of
	image attachment in the ethread instead of main thread to avoid
	gui lockup.

2006-04-21  Sankar P  <psankar@novell.com>

	* mail-mt.c (do_op_status): Fix the cryptic
	hexa-status-bar-message.  The problem still lies somewhere. But
	dont show something weird to the user.
	
2006-04-20  Jeffrey Stedfast  <fejj@novell.com>

	Fix for bug #339052

	* em-inline-filter.c (emif_add_part): Preserve all Content-Type
	params so that they may be restored later.

	* em-format.c (emf_inlinepgp_signed): Restore the original part's
	Content-Type params otherwise we lose valuable information such as
	charset or format=flowed or various other things.

2006-04-18  Jeffrey Stedfast  <fejj@novell.com>

	* mail.error.xml: Removed error id "camel-exception" as it was a
	bogus error.

2006-04-14  Jeffrey Stedfast  <fejj@novell.com>

	* em-composer-utils.c (em_utils_handle_receipt): Fixed up the if
	conditional so that 'account' wasn't ever dereferenced when
	NULL. Fixes bug #324327.

2006-04-10  Jeff Cai <jeff.cai@sun.com>

	** Fixes 333243

	* em-folder-tree-model.c (em_folder_tree_model_remove_folders):
	For null uri, don't need remove it.

2006-04-05  Jeff Cai  <jeff.cai@sun.com>

	Fixes bug #333987
	
	* message-list.c (mail_folder_hide_by_flag):
	If CamelMessageInfo is null, don't free it.

2006-03-29  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	* em-folder-view.c (smfv_setup_view_instance): use the flags
	CAMEL_STORE_FOLDER_INFO_SUBSCRIBED instead of
	CAMEL_STORE_FOLDER_INFO_FAST when getting folder info

2006-03-25  Rajeev ramanathan <rajeevramanathan_2004@yahoo.co.in>

	**Fixes #329585

	* mail-config.glade: Changed Remove button to Delete button

	* mail.error.xml: Changed current Layout DELETE [Do not delete] to
	[Do not delete] DELETE

2006-03-22  Patrick Ohly  <patrick.ohly@intel.com>

	* em-utils.c (em_utils_selection_set_urilist): Fixed premature
	memory free. Fixes bug #335203.

2006-03-21  Simon Zheng  <simon.zheng@sun.com>

	Fixed bug #326571

	* em-utils.c (em_filename_make_safe, emu_get_save_filesel):
	(emu_save_parts_response): Add em_filename_make_safe(), and use it
	to allow filenames contain more valid characters when saving
	attachments.

2006-03-20  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-view.c (emfv_setup_view_instance): Added code to set
	the mail view column for sent folder.

2006-03-12  Frank Arnold  <farnold@cvs.gnome.org>

	* default/de/Inbox: Updated German translation of default inbox.

2006-03-06  Simon Zheng  <simon.zheng@sun.com>

	Fixes bug #332140

	* em-utils.c (em_utils_temp_save_part): Transfer filenames from
	utf-8 to glib encoding before really saving files.

2006-03-03  Andre Klapper  <a9016009@gmx.de>

	* configure.in:

	* mail/default/Makefile.am: added support for macedonian (mk)
	welcome message

2006-03-03  Vincent van Adrighem  <adrighem@gnome.org>

	* default/nl/Inbox: Tino Meinen updated the Dutch welcome message.

2006-03-03  Žygimantas Beručka  <zygis@gnome.org>

	* default/Makefile.am: Added Lithuanian to SUBDIRS.
	* default/lt/*: Added Lithuanian translation for default mailbox.

2006-03-02  Ilkka Tuohela  <hile@iki.fi>

	* fi.po: Updated Finnish inbox to actually use 2.6 example, not
	the old one...

2006-03-01  Ilkka Tuohela  <hile@iki.fi>

	* default/Makefile.am: added "fi" to SUBDIRS
	* default/fi/*: Added localized default mailbox for Finnish,

2006-02-28  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #332832

	* em-composer-utils.c (em_utils_compose_new_message_with_mailto):
	Added code to raise the window when a composer is created due to
	mailto: uri

2006-03-01  Andre Klapper  <a9016009@gmx.de>

	* default/C/Inbox: Update the Welcome mail.

2006-02-27  Jeffrey Stedfast  <fejj@novell.com>

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	Make the verify/decrypt gpg diagnostic text selectable in the
	security dialog that comes up when you click the button in a
	message. Fixes bug #268414.

2006-02-24  Sankar P  <psankar@novell.com>
	
	* em-account-editor.c (emae_check_complete, emae_identity_page):
	Added code to handle the case if the account is marked as default.
	Fixes #332034

2006-02-21  Veerapuram Varadhan <vvaradhan@novell.com>

	** Fixes bug #329733

	* em-folder-properties.c (emfp_dialog_got_folder): Fetch both
	VISIBLE and DELETED count from the folder and adjust it according
	before showing it in the properties dialog w.r.t user preferences.
       
2006-02-21  Tor Lillqvist  <tml@novell.com>

	* em-composer-utils.c: Use the same Win32 macro for gmtime_r()
	that guards against gmtime() returning NULL as elsewhere. gmtime()
	is thread-safe on Win32.
	(attribution_format): Check if camel returns
	CAMEL_MESSAGE_DATE_CURRENT for Date:, try the date from Received:
	then. If that doesn't work either, use current date.

2006-02-20  Srinivasa Ragavan <sragavan@novell.com>

	** Fixes bug #322160 and committed for PRSuman.

	* em-utils.c: Added code to pass a variable to overwrite/ro mode.

	* mail-ops.[ch]: Added code to take care of overwrite and set the file
	mode.

t2006-02-20  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	** Fixes bug 33139

	* mail-vfolder.c: (mail_vfolder_shutdown):
	assign 'vfolder_hash' to NULL after destroying.

	Committed Patch on behalf of Joe Marcus Clarke (marcus@freebsd.org)

2006-02-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #331215
	
	* em-folder-browser.c: (emfb_activate): Uncommented the code to set
	the preview pane position.

2006-02-15  Parthasarathi Susarla <sparthasarathi@novell.com>

	* mail-mt.c (do_op_status): need to show the stauts message

2006-02-15  Shi Pu <shi.pu@sun.com>

	See bug ** 325967
	
	* em-account-editor.c (emae_service_url_changed): When username
	entry value of "Sending Email" page/tab is not empty, check combo
	box of authmech, to pick up the authmech information.

2006-02-13  Karsten Bräckelmann  <guenther@rudersport.de>
 
	* em-account-editor.c: Fix the Account Editor / Security option to
	finally be descriptive, rather than obscuring. Fixes the UI part
	of bug #321797.

2006-02-13  Rohini S  <srohini@novell.com>

	** Fixes bug #221270.

	* mail-send-recv.c (build_dialog): Removed white space before :
	when displaying account information in Send/Receive dialog.

2006-02-13  Andre Klapper <a9016009@gmx.de>

	* mail-mt.c: uncommenting a string. Fixes bug 271734.

2006-02-13  Sushma Rai  <rsushma@novell.com>

	* mail/em-account-editor.c (emae_option_checkspin)
	(emae_receive_options_extra_item): Creating the widget with 
	"use_underline" property. Fixes #330504.

2006-02-11  Andre Klapper <a9016009@gmx.de>

	* mail-config.glade: changed string and added translator comments.
	Fixes bug 256907.

2006-02-11  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* message-list.c (message_list_construct): 
	* em-format-html-display.c (efhd_attachment_button, efhd_add_bar): 
	* em-account-prefs.c (em_account_prefs_treeview_new): 
	Change a11y names. Fixes part of bug #330723.

2006-02-10  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* em-utils.c (em_utils_edit_filters): Fix Filters dialog window
	title to be HIG compliant. Fixes bug #330650.

2006-02-09  Sushma Rai  <rsushma@novell.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): Freeing font value 
	string. See #309316.

2006-02-08  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* mail.error.xml: Fix typo and correct phrasing. Fixes bug #330387.

2006-01-09  Kjartan Maraas  <kmaraas@gnome.org>

	* em-account-editor.h: s/int/guint/g for 1-bit bitfield.
	* em-composer-utils.c: (em_utils_redirect_message): Remove cruft
	* em-folder-tree.c: (emft_drop_target): use guint for 1-bit bitfield
	and rename a variable with a name clash.
	* em-folder-utils.c: (em_folder_utils_rename_folder): Rename var to
	avoid name clashes.
	* em-folder-view.c: guint for 1-bit bitfields.
	* em-folder-view.h: Same as above.
	* em-format-html-print.h: Again.
	* em-format-html.c: (efh_text_html), (efh_multipart_related): Add comments
	* em-format.c: (emf_multipart_alternative): Add comment about using var that
	is passed in rather than a local variable.
	* em-inline-filter.c: (emif_scan): Remove unused var. Mark code static.
	* em-mailer-prefs.h: guint for 1-bit bitfields.
	* em-migrate.c: (em_migrate_folder): mark a struct static. remove unused var
	* em-subscribe-editor.c: guint for 1-bit bitfield
	* em-utils.c: remove unused function
	* em-vfolder-rule.c: mark array static
	* importers/mail-importer.c: (decode_status): Remove unused code. Use guint
	for 1-bit bitfield.
	* mail-autofilter.c: (rule_from_message): rename a variable
	* mail-component.c: guint for 1-bit bitfield
	* mail-folder-cache.c: (update_1folder): remove unused code
	* mail-mt.c: mark some structs static
	* message-list.c: (message_list_select_uid), (ml_value_to_string),
	(ml_tree_value_at), (find_next_undeleted), (build_tree),
	(build_flat): Remove unused code and fix some format specifiers.

2006-02-08  Rajeev ramanathan <rajeevramanathan_2004@yahoo.co.in>

	**Fixes #329586

	* em-account-prefs.c:

	* em-account-prefs.h: Changed the ODD behavior of Default button
	by checking whether an account is default or not and disabling the
	button when default account is in focus.

	Committing to head on behalf of rajeev
	
2006-02-08  Claudio Saavedra  <csaavedra@alumnos.utalca.cl>

	* em-account-prefs.c (em_account_prefs_construct): Reordering
	construction of dialog to prevent critical warnings (#328325).

2006-02-07  Andre Klapper <a9016009@gmx.de>
	* mail.error.xml: fixing one typo.

2006-02-06  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #328651
	
	* em-folder-view.c:
	* em-format-html-display.c:
	* evolution-mail.schemas.in.in:
	* mail-config.c (config_cache_labels):

2006-01-27  Rajeev ramanathan <rajeevramanathan_2004@yahoo.co.in>
	
	** Fixes bug #325786

	* em-folder-browser.c: Added code to display a prompt before
	marking All messages as Read.

	* mail-error.xml: Added a new error message for marking all
	message as read.

2006-02-06  Veerapuram Varadhan <vvaradhan@novell.com>

	** Fixes #326147

	* em-account-editor.c: (em_account-editor.c): Modify e_source to
	reflect to the reverted changes.
	
2006-02-05  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* importers/pine-importer.c (pine_getwidget): Correcting
	"Addressbook" to properly read "Address Book".  Fixes bug #326256.

2006-02-02  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	* em-composer-utils.c (em_utils_handle_receipt): check if account
	is null before accessing it

2006-01-30  Harish Krishnaswamy  <kharish@novell.com>

	* mail-config.glade: s/T_erminal/Fi_xed width/ for consistency with other
	GNOME applications.

2006-01-30  pavithran <pavithran@gmx.de>

	** Fixes bug #316223

	* em-utils.c (emu_save_parts_response): Added a confirmation
	dialog for overwriting existing file during save all.

2006-01-27  Rajeev ramanathan <rajeevramanathan_2004@yahoo.co.in>

	** Fixes #327000

	* em-format-html-display.c: Added code to change cursor to notify
	user on image fit to width

2006-01-26  Oswald Rodrigues <ozzy_rodrigues@yahoo.com>

	* em-popup.c: Corrected typo. changed Add to Addressbook to Add 
	to Address Book. Fixes bug 326256.

2006-01-23  Andre Klapper <a9016009@gmx.de>

	* mail.error.xml: fixed a typo. Fixes bug 328306.

2006-01-23  Ranjan Somani  <sranjan@novell.com>

	** Fixes #326795

	* em-message-browser.c: Pressing Esc key lets u close the window

2006-01-20  Nancy Cai <nancy.cai@sun.com>
	
	** Fixes #326649

	* em-account-prefs.c (mail_accounts_load): select the first row

2006-01-23  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c (efhd_attachment_bar_refresh),
	(efhd_mnemonic_show_bar), (efhd_add_bar): Added Mnemonics for Save
	/ Save All and for show/hide attachment bar.

2006-01-19  Ranjan Somani  <sranjan@novell.com>

	** Fixes #318785

	* mail-config.glade: Resizing of Default n Enable button
 
	committing on behalf of Ranjan -partha
	 
2006-01-19  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	** See bug 324327

	* em-composer-utils.c (em_utils_handle_receipt): account can be
	null. Not necessary to send receipt when account is not enabled

2006-01-16  Harish Krishnaswamy  <kharish@novell.com>

	* mail-component.c (impl__get_userCreatableItems): remove shortcut
	keys (UI Hackfest - See
	http://go-evolution.org/Shortcut_Keys_Review).

2006-01-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #326877

	* em-folder-view.c (emfv_enable_menus): Reverting the patch to
	hide junk/not junk toolbuttons in disabled state.

2006-01-16  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #218570

	* em-folder-browser.c (emfb_expand_all_threads),
	(emfb_collapse_all_threads), (emfb_set_folder), (emfb_activate):
	Added code to handle expande/collapse all and call e-tree for regen of
	the list.
	* message-list.c (load_tree_expand_all),
	(message_list_set_threaded_expand_all),
	(message_list_set_threaded_collapse_all),
	(message_list_set_expand_all), (regen_list_regened): Added code to
	conditionally check for expand/collapse all and save the state after
	the operation.
	* message-list.h: Added state variable for expand/collapse all of
	threads.

2006-01-12  Rohini S  <srohini@novell.com>

	** Fixes bug #221270.

	* mail-send-recv.c (format_url, build_dialog): Changed to display
	account name in Send/Receive dialog.

2006-01-16  Srinivasa Ragavan  <sragavan@novell.com>

	* em-format-html-display.c (em_format_html_display_new): Changed
	event to scroll_event in rajeev's patch.

2006-01-12  Rohini S  <srohini@novell.com>
	
	** Fixes bug #246257

	* mail-dialogs.glade: Interchange of label and checkbox 
	positions in Find message dialog

	* em-format-html-display.c (efhd_update_matches),
	(em_format_html_display_search): Hide Matches Label on dialog open
	and Show Matches Label when required. Fixes bug 246257.

2006-01-16  Srinivasa Ragavan  <sragavan@novell.com>
	
	** Fixes bug #239929 (Committing Rajeev's patch)

	* em-format-html-display.c (efhd_scroll_event),
	(em_format_html_display_new): Adds handler to zoom-in/out on
	control scroll.
	
2006-01-13  Srinivasa Ragavan  <sragavan@novell.com>

	* em-folder-browser.c (emfb_etree_unfreeze, emfb_list_built):

	* message-list.c (message_list_setup_etree):

	Fixes the scroll issue with the message list.

2006-01-12  Srinivasa Ragavan  <sragavan@novell.com>

	* GNOME_Evolution_Mail.server.in.in:

	Changes MailView accel from Control+F1 to Control+1.

2006-01-10  Simon Zheng  <simon.zheng@sun.com>

	* em-composer-utils.c:
	* em-folder-tree-model.c (em_folder_tree_model_save_state):
	* em-format-html.c:
	* em-migrate.c (cp_r, em_migrate_folder),
	(em_migrate_pop_uid_caches_1_4),
	(em_migrate_folder_expand_state_1_4),
	(em_migrate_folder_view_settings_1_4), 
	(em_migrate_imap_cmeta_1_4),
	(em_migrate_1_4, emm_setup_initial), 
	(em_migrate):
	* em-popup.c:
	* em-utils.c (em_utils_save_part_to_file):
	* mail-component.c (mail_component_init):
	* mail-config.c:
	* mail-folder-cache.c:
	* mail-mt.c:
	* mail-ops.c:
	* mail-tools.c (mail_tool_get_local_movemail_path):
	Use e_util_mkdir_hier() instead of e_mkdir_hier().

	Use e_util_strstrcase() instead of e_strstrcasea().
    
	use e_strftime() in evolution-data-server/
	libedataserver/e-data-server-util.c instead of the copy in 
	evolution/e-util/e-util.c.
 
	use e_filename_make_safe() in evolution-data-server/
	libedataserver/e-data-server-util.c instead of the copy in 
	evolution/e-util/e-util.c.
	
	use e_utf8_strftime() in evolution-data-server/
	libedataserver/e-data-server-util.c instead of the copy in 
	evolution/e-util/e-util.c.

2006-01-06  Andre Klapper <a9016009@gmx.de>

	* evolution/mail/mail-ops.c:

	* evolution/mail/mail-send-recv.c:

	* evolution/mail/mail-session.c: changing "cancelled" (British
	English) to "canceled" (American English). Fixes bug 325334.

2006-01-06  Simon Zheng <simon.zheng@sun.com>

	* em-account-editor.c:
	* em-account-prefs.c:
	* em-composer-utils.c:
	* em-folder-tree-model.h:
	* em-migrate.c:
	* em-subscribe-editor.c:
	* em-utils.c:
	* importers/netscape-importer.c:
	* mail-config.c:
	* mail-crypto.c:
	* mail-ops.h:
	* mail-send-recv.c:
	* mail-vfolder.c:
	use libedataserver/e-account-list.h instead of e-util/e-account-list.h.
	use libedataserver/e-account.h instead of e-util/e-account.h.

2006-01-04  Srinivasa Ragavan  <sragavan@novell.com>

	* mail-tools.c: Uncommented mail_tool_get_local_movemail_path for
	non-win32 builds since it is used in non-win32 build.

2006-01-04  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	* em-composer-utils.c (em_utils_composer_send_cb): Use the
	composer window as the parent window while showing the error
	message.

2006-01-02  Shreyas Srinivasan  <sshreyas@novell.com>

	* mail.error.xml: Fix 313095, Add error identifier
	ask-delete-proxy-accounts. 
	
2006-01-02  Harish Krishnaswamy  <kharish@novell.com>

	* em-folder-view.c (emfv_setting_notify): Remove the first check
	in the previous commit.  This is redundant as it is always
	guaranteed that the component has been activated at this point.
	And when not, it ought to crash :-).

2006-01-02  Harish Krishnaswamy  <kharish@novell.com>

	reviewed by: Parthasarathi <sparthasarathi@novell.com>

	* em-folder-view.c (emfv_setting_notify): Set the properties on
	the bonobo component only if it already has been activated. Fixes
	#325375 (critical warning crasher).

2006-01-01  Changwoo Ryu  <cwryu@debian.org>

	* em-folder-properties.c (emfp_dialog_got_folder): translate
	the labels of emfp_items.

	* em-account-editor.c (em_account_editor_construct): translate
	the labels of emae_{editor,druid}_items.
	
2006-01-01  Harish Krishnaswamy  <kharish@novell.com>


	* em-utils.c (em_utils_prompt_user),
	mail-config.glade, mail.error.xml:
	s/don't/do not/ string changes. Fixes #325276.

2005-12-30  Andre Klapper <a9016009@gmx.de>

	* mail.error.xml: Fixing several typos and harmonizing
	  capital/small letters. Partially fixes bug 306117.

2005-12-30  Andre Klapper <a9016009@gmx.de>

	* mail-session.c: changing "canceled" to "cancelled" to stay
	  consistant to the rest.  Fixes bug 325116.

2005-12-30  Andre Klapper <a9016009@gmx.de>

	* evolution-mail.schemas.in.in: added quotes to literal values.
	  Fixes bug 272772.

2005-12-29  Andre Klapper <a9016009@gmx.de>

	* em-folder-properties.c: removed wrong singular string.
	  Fixes bug 311472.

2005-12-22  Andre Klapper <a9016009@gmx.de>

	* mail-config.glade: changed one duplicated mnemonic.
	  Fixes bug 313801.

2005-12-20  Andre Klapper <a9016009@gmx.de>

	* mail-config.glade: changing file selector window title from
	  "Execute command..." to "Select sound file". Fixes bug 324173.

2005-12-19  Andre Klapper <a9016009@gmx.de>

	* mail-config.glade: changed 3 HIG-violating mnemonics.
	  Fixes bug 256913.

2005-12-23  Srinivasa Ragavan  <sragavan@novell.com>

	** Fixes bug #228040, #324677

	* em-folder-view.c (emfv_popup_flag_completed),
	(emfv_popup_flag_clear, emfv_enable_menus): Added menus for
	complete and clear. Also added code to refresh preview on setting
	flags. Also added code to hide junk/not-junk menu depending on
	their sensitivity.

	* em-utils.c (tag_editor_response, em_utils_flag_for_followup):
	Added code to refresh preview.
	
2005-12-22  Shreyas Srinivasan  <sshreyas@novell.com>

	* mail-component.[c,h]: Handle Network Disconnect
	sent by the shell. Add function status_check which 
	handles various Network states.
	
2005-12-21  Tor Lillqvist  <tml@novell.com>

	* em-camel-stream.c (em_camel_stream_init)
	* em-sync-stream.c (em_sync_stream_init): Use
	g_io_channel_win32_new_socket() on Win32 instead of
	g_io_channel_unix_new() to avoid confusion between file
	descriptors and sockets (which can and do overlap!). We know that
	e_msgport_fd() returns a socket on Win32.

2005-12-21  Not Zed  <NotZed@Ximian.com>
 
	* mail-component.c (impl_createView, view_changed_cb): api
	updates.
 
2004-12-21  Not Zed  <NotZed@Ximian.com>

	** See bug #60354.

	* mail-component.c (view_changed_cb): set the shell window title
	as well.
	(impl_createView): renamed from createControls, just return a
	EComponentView instead.

	Committed on behalf of notzed - partha

2005-12-21  Jeff Cai <jeff.cai@sun.com>

	** See bug 324473

	* em-account-editor.c (em_account_editor_construct): delete
	reference to account editor to make sure be destroyed when it is
	closed.

2005-12-21  Sam Yang  <sam.yang@sun.com>

	Fixes #324670

	* em-folder-view.c (emfv_setting_notify): Respond to the change of
	mail/display/paned_size in gconf.

2005-12-20  Veerapuram Varadhan  <vvaradhan@novell.com>

	Fixes #246256

	* mail-dialogs.glade: Change "Case _Sensitive" to "Case _sensitive".
	
2005-12-20  Boby Wang <Boby.Wang@sun.com> 

	** See bug 324319

	* em-format-html-display.c (efhd_add_bar): Add the accessible name
	of arrow button, and the attachment bar can be opened by gok.

2005-12-20  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	** See bug 234008

	* em-folder-tree-model.c:
	* mail-folder-cache.c:
	Make sure that the Draft folder highlights the number of messages in
	it
	
2005-12-18  Tor Lillqvist  <tml@novell.com>

	* Makefile.am: Use THREADS_CFLAGS and _LIBS. Don't need	CAMEL_LIBS.

	* em-account-editor.c
	* em-account-prefs.c
	* em-filter-editor.c
	* em-folder-browser.c
	* em-folder-view.c
	* em-format-html.c
	* em-format-html-display.c
	* em-mailer-prefs.c
	* em-message-browser.c
	* em-migrate.c
	* em-subscribe-editor.c
	* em-sync-stream.c
	* em-utils.c
	* em-vfolder-editor.c
	* em-vfolder-rule.c
	* mail-autofilter.c
	* mail-component.c
	* mail-config.c
	* mail-folder-cache.c: Use gstdio wrappers. Construct pathnames of
	glade, xml, etspec and png files at run-time. Use
	g_filename_{to,from}_uri().

	* em-folder-browser.c (emfb_init)
	* em-folder-view.c (emfv_finalise)
	* em-message-browser.c (emmb_init): As EMFolderView::ui_files now
	always is a list of filenames constructed with g_build_filename(),
	use g_free() on each list entry before calling g_slist_free() on
	the list.

	* em-folder-tree-model.c (em_folder_tree_model_load_state): Use
	e_xml_parse_file().

	* em-migrate.c: Bypass all the code for upgrading from 1.x on Win32.
	(emm_setup_initial): Use GDir instead of dirent.

	* em-sync-stream.c
	* mail-folder-cache.c: Use pthread_equal() to compare pthread_t
	values.

	* em-vfs-stream.c: No EINPROGRESS or ELOOP on Win32.

2005-12-17  Tor Lillqvist  <tml@novell.com>

	* mail-mt.c: Add copyright blurb. Use separate flag field to
	indicate whether a pthread_t field is valid or not. Use
	e_util_pthread_id() in debugging output.

	* mail-mt.c
	* mail-session.c
	* mail-vfolder.c: Include just <gtk/gtk.h> and not a handful of
	individual gtk headers. Harmonize #include order and syntax. Use
	pthread_equal() to compare pthread_t values.

	(em_channel_setup): Call g_io_channel_win32_new_socket() on Win32
	instead of g_io_channel_unix_new(). This avoids the occasional
	"giowin32.c:1661: 12 is both a file descriptor and a socket, file
	descriptor interpretation assumed." style warnings, which indicate
	a real problem in this case.

	* mail-ops.c: Use gstdio wrappers. Open file in binary mode.

	* mail-signature-editor.c
	* mail-tools.c
	* mail-vfolder.c
	* message-list.c
	* message-tag-followup.c: Beautify #include order and syntax. Use
	gstdio wrappers. Construct pathnames of files to be read at
	run-time instead of using compile-time paths.

	* mail-tools.c (mail_tool_get_local_movemail_path): Not used, put
	in #if 0.

	* importers/elm-importer.c
	* importers/evolution-mbox-importer.c
	* importers/evolution-outlook-importer.c
	* importers/mail-importer.c
	* importers/netscape-importer.c
	* importers/pine-importer.c: Use GLib API when
	applicable.

2005-12-16  Sam Yang  <sam.yang@sun.com>

	** Fixes bug #323867.

	* em-folder-view.c (emfv_setting_notify): Respond to the change of
	/apps/evolution/mail/display/show_deleted and thread_list in
	gconf.

2005-12-12  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* em-folder-view.c: Mail Context Menu re-ordered correctly,
	fixes bug #323140.

2005-12-12  Shreyas Srinivasan  <sshreyas@novell.com>

	* mail.error.xml: Fix #47857
	
2005-12-05  Shi Pu  <shi.pu@sun.com>

	See bug ** 323253

	* mail-send-recv.c (format_url): If url->host is NULL or it is
	emtpy, don't print it out in send & receive dialog.

2005-11-28  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-view.c (emfv_setting_notify): literal strings do not
	need to be \0 terminated, they are already nul-terminated by
	definition.

2005-11-28  Sam Yang  <sam.yang@sun.com>

	** See bug #322414

	* em-folder-view.c (emfv_setting_notify): Respond to the change of
	/apps/evolution/mail/display/show_preview in gconf.

2005-11-25  Tor Lillqvist  <tml@novell.com>

	* em-composer-prefs.c (sig_add_script_response): Use gstdio
	wrappers.
	(url_requested): Use g_filename_from_uri()
	instead of just stripping off the "file:" prefix.
	(em_composer_prefs_construct): Construct glade file pathname at
	run-time for Win32 install-anywhere.

2005-11-23  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	** See bug #315987

	* em-composer-utils.c (em_utils_composer_send_cb): Send only if
	account is enabled
	(em_utils_composer_save_draft_cb): Save message to server folder
	only if the account is enabled, else save it locally
	(generate_account_hash): Add default account into the account hash
	only if the account none of the account is enabled.
	(guess_account): use only enabled account

	* mail.error.xml: Add error message for send-no-account-enabled

2005-11-11  Boby Wang <boby.wang@sun.com>

	** See bug 321214.

	* mail-config.glade: Focus on the Tools-> Settings-> Composer
	Preferences -> Forward Style and Reply Style comboboxes.Comboboxes
	are named after their current settings. Now the names were
	corrected.

2005-10-26  Vivek Jain <jvivek@novell.com>
	
	**See #313096

	* em-junk-hook.c (emjh_construct) load the plugin only if it is
	enabled.

2005-10-22  Parthasarathi Susarla <sparthasarathi@novell.com>

	* mail-config.c (mail_config_get_default_account): Return valid
	transport, only if the account is enabled.

2005-10-22  Parthasarathi Susarla <sparthasarathi@novell.com>

	* em-composer-utils.c (create_new_composer): If the account
	corresponding to the fromuri is not enabled.  Then load the
	preferred account from the composer.

2005-10-21  Jeff Cai <jeff.cai@sun.com>

	Reverse previous patch because of bug 319376.	
	* em-folder-view.h:

2005-10-21  Jeff Cai <jeff.cai@sun.com>

	* mail/em-folder-view.h: Change the declaration of flag
	'preview_active' from one bit of int to one bit of guint because
	it will be -1 on linux if being declared one bit of int.

2005-10-19  Philip Van Hoof <pvanhoof@gnome.org>
	
	** See bug 318611

	* mail/em-composer-utils.c: data hiding

2005-10-19  Harish Krishnaswamy <kharish@novell.com>

	* em-format-html-display.h: Include e-attachment-bar.h relative to
	the top dir, so it stops borking the print-message plugin.

2005-10-18  Srinivasa Ragavan <sragavan@novell.com>

	* em-folder-browser.c (emfb_focus_search, emfb_tools_vfolders):
	Make '/' to focus on search bar entry. Fixes bug #268027

	* em-folder-view.c (emfv_enable_menus): Set the target widget.

	* em-format-html-display.[ch] (em_format_html_display_get_bar):
	Added a function to get the attachment bar.

	* em-utils.c (em_utils_temp_save_attachments): Added function to
	save parts of the attachments.

2005-10-03  Srinivasa Ragavan <sragavan@novell.com>

	* em-folder-view.c (emfv_ena) (emfv_popup_items): Mark visible
	  with junk flags as well.

	* em-popup.[ch] (em_popup_target_new_select): Set the flags for
	  junk respectively.
	
2005-10-18  Sankar P  <psankar@novell.com>
	
	- Enhances Signature-Preferences. 
	- Added shortcuts for common operations.
		-- Delete on Del key
		-- Edit on Dbl.Click
	- Prevents adding duplicate and NULL signatures

	* mail-signature-editor.c (menu_file_save_cb:
	(mail_signature_editor, sig_name_changed):
	(menu_file_save_close_cb, delete_event_cb):
	(do_exit): Modified the functions for handling the above
	scenarios.

	* mail.error.xml: Added error strings for duplicate and NULL
	signatures.

	* em-composer-prefs.c (em_composer_prefs_construct):
	(sig_delete_cb, sig_add_cb): Modified the functions so as to
	handle the keyboard accelarators and to grab focus to the list on
	deletion/insertion of signatures.

	* em-composer-prefs.c (signature_key_press, sig_tree_event_cb):
	Added new functions to handle the keypress events on the
	signatures list tree.

	Fixes #269749
	
2005-09-29  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	** See bug 317284
	
	* em-mailer-prefs.c (emmp_header_add_header): Check if its a valid
	header and only then add it
	
2005-09-28  Tor Lillqvist  <tml@novell.com>

	* em-composer-utils.c (reply_get_composer, get_reply_list):
	(post_reply_to_message):

	* em-folder-view.c (emfv_format_link_clicked):

	* importers/netscape-importer.c (netscape_get_boolean): Use
	g_ascii_str(n)casecmp() instead of str(n)casecmp(). We are
	comparing to literal ASCII strings in these cases, so just
	casefolding ASCII is enough. Also better for portability.

	* em-format-html-display.c

	* message-list.c: Define localtime_r() for Win32 using localtime()
	(which is thread-safe in Microsoft's C library).

	* mail-tools.c (mail_tool_do_movemail): Not implemented on Win32.

2005-09-28  Parthasarathi Susarla <sparthasarathi@novell.com>
	
	See bug ** 317329

	* em-vfolder-rule.c (em_vfolder_rule_add_source): Do not add a
	NULL uri.

2005-09-26  S.Antony Vincent Pandian <santony@gmail.com>

	Fixes #208647

	* em-folder-tree.c: Have added a menu item Empty Trash in the
	folder tree's context menu and also added its callback.

2005-09-22  Carsten Guenther <carsten.guenther@scalix.com>

	Fixes #316983

	* em-composer-utils.c (em_utils_send_receipt):
	Exchanged the FROM and TO fields so that a read
	receipt actually goes to the sender of the original
	message.

2005-09-21  Sankar P  <psankar@novell.com>

	* em-account-editor.c (emae_defaults_page): Added code to enable
	the sent folder button for accounts with "None" set as the
	Receiving Server type.  Fixes #315506

2005-09-15  Sankar P  <psankar@novell.com>

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):

	* em-folder-tree.c (render_pixbuf): Added enum and the code to
	change the icon for sent items folder. Fixes #257321
	
2005-09-02  Harish Krishnaswamy  <kharish@novell.com>

	* default/C/Inbox: Update the Welcome mail.

2005-08-25  Not Zed  <NotZed@Ximian.com>

	** See bug #314440.

	* em-format-html.c (efh_url_requested): check the content object's
	mime type, not the container, when seeing if the data should be
	written.
	(efh_write_text_html): add some debug.

	* em-format-html-display.c (efhd_html_button_press_event): fix
	debug.

2005-08-22  Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c (efhd_bar_resize): Dont call update.
	Just set the width on the bar.

2005-08-23  Not Zed  <NotZed@Ximian.com>

	* mail-tools.c (mail_tool_uri_to_folder): cast warning away.

	* mail-folder-cache.c: include missing header for
	e_filename_make_safe.

	* em-junk-hook.h: Fix some header includes, fix the include guard
	to use the right name.
	(EMJunk): Ugh, this is an object, properly derive from it!  How
	did this work?

	* em-junk-hook.c (em_junk_check_junk): fix bool conversion.

	* em-format-html-display.c (efhd_bar_popup_position): another
	wraning, why this crap isn't in the attachment bar like i said it
	should be, i'll never know.
	(efhd_xpkcs7mime_viewcert_foad): only define if used.

	* em-account-editor.c (emae_defaults_page): attempt to fix parentheses
	(emae_security_page): fix conditional compilation warnings.

2005-08-19  Not Zed  <NotZed@Ximian.com>

	** See #312668.

	* mail-component.c (setline_done, impl_setLineStatus): change the
	camel-session online status before (if we're going online) or
	after (if we're going offline) actually doing offline processing.

2005-08-19  Not Zed  <NotZed@Ximian.com>

	* em-format.c (emf_multipart_encrypted): put the s/mime message
	back, awaiting string approval for a change otherwise.

2005-08-18  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_message_add_bar): dont add
	attachment bar if it is disabled.
	(efhd_attachment_button): dont add attachments if there is no bar.

	* em-format.c (emf_inlinepgp_signed, emf_inlinepgp_encrypted): fix
	the error messages for consistency.  We dont need to check
	content-type, since we only get called with the right one.
	(emf_multipart_encrypted): fix up wrong s/mime error.

	* em-format-html.c (efh_inlinepgp_signed)
	(efh_inlinepgp_encrypted): moved to em-format.c; otherwise this
	will break replying, etc.

	** See #271894.

	* em-format.c (emf_multipart_encrypted): use the content object's
	content-type to check types.

2005-08-16  Not Zed  <NotZed@Ximian.com>

	** See #312668.

	* mail-component.c (impl_setLineStatus): new offline interface.
	(setline_check, setline_done): and implementation.

	* mail-offline-handler.[ch]: destroyed, burnt, dissolved in acid.

2005-08-17  Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c 
	(efhd_bar_save_selected): Fix a warning.
	(efhd_bar_resize): Fix the bar size to match other widgets.
	(efhd_bar_scroll_event): Fix scroll issue over bar. bug #312224.
	(efhd_add_bar): Add a frame around the attachment bar. bug #312033

2005-08-17  Kaushal Kumar  <kakumar@novell.com>

	* em-composer-prefs.c (url_requested): Add the close call for fd.

	See bug #307375.

2005-08-15  Not Zed  <NotZed@Ximian.com>

	** See #313440.

	* Makefile.am (mailinclude_HEADERS): Include the idl generated
	headers.

2005-08-16  Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c (efhd_attachment_button): Sets the filename
	in the attachment structure instead of the part
	
2005-08-15  Christian Kellner  <gicmo@gnome.org>

	* mail-send-recv.c (get_folders): Honour the check_all flag for
	the scalix provider.  Fixes bug #313582.

2005-08-14  Rodney Dawes  <dobey@novell.com>

	* em-folder-view.c (emfv_popup_items): Fix two mnemonic conflicts
	in the context menus for the mailer

2005-08-12  Vivek Jain <jvivek@novell.com>

	* em-account-editor.c (emae_check_complete): first prepare the
	page and then validate **Fixes #273842

2005-08-11  Not Zed  <NotZed@Ximian.com>

	** See #232499.

	* mail-folder-cache.c (rename_folders): rename view meta-data
	along with the folder.

2005-08-11  Vivek Jain <jvivek@novell.com>
	
	* em-folder-tree-model.c (account_changed): check if the account
	is enabled, before adding the store

	** Fixes #313057
	
2005-08-11  Parthasarathi Susarla <sparthasarathi@novell.com>

	* em-folder-view.c (emfv_enable_menus): return the target in any
	case.  It will be an empty target and not NULL.

	Fixes bug 312420

2005-08-11  Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c (efhd_attachment_bar_refresh):
	(efhd_bar_resize, efhd_add_bar): Fix to hide the attachment bar
	when no attachments and to resize when the window is resized.

2005-08-10  Not Zed  <NotZed@Ximian.com>

	** See #271985.

	* mail-config.c (mail_config_write_on_exit) 
	(mail_config_get_account_by_source_url) 
	(mail_config_get_account_by_transport_url) 
	(mail_config_get_default_transport): 

	* mail-component.c (load_accounts): check url for content before
	using it.

2005-08-09  Not Zed  <NotZed@Ximian.com>

	** See #312715.

	* em-folder-tree.c (emft_drop_folder_rec): removed.
	(emft_drop_folder): call em_folder_utils_copy_folders to perform
	the operation rather than: doing it sync when it shouldn't be, and
	2; copying code redundantly.

	* em-folder-utils.c (em_folder_utils_move_folder): remove this
	redundant api.
	(em_folder_utils_copy_folder): add delete flag.
	(em_folder_utils_copy_folders): export this function.  fix strange
	argument order.

2005-08-10  Tor Lillqvist  <tml@novell.com>

	* Makefile.am: Link with all needed libraries. Use -no-undefined
	on Win32. Work around annoying MSYS feature on Win32 when
	installing the schemas: Echo the command to a temporary .bat file
	and run it with cmd.exe...

	* importers/Makefile.am: Use the bootstrap import library for
	libevolution-mail.la on Win32 as libevolution-mail.la hasn't been
	built yet when we come here. Use -no-undefined on Win32. Use
	privsolib instead of privlib. (See ../ChangeLog.)

2005-08-08  Not Zed  <NotZed@Ximian.com>

	** See bug #304938.

	* mail-ops.c (mail_send_message): don't try to dereference the
	transport if we don't have one.

2005-08-04  Not Zed  <NotZed@Ximian.com>

	** See bug #300881.

	* em-account-editor.c (emae_setup_signatures): don't add the
	signature listener if we've already added it.

2005-08-08  Vivek Jain <jvivek@novell.com>

	* em-format.c (emf_multipart_appledouble): check part before using
	it, else dump source

2005-08-05  Not Zed  <NotZed@Ximian.com>

	** See bug #312397.

	* em-format-quote.c (emfq_format_message): if we are rendering an
	attached message, include the headers always and a marker for it.

2005-08-07  Rodney Dawes  <dobey@novell.com>

	* em-folder-browser.c (emfb_search_items):
	* em-folder-tree-model.c (sort_cb, em_folder_tree_model_load_state):
	* em-folder-tree.c (emft_drop_target):
	* em-folder-view.c (emfv_popup_items, emfv_uri_popups):
	* em-utils.c:
	* em-vfolder-editor.c (em_vfolder_editor_new):
	* em-vfolder-rule.c (em_vfolder_editor_sourcelist_new):
	* mail-dialogs.glade:
	* mail-vfolder.c (vfolder_setup_desc, vfolder_setup_do):
	(vfolder_adduri_desc, vfolder_load_storage, vfolder_edit):
	(vfolder_edit_rule, vfolder_gui_add_rule):
	* mail.error.xml:
	Change instances of "vfolder" that appear in the UI to use the term
	"Search Folder" instead
	Update some comments to use the term "Search Folder" instead of vfolder
	
2005-08-05  David Malcolm  <dmalcolm@redhat.com>

	* em-account-editor.c (emae_option_checkspin): initialize local
	variable "label".

2005-08-04  Not Zed  <NotZed@Ximian.com>

	** See bug #273885.

	* em-utils.c (em_utils_edit_filters): setup filter source names
	properly translated.

	* em-filter-editor.c (em_filter_editor_construct): take an array
	of structs for the filter source so the incoming/outgoing is
	properly translated.

	** See bug #312397.

	* em-format-quote.c (emfq_format_message): dont quote credits
	here.
	(emfq_format_message_prefix): new prefix handler for credits.
	(emfq_format_clone): invoke the message prefix before anything
	else.

	** See bug #310840.

	* em-icon-stream.c (em_icon_stream_get_image): check for /0
	possibility.

	** See bug #308512.

	* em-account-editor.c (emae_authtype_changed): take into account
	the writability of the password when sensitising remember
	password.
	(get_password): small hack to disable the save-password button
	when appropriate.

2005-08-05 Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c (efhd_init, efhd_complete):
	(efhd_message_add_bar): Fixes the bug #312410.
	
2005-08-04  Srinivasa Ragavan <sragavan@novell.com>

	* em-utls.c (emu_update_save_path): Killed a warning.

2005-08-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_set_folder): not here.
 
	* em-folder-view.c (emfv_set_folder): ref the folder here.

2005-08-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_message_reply): try to fix #309647, only
	act if the selection is actually active.

2005-07-29  Arunprakash <arunp@novell.com>

	* mail/em-folder-utils.c (em_folder_utils_delete_folder):
	Allocated a new string to be used for the error dialog response to
	avoid multiple frees.

2005-08-01  Shakti Sen <shprasad@novell.com>

	* em-composer-prefs.c: Included 'gtkentry.h' to resolve the
	symbol 'GTK_ENTRY'.

	Partly fixes bug #231968.

2005-08-02  Srinivasa Ragavan <sragavan@novell.com>

	* em-utils.c (emu_get_save_filesel, emu_save_part_response):
	(emu_save_messages_response): Fixed a bug where the last path is
	not preserved well.

2005-08-01  Not Zed  <NotZed@Ximian.com>

	* em-subscribe-editor.c (sub_fill_level): always process all nodes
	we have, even if we have already seen the top result.

2005-07-29  Not Zed  <NotZed@Ximian.com>

	** See bug #300607.

	* mail-vfolder.c (store_folder_renamed_rec, store_folder_renamed):
	rename all folders in the folder tree renamed.

2005-07-29  Shreyas Srinivasan  <sshreyas@novell.com>

	* mail-ops.c: Fix #311223. Include <camel/camel-multipart.h>
	so that lazy binding does not fail on CAMEL_IS_MULTIPART.
	
2005-07-29  Shreyas Srinivasan  <sshreyas@novell.com>

	* em-account-editor.c (emae_defaults_page): Fix #307538. Check if
	the provider type exists  before senisitizing widgets.
	
2005-07-28  Not Zed  <NotZed@Ximian.com>

	** See bug #311440.

	* em-utils.c (em_utils_in_addressbook): handle NULL address.
	
2005-07-28  Praveen Kumar <kpraveen@novell.com>

	* em-account-editor.c (emae_check_complete) : Update the "Full Name" 
	text entry with the detected real name of the user. Fixes bug 311778
	
2005-07-27  Srinivasa Ragavan <sragavan@novell.com>
	
	* mail-config.glade: Changed "Host" to "Server"

2005-07-27  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (get_folders): hack to make it honour the
	'refresh only inbox' imap/groupwise setting.

2005-07-26  Harish Krishnaswamy  <kharish@novell.com>

	* Makefile.am: fix make distcheck issues.

2005-07-25  Srinivasa Ragavan <sragavan@novell.com>

	* em-format-html-display.c (efhd_init, efhd_finalise):
	(efhd_attachment_image, efhd_attachment_button):
	(efhd_format_attachment): Added code to create a attachment bar.

	* em-format-html.c (efh_format_message) Added code to add bar at
	the beginning of the message.

	* em-popup.[ch] (em_popup_target_new_attachments)
	(emp_part_popup_set_background)
	(emp_standard_menu_factory): Added code to handle the popup menu
	inside the attachment bar.

	* em-utils.[ch] (em_utils_edit_filters, emu_get_save_filesel)
	(em_utils_save_part, em_utils_save_messages): Added code to handle
	save selected and save all options of the attachment bar.

2005-07-21  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c: reverted dobey's busted view->hide* menu
	stuff.

	* em-account-editor.c (emae_option_entry): if we get a null
	default, then set "" on the entry.
	(emae_option_entry): set the default value on the url if it
	doesn't exist already.

2005-07-20  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (refresh_folders_desc, refresh_folders_get)
	(refresh_folders_got, refresh_folders_free, get_folders)
	(receive_update_got_folderinfo, receive_update_got_store): refresh
	all the folders manually and directly.

	* mail-folder-cache.c (setup_folder): propagate even -1 unread
	counts, they get ignored later.

	* em-composer-utils.c (emu_handle_receipt_message)
	(em_utils_handle_receipt): use getmessagex too, so we can always
	clear any error.

	* em-folder-view.c (emfv_message_selected_timeout)
	(emfv_list_done_message_selected): use getmessagex and do
	something meaninful with the error.

	* mail-ops.c (mail_get_messagex): added new get message which
	returns an exception.

2005-07-19  Not Zed  <NotZed@Ximian.com>

	* mail-tools.c (mail_tool_uri_to_folder): dont get the service
	connected, it will connect if it needs to.

	* mail-ops.c (get_folderinfo_get): * em-folder-utils.c
	(emft_copy_folders__copy)
	(emfu_delete_folders): * em-folder-tree.c
	(emft_get_folder_info__get): Always request subscribed folders, if
	the backend doesn't implement it it will ignore it.

2005-07-13  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (mail_autoreceive_init, auto_online): listen to
	session online events, and if we are online, trigger an
	auto-receive of all auto-check accounts.

2005-07-11  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (auto_account_commit): force an update
	immediately if we're setting up the timeout to start with.

	* em-folder-tree-model.c (em_folder_tree_model_set_unread_count):
	noop if the unread count < 0.
	(em_folder_tree_model_set_folder_info): only set the unread count
	if we actually have one.

	* em-folder-tree.c (emft_tree_row_expanded): get the folder list
	'fast'.

	* mail-ops.c (get_folderinfo_get): get the folder list 'fast'.

2005-07-19  Srinivasa Ragavan <sragavan@novell.com>

	* em-folder-tree.c (emft_popup_move): calling the wrong api to
	move a folder. Infact it was copying for move.

2005-07-14  Vivek Jain <jvivek@novell.com>

	* em-composer-utils.c: included missing header file
	camel-multipart.h

	**Fixes #310330

2005-07-13  Kjartan Maraas  <kmaraas@gnome.org>

	* em-mailer-prefs.c (em_mailer_prefs_construct): Free font name

	* mail-config.c (config_write_style): Free font name and name of
	  citation color.

	* message-list.c (regen_list_regened, regen_list_free): Free
	  search string. Thanks to Michael Zucchi for walking me through
	  this one. My brain wasn't running on all it's cylinders...

2005-07-10  Shreyas Srinivasan <sshreyas@novell.com>

	* mail-config.[ch]: Add new functions to remove proxy accounts and
	proxies created by the account.

	* mail-compnent.c: Remove proxy accounts at startup

	* mail.error.xml: Add warnings for proxy disable and removal of a
	proxy when its parents are removed.

	* em-account-prefs.c: Add checks not to display proxies and
	handling of parent removal/ disabling.
	
2005-07-06  Vivek Jain <jvivek@novell.com>

	* em-junk-filter.c: moved to plugins/sa-junk-plugin

	* em-junk-filter.h: removed

	* em-junk.plugin.[ch]: removed

	* em-junk-hook.[ch]: added new files to have a new hook

	* Makefile.am: updated to removed/add these files.

	* mail-session.c (mail_session_init): assign NULL to junk_plugin,
	remove included file "em-junk-filter.h"

	* mail-component-factory.c (make_factory): register type for
	EMJunkHook

2005-07-05  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_attachment_image): use the cache,
	since we set it up.
	(efhd_image): added a (private!) format handler for all the image
	types so we intercept them and handle them directly.
	(efhd_image_fit, efhd_image_unfit): replace the resize callback
	with two much simpler ones.

	* em-icon-stream.c (em_icon_stream_get_image): added 'fit to'
	arguments.  Changed dramatically to get approximate fit-to image,
	update cache, etc.
	(em_icon_stream_is_resized): added 'fit to' arguments.  changed to
	manipulate the cache properly.
	(emis_fit): helper to fit an image to a size.
	(em_icon_stream_new): added 'fit to' arguments rather than poking
	structures.

	* em-format-html-display.c (efhd_attachment_image): fixed a memory
	leak, various style issues.  Removed all scaling code.
	(efhd_attachment_popup): show menu's appropriately.  add back the
	hide/show menu always.
	(efhd_image_popup): fix formatting.

	** Applied patch from Srini for scaling images to fit by default.

2005-07-04  Veerapuram Varadhan <vvaradhan@novell.com>

	* mail-component.c (handleuri_got_folder): Added "forward"
	command-line option.
	
2005-07-06  Not Zed  <NotZed@Ximian.com>

	* importers/evolution-mbox-importer.c (mbox_getwidget): wrap the
	widgets in another vbox so they display properly.

	* importers/pine-importer.c (pine_getwidget): pack the 'mail'
	widget.

	* importers/pine-importer.c (pine_import):
	importers/elm-importer.c (elm_import):
	importers/evolution-mbox-importer.c (mbox_import): Dont create
	widgets anymore, report progress through the EImport and handle
	cancel.

2005-07-01  Not Zed  <NotZed@Ximian.com>

	* importers/Makefile.am: remove shell/importer link & take out
	netscape & outlook temporarily.

	* Makefile.am: Removed importer link.

2005-06-24  Matt Brown  <matt@mattb.net.nz>

	* em-inline-filter.c: implement extraction of inline
	signed/encrypted pgp parts and package them into
	x-inlinepgp-signed/x-inline-pgp-encrypted parts.

	* em-format-html.c: Formatters to verify/decrypt and then display
	the parts generated by the inline filter.

2005-06-25  Not Zed  <NotZed@Ximian.com>

	** See bug #307398

	* mail-session.c (alert_user): copy the prompt string, in 'no
	cancel' mode we run asynchronously.
	(free_user_message): & free it.

2005-06-24  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_url_requested): dont pass data gtkhtml
	definitely can't handle, to gtkhtml.  This is no security patch,
	but stops gtkhtml wasting time tying to render malicious mails or
	other rubbish.

2005-06-21 Brian Mury <b.mury@ieee.org>

	** See bug #301466.

	* filtertypes.xml, searchtypes.xml, vfoldertypes.xml: fix the
	"match all" case to actually work.

2005-06-18  Tor Lillqvist  <tml@novell.com>

	* GNOME_Evolution_Mail.server.in.in: Use SOEXT.

2005-06-08  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (view_changed_cb): make this run a timeout so
	we don't update too often and suck loads of cpu time.

2005-06-07  Andre Klapper <9016009@gmx.de>

	* mail.error.xml: Fixing typo (bug 306151)

2005-06-02  Not Zed  <NotZed@Ximian.com>

	* Evolution-Mail.idl: only let this be included once.

	* mail-component.c (mail_component_class_init): Setup a test
	function, and fix the bonobo init function so we're actually a
	mailcomponent and not just an evolutioncomponent.
	
2005-06-02  Not Zed  <NotZed@Ximian.com>

	* mail-component.c: change this to sub-class evolution-component,
	not bonobo-object.

	* Evolution-Mail.idl: Made the mail component sub-class
	Evolution.Component so it can add new interfaces for remote gui
	mail operations.

2005-05-31  Rodney Dawes  <dobey@novell.com>

	* em-folder-browser.c (emfb_view_hide_read, emfb_view_show_selected):
	(emfb_view_show_all): Update these methods to use the listener method
	of access from bonobo as they are radio buttons now
	(emfb_verbs): Comment out the verbs for the above methods, as they are
	configured through add_listener now
	(emfb_enable_map): s/ViewHideSelected/ViewShowSelected/
	(emfb_activate): Add the listeners for the radio buttons for filtering
	the message list for unread, selected, or all messages
	
2005-05-24  Rodney Dawes  <dobey@novell.com>

	* em-folder-selector.c (folder_created_cb): Remove this unused method
	(emfs_response): Remove unused variable declarations

	* em-folder-view.c (emfv_popup_{load_images,selectall}): Remove
	these unused methods
	
	* mail-component.c: Include em-folder-utils.h to fix warnings
	
2005-05-20  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mail_component_peek_session): add helper for
	plugins to get mail session.

2005-05-19  Chenthill Palanisamy  <pchenthill@novell.com>

	* mail.error.xml: Added a error message required for
	marking messages as read in subfolders.

2005-05-19  Not Zed  <NotZed@Ximian.com>

	* em-format-html-print.c (em_format_html_print_raw_message): new
	function to print a non-foldered message.  untested.

2005-05-19  Not Zed  <NotZed@Ximian.com>

	* em-folder-utils.h: fix rodney's name choices.  fix
	multiple-inclusion.  fix forward references.  fix all callers.
	add many fixme's for the busted api's.

	* em-format-quote.c (emfq_format_clone): use pseudo mime type to
	find message formatter.

	* em-format-html-display.c (efhd_format_message): remove, it
	didn't do anything.

	* em-format-html.c (efh_format_message): make this a handler
	callback.

	* em-format.c (emf_message_rfc822): make this use the pseudo
	mime-type x-evolution/message/rfc822 instead of the hardcoded
	format_message callback.

	* em-format-html-display.c (efhd_message_prefix): make this use a
	pseudo-mime-type handler rather than hard-coded, so it can be
	overridden by a plugin.

2005-05-17  Radek Doulik  <rodo@novell.com>

	* em-format-html.c: removed include of htmlengine.h which wasn't
	needed

	* em-format-html-display.c: use top level gtkhtml API instead of
	lower level one

	* em-folder-view.c (emfv_popup_selectall): use gtk_html_select_all
	instead of calling html engine directly

2005-05-16  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.h: 
	* mail-autofilter.h: forward-reference structures

	* *.h: Make installed headers includable from mail/

	* Makefile.am (mailinclude_HEADERS): install various mail headers
	as first cut at public plugin api.

	* move e-error into e-util/

2005-05-16  Srinivasa Ragavan <sragavan@novell.com>

	* GNOME_Evolution_Mail.server.in.in: Added tooltips
		
2005-05-13  Rodney Dawes  <dobey@novell.com>

	* Makefile.am: Add new em-folder-utils.[ch] abstraction

	* em-folder-browser.c: Update for new menu layout
	Add new methods to handle the actions that were previously only
	available from the context menu when right-clicking on a folder

	* em-folder-selector.c (emfs_response): Just call emfu_folder_create
	if the user wants to create a new folder in the selector dialog
	(em_folder_selector_get_selected_path): Clean up the code to fix a
	couple potential crashes

	* em-folder-tree.[ch]: Add methods to get pointers to a CamelFolder or
	CamelFolderInfo object for the selected item in the tree
	Add a method to get a pointer to an EMFolderTreeModelStoreInfo object
	for the selected store in the tree
	Move folder operations out into em-folder-utils.[ch] so that they
	are abstracted from the tree and can be used by methods other than
	the internal context menu

	* em-folder-utils.[ch]: Move the folder operations code to here

	* em-folder-view.c: Update for the new menu layout
	Fix Mark as Read/Unread in the context menu to only show up in the list

	* mail-component.c (create_item): Just call emfu_folder_create here
	when the user requests to create a new folder from the New toolbar item

2005-05-13  Shreyas Srinivasan	<sshreyas@novell.com>
	
	* Fixes bug #273868, #300113, #302831.
	
	* mail-offline-handler.c : Add check for Camel Offline
	store to is_service_relevant.

2005-04-21  Jeffrey Stedfast  <fejj@novell.com>

	* em-composer-utils.c (post_reply_to_message): Use the real folder
	and real uid (not the virtual if replying to a message in a
	vfolder). Fixes bug #269129.

2005-05-06  Vivek Jain <jvivek@novell.com>

	* em-folder-view.c: EPopupItem emfv_popup_items[] replace Print
	  with Print... Fixes #272242

2005-05-07  Sankar P  <psankar@novell.com>
	
	* mail-ops.c (mail_send_message)
	Added code to prevent copying of sent items, based on provider type

	* em-account-editor.c (emae_defaults_page)
	Added code to disable the Sent Folders button

2005-05-06  Not Zed  <NotZed@Ximian.com>

	* mail.error.xml: renamed from mail-errors.xml, add i18n tags, fix
	some whitespace issues.  Removed some unecessary translations.

2005-05-06  Chenthill Palanisamy  <pchenthill@novell.com>
	
	* evolution-mail.schemas.in.in: Removed the schema 
	/schemas/apps/evolution/mail/junk/sa/daemon_port
	since its not used anymore.

2005-05-06  Sarfraaz Ahmed <asarfraaz@novell.com>

	* mail/mail-errors.xml : Fixed a typo for #272786

2005-05-05  Radek Doulik  <rodo@site>

	* em-folder-view.c (em_folder_view_get_popup_target): use
	gtk_html_command to ask if selection is active tto avoid using
	selection API directly
	(emfv_popup_copy_text): use gtkhtml API instead of engine API
	(emfv_message_reply): use new gtk_html_get_selection_html function
	to avoid using low level gtkhtml APIs

2005-05-03  Radek Doulik  <rodo@site>

	* em-format-html-display.c: removed include of htmlinterval.h as
	it's not needed

2005-04-28  Parthasarathi Susarla <sparthasarathi@novell.com>

	* em-folder-view.c (emfv_set_folder): remove a call to
	  refresh folder from here
	* em-folder-browser.c (emfb_set_folder): call 
	  mail_refresh_folder here
	
2005-04-28  Not Zed  <NotZed@Ximian.com>

	* message-list.c: add some message list loading/profiling points,
	"list".

	* em-folder-view.c: add some message display/loading profiling
	points, "goto".

2005-04-12  Not Zed  <NotZed@Ximian.com>

	** See bug #273752

	* em-folder-tree.c (emft_drop_folder_rec): handle NULL
	"parent_name" - dropping to store node.

2005-04-08  Jeffrey Stedfast  <fejj@novell.com>

	* em-composer-utils.c (em_utils_send_receipt): Simplify the
	scanning for '@' by using strchr().

2005-04-08  Not Zed  <NotZed@Ximian.com>

	* em-composer-utils.c (em_utils_ask_receipt): removed.
	(em_utils_handle_receipt): asynchronously load message if none is
	supplied.

	* em-folder-view.c (emfv_set_seen): pass message in.

	* em-composer-utils.c (em_utils_ask_receipt): strip leading lwsp
	on the disposition address.
	(em_utils_ask_receipt): added a comment about which rfc.
	(em_utils_handle_receipt): merged ask_receipt into here.  Changed
	api to take a message instead, so we don't have to load the
	message every time.  Also only set receipt-handled if we have a
	receipt requested in the first place.

2005-04-05  ERDI Gergo  <cactus@cactus.rulez.org>

	* mail-errors.xml: Added new dialog for receipt requests

	* em-composer-utils.c (em_utils_guess_account): Made guess_account
	public, to be callable from em-folder-view
	(em_utils_send_receipt): New function to send an RFC
	2298-compliant message delivery notification

2005-04-05  Not Zed  <NotZed@Ximian.com>

	** See bug #74320

	* em-format.c (em_format_part_as): if the snooped type is NULL,
	fall back to application/octet-stream.

2005-04-04  Rodney Dawes  <dobey@novell.com>

	* em-folder-view.c (emfv_popup_items): Add Mark as Read/Unread back
	to the context menu (#73192)
	Fix the ordering values for some menu items in the context menu that
	had duplicate order values

2005-03-31  Not Zed  <NotZed@Ximian.com>

	** See bug #72935

	* em-folder-view.c: always enable the stop button.

2005-03-31  Not Zed  <NotZed@Ximian.com>

	** See bug #72518

	* em-folder-tree.c (emft_popup_delete_folder): prompt for vfolder
	case differently.

2005-03-31  Not Zed  <NotZed@Ximian.com>

	* message-list.c (on_selection_changed_cmd): only noop if we only
	have 1 message selected, otherwise we don't update the menu's.
	Fixes a problem introduced by 64987's fix.

2005-03-30  Li Yuan  <li.yuan@sun.com>

	* em-account-prefs.c: (em_account_prefs_treeview_new):
	add a11y name to Mail Accounts Table
	* mail-config.glade:
	add a11y name to tables in Mail Preferences page and 
	Composer Preferences page.
	Fixes #73914

2005-03-16  Jeffrey Stedfast  <fejj@novell.com>

	* em-format-html.c (efh_format_headers): Don't show multiple
	"Mailer" headers even if multiple x-mailer/user-agent/whatever
	headers exist. Fixes bug #70394.

2005-03-16  Not Zed  <NotZed@Ximian.com>

	** See bug #73363

	* em-folder-view.c (emfv_list_message_selected): insert a timeout
	before loading the message.
	(emfv_message_selected_timeout): handle the timeout, start loading
	the message.
	(emfv_set_folder, emfv_destroy): cleanups for above.

2005-03-16  Not Zed  <NotZed@Ximian.com>

	** See bug #73559
	
	* em-filter-source-element.c
	(em_filter_source_element_get_sources): check the url != "" and decoded
	before using it.

2005-03-16  Not Zed  <NotZed@Ximian.com>

	** See bug #71003, again.

	* mail-component.c (impl_quit): fix sense of 'can quit' logic.

2005-03-14  Not Zed  <NotZed@Ximian.com>

	** See bug #73550

	* em-format-hook.c (emfh_format_format): if we are disabled, don't
	invoke handler, try to invoke old handler if there was one.

2005-03-10  Not Zed  <NotZed@Ximian.com>

	** See bug #73293

	* message-list.c (main_folder_changed): emit a 'list built' signal
	if we just modified it too.

2005-03-10  Vivek Jain  <jvivek@novell.com>
	
	**fixes bug #73139
	* em-folder-tree.c (render_pixbuf):change the shared-folder icon names 
	to the names in gnome-icon-theme 

2005-03-03  Not Zed  <NotZed@Ximian.com>

	** See bug #66592

	* mail-tools.c (mail_tool_make_message_attachment): jus call
	camel_medium_remove_header to remove the bcc header, don't need to
	loop.

	* mail-ops.c (mail_send_message): try to find the account by uid
	first, fall back to name.

	* em-composer-utils.c (composer_get_message): set
	x-evolution-account by uid, not name.

2005-03-02  Not Zed  <NotZed@Ximian.com>

	** See bug #66592

	* em-composer-utils.c (got_post_folder): no longer needed.
	(composer_get_message): remove 'post' and 'no_recipeints' args.

	* mail-ops.c (mail_send_message): change for xev changes. Also
	handle postto if set.

	* mail-tools.c (mail_tool_remove_xevolution_headers) 
	(mail_tool_restore_xevolution_headers): fix for api change.
	(mail_tool_destroy_xevolution): remove.

	* mail-tools.h: remove XEvolution, just use a struct _header_raw
	for it.

	* em-composer-utils.c (em_utils_composer_send_cb): don't post
	message here, just queue it like any other outgoing mail.

2005-03-02  Not Zed  <NotZed@Ximian.com>

	** See "bug" 73100

	* mail-dialogs.glade: empty out the license_top_label text, it is
	always overwriten by the code.

2005-03-01  Not Zed  <NotZed@Ximian.com>

	* message-list.c: include atkutil.h
	(message_list_construct): cast warning.

	* mail-session.c (mail_session_set_interactive): remove unused
	variable since we can no longer terminate password requests.

	* mail-autofilter.c (em_vfolder_rule_from_address): properly
	define in header.

	* em-utils.c (emu_get_save_filesel): only define filename in the
	!gtkfilechooser case.

	* em-mailer-prefs.c (restore_labels_clicked): cast for warning.
	(em_mailer_prefs_construct): same.

	* em-format-html.c (efh_format_header): remove unused variable.

	* em-account-editor.c (emae_widget_druid_glade): remove unused
	variable.

	* importers/mail-importer.h: forward-delcare struct
	_MailComponent.

	* *c: remove/disable various debug.

2005-03-02  Harry Lu <harry.lu@sun.com>

	Fix for 71733.

	* mail-signature-editor.c: (mail_signature_editor): if is_new,
	let name_entry get the focus.

2005-02-28  JP Rosevear  <jpr@novell.com>

	* em-utils.c (em_utils_configure_account): pass in accountDruid
	config id

	* em-account-prefs.c (account_add_clicked): pass in accountDruid
	config id
	(account_edit_clicked): pass in accountWizard config id
	
	* em-account-editor.h: update protos

	* em-account-editor.c (em_account_editor_new_with_config_id):
	create a new account editor with a specific config id
	(em_account_editor_new): pass
	(em_account_editor_construct): make this static and take the
	config id as an arg

2005-02-24  Not Zed  <NotZed@Ximian.com>

	** See bug #72609

	* em-inline-filter.c (emif_scan): try to convert the filename
	based on the incoming charset or the locale charset.  This will
	make sure it is always valid.

2005-02-28  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c: reverted Mengjie's patch for 72545.

2005-02-27  Frank Arnold  <farnold@cvs.gnome.org>

	* default/de/Inbox: Added German translation of default inbox.

2005-02-25  Mengjie Yu  <meng-jie.yu@sun.com>

	* em-folder-browser.c (emfb_edit_select_all): make the 'select
	all' work in all conditions.

	Fixes #72545

2005-02-24  Not Zed  <NotZed@Ximian.com>

	** See bug #68459

	* em-composer-utils.c (get_reply_sender): check the followup-to
	header before the newsgroups header.
	(reply_get_composer, get_reply_sender, get_reply_all): change
	post-to to be a CamelNNTPAddress not a string pointer.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #71003

	* mail-component.c (impl_quit): add a new state MC_QUIT_THREADS to
	wait for all mail threads to finish before quitting.

2005-02-23  Jeffrey Stedfast  <fejj@novell.com>

	* em-format-html.c (efh_format_header): Don't use the pre-UTF-8
	converted subject header string from the CamelMimeMessage object,
	decode it ourselves using the the user's override charset. Fixes
	bug #62109.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #34153 and no doubt duplicates

	* mail-component.c (impl_requestQuit): use the VISIBLE count not
	the TOTAL count to check if there are unsent emails.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #71528.

	* em-migrate.c (remove_system_searches, em_migrate_1_4): remove
	all 'system' searches when upgrading from pre 2.0.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #71967

	* em-account-editor.c (emae_receive_options_extra_item): make sure
	we track the keep_on_server setting in the e-account, not just the
	url (hack).

2005-02-23  Hans Petter Jansson  <hpj@novell.com>

	* mail-session.c:
	* mail-config.c: Include <libedataserverui/e-passwords.h>.

2005-02-22  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_send_page): fix argument order to
	memset.
	(emae_security_page): fix the non-have_nss case.

2005-02-22  Marco Pesenti Gritti  <marco@gnome.org>

	* mail/em-popup.c (emp_apps_open_in, emp_standard_menu_factory):
	Use gnome-vfs API to launch external applications

2005-02-22  Not Zed  <NotZed@Ximian.com>

	** See bug #40515

	* mail-config.c (mail_config_signature_run_script): run the script
	using /bin/sh -c, so arguments may be passed to the script.

2005-02-22  Not Zed  <NotZed@Ximian.com>

	** See bug #68866

	* em-format-quote.c (emfq_format_headers): line-feed after all
	headers for blind people.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #35219

	* em-utils.c (em_utils_flag_for_followup_clear): clear the flag
	tags rather than setting them to "".  Also change to using newer
	messageinfo api.
	(tag_editor_response, em_utils_flag_for_followup)
	(em_utils_flag_for_followup_completed):	some cleanup/api stuff.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #64987

	* message-list.c (message_list_select_thread): select the paths
	with one call.
	(on_selection_changed_cmd): get the cursor_uid from the cursor.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #72337

	* mail-component.c (store_info_new, store_info_unref): refcount
	the storeinfo's.
	(mc_add_store_done): noop if removed.
	(store_hash_free, mail_component_remove_store): mark storeinfo
	removed.

2005-02-21  Not Zed  <NotZed@Ximian.com>

	** See bug #70718

	* em-folder-view.c (emfv_list_built): handle list_built events -
	whenever the list changes.
	(emfv_gui_folder_changed, emfv_folder_changed): removed, we want
	to run off the viewed list, not the physical folder.

2005-02-22  Rodney Dawes  <dobey@novell.com>

	* em-account-editor.c (emae_security_page): The GladeXML object is
	no longer a part of the private structure, and we need to reference
	it directly as it is a local variable now

2005-02-14  Not Zed  <NotZed@Ximian.com>

	** See bug #61363 & e-util/ChangeLog

	* em-account-editor.c: All sorts of changes to make the ui more
	dynamic, re-create all widgets when it needs a reconfigure.  A bit
	slower and it flickers a bit.
	
	* em-account-editor.c (emae_setup_service): take xml file pointer.
	(emae_send_page): create a new send page every time we need to,
	don't re-use the old oneq.
	(emae_setup_authtype): renamed to refresh_authtype.
	(emae_setup_service): init authtype pointer.
	(emae_needs_auth): use the auth_frame pointer directly.
	(emae_refresh_providers): rename from setup_providers.

2005-02-11  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_setup_service): set needs_auth to NULL
	if we don't, so it gets reset if the ui changes.

2005-02-10  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_setup_providers): don't include any
	providers which are store and transport in the transport page.
	(emae_send_page): show no send options page at all if the provider is
	store and transport.
	(emae_uri_changed): copy store url to transport if as above.

2005-02-09  Not Zed  <NotZed@Ximian.com>

	** See bug #70795

	* em-folder-view.c (em_folder_view_open_selected): set the search
	on the browser to match the current view.

	* message-list.c (mail_regen_list): save the search if no folder
	set, incase the folder gets set later on.

2005-02-18  Rodney Dawes  <dobey@novell.com>

	* mail/em-folder-view.c (emfv_popup_copy_text): New method to copy
	the selected text in the mail display, to the clipboard
	(emfv_popup_items): Restructure this list for the new context menus
	layout that we are moving to, to improve the UI
	(emfv_popup): Add a third argument for whether we are on the mail
	display or not, so that we can pop up the correct portion of the menus
	Pass the on_display argument on to create the popup target
	Only generate the label items if we are on the list and not the display
	(emp_uri_popup_vfolder_{sender,recipient}): New methods to create
	vfolders to and from mailto: addresses from the context menu
	(emfv_enable_menus): Create the target here for clicking on the list
	(em_folder_view_get_popup_target): Add a third argument so that we
	can tell whether we are on the display or not
	Set the appropriate flags on the target for whether we are on the
	message display,, and whether or not there is selected text in it
	(emfv_list_right_click): We aren't rigt-clicking on the display here
	(emfv_popup_menu): We aren't right-clicking on the mail display here
	(emfv_uri_popups): Add the submenu for creating a vfolder from mailto:
	(emfv_format_popup_event): We are right-clickingo nt he display here

	* mail/em-folder-view.h: Add the new flags we need for the mail
	context menus popup target here
	(em_folderiew_get_popup_target): Add the on_display argument

	* mail/em-popup.c (emp_standard_uri_popups): Fix the label and mnemonic
	for the Send New Message popup item for mailto: addresses

	* mail/mail-autofilter.c (rule_from_address):
	(em_vfolder_rule_from_address): New methods to create a vfolder based
	on a CamelInternetAddress object that we get from the mailer

	* mail/mail-vfolder.[ch] (vfolder_gui_add_from_address): New method to
	create a vfolder rule based on the mailto: addresses

	Fixes #23822

2005-02-15  Radek Doulik  <rodo@novell.com>

	* em-junk-filter.c: use camel_debug

2005-02-10  Not Zed  <NotZed@Ximian.com>

	** See bug #72266

	* em-folder-selection-button.c
	(em_folder_selection_button_clicked): if the selector is already
	up, just raise it.
	(em_folder_selection_button_destroy): destroy the selector if it
	is still up.

2005-02-09  Not Zed  <NotZed@Ximian.com>

	** See bug #71429
	
	* em-folder-view.c (emfv_activate): setup the plugin menu's after
	the main ones.

2005-02-08  Not Zed  <NotZed@Ximian.com>

	** See bug #72228

	* mail-ops.c (mail_send_message): fix this god-awful goto-loop
	crap, and delete the message if it worked.
	(mail_send_message): fix a major-leak with sent messages never
	being unreffed.
	(send_queue_send): don't get messages ourself.
	(mail_send_message): dont lose the exception if we
	can't even open the sent folder.

2005-02-07  Not Zed  <NotZed@Ximian.com>

	** See bug #72209

	* em-folder-tree.c (emft_popup_copy_folder_exclude): implement one
	for copying/moving folders.

	* em-folder-selection.c (em_select_folder): add an excluded func
	argument, fix callers.

	* em-folder-tree.c
	(em_folder_tree_set_exclude_func): allow custom callback for
	exclusion.
	(emft_select_func): handle the custom excluded callback.

2005-02-07  Harry Lu  <harry.lu@sun.com>

	Fix for 72275.
	* em-folder-view.c: (emfv_popup_menu): try to bring up menu for
	preivew html object.  
	(emfv_format_popup_event): handle event == NULL case.
	* em-format-html-display.c: (em_format_html_display_popup_menu):
	New function to popup context menu.
	* em-format-html-display.h: add new function declaration.

2005-02-04  Not Zed  <NotZed@Ximian.com>

	* em-subscribe-editor.c (sub_folderinfo_get): reverted jeff's
	patch for the subscribed hint.

	** See bug #65329

	* em-folder-properties.c (emfp_dialog_got_folder): translate
	local-store special folders.

	* mail-session.c (alert_user, do_user_message): if we aren't
	waiting for cancel, then don't worry about waiting on the reply
	port, otherwise we could block when we don't need to, if there is
	another window already up.

2005-02-03  Jeffrey Stedfast  <fejj@novell.com>

	* message-list.c (message_list_set_folder): Use
	g_hash_table_foreach_remove() instead so the keys don't point to
	free'd values.
	(normalised_free): Return TRUE.

2005-02-02  Rodney Dawes  <dobey@novell.com>

	* em-subscribe-editor.c (em_subscribe_editor_new): Use the
	gtk_widget_ensure_style method instead of gtk_widget_realize when
	setting the border widths of the dialog containers for HIG compliance

	Fixes #68743

2005-02-02  Jeffrey Stedfast  <fejj@novell.com>

	Fixes bug #70454

	* em-subscribe-editor.c (sub_folderinfo_get): Request subscription
	info (new flag).
	(sub_fill_level): Fixed the FIXME here (imap4 now implements
	CAMEL_FOLDER_SUBSCRIBED flag properly).

2005-02-01  Rodney Dawes  <dobey@novell.com>

	* em-folder-browser.c: Replace "_Virtual Folder" with "_vFolder" for
	the search menu to create a vfolder from a search

	* em-folder-tree-model.c (sort_cb): s/VFolders/vFolders/ for sorting
	in the folder tree
	(em_folder_tree_model_load_state): s/VFolders/vFolders/ in a comment

	* em-folder-view.c: s/VFolder/vFolder/ for the popup menu

	* em-vfolder-editor.c (em_vfolder_editor_new): Replace the string
	"Virtual _Folders" with "v_Folders" for the label

	* em-vfolder-rule.c (em_vfolder_editor_sourcelist_new): Repalce the
	string "VFolder source" with "vFolder source"

	* mail-errors.xml:
	* mail-errors.xml.h: Replace "virtual folder" with "vFolder" in an
	error string

	* mail-vfolder.c (vfolder_setup_desc): s/vfolder/vFolder/
	(vfolder_setup_do): s/vfolder/vFolder/
	(vfolder_load_storage): s/VFolders/vFolders/
	(vfolder_edit_rule): s/VFolder/vFolder/
	(vfolder_gui_add_rule): s/VFolder/vFolder/

	Fixes #68137
		
2005-02-01  Not Zed  <NotZed@Ximian.com>

	** See bug #65329.

	* mail-component.c (view_changed_cb): translate special names on
	the local store.

	* em-folder-tree-model.c (sort_cb): use the type hint to sort for
	inbox, not the name.
	(emft_is_special_local_folder): removed.
	(em_folder_tree_model_set_folder_info): special-case the
	local-store case, handle translated names and the name hints.

	* em-folder-tree.c (render_pixbuf): use the camel folderinfo
	folder type to determine the icon, don't hardcode based on name.

	** See bug #71310

	* em-composer-prefs.c (sig_add_script_response): force a save of
	the signatures as soon as they change.  Also save the script name
	if we were just editing it, not just the signature name.

	** See bug #71312.

	* em-folder-view.c (em_folder_view_open_selected): if we're
	looking at a vfolder, then look open the original folder if we need
	to perform any edits.

2005-01-31  Hans Petter Jansson  <hpj@novell.com>

	* importers/mail-importer.h (mc): Remove unused global symbol.

2005-01-28  Jeffrey Stedfast  <fejj@novell.com>

	* message-list.c (message_list_set_folder): Reset the normalised
	string sort table.

2005-01-31  JP Rosevear  <jpr@novell.com>

	Fixes #71937

	* evolution-mail.schemas.in.in: fix spelling error

	* mail-errors.xml: fix two spelling errors

2005-01-31  Not Zed  <NotZed@Ximian.com>

	** See bug #67083

	* em-format-html.c (efh_format_text_header): no-wrap the header line.

	** See bug #69850
	
	* mail-autofilter.c (rule_from_message): dont crash if we're
	missing the requested headers.

	** See bug #71521.

	* em-account-editor.c (emae_url_set_hostport): dont ever set a
	NULL host.

2005-01-28  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_service_provider_changed): handle
	'hide' bits, don't get/set values from the widgets at all.

	* em-account-editor.c: put some tables back into the
	druid and editor, since econfig supports tables now.

	* em-account-editor.c (emae_service_provider_changed): handle
	'hide' bits, don't get/set values from the widgets at all.

	* em-account-editor.c: put some tables back into the
	druid and editor, since econfig supports tables now.

	* em-account-editor.c (emae_service_provider_changed): handle
	'hide' bits, don't get/set values from the widgets at all.

	* em-account-editor.c: put some tables back into the
	druid and editor, since econfig supports tables now.

	** See bug #71520.
	
	* em-account-prefs.c (account_edit_clicked): repeat the nasty hack
	from account_edit, to refresh the list after edit.

2005-01-27  Not Zed  <NotZed@Ximian.com>

	* See bug #69815.
	
	* mail-component.c (impl_quit): shutdown vfolders as first step.

	* mail-vfolder.c (vfolder_setup_do): if we're shutdown during
	processing, just noop.
	(vfolder_adduri_do): same.
	(mail_vfolder_shutdown): set the shutdown flag.

2005-01-27  Rodney Dawes  <dobey@novell.com>

	* mail-config.glade: Fix the labels in the account druid to be
	left aligned, and justified left
	Fix the border and spacing for all the vboxes in the account druid
	pages to be HIG compliant
	Fix the account naming info label to be more concise

	Fixes #68696

2005-01-27  Rodney Dawes  <dobey@novell.com>

	* mail-send-recv.c (build_dialog): Fix the dialog to have borders
	that are HIG-compliant and fix up the spacing and padding of the
	internal widgets to do the right thing to be HIG compliant

2005-01-27  JP Rosevear  <jpr@novell.com>

	* em-format-hook.c: add a d(x) debugging define and default to off

2005-01-26  Mengjie Yu  <meng-jie.yu@sun.com>

	Fixes #71774 

	* em-folder-tree.c (emft_popup_rename_folder): we should check
	whether the 'new_name' is a NULL pointer to avoid Evolution
	crashes.

2005-01-25  Mengjie Yu  <meng-jie.yu@sun.com>

	* em-mailer-prefs.c: (restore_labels_clicked),
	(em_mailer_prefs_construct):
	add a11y names for color pickers.

2005-01-24  Hans Petter Jansson  <hpj@novell.com>

	* Makefile.am (libevolution_mail_la_LIBADD): Pull in the contact
	editors, so we can pass pointers to their creation functions to
	ENameSelectorEntry.

2005-01-24  JP Rosevear  <jpr@novell.com>

	* searchtypes.xml: add back body contains

2005-01-21  JP Rosevear  <jpr@novell.com>

	Fixes #46287
	
	* mail-config.glade: remove enable/disable button

	* em-composer-prefs.h: remove unused button

	* em-composer-prefs.c (spell_language_toggled): handle the cell
	being toggled
	(spell_setup): enable/disable button is gone
	(em_composer_prefs_construct): setup a listener for the toggle
	cell

2005-01-24  Radek Doulik  <rodo@ximian.com>

	* em-popup.[ch]: removed EM_POPUP_SELECT_MARK_[NO]JUNK masks

2005-01-20  Radek Doulik  <rodo@ximian.com>

	* em-folder-view.c: patch from Chris Lahey, makes Mark as Junk/not
	Junk items active on all messages, removes calls to
	message_list_get_selected where not needed

2005-01-24  Not Zed  <NotZed@Ximian.com>

	* searchtypes.xml: changed for 69122.

2005-01-21  JP Rosevear  <jpr@novell.com>
	
	Fixes #46404
	
	* em-folder-view.c (emfv_print_response): use the config in the
	print data and free it
	(em_folder_view_print): load the config from e_print and use the
	dialog from e_print

2005-01-21  Not Zed  <NotZed@Ximian.com>

	** See bug #60664.

	* em-format-html-display.c (efhd_init, efhd_gtkhtml_style_set): if
	the style changes, re-calculate the page colours, and redraw.

2005-01-20  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (emft_copy_folders__desc): Added a description
	function for copying folders (so we don't get a "Working 0x..."
	status message).

	* mail-mt.c (do_op_status): Always g_free(what) since we always
	strdup it.

2005-01-20  Not Zed  <NotZed@Ximian.com>

	** See bug #55831.

	* evolution-mail.schemas.in.in: added open_many prompt key.

	* mail-errors.xml: added ask-open-many

	* em-folder-view.c (em_folder_view_open_selected): put back the
	'you're opening too many are you sure' thing.

2005-01-19  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-properties.c (emfp_get_folder_item): Increment i each
	time thru the loop or we lose widgets.

2005-01-19  Not Zed  <NotZed@Ximian.com>

	** See bug #66943.

	* em-composer-utils.c (save_draft_done): check if the
	editor_engine is still there before trying to invoke a method on
	it.
	(em_utils_composer_save_draft_cb): grab resources before getting
	the folder, so the composer doesn't go away.

2005-01-18  Rodrigo Moya <rodrigo@novell.com>

	* em-filter-source-element.c:
	* mail-config.c: removed e-url.h include.

2005-01-18  Not Zed  <NotZed@Ximian.com>

	** See bug #70768.

	* em-folder-browser.c (emfb_mark_all_read): get the uid list from
	the message-list (view) rather than folder (model).

	* message-list.c (message_list_foreach): removed, no longer used.
	(message_list_get_uids): new function replacing ml_foreach, get
	visible uids's of messages.

2005-01-18  Not Zed  <NotZed@Ximian.com>

	** See bug #71105.

	* em-folder-tree.c (emft_popup_rename_folder): dont let a user
	rename a folder to one including '/'.

	* em-format-html.c (emfh_gethttp): kill old 'load http 0 now=0' debug.

	** See bug #70563.

	* em-utils.c (emu_set_proxy, emu_proxy_setup)
	(em_utils_get_proxy_uri): make sure the init code is called from
	main thread (gconf usage), and add locking for data consistency.

2005-01-14  Not Zed  <NotZed@Ximian.com>

	** Related to changes for #65178.

	* mail-vfolder.c (mv_find_folder): changed from my_list_find, take
	store arg and use camel_Store_Folder_uri_equal() instead of wrong
	uri_cmp function.
	(mail_vfolder_delete_uri): same.
	(mail_vfolder_rename_uri): same.
	(uri_is_ignore): take store arg, and same as above.  use the right
	uri for checking sent folder.
	(mail_vfolder_*): convert to storing uri's in camel form.

2005-01-13  Not Zed  <NotZed@Ximian.com>

	** See bug #71029.

	* em-account-editor.c (emae_option_toggle): revert menjie's patch
	and do it using object args.

2005-01-12  Not Zed  <NotZed@Ximian.com>

	** See bug #70990.

	* em-account-editor.c (emae_service_url_changed): if the value is
	"" then don't set it

	** See bug #70018.

	* mail-signature-editor.c (mail_signature_editor): use the right
	version for the gtkhtml editor control.

2005-01-11  Vivek Jain  <jvivek@novell.com>

	* em-folder-tree.c (render_pixbuf): Added conditions to check for
	shared folders to display different icon if it is a shard folder.	

2005-01-07  Not Zed  <NotZed@Ximian.com>

	* em-account-prefs.c (account_add_clicked): remove old code, setup
	transient parent and weak ref for refresh.

2005-01-06  JP Rosevear  <jpr@novell.com>

	* Makefile.am: install schemas properly

2005-01-06  Jeffrey Stedfast  <fejj@novell.com>

	* mail-folder-cache.c (mail_note_store): Handle the
	CamelOfflineStore case just like the CamelDiscoStore case.

	* mail-ops.c (prep_offline_do): Since we can't kill off
	CamelDisco* (groupwise is using it), we have to handle both
	CamelOfflineFolder and CamelDiscoFolder for now.
	(set_offline_do): Same.

2005-01-05  Not Zed  <NotZed@Ximian.com>

	* em-menu.c: (emph_targets[]): Add the widget target, missed this.

2005-01-05  Not Zed  <NotZed@Ximian.com>

	* em-menu.c (em_menu_target_new_widget): add a semi-dummy target
	for widget target.

	* mail-component.c (handleuri_got_folder): handle the "reply"
	parameter, if set.

	* em-composer-utils.c (em_utils_reply_to_message): only ref the
	source if supplied.
	(reply_to_message): only unref the source if supplied.

2004-12-28  Mengjie Yu  <meng-jie.yu@sun.com>

	* em-folder-tree.c: (em_folder_tree_new_with_model):
	add atk name for the treeview.

2004-12-22  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_needs_auth): moved to after
	emae_authtype_changed to fix warning.

2004-12-17  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_attachment_popup): 

	* message-list.c (ml_tree_drag_data_received): 

	* em-folder-view.c (emfv_popup, emfv_format_popup_event): 

	* em-folder-tree.c (tree_drag_data_received): api changes.
	(emft_popup): 

	* em-popup.c (emp_standard_menu_factory) 
	(emp_standard_menu_factory): api changes.

2004-12-21  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_needs_auth): if we're turned on, then
	record the current authtype setting on the widgets, if we're
	turned off, clear the authmech setting.
	(emae_setup_service): setup the needs auth after the authtype, and
	get setting from url->authmech.
	(emae_service_provider_changed): only clear the url->authmech if
	we don't have the current one in our list.

2004-12-20  Takeshi AIHANA <aihana@gnome.gr.jp>

	* default/Makefile.am: Added 'ja' and 'nl' to install.

2004-12-14  Rodney Dawes  <dobey@novell.com>

	* mail-account-gui.c: Remove this from CVS
	
	* mail-config.glade: Use em_account_editor_folder_selector_button_new
	instead of mail_account_gui_folder_selector_button_new

2004-12-14  JP Rosevear  <jpr@novell.com>

	Fixes #68759
	
	* mail-account-gui.c (service_check_supported): fix typo in
	routine name

2004-12-08  Hans Petter Jansson  <hpj@novell.com>

	* importers/pine-importer.c: Include <libebook/e-destination.h> from
	evolution-data-server.

2004-12-08  Rodney Dawes  <dobey@novell.com>

	* em-folder-tree.c:
	* mail-component.c (impl__get_userCreatableItems): 
	Use stock_new-dir instead of stock_folder for "New Folder" creation

2004-12-07  Mengjie Yu  <meng-jie.yu@sun.com>

	* mail-config.glade: add mnemonic for buttons, labels, etc.
	* mail-dialogs.glade:add mnemonic for buttons, labels, etc.
	* message-tags.glade:add mnemonic for buttons, labels, etc.

2004-12-08  Not Zed  <NotZed@Ximian.com>

	* mail-component-factory.c (make_factory): and put them here
	instead so they're available even when the mailer isn't activated
	yet.

	* mail-component.c (mc_startup): remove plugin hook registrations.

2004-11-22  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_receive_options_extra_item): dont
	track containee widgets anymore, they are automagically destroyed
	by the container if required.

2004-11-25  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): do not call gconf here
	as we may be called from worker thread
	(em_junk_filter_get_plugin): read alternative spam[cd] binaries
	paths here, use init lock to be sure no one is accessing spam[cd]
	binaries paths

	Fixes #69623

2004-12-01  Mengjie Yu  <meng-jie.yu@sun.com>

	* em-account-editor.c:according to the HIG, remove accelerators in 
	the notebook tab labels 

2004-12-01  Mengjie Yu  <meng-jie.yu@sun.com>

	* em-account-editor.c: (emae_option_toggle),
	(emae_receive_options_item):add mnemonic for buttons.
	* em-format-html-display.c: (efhd_attachment_button):add atk name
	for the popup button.
	* mail-account-gui.c: (mail_account_gui_build_extra_conf):add 
	access key for checkbox.
	* message-list.c: (message_list_construct):add a atk name for the
	message list.

2004-11-22  Not Zed  <NotZed@Ximian.com>

	** See bug #69339.

	* em-format-html.c (efh_format_do): after closing the base output
	stream, re-loop if more jobs were queued.

2004-11-19  Not Zed  <NotZed@Ximian.com>

	** See bug #69339.

	* em-format-html.c (efh_format_do): close the stream/html after we're
	finished, since the multipart/related stuff may write more content
	for orphaned attachments.

2004-11-23  Not Zed  <NotZed@Ximian.com>

	** See bug #69579.

	* em-folder-properties.c (em_folder_properties_show): check to see
	if the vfolder is the unmatched folder before letting the user try
	to see its properties.

2004-11-30  Not Zed  <NotZed@Ximian.com>

	** See bug #68958.

	* em-folder-browser.c (emfb_list_built): if the pending selected
	uid isn't in the folder (yet), don't clear it, just keep it
	around.  Hook/unhook folder_changed events.
	(emfb_folder_changed, emfb_gui_folder_changed): if a select_uid is
	set, and the message is now available, then select it.

2004-11-28	S.Ã?aÄ?lar Onur <caglar@uludag.org.tr>

	** See bug #69446.

	* evolution-2.0.2/mail/mail-account-gui.c (mail_account_gui_setup): 
	some strcasecmp() calls changed with g_ascii_strcasecmp() for Turkish
	character conversiton problems [ http://www.i18nguy.com/unicode/turkish-i18n.html ]

2004-11-26  JP Rosevear  <jpr@novell.com>

	* em-format.c: wrap printf's in debug defines

2004-11-26  JP Rosevear  <jpr@novell.com>
	
	* em-format-html-display.c (efhd_xpkcs7mime_button): get image
	widget directly from icon factory

	* mail-send-recv.c (build_dialog): ditto
	
2004-10-12  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c: when starting new spamd, call it with
	--socketpath parameter to use unix sockets instead of opening TCP
	port. kill such started daemon in finalize callback which is
	installed by atexit. also try to respawn spamd in case spamc
	returns error, if respawning is too fast (8 restarts in last 5
	minutes) fallback to spamassassin

	* mail-component.c (impl_quit): call mail_session_quit

	* mail-session.c (mail_session_init): call junk plugin init
	(mail_session_quit): new method, called on evo exit

2004-11-22  Joan Sanfeliu  <joan@fibranet.com>

	* mail-config.glade : Evolution word spelled with an uppercase E

	Fixes #61065

2004-11-16  Not Zed  <NotZed@Ximian.com>

	* Makefile.am:
	* importers/Makefile.am: Removed camel linking.

2004-11-15  Not Zed  <NotZed@Ximian.com>

	* *.c: Moved various things from e-util to libedataserver.

	* GNOME_Evolution_Mail.server.in.in: remove the startup wizard stuff.

	* mail-config-druid.[ch]:
	* mail-account-editor.[ch]:
	* mail-account-gui.[ch]: removed & deleted.

	* mail-session.c (mail_session_init): and here too.
	* em-migrate.c (em_migrate_1_4): init camel-provider library too.
	(e_path_to_physical): copy from e-util/e-path.c.

	* Makefile.am (libevolution_mail_la_LIBADD): link to new libcamel
	provider too.

2004-11-12  Not Zed  <NotZed@Ximian.com>

	* filtertypes.xml:
	* vfoldertypes.xml: 
	* searchtypes.xml: Added 'match all' rules.

	** Merge in notzed-messageinfo-branch.

2004-11-11  Radek Doulik  <rodo@ximian.com>

	* em-format-hook.c (emfh_enable): l = g_list_next (l); in inner
	loop instead of g = g_list_next (l).. probably typo after c'n'p

	* em-format.c (em_format_class_remove_handler): in case the old
	handler doesn't exist, remove 'info' handler from type_handler
	table

2004-11-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_popup): Fix the popup id.
	
2004-11-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_list_done_message_selected): revert
	jeff's last change - we do actually want to know when we couldn't
	load a message.  the crash he was fixing was fixed elsewhere.
	also fix the unref ordering stuff.

	* em-format-html.c (efh_format_timeout): removed the fixme i
	added.

2004-11-01  Not Zed  <NotZed@Ximian.com>

	** See bug #67496.

	* em-format-html.c (efh_text_html): use the base on the emformat
	to calculate our absolute iframe uri.
	(efh_multipart_related): same as emf_multipart_related.

	* em-format.c (emf_multipart_related): remove content-location
	handling, now done in format_part_as.
	(em_format_part_as): track content-base (& absolute
	content-location) of all parts here.

2004-11-02  Not Zed  <NotZed@Ximian.com>

	* em-event.c (eme_target_free, em_event_target_new_message):
	handle NULL folder or message.

2004-11-02  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-view.c (emfv_list_done_message_selected): Check for
	NULL messages (happens if the message isn't available).

2004-11-02  Radek Doulik  <rodo@ximian.com>

	* em-format-html.c: replace 3 nested html tables used to create
	this gray border around parts content with div block with border
	style
	use shorthand border: property

2004-11-01  Jeffrey Stedfast  <fejj@novell.com>

	* em-account-editor.c: Change the labels back to the same as they
	were in 2.0

2004-11-12  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (auto_account_finalised): fix the callback
	signature.

2004-11-11  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_add_store):
	(mc_add_store_done): Let the counters know about the junk/trash
	folders that have already been opened.

	* em-vfs-stream.[ch]: Added stream class to read/write gnome-vfs
	data from camel.  NFI if this will work, depends on how
	thread-safe gnome-vfs is.

2004-11-08  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.c (uri_is_spethal): fix the special check for local
	folders.

2004-10-30  Not Zed  <NotZed@Ximian.com>

	* */*.c, *.c: camel api changes.

2004-10-28  Not Zed  <NotZed@Ximian.com>

	* mail-folder-cache.c (real_flush_updates): 
	* em-message-browser.c (em_message_browser_new): 
	* em-mailer-prefs.c (em_mailer_prefs_construct): 
	* em-format-html-display.c (efhd_attachment_popup): 
	* em-folder-view.c (emfv_popup, emfv_list_done_message_selected) 
	(emfv_format_popup_event): 
	* em-folder-tree.c (emft_popup): 
	* em-folder-properties.c (emfp_dialog_got_folder): 
	* em-folder-browser.c (em_folder_browser_new): 
	* em-composer-utils.c (em_utils_reply_to_message): 
	* em-composer-prefs.c (em_composer_prefs_construct): 
	* em-account-editor.c (em_account_editor_construct): added hook
	docs, and cleaned up some of the hook point names.

2004-10-22  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c: Give the Rename item a different path than the
	Delete item.

2004-10-22  Not Zed  <NotZed@Ximian.com>

	* em-event.c (eme_target_free): duh, they're camel not gobjects.

	* em-folder-view.c (emfv_list_done_message_selected): added a
	message.reading event.

2004-10-22  Nat Friedman  <nat@novell.com>

	* em-event.c: Add a REPLY_ALL flag to the Message target.
	* em-composer-utils.c (em_utils_reply_to_message): Set the
	REPLY_ALL flag when appropriate.

2004-10-21  Not Zed  <NotZed@Ximian.com>

	* em-composer-utils.c (em_utils_reply_to_message): emit a
	'message.replying' event with a message target.

2004-10-21  Nat Friedman <nat@novell.com>

	* em-event.c (em_event_target_new_message): new target type for
	message-related events.

2004-10-21  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_format_popup_event): put 'evolution' back
	in the popup hook names.

2004-10-19  JP Rosevear  <jpr@novell.com>

	* em-account-editor.c, em-composer-prefs.c, em-config.c,
	em-event.c, em-folder-browser.c, em-folder-properties.c,
	em-folder-tree.c, em-folder-view.c, em-format-hook.c,
	em-format-html-display.c, em-mailer-prefs.c, em-menu.c,
	em-message-browser.c, em-popup.c, message-list.c: convert to
	org.gnome hook names

2004-10-19  JP Rosevear  <jpr@novell.com>
	
	* message-list.c: convert to G_DEFINE_TYPE

2004-10-11  Not Zed  <NotZed@Ximian.com>

	** See bug #67014.

	* mail-errors.xml: added "checking-service" error.

	* em-account-editor.c (em_account_editor_construct): keep track of
	the dialogue
	(emae_editor_destroyed): , and clean up when destroyed.

	* em-account-editor.c (emae_check_authtype)
	(emae_check_authtype_response, emae_check_authtype_done): handle
	checking authtype gui here.

	* mail-config.c (check_service_describe, check_service_check) 
	(check_response, mail_config_check_service): removed.

	* mail-ops.c (mail_check_service): moved here from mail-config,
	and modified to be a re-usable threaded function.

2004-10-18  Not Zed  <NotZed@Ximian.com>

	** See bug #68006.

	* em-folder-view.c (emfv_init): dont ref/sink the invisible.
	(emfv_destroy): just destroy it here.

2004-10-15  Not Zed  <NotZed@Ximian.com>

	* em-composer-utils.c (create_new_composer):
	(em_utils_compose_new_message, forward_non_attached): do noting if
	the composer couldn't be created.  We get a popup from elsewhere
	to let the user know.

2004-10-14  Sivaiah Nallagatla <snallagatla@novell.com>

	* mail-errors.xml : Remove Pango markup from groupwise 
	account setup error message 

2004-10-12  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_find_handler): use builtin
	handlers (and plugins) always overriding bonobo ones.

2004-10-11  Not Zed  <NotZed@Ximian.com>

	** See bug #67408.

	* em-folder-view.c (emfv_gui_folder_changed): noop if we were
	destroyed.
	(emfv_destroy): set destroyed bit.

2004-10-11  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_startup): register the formatter types
	before registering the formatter hook.

2004-10-08  JP Rosevear  <jpr@novell.com>
 
	* mail-account-gui.c (browse_clicked): use "Select a file"
	
2004-10-08  Harry Lu  <harry.lu@sun.com>

	* em-folder-tree.c: (em_folder_tree_class_init), (real_popup_menu),
	(emft_popup_menu), (emft_tree_button_press): implement popup_menu
	so that popup menu can be shown with Shift+F10 on folder tree.
	* em-folder-view.c: (emfv_popup), (emfv_list_key_press):
	same as above.

2004-10-07  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_startup): dont init the base plugin system
	here anymore, only register the hook types for mail hooks.

2004-09-28  Not Zed  <NotZed@Ximian.com>

	* em-composer-utils.c (forward_non_attached): put back in the
	attachment attaching code.  Doesn't work for s/mime and pgp, but
	why bother arguing about it.

2004-10-06  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_get_folder_info__desc): fix busted cast.

	* *.c: e-popup api changes.

2004-10-06  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_tree_button_press): remove some debug
	that made it in accidentally.

2004-10-05  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_popup_copy_folder_selected): remove old
	debug which no longer works.

	** See bug #66991 (related to #64377).

	* em-folder-tree.c (em_folder_tree_set_selected): if we get a NULL
	uri or "", just clear the list.
	(emft_tree_button_press): select the new path as well as move the
	cursor there, otherwise emft_tree_user_event clears the selection.

2004-09-30  David Malcolm  <dmalcolm@redhat.com>

	* em-migrate.c (upgrade_passwords_1_2): fix uninitialised pointer.

2004-09-27  Jeffrey Stedfast  <fejj@novell.com>

	* em-account-editor.c: Changed the SSL option menu labels.

2004-09-21  Not Zed  <NotZed@Ximian.com>

	** See bug #63521.

	* mail-ops.c (fetch_mail_fetch): delete all the messages on the
	server if we're not in keep on server mode and everything worked.
	uncancel ourselves before saving the cache uid since it could be
	cancelled otherwise.

2004-09-24  Not Zed  <NotZed@Ximian.com>

	** See bug #66706.

	* em-subscribe-editor.c: add a sequence number to EMSubscribe and
	the subscribe_msg structures.  NOOP if the sequence has changed in
	all callbacks.  up the sequence number when we refresh.

2004-09-20  Not Zed  <NotZed@Ximian.com>

	** See bug #65329.

	* em-folder-tree-model.c (emft_is_special_local_folder): added
	helper for finding local folders for translation.
	(em_folder_tree_model_set_folder_info): translate the special
	local folder names.

	* mail-component.c: mark standard folder names for translation.

2004-09-23  Not Zed  <NotZed@Ximian.com>

	** See bug #65058 (again again).

	* em-format-html.c (efh_text_html): calculate our location uri
	ourselves (content id).

	* em-format.c (em_format_add_puri): if we have no content-location
	key, don't fallback to any container's location.

2004-09-23  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_get_folder_info__desc): describe the
	get-folder process.  This also makes it cancellable.

	** See bug #64972.

	* em-composer-utils.c (em_utils_reply_to_message): pass the folder
	to guess_account.

2004-09-03  Not Zed  <NotZed@Ximian.com>

	** See bug #65058.

	* em-format-html.c (efh_image): use the content-id rather than
	the uri for tracking our image reference.  Makes more
	sense anyway, its guaranteed unique.

2004-09-21  David Malcolm  <dmalcolm@redhat.com>

	* em-folder-tree-model.c (em_folder_tree_model_set_selected): Fix
	a typo setting the root node.

2004-09-09  Jeffrey Stedfast  <fejj@novell.com>

	* em-message-browser.c (emmb_set_message): Ignore the
	emfv->mark_seen for deciding whether or not to mark the message as
	seen. Fixes bug #65448.

2004-09-09  Jeffrey Stedfast  <fejj@novell.com>

	* mail-account-gui.c (mail_account_gui_new): If built with
	gtkfilechooser support, we need to add a checkbox in the chooser
	so that the user can select files or folders (allowing him to
	choose - otherwise they won't be able to setup certain types of
	accounts). Fixes bug #64974.

2004-09-12  JP Rosevear  <jpr@novell.com>

	Fixes #65703
	
	* em-popup.c: use proper stock icon name

2004-09-08  Not Zed  <NotZed@Ximian.com>

	** See bug #60515.

	* mail-account-gui.c (sig_fill_menu): connect to the activate
	signal for the none item.

2004-09-03  Not Zed  <NotZed@Ximian.com>

	** See bug #59717.

	* mail-config.c (mail_config_check_service): Make the dialog
	modal.  Not ideal but a problem with the way the function works,
	it should be fully async instead.

2004-09-01  Jeffrey Stedfast  <fejj@novell.com>

	Fix for bug #63377 and prevention of similar cases.

	* em-format.c (emf_finalise): Free the default_charset.
	(emf_format_clone): Clone the default_charset - this prevents the
	particular crash described in bug #63377.

	* em-utils.c (em_utils_message_to_html): If source is NULL, set
	our own default charset (from the user's gconf key) on the
	formatter to make sure there's always a source charset for
	conversion to UTF-8.

2004-08-30  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (emft_popup_delete_folder): Set the store and
	full_name info on the dialog.
	(emft_popup_delete_response): Use the requisite data stored on the
	dialog object rather than examining the selection again. Fixes bug
	#62665.

2004-08-30  Not Zed  <NotZed@Ximian.com>

	** See bug #64377.

	* em-folder-selector.c (emfs_response): only set the uri if we
	have one to set.

	* em-folder-tree.c (em_folder_tree_finalize): Removed
	cose using selected_path and selected_uri strings.
	(emft_popup_new_folder): "
	(emft_popup_copy_folder_selected): "
	(emft_tree_selection_changed): 
	(emft_tree_row_activated): ", free paths after use.

	* em-folder-selector.c (emfs_create_name_changed): free
	get_selected_uri return.
	(emfs_create_name_activate): "
	(em_folder_selector_get_selected_path): handle api change, store
	the selected_path too.

	* em-folder-tree.c (em_folder_tree_get_selected_uri):
	de-constify,and get the selection directly from the tree.
	(em_folder_tree_get_selected_path): same.

2004-08-27  Not Zed  <NotZed@Ximian.com>

	** See bug #63456.

	* message-list.c (main_folder_changed): noop if the async_event
	pointer is NULL which can happen during destroy.

2004-08-27  JP Rosevear  <jpr@novell.com>

	* importers/mail-importer.c (import_folders_rec): utf8_filename
	should be char * not char

2004-08-27  Hans Petter Jansson  <hpj@ximian.com>

	* em-utils.c (emu_can_save): Don't crash if we're passed a NULL
	path. GtkFileChooser can return NULL filenames that get passed
	to this function.

2004-08-26  Christian Neumair  <chris@gnome-de.org>

	* GNOME_Evolution_Mail.server.in.in:
	Don't mark component menu accel for translation.

2004-08-24  Jeffrey Stedfast  <fejj@novell.com>

	Fix for bug #63177

	* em-folder-tree.c (emft_drop_async_drop): Check full_name == NULL
	rather than full_name[0] since store's have NULL full_names, not
	empty string (like they used to).
	(emft_drop_folder): Same.
	(tree_drag_data_received): Don't abort the drop if the user
	dropped on a store, this is allowed (depending on the store).

2004-08-25  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (store_info_new): only open the trash or junk
	if they're vfolders here.  Some stores that implement their own
	trash folders are unacceptably slow to open otherwise.

2004-08-25  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* importers/evolution-mbox-importer.c (load_file_fn):

	* importers/evolution-outlook-importer.c (load_file_fn):

	* importers/mail-importer.c (import_folders_rec): Convert filename
	to UTF-8 from local encoding before displaying it.

2004-08-23  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (em_folder_tree_set_selected): store the
	select-uri on the view not in the thread message.
	(emft_get_folder_info__free):
	(emft_get_folder_info__got): select_uri removed.
	(em_folder_tree_set_selected_list): don't set each selected
	separately, do it as a list.
	(emft_maybe_expand_row): if this is a selected row, select it too.
	(emft_get_folder_info__got): do no pending set selection stuff
	here.
	(em_folder_tree_set_selected): just call set_selected_list with
	one item.
	(emft_expand_node): if this is a selected row, select it too.
	(emft_get_folder_info__got): no longer need to track lost folders.
	(emft_tree_row_activated): clear the pending select list.
	(emft_tree_selection_changed): and here too.
	(em_folder_tree_get_selected_uris): get the lost folders from the
	un-applied selected ones now.  also fixes a list appending error.
	(emft_tree_user_event): find out when the user hits a key or mouse
	button to override any pending single-user select and don't
	override the cursor setting either.
	(emft_tree_row_expanded): set the 'load subdirs' false before we
	load it, so we don't try to load it again if its still being
	loaded.
	(emft_get_folder_info__got): don't check the loaded flag here, it
	should be set by the callee, also check the exception return.

2004-08-13  Jeffrey Stedfast  <fejj@novell.com>

	Fix for bug #62812

	* em-format-html-display.c (em_format_html_display_search): Set
	the search_dialog to be transient for the parent window and make
	sure to destroy the search_dialog when the parent gets destroyed.

2004-08-21 Sivaiah Nallagatla <snallagatla@novell.com>

	* mail-erros.xml: changed the groupwise account setup error
	message

2004-08-16  Not Zed  <NotZed@Ximian.com>

	** See bug #62963.

	* message-list.c (build_tree, build_flat): define selected in
	declaration block, not inline. Spotted by Vincent Noel
	<vnoel@cox.net>

2004-08-13  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (em_utils_message_to_html): don't include the
	terminating NUL in the data length.
	(em_utils_part_to_html): nor here.

2004-08-12  Carlos Garnacho Parro  <carlosg@gnome.org>

	* em-utils.c: Optionally use GtkFileChooser if compiled against
	Gtk+ >= 2.4.0

	* mail-config.glade: added the "use_filechooser" property to the
	various GnomeFileEntries

2004-08-10  Jeffrey Stedfast  <fejj@novell.com>

	Partial fix for bug #62771

	* em-format-quote.c (emfq_format_header): Same.

	* em-format-html.c (efh_format_header): Decode the
	X-Mailer/User-Agent headers.

2004-08-10  Not Zed  <NotZed@Ximian.com>

	* mail-session.c (get_password): just call
	e_passwords_ask_password directly.
	(pass_activate, pass_response, request_password, do_get_pass)
	(do_free_pass, main_forget_password): no longer required as
	e_password now handles the magic, and is thread safe.

	* mail-config.c (mail_config_write_on_exit): epasswords api
	change.

2004-08-06  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree-model.c (em_folder_tree_model_get_selected):
	Return NULL not FALSE on error.

2004-06-08  Karsten BrÃ€ckelmann  <guenther@rudersport.de>

	* em-format-html-display.c (smime_encrypt_table[4]): minor typo,
	uppercase 'the' corrected.

2004-08-03  Jeffrey Stedfast  <fejj@novell.com>

	* em-composer-utils.c (format_sender): If type="{Sender}" and name
	is an empty string, use the addr. Fixes bug #62377

2004-08-01  JP Rosevear  <jpr@novell.com>

	* default/C/Inbox: Update to just call us "Evolution" and be more
	accurate about the new features included

2004-07-29  Sivaiah Nallagatla <snallagatla@novell.com>

	* mail-errors.xml: add the error message needed for groupwise
	account setup

2004-07-28  Not Zed  <NotZed@Ximian.com>

	** See #61958.

	* mail-folder-cache.c (real_flush_updates): remove the soreinfo
	lookup, it isn't used anywhere anymore.
	(mail_note_folder): hook onto the events outside of the lock, and
	don't pass the mfi pointer anymore.
	(mail_note_store): hook onto the events outside of the lock.
	(folder_changed, folder_finalised, folder_renamed): lookup the mfi
	if needed, it is no longer passed to the callback.
	(unset_folder_info): change unhook calls for new parameters.

2004-07-28  Not Zed  <NotZed@Ximian.com>

	** See #61940.

	* em-composer-utils.c (composer_set_body): add emformat source arg.
	(em_utils_reply_to_message): take source arg.  Fixed callers.

	* em-utils.c (em_utils_message_to_html): take a source formatter
	argument, so we can copy/honour settings from it.
	(em_utils_part_to_html): similar.

2004-07-27  Not Zed  <NotZed@Ximian.com>

	** See #57972.

	* message-list.c (search_func): removed.
	(ml_search_path): new function to just search, not actually change
	the cursor like e_tree_find does.
	(message_list_can_select): new function, returns true if the
	selection specified is possible without changing the selection.
	(message_list_select): rewritten.
	(select_path): helper to select a path in a way that 'works
	reliably'.
	(message_list_select_next_thread): rewritten to use the
	table-adapter, so it properly handles arbitrary sorting.

	* em-folder-view.c (em_folder_view_get_popup_target): setup
	next/prev flags as appropriate.
	(emfv_enable_map[]): setup next/prev flags.

	* em-folder-view.h: added last and first message status bits to
	folder view select mask.

2004-07-23  Radek Doulik  <rodo@ximian.com>

	* added len parameter to em_utils_part_to_html and
	em_utils_message_to_html. it is used to return length of returned
	buffer. we use that info later when setting composer body content.

2004-07-22  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (impl_createControls): dont call
	e_error_default parent here, we dont have access to the toplevel
	yet.

2004-07-23  Not Zed  <NotZed@Ximian.com>

	** See bug #61824.

	* em-popup.c (emp_part_popup_reply_sender)
	(emp_part_popup_reply_list, emp_part_popup_reply_all): use new
	api.  We have no uid/folder to update here.

	* em-folder-view.c (emfv_message_reply): use new api for replying
	so we can supply the message content and have flags updated.

	* em-composer-utils.c (em_utils_reply_to_message): added optional
	folder and uid.
	(em_utils_reply_to_message_by_uid): removed, use the other
	interface instead.
	(reply_to_message): just call reply_to_message if we get a message
	to reply to.
	(em_utils_reply_to_message): if no message supplied, load it via
	the uid.

2004-07-22  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (em_utils_part_to_html, em_utils_message_to_html):
	set the session on the formatter.  See #61767.

2004-07-22  Not Zed  <NotZed@Ximian.com>

	** See bug #61747.

	* message-list.c (search_func): don't emit a message_selected here
	(god knows why we did?).  Don't update cursor_uid either, just
	clear it.
	(message_list_select): select the path if we find it here, causing
	the cascade of selection action.

2004-07-19  Jeffrey Stedfast  <fejj@novell.com>

	* em-migrate.c (em_migrate_folder): Free uri and name
	strings. Fixes a leak.

2004-07-13  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-view.c (emfv_message_reply): Chck that the selection
	is active. Hopefully this will fix bug #61427.

2004-07-13  Dan Winship  <danw@novell.com>

	* em-utils.c (em_utils_selection_set_urilist):
	(em_utils_temp_save_part): free return value from e_mkdtemp

2004-07-09  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_folder_expunge): only call expunge if
	the folder is set.
	(emfb_enable_map[]): only enable expunge menu item if we have a
	valid folder set.

	** See bug #60900.

	* em-format-html.c: convert the text_inline_parts hash to be keyed
	off the partid.
	(efh_free_inline_parts): -> efh_free_cache and fix to do it.

	* em-format.c (emf_free_cache): make the inline table cache other
	info too based on partid, this frees the structure.
	(emf_clone_inlines): copy all of the cache data.
	(em_format_is_inline): use the new data structure to determine
	state.
	(em_format_set_inline): same for setting.
	(emf_multipart_signed): cache/lookup the cached part.
	(emf_insert_cache): helper to add a cache entry.
	(emf_multipart_encrypted): cache decrypted part.
	(emf_application_xpkcs7mime): same.

2004-07-08  Not Zed  <NotZed@Ximian.com>

	** See bug #60900 (related only).

	* em-format-html-display.c (efhd_attachment_show): let set_inline
	do the redraw itself if required.  kill some dead code.

	* em-format.c (em_format_set_inline): trigger a redraw here like
	the other em_format_set methods, if the state changed.

	* em-format.c (emf_format_clone): free inline table keys & setup
	string hash table.

	* em-format-quote.c (emfq_format_attachment): 
	* em-format-html-display.c (efhd_format_attachment): 
	* em-format-html.c (efh_format_attachment): is_inline api changes.

	* em-format-html-display.c (efhd_attachment_show): set_inline api
	changes.

	* em-format.c (em_format_is_inline): make this use the partid
	rather than the part address as a key, which may change.
	(emf_init): make the inline talbe a string hashtable.
	(emf_finalise): free inline keys.
	(emf_clone_inlines): copy the key string.

2004-07-07  Jeffrey Stedfast  <fejj@novell.com>

	Fix for bug #61199.

	* em-format-html.c (efh_format_address): Same.

	* em-format-quote.c (emfq_format_address): Make sure 'real' isn't
	NULL before using.

2004-07-08  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* Makefile.am:
	tarball should ship .schemas.in.in files, not generated files.

2004-07-02  JP Rosevaer  <jpr@novell.com>

	* Makefile.am (SUBDIRS): Revert previous error change

2004-09-10  Not Zed  <NotZed@Ximian.com>

	* em-*: various doco updates.

	* em-format-quote.c (emfq_builtin_init): instead of removing the
	type, just add an override noop.  Changed api's.

2004-09-09  Not Zed  <NotZed@Ximian.com>

	* em-format.c (em_format_class_remove_handler): Change this to use
	the original structure only, not by type.

	* em-format-hook.c (emfh_enable): implement hook enablation.

2004-09-07  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_setup_providers): set the provider
	shown selected on the store as well.

	* mail-config.glade: moved the druid 'help text' directly into the
	glade file.

	* em-account-editor.c (emae_check_complete): add pre-load for
	management page options.

	* em-utils.c (em_utils_configure_account): remove use of
	mail-config-druid.

	* em-account-editor.c (emae_remove_childen): removed.
	(*): removed service->url, always get it from/set it to the
	e-account so it doesn't have side-effects with plugins.

	* mail-dialogs.glade: fix up the names of the various license
	dialog fields.

2004-09-06  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (emae_receive_options_extra_item): store the
	config widgets in the item entry itself.
	(emae_auto_detect): wasted a whole lot of time on this crap.

	* em-account-prefs.c (account_able_clicked): removed some redundant logic.

	* mail-send-recv.c (mail_autoreceive_setup): renamed to
	mail_autoreceive_init and rewrote all the callbacks.  now it
	listens to events on the accountlist directly and doesn't need
	invoking manually.  It also runs relative to the account always,
	rather than copying the uri.  Removed all callers except the mail
	component one.

	* em-account-editor.c (em_account_editor_provider_selector_new):
	removed becaus eof below.
	(em_account_editor_construct): copy the account to a working
	object if supplied, else create a new one.

	* mail-config.glade: make the provider selectors just use
	em_account_editor_dropdown new for the dropdown menu.

	* em-account-editor.c (prepare_signatures): removed, merged into
	the identity page code.
	(sig_fill_menu): removed.
	(emae_setup_signatures): new function to setup signatures on a
	gtkcombobox.
	(clear_menu): removed.
	(signature_changed): removed.
	(emae_signature_changed): new function for changed.
	(signature_removed): removed.
	(emae_signature_removed): new function for removed.
	(emae_signature_get_iter): helper for finding the right row for
	this signature.
	(signature_added): removed.
	(emae_signature_added): new function for added.
	(sig_activate): removed.
	(emae_signaturetype_changed): new function to update the account
	info immediately.
	(sig_add_new_signature): renamed to emae_signature_new.
	(select_account_signature): no longer needed, this happens in the
	setup.

	* mail-config.glade: changed the signature thing to a custom
	widget (gtkcombobox).

	* em-account-editor.c (em_account_editor_construct): updates for
	api change, table sections require table items.
	(emae_setup_service): handle host:port hostname syntax.
	(emae_hostname_changed): and here too.
	(emae_commit): fill this out, and implement it.

2004-09-04  Not Zed  <NotZed@Ximian.com>

	* *.c: include gnome i18.h if needed since camel-object.h was
	fixed.

	* em-format.c (em_format_class_add_handler): if a handler is
	already set for type, link it in.

	* em-format.h: added a link pointer to EMFormatHanlder, so that
	overrides can also fallback.  remove applications member - not
	used anymore.

2004-09-01  Not Zed  <NotZed@Ximian.com>

	* em-popup.h: added some docs.

	* em-popup.c (emp_standard_menu_factory): 
	* em-folder-tree.c (tree_drag_data_received): popup api changes.

2004-08-31  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_attachment_button_show): use a
	wrapper for the button event since the popup event has changed
	signature.

2004-08-30  Not Zed  <NotZed@Ximian.com>

	* em-popup.c (emp_standard_menu_factory): changed args.
	(struct _open_in_item): removed, use user data instead.
	(*): fix callbacks for new apis.
	(emp_popup_open): Removed some dead popup callbacks never invoked.
	(em_popup_target_new_attachments): new target type for attachment
	bar in composer.

	* em-folder-tree.c (emft_popup*): convert to new e-popup apis.

	* em-folder-view.c: emfv_popup_*: convert to new e-poup callback
	signatures.
	(EMFV_MAP_CALLBACK): fix for e-popup callback change.
	(EMFV_POPUP_AUTO_TYPE): same.
	(emfv_popup): dont bother setting item callback data.
	(emfv_popup_labels_free): api changes.
	(emfv_popup_items_free): new free method.
	(EMFVPopupItem): No longer needed.
	(emfv_uri_popup_free): api changes.
	(emfv_format_popup_event): new api's == simpler code.

	* em-account-editor.c (emae_receive_options_extra_item): add a
	hack for the label item, which is only used by connector to
	override the hostname and username labels.

2004-08-24  Not Zed  <NotZed@Ximian.com>

	* em-account-editor.c (em_account_editor_construct): create the
	window rather than the widget here.

	* mail-config.glade: remove the extra_page from the druid, it is
	autogenerated now.  renamed the "Receiving options" notebook page
	to "Receiving Email" since it isn't hte options page.

	* em-account-editor.c (emae_receive_options_page): no longer
	needed, autogenerated.
	(emae_receive_options_item): setup the auto-receive time values.
	(emae_receive_page): don't setup the auto check time values here.

	* mail-config.glade: Remove the Receiving Mail tab, it is now
	completely auto-generated.

2004-08-17  Not Zed  <NotZed@Ximian.com>

	* em-event.[ch]: mail event dispatcher.

	* mail-component.c (mc_startup): hook into events.

	* mail-folder-cache.c (update_1folder): always set the uri field.
	(real_flush_updates): emit a folder.changed:new event if we have new
	mail.

2004-08-13  Not Zed  <NotZed@Ximian.com>

	* mail-config.glade: replaced ssl selector with custom widget
	(gtkcombobox).  Giv the preferences, composer toplevel unique
	names.

2004-07-29  Not Zed  <NotZed@Ximian.com>

	* mail-config.glade: replaced source and transport selector with
	custom widget (gtkcombobox).

	* em-account-editor.[ch]: copy over mail-account-gui.[ch] and
	rename stuff.  Make a gobject.  Move most internals, internal.

2004-07-28  Not Zed  <NotZed@Ximian.com>

	* em-composer-prefs.c (em_composer_prefs_construct): get the
	toplevel tab as the root.
	(em_composer_prefs_construct): setup plugin metadata for composer
	prefs.

	* em-mailer-prefs.c (em_mailer_prefs_construct): setup plugin
	metadata for mail preferences.

	* em-config.c (em_config_target_new_prefs): new target for 'prefs'
	mode, everything global via gconf.

	* em-mailer-prefs.c (em_mailer_prefs_construct): get the gui from
	the preferences_toplevel not the preferences_tab window which we
	don't need.

	* mail-config.glade: rename the preferences 'toplevel' to
	preferences_toplevel so we can get it unparented.  And the
	composer toplevel to composer_toplevel.

	* em-folder-properties.c (em_folder_properties_show): remove test
	code.

	* em-format.h (struct _EMFormatPURI): add a free function
	callback.

	* em-format.c (emf_clear_puri_node): if the free function is set,
	call it.

2004-07-01  Rodney Dawes  <dobey@novell.com>

	* Makefile.am (BUILT_SOURCES): Remove $(error_i18n)
	(CLEANFILES): Put $(error_i18n) in here

2004-06-29  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree-model.c (folder_created_cb): call
	folder_subscribed directly from the async function not
	foldre_subscribed_cb, otherwise we run out of order.  Part of
	#60775.

	* em-vfolder-rule.c (source_add): setup exclusion for vfolder
	sources, noselect folders.  Bug #60794.

2004-06-23  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-selector.c (em_folder_selector_get_selected_path):
	Don't prepend the path string with a '/'.

	* em-folder-tree.c (em_folder_tree_create_folder): This takes a
	full_name so update the argument to make that clear.
	(emft_create_folder): Same and also don't strip a leading '/'

2004-06-25  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (folder_tree_new): set search column.  #60152.

2004-06-24  Rodney Dawes  <dobey@novell.com>

	* em-utils.c (em_utils_add_address): Add code to set the parent,
	position, and type hint of the "Add address" dialog

	Fixes #60030

2004-06-23  Not Zed  <NotZed@Ximian.com>

	** See #54030.

	* e-searching-tokenizer.c (e_searching_tokenizer_match_count):
	only return a count if we're using the primary search string.

	* em-format-html-display.c (efhd_search_response): set the primary
	search string to NULL instead of resetting it.
	(efhd_update_search): dont noop if we have a null search text,
	just set an empty search.

	* e-searching-tokenizer.c (e_searching_tokenizer_reset): remove
	this, revert jeff's fixes for 54030.  this is incomplete and so
	doesn't work either (search text stays remembered and secondary
	search text lost too).

	** See #60523.

	* em-folder-view.c (emfv_finalise): unhook the folder changed
	before destroying the async thing, and move it all to destroy
	event anyway.
	(emfv_destroy): as above.

2004-06-22  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree-model.c (sort_cb): Same as below.
	(em_folder_tree_model_remove_folders): Same.

	* em-folder-tree.c (emft_maybe_expand_row): As toshok discovered,
	gtk_tree_model_get() strdup's string arguments, *sigh*, so we need
	to free them.
	(tree_drag_data_delete): Same.
	(tree_drag_data_get): Same.
	(tree_drag_data_received): Same.
	(emft_drop_target): Same
	(em_folder_tree_get_selected_uris): Same.
	(get_selected_uris_path_iterate): Same.
	(emft_update_model_expanded_state): Same.
	(emft_tree_row_expanded): Same.
	(emft_tree_row_activated): Same.
	(emft_popup_delete_response): Same.
	(emft_popup_delete_folder): Same.
	(emft_popup_rename_folder): Same.
	(emft_popup_properties): Same.
	(emft_tree_button_press): Same.
	(emft_tree_selection_changed): Same.

2004-06-22  Chris Toshok  <toshok@ximian.com>

	* em-folder-tree.c (render_pixbuf): gtk_tree_model_get on a string
	field allocates the return value.  free path.

2004-06-22  Jeffrey Stedfast  <fejj@novell.com>

	* em-popup.c (emp_apps_open_in): If the app requires a terminal to
	run, give it a bloody terminal (who uses vi in an xterm to view
	attached text files? *sigh*). Fixes bug #51259.

2004-06-21  Chris Toshok  <toshok@ximian.com>

	* em-folder-tree.c (render_display_name): gtk_tree_model_get on a
	string field allocates the return value.  free name.

2004-06-21  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): make sure we test for
	-p and --port only and not for other options as --pidfile

	Fixes #60260

	(em_junk_sa_test_spamd): try to get spamd/spamc binaries from
	gconf

	Implements #59368

2004-06-18  Not Zed  <NotZed@Ximian.com>

	** See #31027.

	* em-vfolder-editor.c (em_vfolder_editor_new): make sure we
	construct the rule editor with a source of 'incoming', otherwise
	newly created rules have no source in the current session.

	* em-vfolder-rule.c (em_vfolder_rule_init): init the vfolder
	source to 'incoming' always.

	* mail-vfolder.c (uri_is_ignore): fix debug statement.

	** See #60214.

	* em-folder-view.c (em_folder_view_print): re-arrange code to make
	the dialogue async.  We also now load the message every time
	before printing.
	(emfv_print_response): handle response to print.
	
	* em-format-html-print.c (em_format_html_print_message): new api
	to print a specific uid on a specific folder.

2004-06-18  Not Zed  <NotZed@Ximian.com>

	* em-vfolder-rule.c (get_widget): use mail dialogs.glade.

	* mail-dialogs.glade: move the vfolder-source window here from
	mail-config.glade.

	* Makefile.am (glade_DATA): fix the glade list.

	* mail-license.glade, subscribe-dialog.glade, mail-security.glade,
	* mail-search.glade: Merged into mail-dialogs.glade.  Should be
	easier to manage.

	* message-tag-followup.c (construct): use mail dialogs glade file.

	* mail-account-gui.c (display_license): use mail dialogs glade file.

	* em-subscribe-editor.c (em_subscribe_editor_new): use new glade
	file.

	* em-format-html-display.c (em_format_html_display_search): use
	merged glade file.
	(efhd_xpkcs7mime_validity_clicked): same.

	* mail-dialogs.glade: merge various glade files into here.

2004-06-17  Not Zed  <NotZed@Ximian.com>

	** See #59885.

	** Moved all of the mail specific filtering stuff from filter/* to
	here.  Renamed appropriately into em* space, etc.

	* em-filter-folder-element.c (emff_copy_value): implement for folders.

	* em-vfolder-rule.c (get_widget): read the vfolder glade from
	mail-config.glade.

	* mail-config.glade: moved the vfolder source selector here.

	* em-search-context.c: new mail search specific rule context.

	* mail-component.c (setup_search_context): use the new
	em_search_context.

	* vfolder-rule.c (validate): change error to mail context.
	
	* filter-folder.c (validate): change error to mail context.

	* Makefile.am (em-filter-i18n.h): added rule for i18n of mail
	filter type stuff.
	(libevolution_mail_la_SOURCES): added in the filter and vfolder
	rule stuff specific to mail.

	** See #59885.

	* em-format-html-quote.[ch]: remove and remove from build, not
	used.

	* Makefile.am (libevolution_mail_la_LIBADD): add libeabutil and
	evolutionsmime.

	* mail-component-factory.c (factory): there is no mail_config
	anymore.

2004-06-16  Rodney Dawes  <dobey@novell.com>

	* em-folder-properties.c: Include gtk[hv]box.h so we can use them
	(emfp_dialog_got_folder): Fix the border widths and spacings for
	the internal widgets and the dialog's vbox and action area to be
	compliant with the HIG
	Fix the general layout of the dialog to be HIG-compliant as well
	Use ngettext for the row labels for number of messages
	Add a cancel button, since we are not instant-apply
	Align the message counts to the right
	Part of this patch is from Christian Neumair <chris@gnome-de.org>

	* mail-component.c (view_changed_cb): Fix a typo for the sent folder
	send is not a pluralization of sent

2004-06-16  JP Rosevear  <jpr@novell.com>

	* em-composer-prefs.c (spell_set_ui): clear the error, don't free
	it, so NULL is handled properly

2004-06-16  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (em_utils_selection_get_urilist): handle comments in
	the urilist.  Can't remember the rfc for it.

	** See #56479.

	* em-utils.c (em_utils_in_addressbook): use the main thread to
	setup the addressbook list.
	(em_utils_in_addressbook): only check against the "completion"
	sources, not all of them.

2004-06-15  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_mail_stop): call mail_cancel_all to
	implement the stop button.

	* em-utils.c (emu_addr_sources_refresh): don't unref the group
	list, otherwise the sources become broken now (?).
	(em_utils_in_addressbook): add some locking.  add cancellation.
	this is almost certainly going to cause issues.

	* mail-mt.c (mail_cancel_hook_add, mail_cancel_hook_remove)
	(mail_cancel_all): new functions to implement a global mailer stop
	button.

2004-06-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (save_part_save): This code no longer needs to do
	charset conversion. Yay. Fixes bug #60225.

	* em-utils.c (em_utils_save_part_to_file): Use the proper e-error
	namespace.

2004-06-15  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (emft_popup_copy_folder_selected): frombase is
	simply the select_path, since selected_path is now just the
	full_name rather than the path. Fixes bug #60075.

	* em-composer-utils.c (attribution_format): New function to format
	an attribution string (won't crash if translators were sloppy with
	their strftime/printf-style formatters). Also nice/extendable for
	future feature enhancements such as user-customisable attribution
	strings.
	(composer_set_body): Use above function rather than using
	e_strftime/etc ourselves.

2004-06-15  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_init): Changed the second
	gtk_selection_add_target() to use GDK_SELECTION_CLIPBOARD rather
	than GDK_SELECTION_PRIMARY again. This should fix bug #60022.

2004-06-14  Radek Doulik  <rodo@ximian.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): the check button
	label has now opposite meaning (after UI changes), call
	toggle_button_init with 'not' parameter set to TRUE
	(toggle_button_toggled_not): new helper function, sets negative
	value to gconf bool key

2004-06-14  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.c (rule_changed): don't check rule->source, its
	irrelevent to vfolder sources, and clean up the logic a bit.
	#59158.

	* em-folder-tree.c (emft_popup_new_folder_response): destroy the
	create dialogue if we're firing up the vfolder creation window.

	* em-composer-utils.c (get_reply_all): if we removed all of the
	addresses because they were 'us', add the first to
	address back.  otherwise reply-to-all behaves strange.

2004-06-11  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (em_folder_tree_set_selected): Free any old
	select_uri string we may have.
	(emft_tree_row_expanded): Remove the gross hack that was here.
	(emft_get_folder_info__got): Check for priv->select_uri and try
	selecting it (if we can't select it yet, it'll just be re-queued
	for later).
	(emft_tree_row_activated): Clear the select_uri if set, the user's
	selection overrules any auto-selection.
	(emft_tree_selection_changed): Same.

2004-06-11  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_tree_button_press): rearrange the setting
	up of the target flags, stores can have a null path.

	* em-folder-selector.c (emfs_create_name_changed): use
	get_selected_uri rather than path.  a valid uri may have a null
	path now.
	(emfs_create_name_activate): and here too.
	(em_folder_selector_get_selected_path): check the uri is null for
	a selected path, and then handle a null path.

	* em-folder-tree-model.c (em_folder_tree_model_add_store): revert
	previous change.  Stupid emftm.

	* em-utils.c (em_uri_from_camel): handle a null path or fragment.

	* em-folder-tree-model.c (em_folder_tree_model_add_store): set the
	full name of the store to "".  Fixes #59925 and probably other
	issues.  Related to the removal of folderinfo->path.

2004-06-10  Jeffrey Stedfast  <fejj@novell.com>

	Fixes bug #58825. Ugh. Really Gross Hack (tm).

	* em-folder-tree.c (emft_tree_row_expanded): If the store that we
	are expanding matches the uri that we've been requested to select
	(e.g. from before the store was added to the tree), then give the
	uri to the get_folder_info_op.
	(em_folder_tree_set_selected): If the store for the uri isn't in
	the tree yet, save the uri for later.

	* mail-component.c (folder_selected_cb): Set the selected state of
	the folder-tree and save it.
	(impl_createControls): Restore the selected state on the
	folder-tree.

	* em-folder-tree-model.c (em_folder_tree_model_set_selected): New
	function to set the selected-uri saved state.
	(em_folder_tree_model_get_selected): New function to get the
	selected uri saved state.
	(em_folder_tree_model_save_state): Renamed.

	* em-folder-tree.c (emft_update_model_expanded_state): Don't let
	path be NULL if the node is a store node (path == NULL for any
	other case is a bug).
	(emft_maybe_expand_row): Same.

2004-06-10  Not Zed  <NotZed@Ximian.com>

	* message-list.c (message_list_set_selected): use new
	etreeselectionmodel api to select paths in one call.  Fixes
	#59546.

	* em-folder-view.c (emfv_message_reply): check that we have
	content selected, not just a selection, before trying to reply to
	that content.  #59146.
	(emfv_message_reply): strip call content-* headers (fixme), and
	set transfer-encoding to 8bit.

2004-06-08  Rodney Dawes  <dobey@ximian.com>

	* mail-config.glade: Fix for SSL options appearing for sendmail

2004-06-08  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (em_folder_tree_set_selected): Scroll to the
	selected folder if needed. Fixes bug #59609.

	* em-folder-selector.c (em_folder_selector_construct): Make the
	chooser non-modal. Fixes bug #53735.

	* em-folder-tree.c (emft_tree_row_collapsed): Only change the
	cursor if the currently selected folder is a subfolder of the
	folder collapsed. Fixes bug #59801 without breaking bug #57665.
	(emft_tree_test_collapse_row): Renamed from
	emft_tree_collapse_row() to match the new signal we are connected
	to.

2004-06-07  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree-model.c (em_folder_tree_model_add_store): Set the
	store's FULL_NAME to NULL here. Fixes the crash in bug #59713.

2004-06-07  Dan Winship  <danw@novell.com>

	* em-folder-view.c (emfv_popup_menu, emfv_message_pixmaps):
	s/stock_save_as/stock_save-as/

	* em-popup.c (emp_standard_select_popups,
	emp_standard_object_popups): Likewise	

2004-06-05  Christian Neumair  <chris@gnome-de.org>

	* em-folder-tree.c: Shuffle usage of trailing "..." in menus according
	to the HIG.

2004-06-05  Christian Neumair  <chris@gnome-de.org>

	* mail-component.c (view_changed_cb): Use ngettext for message count
	information.

2004-06-04  Radek Doulik  <rodo@ximian.com>

	* default/C/Inbox (Content-Type): added size info to IMG tags so
	that it loads the message smoother

2004-06-03  William Jon McCann  <mccann@jhu.edu>

	* mail-session.c (request_password): Don't pack entry and checkbox
	widgets directly into the dialog vbox so that they line up
	correctly with the action area buttons.

2004-06-02  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_add_local_store_done): put this back in,
	local folders not being noted properly all the time.

2004-06-01  Jeffrey Stedfast  <fejj@novell.com>

	* em-composer-utils.c (forward_non_attached): Don't attach
	anything ever. This is confusing way too many users who expect it
	to attach all or nothing. Since Forward-Attached is what users
	should be using to forward a message and all attachments, make
	these not attach anything (which is what other mailers do
	anyway). This wlso makes Forward-Quoted consistant with
	Reply-Quoted which is a Good Thing (tm).

2004-06-01  Not Zed  <NotZed@Ximian.com>

	* em-folder-selector.c (em_folder_selector_get_selected_uri): set
	the right path on the url.

	* mail-signature-editor.c (load_signature): ugh, unlike camel
	exceptions, you can't pass NULL to CORBA calls.
	(mail_signature_editor): ditto.  See bug #58815.

2004-05-28  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (d): Disable debug here too - all this code has
	been working fine.

	* em-folder-selector.c (d): Disable debug spew here too (not that
	this debug was ever seen since it never hit those conditions).

	* mail-folder-cache.c (d): Disable debug here too.

	* em-folder-tree-model.c: Disable debug spewage that we don't need
	anymore. The amount of debug spewage on the console is getting to
	be too much to find anything.

	* em-folder-tree.c (emft_expand_node): Use p+1 as the full_name
	rather than p. Fixes bug #59187.

2004-05-27  Jeffrey Stedfast  <fejj@novell.com>

	* em-folder-tree.c (emft_get_folder_info__got): Instead of
	removing the "Loading..." row for toplevel folder nodes on failure
	(which indicates a failure conenct to the server, most likely),
	collapse the store node so that if the user expands the store
	node, it will automagically try connecting again. Fixes bug #57493.

2004-05-27  Rodney Dawes  <dobey@novell.com>

	* Makefile.am (EXTRA_DIST): Add $(error_i18n)

2004-05-26  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.c (vfolder_adduri_desc): initialise desc to NULL
	before using it later on.  gcc doesn't warn on this if you're not
	optimising.  Sigh.  Probably fix #59070, #59060, #58972 and
	friends.

	* importers/evolution-mbox-importer.c (create_control_fn): set the
	default selection to inbox.

	* importers/evolution-outlook-importer.c (folder_selected)
	(create_control_fn): copied from mbox importer.  fixes a crash &
	lets you choose the target folder.

2004-05-25  Jeffrey Stedfast  <fejj@novell.com>

	* mail-errors.xml: a few fixes.

	* em-format-quote.c (emfq_text_plain): Only strip the signature if
	we are in some wy modifying the content (we don't want to remove
	the signature if we are editing the message as a new
	message). Fixes bug #58826.

2004-05-25  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_add_local_store_done): removed, now
	redundant.

	* em-folder-tree.c (em_folder_tree_set_selected): fix for path changes.

	* em-folder-tree-model.c (em_folder_tree_model_set_unread_count):
	change to use full name rather than path name.

	* em-folder-tree-model.h: renamed path_hash to full_hash.

	* em-folder-tree-model.c (folder_subscribed): dont use
	g_path_get_dirname here, it is os dependent, we want / always.
	(full_hash_free): rename from path_hash free.

	* em-folder-view.c (emfv_popup_menu[]): disable add sender to
	addressbook bar if it is also disabled.  #58955.

2004-05-24  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c (mail_account_gui_build_extra_conf): don't
	enable the widget based on its writability if it is a dependent
	option which is now disable.
	(setup_toggle): return whether the widget is sensitive too.
	#57171.

	* em-popup.c (em_popup_target_new_select): only enable add sender
	if we also have 1 selected.  #56663.

	* em-folder-view.c (emfv_enable_menus): remove some debug.

	* em-format-html.c (efh_format_header): output commas between
	newsgroups, and also append_printf.

2004-05-24  Sivaiah Nallagatla <snallagatla@novell.com>

	* mail-account-gui.c (mail_account_gui_build_extra_conf): added
	empty handling for CAMEL_PROVIDER_CONF_HIDDEN
	(extract_values): added handling for CAMEL_PROVIDER_CONF_HIDDEN

2004-05-24  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (em_folder_tree_set_selected): use set_cursor
	instead of scroll_to_row.  See #58383.
	(get_selected_uris_iterate): removed.
	(em_folder_tree_get_selected_uris): use an interative call based
	on gtk_tree_selection_get_selected_rows rather than
	selected_foreach, as the gtk+ docs suggest.  was trying to fix a
	bug but it seems gtktreeselection bug (shift-select rows using
	keyboard only)

	* message-list.c (regen_list_regened): pull the message from the
	regen list before we check the list and pending uid.

	* em-folder-view.c (emfv_enable_menus): remove the hack for
	enabling select delete from here and put it in the right place.
	(em_folder_view_get_popup_target): put it here so its consistent.

2004-05-22  Not Zed  <NotZed@Ximian.com>

	* mail-tools.c (mail_tool_uri_to_folder): put note_store back in.
	Quick hack to fix the issue of folders being opened before we hook
	onto folder_created.

	* mail-folder-cache.c: remove 'name' from update struct, not used
	anymore

	** Another unread count bug, #58814.

	* mail-vfolder.c (context_rule_added):
	* mail-tools.c (mail_tool_uri_to_folder):
	* mail-component.c (mc_add_local_store_done): don't call mail note
	folder anymore, fix up headers.

	* mail-folder-cache.c (store_folder_opened)
	(mail_note_store_remove, mail_note_store): handle the new
	store:folder_opened signal.  Don't need the mail_note_folder hack
	anymore, mail_tool_uri_to_folder slowly does less.

2004-05-21  Not Zed  <NotZed@Ximian.com>

	* mail-mt.c (do_call): add marshaller for p_ppppp call.

	* mail-session.c (get_password): fix for camel api changes.
	(forget_password): same.

	** See #58376.

	* message-list.c (mail_regen_list): do some timeout foo so we
	don't keep doing list regnerations if we're getting called too
	often.  God knows what this will break.
	(message_list_set_selected): removede bug printf.
	(regen_list_free): move the message-list poking stuff into
	regen_list_regened.
	(message_list_set_folder): call mail_regen_cancel to cancel any
	regen stuff.
	(mail_regen_cancel): cancel/clear outstanding regenerations.
	(message_list_destroy): do it here too.
	(message_list_select_uid): also set the pending select uid if we
	have a timeout pending.

	* mail-component.c (impl_createControls): set the defualt parent
	to the main folderview as soon as its created.

	* em-folder-tree.c (emft_popup_copy_folder_selected): use
	get_toplevel rather than get_ancestor.  seems the more reliable
	one.  also we're always parented so we shoudl always find a
	toplevel window.
	(em_folder_tree_create_folder): same.
	(emft_popup_delete_response): set error parent.
	(emft_popup_delete_folder, emft_popup_rename_folder) 
	(emft_popup_rename_folder, emft_popup_rename_folder): 

	* em-migrate.c (update_passwords_1_2): finally put the 1.2
	password upgrade patch in.  Untested.  #42721.

2004-05-20  Jeffrey Stedfast  <fejj@novell.com>

	Fixes for bug #57305.

	* mail-account-gui.c (sig_add_new_signature): Updated for changes
	below.

	* em-composer-prefs.c (em_composer_prefs_new_signature): No longer
	takes a script argument (makes no sense to edit a script with an
	HTML editor if we require that the script already exist before we
	let the user add it anyway).
	(sig_add_cb): Updated for above change.
	(sig_add_script_response): Don't pop up an editor window for the
	newly added script, the script has already been created! Instead
	simply create a new ESignature object, set the sig->name, and add
	it to the signature list.

2004-05-20  Radek Doulik  <rodo@ximian.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): remove "use
	daemon" handling code

	Fixes #56909

2004-05-20  Not Zed  <NotZed@Ximian.com>

	** See #58388.

	* mail-mt.c (mail_msg_check_error): surpress any errors about
	messages not found because of invalid uid's.  They're really just
	internal errors.

	** See #57583.

	* message-list.c (build_tree): save/restore the selection when we
	update.
	(message_list_set_selected): util to set the selected messages
	from a list of uids.
	(build_flat): same.  I wonder if etree's unbroken enough to use it
	more directly?

	** See #58693.
	
	* mail-send-recv.c (mail_autoreceive_setup): add bounds checking
	so sloppy ui work wont break it again.

	* mail-config.glade: put the minimum for autocheck back to 1
	minute.  Naughty jeff.

2004-05-19  Chris Toshok  <toshok@ximian.com>

	* importers/pine-importer.c (import_contacts): use the new
	e_book_new_* and e_book_open apis.

	* em-utils.c (em_utils_in_addressbook): use the new e_book_new_*
	and e_book_open apis.

2004-05-19  Jeffrey Stedfast  <fejj@novell.com>

	* message-tags.glade: Fixed the icon name to get the right one.

	* message-list.c (message_list_init_images): Changed to load an
	empty pixbuf manually rather than relying on the pixbuf returned
	for "" from e_icon_factory_get_icon() since it has changed to
	return a broken image icon.

2004-05-19  JP Rosevear  <jpr@novell.com>

	* Makefile.am: don't dist the error .h file

2004-05-19  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (send_queue_send): set seen when we set deleted.  ?
	#56549.

	* em-inline-filter.c (emif_add_part): if we end up with an
	application/octet-stream part, pre-snoop it so we set the right
	mime type to start with.  Fixes #58554.

	* em-format.c (emf_snoop_part): removed, now in em-utils.

	* em-utils.c (em_utils_snoop_type): rah rah, snoop a mime part's
	type.

	* em-format-html.c (efh_text_plain): Revert jeff's fix for #56290.
	Ugh, we already have all the citation info in local data.  Removed
	the need for gconf too.

2004-05-19  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_format_secure): make this match the efhd
	stuff.

	* em-format-html-display.c: removed stock_signature-nokey since it
	doesn't exist in gnome-icon-theme.
	(efhd_xpkcs7mime_button): if there is no signing, but encryption,
	use its icon.  if there's no encryption too, use a broken icon
	(?).

2004-05-05  William Jon McCann  <mccann@jhu.edu>

	* GNOME_Evolution_Mail.server.in.in: Add menu_label and
	menu_accelerator.

2004-05-19  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mc_quit_sync): fixed up the empty trash on
	exit thing, to update for all stores, not update the timestamp on
	the first store synced.

2004-05-18  Cantona Su <paradisetux@hotmail.com>

	* em-format-html.c: Added header "X-Newsreader" for handle Outlook
	Express as Mailer.
	
2004-05-18  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (em_folder_browser_show_preview): don't
	nomarkseen when we restore the message when we show the preview.
	#58387.

	* mail-folder-cache.c (folder_changed): no new message test if its
	the drafts folder too.

	* mail-vfolder.c (vfolder_adduri_desc): use a nicer, account-based
	formatter for folder names.  Hmm, that was a good waste of time.
	For #55412.

	* em-folder-view.c (emfv_list_selection_change): Listen to the
	tree selection change event directly & proxy out, so we can update
	the status bar properly.  Blah.  For #58600.

	** Quick fix for #57434

	* em-format.c (emf_format_clone): fix the FIXME about cloning
	headers shown.

	* em-format-html.c (efh_format_headers): only show rupert if we're
	showing rupert.

	* em-format-html-print.c (efhp_init): default show_rupert to off.

	* em-format-html.c (efh_init): default show_rupert to on.

	* em-format-html.h: added show_rupert bit.

	* mail-folder-cache.c (folder_changed): don't emit new mail if its
	any vfolder, not just vtrash folder.  #56350.

	* em-folder-view.c (emfv_list_done_message_selected): run
	enable_menu's to make sure we're up to date.  #58352.

	** crappy hacks for #58385.

	* em-folder-selection-button.c
	(em_folder_selection_button_clicked): leave Ok button for this
	selection.

	* em-folder-selection.c (em_select_folder): added oklabel here too.

	* em-folder-selector.c (em_folder_selector_new)
	(em_folder_selector_construct, em_folder_selector_create_new):
	Added oklabel- text for ok label.
	(em_folder_selector_create_new): Set the ok label to Create.

	* em-message-browser.c (emmb_set_message): don't mark message seen
	if user has disabled auto-mark seen feature.  #58629.

	* em-format.c (em_format_part): if we have no content-type header,
	then we get no mime-type set, so assume text/plain.  #58470.

2004-05-17  Jeffrey Stedfast  <fejj@ximian.com>

	* em-mailer-prefs.c: #include <gtk/gtkliststore.h>. Fixes bug
	#58407.

2004-05-17  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c (mail_account_gui_setup): put the None item
	at the head of the providers list.
	(mail_account_gui_setup): only set the transport default fallback
	if it is not a STORE_AND_TRANSPORT type provider (since that was
	just disabled).  #57939.

	* message-list.c (on_selection_changed_cmd): only NOOP if we have
	no selection and no uid, if we have a selection and no uid, then
	always update.  Fixes #58267 without breaking the double-load
	thing.

	* em-folder-view.c (em_folder_view_open_selected): keep the hide
	deleted status.  Makes #51082 work at last.

	** Bug #6556.

	* message-list.c (ml_drop_async_desc, ml_drop_async_drop)
	(ml_drop_async_done, ml_drop_async_free, ml_drag_data_action)
	(ml_drop_popup_copy, ml_drop_popup_move, ml_drop_popup_cancel)
	(ml_tree_drag_data_received): implement async drop operations and
	the ask drop option menu.

2004-05-14  Not Zed  <NotZed@Ximian.com>

	** Bug #6556.

	* message-list.c (ml_selection_received_uidlist): removed, not
	needed anymore.
	(ml_selection_received): call get_uidlist to paste the selection.
	(ml_tree_drag_data_received): same here.

	* em-folder-tree.c (emft_drop_uid_list): removed, not needed
	because of below change.

	* em-utils.c (em_utils_selection_get_uidlist): actually do the
	copy now, don't just decode the data.

	* em-folder-tree.c (tree_drag_data_received): just copy the
	selection data data itself, dont decode yet.
	(emft_import_message_rfc822): removed, not needed, use em utils
	stuff instead.
	(emft_drop_message_rfc822): same.
	(emft_drop_text_uri_list): same.
	(emft_drop_async_free): simply free stuff.
	(emft_drop_async_drop): call em_utils stuff where they exist to do
	the drop.

	* message-list.c (ml_tree_drag_data_get): send x-mailbox instead
	of message/rfc822 for the mailbox.
	(ml_tree_drag_data_received): handle drop of x-mailbox differently
	to message/rfc822.
	(ml_tree_drag_motion): implement so proper options are setup
	whilst dragging.
	(message_list_construct): seutp the drag src/dest types for
	changes typs and with ASK action.

	* em-utils.c (em_utils_read_messages_from_stream): dont unref the
	stream when we get it.
	(em_utils_selection_get_mailbox): add an argument to scan from or
	not, for message/rfc822 vs x-mailbox drops.
	(em_utils_read_messages_from_stream): Same.

	* em-folder-tree.c (tree_drag_motion): default to move properly.

	* message-list.c (ml_selection_received_uidlist): take a move flag.
	(ml_tree_drag_data_received): handle move action.

	* em-folder-tree.c (em_folder_tree_new_with_model): got sick of
	this bloody warning.

	* em-format.c (default_headers[]): just remove x-mailer from the
	header list, if it isn't on by default.  This is the default list.
	(em_format_default_headers): loop through everything.

2004-05-14  Jeffrey Stedfast  <fejj@novell.com>

	* em-popup.h: s/RESEND/EDIT/

	* em-popup.c (em_popup_target_new_select): s/RESEND/EDIT/

	* em-folder-view.c: s/RESEND/EDIT/
	(emfv_popup_edit): Renamed from emfv_popup_resend. Part of the fix
	for bug #58358 (The main fix was just a change to the ui file).

	* mail-config.c (mail_config_init): Build the path to the gtkrc
	filename and store it on the config struct so we don't have to
	keep rebuilding it.
	(config_write_style): Reuse config->gtkrc string instead of
	constructing the path again.
	(mail_config_write_on_exit): Free the gtkrc path.
	(config_write_style): fflush the gtkrc file.

	* em-popup.c (emp_popup_resend): Updated the #if 0'd code for the
	API chanegs made to em_utils_edit_messages().

	* em-folder-view.c (em_folder_view_open_selected): Pass TRUE as
	the replace argument to em_utils_edit_messages() here.
	(emfv_popup_resend): Pass FALSE here. Fixes bug #58357.

	* em-composer-utils.c (em_utils_edit_messages): Now takes a
	'replace' argument specifying whether or not the original message
	should be deleted when the edited message is sent or saved.

	* em-format-html.c (efh_format_secure): Same. Also changed the
	"Valid signature, cannot verify sender" string to "Valid signature
	but cannot verify sender" as I think it reads nicer.

	* em-format-html-display.c (efhd_format_secure): Since signature
	status is a tri-state, use 3 different colours too (yellow for
	valid sig but unknown sender).

2004-05-13  Jeffrey Stedfast  <fejj@novell.com>

	* em-format.c (em_format_default_headers): Don't include the last
	default_header when setting the default headers. If the user has
	configured Evolution to display the Mailer header, then it will be
	set in em-folder-view.c as appropriate when it checks the gconf
	settings. Fixes bug #58217.

	* em-mailer-prefs.c (em_mailer_prefs_construct): Default
	"x-evolution-mailer" header to disabled.

	* em-format-quote.c (emfq_text_plain): Add a stripsig
	filter. Fixes bug #52767.

	* em-stripsig-filter.[c,h]: New filter class to strip
	signatures. Useful when generating forwards/replies.

2004-05-13  Not Zed  <NotZed@Ximian.com>

	* em-migrate.c (em_migrate_folder): move ignore case outside of
	block.  Stupid c language.

	* em-folder-view.c (emfv_format_popup_event): fix warning with
	cast.

	** See bug #58304.

	* em-junk-filter.c (em_junk_sa_setting_notify): listen to sa
	settings changes, update some globals.
	(em_junk_filter_get_plugin): setup the gconf client here and
	listen to changes.
	(em_junk_sa_get_local_only, em_junk_sa_get_use_daemon) 
	(em_junk_sa_get_daemon_port): removed, use globals instead.

2004-05-13  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_message_reply): re-enabled the reply to
	selection stuff.  I worked out how to make it work; I think.

	* em-format-html-display.c (efhd_html_button_press_event): if we
	aren't on a clickable object, do a null popup event instead.

	* em-folder-view.c (emfv_format_popup_event): do the full popup if
	we aren't on anything (not on a uri or part).  See #8414.

	* GNOME_Evolution_Mail.server.in.in: added "email" to the
	uri_schema's attribute.

	* mail-component.c (impl_handleURI): handle email: uri's, specify
	opening a message on a folder.
	(handleuri_got_folder): open the message.  For some 1337 s3Kr3t
	ha0x.

2004-05-12  Not Zed  <NotZed@Ximian.com>

	** See bug #58302.

	* em-composer-utils.c (em_utils_post_to_folder): 
	* em-composer-utils.c (em_utils_compose_new_message_with_mailto):
	poke the composer headers from account directly, don't call set
	headers which overwrites stuff.

2004-05-12  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (setup_search_context): enable threading option
	type on the search bar.

	* mail-errors.xml.h: add for translators.

	* Makefile.am (%.xml.h): fix for xml i18n stuff.

	* mail-errors.xml: moved from the .xml.in file.

2004-05-11  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (em_uri_from_camel): pass an exception to
	provider_get, it relies on one.

	* em-migrate.c (em_migrate_1_4): fix some error messages, and fail
	with fatal errors properly.
	(em_migrate_local_folders_1_4): EEP!  Who cares if this fails!
	Well I do.  Setup exceptions and return codes.
	(em_migrate_dir): and here too.  Sloppy!
	(em_migrate_dir): change the code slightly, 1.4 would recurse all
	folders, even if the parent folder doesn't have a
	folder-metadata.xml.  Make sure we copy that mode.
	(get_local_store_uri): Make it copy the 1.4 behaviour properly.
	Any error -> use defaults.
	(em_migrate_dir): lots of changes.
	(mbox_build_filename): take the output string as an arg.
	(cp): add an argument to overwrite/append or require a unique
	empty file.
	(cp_r): add mode arg here too.
	(em_migrate_folder): split the folder copy stuff from em_migrate
	dir entirely.  blah.
	(em_upgrade_accounts_1_4): can't fail, remove return code, etc.
	(em_upgrade_xml_1_4): removed this rather redundant odd api.
	(upgrade_xml_uris): this can't fail, remove return codes etc.
	(em_upgrade_xml_1_0): another oddly redundant function.
	(em_migrate_pop_uid_caches_1_4): error messages, blah blah.
	(em_migrate_folder_expand_state_1_4): no fatal states here.
	(em_migrate_folder_view_settings_1_4): nor here.
	(emm_setup_initial): do i18n 'better', using
	gnome_i18n_get_language_list, rather than hacky code.

2004-05-10  Not Zed  <NotZed@Ximian.com>

	* mail-tools.c: remove e-meta.h, not used anymore.

2004-05-11  Dan Winship  <danw@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Remove the mail folder
	control factory

	* mail-component-factory.c (factory): Remove support for the mail
	folder control

	* mail-component.c: Remove the property bag stuff
	(mail_control_new): Gone

2004-05-10  David Malcolm  <dmalcolm@redhat.com>

	* em-subscribe-editor.c (sub_queue_fill_level): Fixed warning

2004-05-10  Jeffrey Stedfast  <fejj@novell.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): Default the
	Mailer header to enabled. Fixes bug #58217.

2004-05-10  JP Rosevear  <jpr@ximian.com>

	* mail-ops.c (mail_send_message): set header to just Evolution
	(mail_append_mail): ditto

	* em-message-browser.c (em_message_browser_window_new): set title
	to just Evolution

2004-05-10  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_activate): cleanup the view menus if they
	were created.

	* em-folder-view.h: added list_active bit, means the view is
	showing the list and needs e.g. view menus.

	* em-folder-view.c (emfv_setup_view_instance): was
	create_view_instance.  Now also setup the menu's if we're showing the list.

	* em-folder-browser.c (emfb_create_view_menus): removed.  moved
	functionality into emfolderview.

2004-05-07  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #57152.

	* em-folder-tree.c (emft_get_folder_info__got): If we queried for
	a recursive folder-info listing, then pass fully_loaded as TRUE to
	set_folder_info().
	(emft_get_folder_info__got): If we find that a folder doesn't have
	children, set the expanded state to FALSE.

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	Now takes a "fully_loaded" argument to hint to set_folder_info
	whether or not folder-info's without child nodes can possibly have
	children (eg. if fully_loaded is set and fi->child is NULL, then
	'load' will be FALSE no matter what fi->flags contains).

2004-05-07  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): set cite_color property of
	gtkhtml widgets
	(mail_config_init): add /apps/evolution/mail/display dir to gconf
	client and watch for mark_citations and citation_colour changes

	See bug #57587

2004-05-07  Not Zed  <NotZed@Ximian.com>

	* mail-account-editor.c: include missing header.

	** See bug #57935.

	* em-folder-view.c (emfv_set_message): add new arg, nomarkseen,
	don't mark the selected message seen once its loaded.
	(emfv_list_message_selected): clear the nomarkseen flag once we've
	processed the selection.
	(emfv_list_done_message_selected): handle the nomarkseen flag,
	don't mark a message seen if it was explictly selected.

	* em-folder-browser.c (emfb_list_built): use
	em_folder_view_select_message rather than doing it via the
	messagelist directly.

	** Dunno why i bothered, but see bug #58090.

	* importers/netscape-importer.c
	(netscape_filter_parse_conditions): check for custom headers
	properly.
	(netscape_filter_flatfile_get_entry): put in some validate checks.
	(netscape_filter_to_evol_filter): implement custom headers properly.
	(ns_filter_condition_types): add missing "status" string.

	** See #58017.

	* message-list.c (mail_regen_list): use thread_queued, so we don't
	regen out of order.

	* em-folder-view.c (emfv_list_message_selected): use the queue
	thread so we don't get messages out of order.

	* mail-ops.c (mail_transfer_messages): use thread_queued_slow.
	(mail_prep_offline): and here too.

2004-05-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (folder_selected_cb): Check that the folder is
	selectable using the new flags argument.

	* em-folder-selector.c (folder_selected_cb): Updated for below
	changes.

	* em-folder-tree.c (emft_tree_selection_changed): Updated to pass
	a flags argument to the folder_selected signal.
	(emft_tree_row_activated): Same.

2004-05-06  Radek Doulik  <rodo@ximian.com>

	* em-composer-prefs.c (sig_selection_changed): reset the preview
	if no signature is selected

	Fixes #57167

2004-05-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_tree_row_collapsed): Select the row that
	was just collapsed. Fixes bug #57665.

	* mail-autofilter.c (rule_match_thread): Removed.
	(rule_from_message): Removed the AUTO_THREAD bit.

	* em-folder-view.c: Removed vFolder/Filter on Thread. These were
	both broken.
	(struct _filter_data): Removed a bunch of data members since most
	of them weren't used.

2004-05-05  Not Zed  <NotZed@Ximian.com>

	** See bug #57720.
	
	* em-folder-browser.c (emfb_create_view_menus): removed some stuff
	done in create_view_instance in the superclass.

	* em-folder-view.c (emfv_create_view_instance): moved here from
	em-folder-browser, setup the view instance for the folder.
	(emfv_set_folder): if the folder is set, create the view instance.

	* em-folder-browser.c: moved the galview instance and menu
	pointers to EMFolderView, since they're basically meta-data on the
	messagelist @ to fix issues.

	* em-folder-view.c (em_folder_view_open_selected): copy over the
	threaded list value when the message browser is brought up.

	** some clean up

	* evolution-mail.schemas.in.in: removed xmailer_mask stuff.

	* em-migrate.c (mail_display_map[]): Removed xmailer_mask stuff.

	* em-folder-view.c (emfv_setting_notify): removed xmailer_mask stuff.

	* em-format-html.c (em_format_html_set_xmailer_mask): removed.
	This isn't used anymore.

	** Fixes the double-draw on separate mail view.

	* message-list.c (on_cursor_activated_cmd): noop if the cursor and
	uid match for all cases (clearing uid).
	(on_selection_changed_cmd): noop if the cursor and new selection
	hasn't changed & fix a memleak.

2004-05-04  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #55303, but ideally there would be a nicer way of
	doing this - likely with some added ETree API but that's not
	likely to happen anytime soon.

	* em-folder-browser.c (scroll_idle_cb): Recall the saved scrollbar
	position state and set it, then reconnect to the
	message_list_scrolled signal.
	(emfb_list_built): Calculate a default scrollbar position for
	scroll_idle_cb to use if there's no saved state.
	(emfb_set_folder): Disconnect from the message_list_scrolled
	signal and the idle_scroll_id.
	(emfb_list_scrolled): Save the scrollbar position state.
	(emfb_destroy): Disconnect from list_scrolled_id and
	idle_scroll_id.

	Fix for bug #58004.

	* mail-account-gui.c (display_license): Fixed to compile.
	(select_account_signature): Activate the signature menu item.
	(signature_added): Connect to the activate signal for each item.
	(sig_changed): Removed.
	(prepare_signatures): Don't bother connecting to the
	"selection-done" signal, it doesn't seem to work the way we
	expected it to work.

2004-05-04  Sarfraaz Ahmed <asarfraaz@novell.com>

	* mail-account-gui.c (display_license): This now takes CamelProvider
	as argument. Made the display message more generic. Removed the signal
	connects for buttons and replaced those with proper gtk_reponses.
	(mail_account_gui_check_for_license): Modified the gconf key for
	licenses to be a string list.
	* evolution-mail.schemas.in.in: Added the gconf schema entry for a 
	string list to handle the component names whose licenses are accepted.
	* mail-license.glade: Modified the display string and added the
	appropriate gtk_response types for the buttons.
	
2004-05-03  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #57968

	* message-list.c (message_list_set_folder): Save the tree/hide
	state of the current folder before clearing the message-list.
	(message_list_set_folder): Note that a new folder has just been
	set (now needed by the regen code to tell whether or not it should
	save the tree state before clearing the tree).
	(message_list_destroy): Save the tree/hide state before destroying
	the message-info's, not after.
	(regen_list_regened): If the regen is being performed in response
	to a message_list_set_folder, don't save the tree state before
	clearing the tree or we'll clobber the real state with bogus data.

2004-05-03  William Jon McCann  <mccann@jhu.edu>

	* mail-account-gui.c: Add gtkdialog header to fix build.

2004-05-03  Not Zed  <NotZed@Ximian.com>

	* em-composer-utils.c (create_new_composer): take fromuri and
	subject to set the basic headers/account.
	(em_utils_compose_new_message)
	(em_utils_compose_new_message_with_mailto, forward_attached)
	(em_utils_forward_attached, forward_non_attached)
	(em_utils_forward_inline, em_utils_forward_quoted)
	(em_utils_forward_message, em_utils_forward_messages): Take the
	from folder uri to set the from account if it can.  Fixed all
	callers.  For #57964.

	* mail-send-recv.c (receive_update_done): removed.

	* em-mailer-prefs.h:
	* message-tag-followup.h:
	* mail-config-druid.h:
	* mail-tools.h: clean up & use forward decls.  Fix users with
	busted includes.

	* em-composer-utils.c (em_utils_compose_new_message)
	(em_utils_compose_new_message_with_mailto)
	(em_utils_post_to_folder, em_utils_post_to_url)
	(em_utils_edit_message, em_utils_edit_messages)
	(em_utils_forward_attached, em_utils_forward_inline)
	(em_utils_forward_quoted, em_utils_forward_message)
	(em_utils_forward_messages, em_utils_redirect_message)
	(em_utils_redirect_message_by_uid) :
	(em_utils_reply_to_message, em_utils_reply_to_message_by_uid)
	(em_utils_post_reply_to_message_by_uid): Moved these here from
	em-utils.c.

2004-04-30  Priit Laes  <amd@tt.ee>

	* mail-config.glade: fix typo. #53466.

	* evolution-mail.schemas.in.in: use American English instead of
	British. #53466.

2004-04-30  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #56645

	* em-folder-tree.c (tree_drag_motion): If the row the cursor is
	hovering over has children and is not expanded already, setup a
	timer to auto-expand it if the user hovers there long enough.
	(tree_autoexpand): Callback to expand the row.
	(tree_drag_leave): Disconnect the timer.
	(tree_drag_drop): Same.
	(em_folder_tree_destroy): Same.

2004-04-30  Enver ALTIN  <enver.altin@frontsite.com.tr>

	* evolution-mail.schemas.in.in: Fixed a type-o.

2004-04-30  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (message_list_set_folder): Properly initialise
	the strikeout column for both types of folders (trash and not
	trash). Completes the fix for bug #57304.

2004-04-30  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (emu_can_save): fix the overwrite? question.  #57822.

2004-04-29  Not Zed  <NotZed@Ximian.com>

	* mail-errors.xml.in: change all the session-message-* things to
	just be secondary, otherwise they look awful all big fonted.

	* mail-session.c (error_type[]): forgot to prefix error type with
	"mail:"

	* em-account-prefs.c (account_delete_clicked): duh, use the right
	error id.

	* mail-send-recv.c (receive_update_got_store): call
	mail_note_store rather than get_folder_info so that unread counts
	are propagated to the ui too.

	* mail-errors.xml.in: fix the password dialogue text.

2004-04-28  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (sort_cb): Sort the VFolders. Fixes bug
	#56636.

	* em-mailer-prefs.c (citation_color_set): We only want 8bits per
	color. Fixes bug #57588.

	* em-folder-tree-model.c (em_folder_tree_model_remove_store):
	Duh. If the lookup of si fails, don't use si->display_name in the
	warning message. Actually, don't bother with a warning message at
	all, this is a perfectly valid situation. Fixes bug #57746.

	* mail-ops.c (mail_send_message): Don't set the Date header here
	anymore. It has either already been set (when written to the
	Outbox) or will automagially be set to the current time if a Date
	hasn't already been set when the transport sends it. Fixes bug
	#57599.

	* em-composer-prefs.c (sig_add_script_response): Use
	g_shell_parse_argv() to get the actual script path and then check
	that we can exec argv[0] rather than treating the entire
	command-line as the signature script. Fixes bug #57305.

2004-04-28  Not Zed  <NotZed@Ximian.com>

	* message-list.c (ml_selection_clear_event): return the right
	type, related to #53839.

	** Changed error messages to use EError.

2004-04-27  Not Zed  <NotZed@Ximian.com>

	** See bug #57659.

	* mail-ops.c (fix_unmatched_info): removed, done in camel now.

	** See bug #57511.

	* mail-config.glade: gave the whole smime frame (vbox) a name so
	we can use it from code.

	* mail-account-gui.c (mail_account_gui_new): get the smime_vbox
	widget if we have no NSS, the name changed and the HIG patches
	didn't fix it.

2004-04-26  Radek Doulik  <rodo@ximian.com>

	* em-format-html.c (efh_format_timeout): set gtk_html_begin's
	flags to avoid scroll to top of the message and
	reloading+flickering of images

	* em-html-stream.c: added GtkHTMLBeginFlags flags field
	(em_html_stream_set_flags): new helper function to set new flags
	field
	(emhs_sync_write): use gtk_html_begin_full with new flags field
	(em_html_stream_new): zero flags field

	Fixes #51654

2004-04-23  Sarfraaz Ahmed <asarfraaz@novell.com>

	* mail/mail-license.glade: Glade file for displaying the license.

2004-04-23  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (em_format_html_load_http): fix the check to
	see if we've already loaded the images.  #57450.

2004-04-23  Sarfraaz Ahmed <asarfraaz@novell.com>

	* mail-account-gui.c (mail_account_gui_source_complete): Added a 
	check for HAS_LICENSE flag.
	(mail_account_gui_check_for_license)(display_license)
	(populate_text_entry)(check_button_state)(set_license_accepted)
	(set_license_rejected): Implemented

2004-04-22  Not Zed  <NotZed@Ximian.com>

	* em-migrate.c (em_migrate_imap_cmeta_1_4): do the imap cmeta
	files, it just does the sync offline stuff.  #56674.
	(em_migrate_1_4): non-fatalise some of the options, call above.

	* mail-component.c (view_changed_cb): display selected count
	instead of unread if we have >1 selected.  Also don't do special
	case drafts/sent/outbox stuff if folders are inbox or re-used.
	(view_control_activate_cb): force check of autosaved messages as
	soon as the mailer starts up (well, after a delay, this seems
	wrong).  #57093.

2004-04-21  Not Zed  <NotZed@Ximian.com>

	* em-inline-filter.c (emif_scan): use a better test for non-full
	lines.

	* em-folder-browser.c (emfb_activate): dont desensitise
	HideDeleted just 'cause we have no folder, it needs to depend on
	Trash folder only.
	(emfb_set_folder): set the hidedeleted sensitivity based on
	whether we have a trash folder or not.  Fixed #57226.

	* em-folder-view.c (emfv_class_init): use the right signal
	callback for the changed signal.  Fixes #57246.

	* mail-component.c (impl_createControls): fix for
	e_user_creatable_items api changes.
	(create_item): split out the code to create the item.
	(create_local_item_cb): new callback for local item creation.
	(impl_requestCreateItem): call create_item to do the work.

2004-04-19  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c: Use E_ICON_SIZE_* enums for the menu icon
	sizes.

	* em-folder-view.c: Use E_ICON_SIZE_* enums for the menu/toolbar
	icon sizes.

	* message-tag-followup.c (construct): Same.

	* message-list.c (message_list_init_images): Same.

	* mail-send-recv.c (build_dialog): Same.

	* mail-mt.c (do_op_status): Same.

	* mail-config-druid.c (evolution_mail_config_wizard_new): Same.

	* em-popup.c (em_popup_create_menu): Same.

	* em-format-html-display.c (efhd_format_prefix): Same.

	* em-format-html.c (efh_format_secure): Same as below.

	* em-folder-tree.c (render_pixbuf): Don't use absolute icon sizes,
	use the e-icon-factory enums.

2004-04-19  Jeffrey Stedfast  <fejj@ximian.com>

	* em-composer-prefs.h: Removed variables that got re-added with
	the icon-theme patch somehow.

	* em-account-prefs.c: Don't bother keeping global references to
	the enable_pixbuf anymore, since it's unnecessary.

2004-04-19  Michael Terry  <mike@mterry.name>

	* GNOME_Evolution_Mail.server.in.in:
	* em-account-prefs.[ch]:
	* em-composer-prefs.[ch]:
	* em-folder-browser.c:
	* em-folder-tree.c:
	* em-folder-view.c:
	* em-format-html-display.c:
	* em-format-html.[ch]:
	* em-popup.c:
	* mail-component.c
	* mail-config-druid.c:
	* mail-config.glade:
	* mail-mt.c:
	* mail-send-recv.c:
	* message-list.c:
	* message-tag-followup.c:
	* message-tags.glade: Update the mailer to use icon themes through the
	EIconFactory object in e-util

2004-04-16  David Malcolm  <dmalcolm@redhat.com>

	* importers/netscape-importer.c (netscape_import_accounts):
	Removed unused and uninitialised "url" local that gets g_free-ed

2004-04-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (config_write_style): Change the message display
	widget names to match the ones we are using in 1.5 (rather than
	the ones from earlier versions). Fixes bug #57070.

2004-04-14  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c: Added a new "message_list_scrolled" signal so
	our users can listen to this event in order to update saved state.
	(message_list_get_scrollbar_position): Simplified.
	(message_list_set_scrollbar_position): Simplified.

	* em-format.c: Don't complain about message errors ("Internal
	Error: ..."), instead silently fall back to display the message as
	source. Fixes bug #56876.

2004-04-14  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_set_folder_uri): ugh, use the queued
	thread to get the folder, otherwise we can get folders set on the
	display out of order.

	* message-list.c (message_list_set_search): if we set this while
	frozen, save the search elsewhere.
	(message_list_thaw): if we had a frozen-time search, use it when
	we regenerate.

	* em-folder-browser.c (emfb_set_folder): freeze/thaw the
	messagelist around changes so we don't have multiple updates fire
	off changing folders.
	(emfb_activate): remove an unused variable i never used.

	* message-list.c (message_list_freeze, message_list_thaw): lock
	some updates to the ui, so you can do things like set folder and
	search atomically.
	(message_list_set_threaded, message_list_set_hidedeleted)
	(message_list_set_search, message_list_hide_uids)
	(message_list_hide_clear, message_list_set_folder): dont refresh
	the list if we're frozen.

	* mail-component.c (impl_createControls): remove debug comment.

	** See #56641.

	* em-format-html-display.c (efhd_format_secure): fix a small
	memleak.
	(efhd_bonobo_unknown, efhd_format_attachment): close the <object>
	tag properly, and <br> it as well to make sure its separated.

	* em-sync-stream.c: add some runtime and compile time stream
	logging stuff.

	** See bug #56149.

	* em-folder-view.c (emfv_edit_cut): similar to below, use focus to
	determine who we select from.
	(emfv_edit_copy): ditto.

	* message-list.c: Remove primary selection stuff.  It just annoys.

	* em-folder-browser.c (emfb_edit_copy): use focus rather than
	selection owner to determine who to copy from.
	(emfb_edit_cut): similarly.

	* em-format.c (emf_multipart_related): hmm, use the right pointer
	when iterating the pending uri list.

2004-04-13  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (impl_createControls): We don't actually want
	to disallow clicking on \NoSelect folders. Fixes a bug campd has
	been complaining to me about :-)

	* mail-config.c (mail_config_signature_run_script): If we get an
	empty charset string from gconf, don't try to use the result to
	create a charset filter. Real fix for bug #51924.

	* mail-config.glade: Removed crackrock usage of GtkFixed as
	fillter. Also HIGified some other stuff.

2004-04-13  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_set_folder): track the messagelist
	hidedeleted value since it looks it up when we set the folder.

	* em-folder-browser.c (emfb_hide_deleted): use new method below to
	propagate change.
	(emfb_activate): same.

	* em-folder-view.c (em_folder_view_set_hide_deleted): accessor to
	set the hide_deleted state, emits a view_changed event.

	* mail-component.c (view_changed_cb): use VISIBLE rather than
	TOTAL for the displayed total count.  Also deleted if we're not in
	hide deleted mode.  And do spethal things with spethal folders,
	etc.

	* mail-ops.c (mail_refresh_folder): run this in the
	thread_queued_slow, so it runs in sequence and after folder_sync.

	* em-folder-view.c (emfv_set_folder): fire off a refresh_folder
	once the folder is loaded.  Addresses #56871.

	* em-format-html.c (efh_format_headers): use %% for %%.
	(efh_format_done): reset load_http_now once we've done, should
	fix #56338 finally.

	* em-folder-view.c (emfv_init, emfv_finalise, emfv_activate):
	revert dans' creatable items handler patch, moved to
	mail-component instead (which deals with the actual menu's).

	* mail-component.c (impl_createControls): setup a user creatable
	items handler on the view widget.
	(view_control_activate_cb): activate the user creatable items
	handler on the view widget.

	* em-folder-view.c (emfv_init): add a comment about jeff's last
	fix.

	* em-utils.c (forward_non_attached): Set attachments from
	forwardee before we set the body, otherwise images wont resolve
	properly.  Related to #56566.

2004-04-12  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_init): Need to set the session on the
	preview object. Fixes bug #56862.

	* em-folder-tree.c (em_folder_tree_set_selected): Scroll to the
	auto-selected folder. Fixes bug #56707.

	* message-list.c (message_list_get_scrollbar_position): New
	function.
	(message_list_set_scrollbar_position): New function.

	* em-utils.c (em_uri_to_camel): If the provider is unavailable,
	return euri like the other fail cases. Fixes bug #56846.

2004-04-10  Francisco Javier F. Serrador  <serrador@cvs.gnome.org>

	* evolution-mail.schemas.in.in.h: Correct typo s/hight/height/ at
	"Subscribe dialog default hight"

2004-04-09  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_init): Don't bother adding the
	autogen sig here, e-signature-list.c handles this now.

	* em-migrate.c (em_upgrade_accounts_1_4): Migrate the signature
	uids. Fixes bug #56726.

2004-04-09  Chris Toshok  <toshok@ximian.com>

	* importers/pine-importer.c (import_contact): use
	e_destination_export_to_vcard_attribute instead of exporting to
	xml, and use e_contact_set_attributes.

	* em-utils.c (em_utils_camel_address_to_destination):
	EABDestination -> EDestination.
	(reply_get_composer): same
	(post_reply_to_message): same.

	* em-composer-utils.c (ask_confirm_for_unwanted_html_mail):
	EABDestination -> EDestination.
	(composer_get_message): same.

2004-04-09  Radek Doulik  <rodo@ximian.com>

	* em-format-html.c (efh_format_headers): add width=16 height=16 to
	rupert's image so that it doesn't flicker/move

2004-04-09  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-selection.c (em_select_folder): Set the excluded bits
	on the folder-tree. Don't allow the user to xfer messages into
	folders which are: NoSelect, Virtual, nor vTrash. Fixes bug
	#56229.

2004-04-09  Dan Winship  <danw@ximian.com>

	* em-folder-view.c (emfv_init): Create an
	EUserCreatableItemsHandler for the view.
	(emfv_finalise): Unref it.
	(emfv_activate): Activate it

	* mail-component.c (impl__get_userCreatableItems): add
	object/folder flags to the items

2004-04-08  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (cp_r): Now takes a pattern argument to limit files
	that get copied over (so we can limit imap cache to only the
	summary files - makes it faster).

	* mail-account-gui.c (mail_account_gui_build_extra_conf): Fixed up
	a bit to look nicer and make it closer to HIG compliant.

	* em-folder-tree.c (emft_drop_folder): We need to recursively copy
	the dragged folder tree over to the drop location, not just the
	parent folder. We also need to subscribe to the newly created
	folder in some cases.

2004-04-08  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_format_headers): add the monkey button if
	we're from evolution.  See #52977.
	(emfh_gethttp): cast away a warning.

	* mail-folder-cache.c:
	(update_1folder): VJUNK_FOLDER's dont exist, they're VTRASH
	folders now.

	* em-folder-view.c: remove message_changed stuff from camel folder
	stuff.

	* mail-component.c (mail_component_init): don't setup the search
	context here, wait till its requested.  Fixes #56672.

2004-04-07  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (view_changed_cb): hook to update the info
	label when the folderview changes.

	* em-folder-view.c (emfv_class_init): added 2 signals 'loaded' and
	'changed'.  For when a folder is set/cleared or when some state
	changes.
	(emfv_set_folder): emit LOADED signal when we set the folder.
	(emfv_list_message_selected): emit changed event.
	(emfv_gui_folder_changed): emit changed event.

2004-04-07  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_tree_button_press): Check that
	emft_selection_get_selected() returns TRUE before we try to use
	the iter. Fixes bug #56652.
	(emft_popup_delete_response): Same idea here.
	(emft_popup_delete_folder): Same.
	(emft_popup_rename_folder): Same.
	(emft_popup_properties): Same.

	Fix for bug #56538

	* em-folder-view.c (emfv_set_folder_uri): Don't set the preview
	empty here.
	(emfv_set_folder): If the folder is the same as the folder already
	on the emfv, just return. Otherwise clear the preview and continue
	setting the folder as normal.

2004-04-07  Jeffrey Stedfast  <fejj@ximian.com>

	* em-account-prefs.c (em_account_prefs_apply): Removed.

	* em-mailer-prefs.c (em_mailer_prefs_apply): Removed.

	* em-composer-prefs.c (em_composer_prefs_apply): Removed.

	* mail-config-factory.c (mail_config_control_factory_cb): No
	longer need the Apply stuff.

	* em-mailer-prefs.c (em_mailer_prefs_construct): Don't call a
	function that doesn't exist anymore.

2004-04-06  Jeffrey Stedfast  <fejj@ximian.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): Changed to save
	the settings in the signal callbacks.
	(em_mailer_prefs_apply): Don't save the settings here.

	* em-composer-prefs.c (em_composer_prefs_apply): Don't save the
	settings here.
	(em_composer_prefs_construct): Changed to save the settings in the
	signal callbacks.

2004-04-06  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_tree_row_expanded): ref the emfoldertree
	in our thread message.
	(em_folder_tree_set_selected): same.
	(emft_get_folder_info__free): unref it.

	* mail-folder-cache.c (ping_store): use thread_queued_slow not
	thread_queued - we dont care when it runs.

	* em-folder-view.c (emfv_set_folder_uri): use thread_new for
	getting the folder, we do elsewhere, and it aids interactivity.

2004-04-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_dir): Migrate the thread_list
	setting. Fixes bug #56297.

2004-04-05  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_xpkcs7mime_button): if we have no
	sign status, use signed-nokey, rather than no icon.
	(efhd_xpkcs7mime_viewcert_clicked): show the certificate viewer
	since certificate_viewer_show doesn't show it.
	(efhd_xpkcs7mime_viewcert_foad): foad foad foad.  The api changed
	and we need to foad it ourselves.

	** See bug #52822.

	* em-format-html-display.c (efhd_xpkcs7mime_add_cert_table): if we
	can't find the cert, then desensitise the cert button.

	** See bug # 56402.

	* mail-folder-cache.c (update_folders): if we're cancelled, noop.
	(mail_note_store_remove): mark the update data cancelled.

	* mail-ops.c (add_special_info): removed, this is done in camel
	now.
	(fix_unmatched_info): renamed from add_unmatched_info.
	(get_folderinfo_got): Removed the meaningless comment here.

2004-04-02  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (cp_r): Revert my "fix" from yesterday. We can't
	necessarily show progress (progress window may have been destroyed
	already).

	Fixes bug #53851

	* em-folder-view.c (emfv_popup_move_cb): Save the uri as the
	default for copy/move.
	(emfv_popup_move): Use the default copy/move uri.
	(emfv_popup_copy): Same.

	* em-folder-selection.c (em_select_folder): Select the uri *after*
	the dialog gets shown.

2004-04-02  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #37416

	* mail-folder-cache.c (update_1folder): Same as below. Also add
	vJunk fodlers to the list of folders that we display the total
	count for (as discussed on the mailing lists).

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	Use 'total - deleted' as the count for Outbox rather than just the
	total count.

2004-04-02  Not Zed  <NotZed@Ximian.com>

	* em-inline-filter.c: do a per-line validation of the uuencoded
	stuff, based on the length byte.

	** See bug #56338.

	* em-format-html.c (emfh_gethttp): fix the fugly "load http if"
	that doesn't work to be a fugly "load http if" that does work.
	(efh_format_timeout): dont set load_http_now here, its only an
	override now.

2004-04-01  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (cp_r): Report progress. "Fixes" bug #56355.

	* mail-account-gui.c (signature_changed): Set the updated
	sig->name on the menu item.

	* importers/netscape-importer.c (netscape_import_accounts):
	Updated for signature API changes.

	* mail-account-gui.c: Same.

	* mail-signature-editor.c: Same.

	* em-composer-prefs.c: Same.

	* mail-config.c: Rewrote the signature stuff to use ESignatureList
	instead. Much cleaner and less broken.

	* em-mailer-prefs.c (em_mailer_prefs_construct): Always make the
	Add/Remove Header buttons de-sensitised at the start. Fixes bug
	#56284.

2004-04-01  Eric Zhao  <eric.zhao@sun.com>

	* mail-account-gui.c (transport_type_changed): Commented grabbing
	focus on hostname edit, fix the focus issue of Account Assistant.

2004-03-31  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html.c (efh_text_plain): Only do citation colouring if
	the user has specified to do so and use the user's specified
	colour when appropriate. Fixes bug #56290.

	* em-subscribe-editor.c (em_subscribe_editor_new): Save/restore
	the subscribe dialog's window size. Fixes bug #56230.

2004-03-31  Not Zed  <NotZed@Ximian.com>

	* mail.h: REMOVED!  And there was much rejoicing.

	* *.[ch]: Cleaned up header inclusions and added plenty of forward
	declarations.  Sped up complete re-compilation by upto 20%.
	
	** See bug #55950.

	* em-utils.c (em_utils_in_addressbook): utility for checking if an
	email address is in the addressbook.  I can't tell if it works
	'cause it crashes eds.

	* em-format-html.c (emfh_gethttp): handle addressbook checking.

2004-03-30  Not Zed  <NotZed@Ximian.com>

	* mail-config.h: clean up the headers and use some forward decl's
	instead.

	* em-format-html.c (em_format_html_set_load_http): change state to
	an int 'style' instead.

	* em-folder-view.c (emfv_setting_notify): set the format load http
	option to the config value directly.

	** See bug #56147.

	* message-list.c (clear_info): set the node data to NULL when we
	unref its data.
	(ml_get_save_id): use a different test for the root node, and
	return NULL if we don't have any data on the node (because we're
	cleaing it).

	** See bug #54962.

	* em-folder-tree.c (emft_popup_new_folder_response): put back the
	old hack to open the vfolder editor if you try to create a folder
	under vfolders.

	** See bug #55940.

	* mail-autofilter.c (mail_filter_rename_uri): map the uri to an
	email uri before passing to filter code.
	(mail_filter_delete_uri): same here.

2004-03-30  Radek Doulik  <rodo@ximian.com>

	* mail-config.glade: add spellLiveToggled signal

	* em-composer-prefs.c (em_composer_prefs_construct): fix typo,
	call toggle_button_init on prefs->spell_check instead of againg on
	prefs->auto_smileys
	(spell_setup): connect spellLiveToggled signal

	Fixes #55964

2004-03-29  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_create_folder__free): Free the
	folder-info.

	* em-folder-browser.c (emfb_activate): Instead of comparing
	sstate[0] to '1', compare it against '0' like all the other code
	does.

2004-03-25  Sivaiah Nallagatla <snallagatla@novell.com>

	* Makefile.am : remove local-config.glade from glade_DATA as it 
	is removed from CVS 

2004-03-25  Rodney Dawes  <dobey@ximian.com>

	* em-composer-prefs.c (sig_edit_cb):
	(sig_add_script_cb): Use gtk_window_present instead of doing a show
	then raise, as this also puts the window on the current workspace
	(em_composer_prefs_construct): Fix the border widths for the dialog
	vbox and action area to be HIG-compliant, and realize the window
	Remove the dialog separator
	Use a box_pack_start, rather than box_pack_start_defaults which causes
	some weird behaviour when changing the border widths
	* em-subscribe-editor.c (em_subscribe_editor_new): Realize the dialog
	and set the border widths for its vbox and action area to be compliant
	with the HIG
	* local-config.glade: Removed this file as it is no longer used
	* mail-account-editor.c (construct): Realize the dialog, remove its
	separator, and set the border widths for its vbox and action area to
	be HIG-compliant
	* mail-account-editor.c (source_type_changed):
	(transport_type_changed): Fix the showing and hiding of the widgets
	related to the SSL options
	(mail_account_gui_new): Get the transport/source frames for the SSL
	options, and hide them by default
	Show the default folder buttons by default here
	(mail_account_gui_setup): Only call _show not _show_all here, so we
	don't mess up the shown/hidden state of things
	* mail-account-gui.h: Add ssl_frame widget to the MailAccountGuiService
	* mail-config.glade:
	* mail-search.glade:
	* mail-security.glade: HIG-compliance fixes for the glade dialogs
	* message-tag-followup.c (construct): Don't set border_width on the
	dialog itself
	Remove the separator from the dialog
	Set the border_widths for the dialog's vbox and action areas to be
	compliant with the HIG
	* message-tags.glade:
	* subscribe-dialog.glade: HIG-compliance fixes for these dialogs

	Original patch from Martyn Russell
	
2004-03-24  Danilo Å egan  <dsegan@gmx.net>

	* mail-ops.c (get_messages_desc): Use ngettext for handling plural
	forms (fixes bug #53464).

2004-03-23  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html.c (emfh_gethttp): Use sizeof() to decide how big
	buffer is so that in the future, if we change the length of
	bufefr, things will Just Work (tm).

	* em-mailer-prefs.c (em_mailer_prefs_construct): Fixed the key to
	fetch the value from the correct location. It's
	junk/check_incoming, not junk/sa/check_incoming. Fixes bug #55903.

	* em-folder-tree-model.c (em_folder_tree_model_set_expanded):
	Fixed some logic bugs.

2004-03-23  Radek Doulik  <rodo@ximian.com>

	* em-format-html-display.c (efhd_format_attachment): use
	EM_FORMAT_HTML_VPAD

	* em-format-html.h (EM_FORMAT_HTML_VPAD): added new define for
	vertical padding

	* em-format-html.c (efh_format_message): change padding table so
	that it works OK with fixed gtkhtml

2004-03-23  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_attachment_popup): dont add the
	show/hide menu items if we can't ever show it inline.
	(efhd_attachment_button): disable the ">" button if we can't view
	the content inline.  See #52086.

	* em-format-quote.c (emfq_format_attachment): format inline(d)
	parts automatically into the reply.  Part of #55702.

	* em-utils.c (em_uri_from_camel): if we get an email uri passed in,
	just pass it out again, without first going to camel to do it.

2004-03-22  Not Zed  <NotZed@Ximian.com>

	* em-format.c: 
	* em-mailer-prefs.c: Add Newsgroups to the default header list.

	* em-format-html.c (efh_format_header): handle the newsgroups
	header, output news: url's.  For bug #??? i can't recall, i closed
	it already!

2004-03-19  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #54800.

	* em-folder-tree.c (tree_drag_drop): Remove the autoscroll
	timeout.
	(tree_drag_leave): Remove the autoscroll timeout.
	(tree_autoscroll): New autoscroll timeout callback - automagically
	scrolls the treeview if appropriate.
	(tree_drag_motion): Setup the autoscroll timeout.

2004-03-19  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mail_component_remove_store): ref the store
	before running the async disconnect, otherwise we unref one too
	many times.

2004-03-18  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (mail_account_gui_setup): Don't set the
	account source/transport types to disabled simply because the
	provider is NULL (think of the "None" option).
	(source_type_changed): Need to update widget sensitivity based on
	locked'ness here.
	(transport_type_changed): Same.

	* em-utils.c (em_utils_add_address): rfc2047 decode the address
	here before passing it off to the addressbook (which expects it to
	be in human-readable form, not encoded). Fixes bug #55591.

2004-03-18  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c (mail_account_gui_new): save the source and
	transport vbox's to enable/disable the whole lot easier.
	(mail_account_gui_setup): enable above based on perms.
	(mail_account_gui_build_extra_conf): also disable extra page, as
	above.

	* em-account-prefs.c (account_cursor_change): disable the whole
	account editor if accounts are ro.

2004-03-17  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_message_deliverystatus): format as plain
	text too.

	* em-format.c (emf_message_deliverystatus): format delivery
	status messages as plain text, rather than as messages.  since
	they wont be CamelMimeMessages.  Maybe they should be silently
	hidden.

	* mail-offline-handler.c (store_go_online): split this, only call
	add_store/note_store once we've actually set the store online.
	(store_went_online): set the store up once we're fully online.
	Works around a deadlock in #55618.

	* em-account-prefs.c (account_cursor_change): disable
	editing/adding/removing accounts etc if accounts aren't editable.
	(em_account_prefs_construct): call above after setup.

	* mail-component.c (mc_quit_sync): if we have empty on exit days,
	check that.  keep track of the last empty on exit time.

	* em-mailer-prefs.c (emmp_empty_trash_init): init the trash stuff
	here.
	(em_mailer_prefs_apply): save empty trash on exit frequency.

2004-03-16  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c (mail_account_gui_auto_detect_extra_conf):
	check extra conf items are writable.
	(mail_account_gui_build_extra_conf): same.
	(setup_service): add gui arg, and do above for auth and ssl args.

2004-03-16  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #55358.

	* em-folder-tree.c (emft_expand_node): Changed to be the callback
	function for em_folder_tree_model_expand_foreach().
	(emft_maybe_expand_row): Renamed from emft_loading_row_cb(). We
	now handle both "loading-row" an "loaded-row" signals. Also
	updated for slight change in key generation.
	(em_folder_tree_new_with_model): Connect to the "loaded-row"
	signal.
	(emft_update_model_expanded_state): Updated for slight change in
	key generation.

	* em-folder-tree-model.c (em_folder_tree_model_add_store): Emit
	the "loaded-row" signal for the newly added store.
	(em_folder_tree_model_set_folder_info): Emit "loaded-row" for the
	row we've just set the info on (but only after we've added a child
	node if there is one, so the signal handler can expand the newly
	added row if appropriate).
	(em_folder_tree_model_class_init): Setup the "loaded-row" signal.
	(em_folder_tree_model_finalize): The tree-state is now an xml file
	and not a binary file, so change the expanded free func.
	(em_folder_tree_model_load_state): Load the expand-state xml
	file. If one doesn't exist, setup some defaults.
	(em_folder_tree_model_get_expanded): Scan the XML tree for the
	node.
	(em_folder_tree_model_set_expanded): Same.
	(em_folder_tree_model_save_expanded): Save the expand-state xml
	tree to disk.
	(em_folder_tree_model_expand_foreach): New function to iterate
	over all xml nodes and call the callback if the expand state is
	"true".

2004-03-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (impl_requestCreateItem): Don't focus the
	name_entry widget here.

	* em-folder-selector.c (em_folder_selector_create_new): Focus the
	name_entry widget here rather than in mail-component.c

	* em-folder-tree.c (emft_drop_async_desc): New function to return
	a description of the async drop operation. Fixes bug #54808.

2004-03-15  Jeffrey Stedfast  <fejj@ximian.com>

	* em-utils.c (reply_to_message): If the mail_get_message() async
	op fails, it will still call us with a NULL message to check for
	that. Fixes bug #55612.
	(post_reply_to_message): Same.

	* em-folder-tree.c (emft_copy_folders__copy): Use
	camel_store_rename_folder() when appropriate (m->tostore ==
	m->fromstore && m->delete)

2004-03-15  Not Zed  <NotZed@Ximian.com>

	* em-format.c (em_format_format_error): make this a varags
	function, which then calls the virtual method to do the work.
	(emf_multipart_appledouble, emf_multipart_mixed)
	(emf_multipart_alternative, emf_multipart_related)
	(emf_message_rfc822): print an error to explain why you're getting
	source content displayed.
	(em_format_format_secure): make this a function.  and if we're
	done formatting a secure part, and we dont have a parent anymore,
	null out the validity.  See #55541.

2004-03-12  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_search_search_activated): No-op if
	emfv->folder is NULL (this means we are looking at a store folder?
	or else the folder hasn't loaded yet). Fixes bug #55293.

2004-03-11  Radek Doulik  <rodo@ximian.com>

	* mail-ops.c: remove junk learning thread, it's handled in
	camel-folder.c:folder_changed now

	* em-folder-view.c (emfv_popup_mark_junk): use
	em_folder_view_mark_selected, set junk, junk-learn and seen flags
	(emfv_popup_mark_nojunk): similar, reset junk, set junk-learn flags

2004-03-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (mail_send_mail): Removed. No longer in use (hasn't
	been since before 1.2).
	(send_queue_send): Before enetring the main send loop, create a
	temporary uid array containing ONLY the messages we will send
	(ie. not any that have been marked deleted) so that we can more
	accurately report the number of messages total that we are
	sending. Also continue sending even if we encounter an exeption in
	mail_send_message() (unless, of course, it is a
	user-cancel). Merge any exceptions we get into the master
	exception variable and ALWAYS sync/expunge the queue folder.

2004-03-11  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_set_folder): Reverted signal blocking
	stuff. Doesn't work and is unneeded with the proper fix.

	* em-format-html.c (efh_format_header): Fixed a bug where txt
	wasn't being properly initialised in all cases for Date
	headers. Also fixed the x-evolution-mailer code to simply use the
	ehader->value that was passed in.
	(efh_format_headers): Fixed to handle the special
	X-Evolution-Mailer header.

2004-03-11  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_set_folder): a really gross hack,
	disable all search handlers before setting the search and set hte
	search manually rather than going through the callbacks.  Partial
	fix for #55267, and ugly as it is.
	(emfb_init): save the search signal id's.
	(emfb_set_folder): ugh, properly set the defaults if the settings
	haven't been stored on the folder, and properly move them upstream
	to the bonobo menus.

	* em-folder-tree-model.c (sort_cb): when we sort, handle not
	having the node in the tree.  otherwise we always compare against
	"" which puts it at the head of the branch, rather than the tail.
	See #55428.

	* em-folder-tree.c (tree_drag_motion): make dnd look funny for
	joe.  #55246.

	* mail-component.c: change stores hash to point to a structure, in
	which we maintain the vtrash and vjunk folders for the entirety of
	the session.  memory use be damned i guess.  #55417 and partially
	#55391.	

2004-03-11  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_format_header): pass the raw header in
	instead of name and value.
	(efh_format_headers): if we have specific headers to show, iterate
	over all headers and print out all matching ones, so duplicate
	headers are properly displayed.  Related to #55298.

	* em-folder-selector.c (em_folder_selector_construct): dont set
	this to be modal.  otherwise you can't click on error popups. duh.

2004-03-08  Not Zed  <NotZed@Ximian.com>

	* em-folder-selection-button.c
	(em_folder_selection_button_clicked): don't let the user select
	virtual/vtrash folders or non-selectable folders.

	* mail-component.c (impl_createControls): disable selection of
	non-select rows.

	* em-folder-selector.c (em_folder_selector_create_new): exclude
	folders with noinferiors set.

	* em-folder-tree.c (folder_tree_new): add folder tree arg, hook
	onto the selection funciton for the tree selection.
	(emft_select_func): selection override function.  allow certain
	things to be excluded.
	(em_folder_tree_set_excluded): api to set what is excluded from
	the selectability.
	(emft_tree_row_activated): call emft_select_func check to see if
	this row is excluded before emitting an activated signal.

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	save folder info->flags in the tree store.

	* mail-folder-cache.c (create_folders): use tail recursion.
	(get_folders): tail recurse.

	* (*): Fixed for api changes in camel.

2004-03-10  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #55298.

	* em-format-html.c (efh_format_header): Now takes a default txt
	argument (header value). For address/date headers, if this isn't
	set, default back to the old behaviour of looking it up.
	(efh_format_headers): If we are iterating thru the camel raw
	headers, always pas the header value as the txt argument,
	otherwise always pass NULL.

2004-03-10  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	Removed an unused variable left over from an old attempted fix.

	* em-folder-selector.c (emfs_response): Select the same folder in
	the create-folder dialog as is selected in the parent selector
	dialog. Fixes the rest of bug #53862.

	Partial fix for bug #53862.

	* em-folder-selector.c (emfs_response): Connect to the newly added
	"folder-added" signal and save a created_uri string so that we can
	be sure to only listen for the creation of the folder the user
	created in *our* create-folder dilog (and not from some other
	place).

	* em-folder-tree-model.c (folder_subscribed): Emit a new
	"folder-added" signal.

	* mail-session.c (request_password): Focus the entry widget. Fixes
	bug #55330.

2004-03-10  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (pipe_to_sa_with_error): call
	camel_stream_close and close the fds[1]
	(pipe_to_sa_with_error): do not call close, camel_stream_close
	should be enough to be sure the fd was closed

2004-03-08  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_create_folder): New async function to
	create a folder.
	(em_folder_tree_create_folder): Partly moved into
	emft_create_folder. Might be able to remove this code, but lewing
	might be using it in Connector or something? Need to ask him...
	(emft_popup_new_folder_response): Use emft_create_folder()
	instead.

2004-03-08  Radek Doulik  <rodo@ximian.com>

	* mail-ops.c (mail_filter_junk): new method, filter folder with
	FILTER_SOURCE_JUNKTEST type filter

	* em-folder-view.c: added Filter Junk command and junk icons to
	menus, added apply filters icon to popup menu
	(emfv_popup_filter_junk): new helper method, calls
	mail_filter_junk

2004-03-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (em_format_html_display_search): Don't
	set our parent window as the efhd, ehfd isn't even a widget.

	Fixes bug #54030

	* em-format-html-display.c (efhd_search_response): Reset the
	searching tokeniser on Cancel.

	* e-searching-tokenizer.c (e_searching_tokenizer_reset): New
	function to reset a search tokeniser.

2004-03-05  Not Zed  <NotZed@Ximian.com>

	** See bug #55096.

	* importers/evolution-mbox-importer.c (process_item_fn): hack,
	unref when complete

	* importers/evolution-outlook-importer.c (outlook_importer_new):
	init status lock.
	(process_item_fn): hack, unref ourselves when we're complete.  i
	think the shell leaks the ref.

2004-03-04  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_popup): If event == NULL, don't try to
	use event->key.time

	* em-migrate.c (upgrade_vfolder_sources_1_4): New function to
	upgrade vfolder sources.
	(em_upgrade_xml_1_4): If the doc is vfolders.xml, upgrade the
	sources nodes.

2004-03-03  Not Zed  <NotZed@Ximian.com>

	** See bug #53738.

	* mail-ops.c (fetch_mail_fetch): if we've been cancelled, uncancel
	so syncing can work.  and always sync the folder (with expunge if
	deleting).

	** See bug #54924.

	* em-utils.c (em_utils_selection_set_urilist): Try to get the drop
	filename from the message subject, or folder name.
	(em_utils_empty_trash): kill warning.

	** See bug #54121.

	* mail-component.c (impl_requestCreateItem)
	(emc_new_folder_response): Hack in a nastish implementation of
	create folder for the new menu.
	(impl__get_userCreatableItems): add 'new mail folder' to new
	button.

2004-03-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	if we have the folder opened already, and its the outbox, then use
	the total count instead of unread count.  Bit of hack, but copies
	mail-folder-cache stuff.

	* mail-component.c (mc_add_store): renamed from
	mail_component_add_store, internal call.  Added a done callback.
	(mc_add_local_store): renamed from mc_add_store, callback for
	local store.
	(mail_component_add_store): call mc_add_store to do the work.
	(mc_add_local_store_done): ugh, the target of all this shit - note
	all the default folders now they should be setup.

	* mail-folder-cache.c (mail_note_folder): clean up the logic a
	bit.  was gonna do osmething else but it didn't work.
	
2004-03-02  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (mail_send): if we're already sending, up the
	again count to tell it we need to re-send again.
	(receive_done): if we've been asked to run a send again while we
	were already running it, run it again to make sure we didn't miss
	any new messages.  See bug #46839.

	* em-mailer-prefs.c (em_mailer_prefs_construct): update
	check_incoming_imap changes for merge conflicts.
	(settings_changed): i have no idea what these changes jeff did do,
	but check_incoming_imap is no longer needed, so i've deleted most
	of it.

2004-02-27  Not Zed  <NotZed@Ximian.com>

	* em-format.c (emf_multipart_encrypted, emf_multipart_signed): If
	validation fails, display as multipart/mixed rather than unkown
	attachment type, and make the error a little clearer that its an
	error.  See #52939.

2004-02-26  Not Zed  <NotZed@Ximian.com>

	* message-list.c (regen_list_regened): NOOP if the folder has
	changed.

	* mail-session.c (mail_session_check_junk_notify): remove
	check_incoming_imap test.
	(mail_session_init): "

	* evolution-mail.schemas.in.in: Remove check_incoming_imap option.

	* mail-config.glade: Remove check incoming imap checkbox.

	* em-mailer-prefs.c (em_mailer_prefs_construct): remove
	check_incoming_imap test.
	(em_mailer_prefs_apply): "
	(settings_changed): "

2004-03-02  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_tree_button_press): s/||/&&/. Fixes a
	dumb bug I introduced yesterday.

2004-03-01  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-selector.c (em_folder_selector_construct): Connect to
	the folder-activated signal.
	(folder_activated_cb): Call gtk_dialog_response() with
	GTK_RESPONSE_OK. Fixes bug #54793.

	* em-folder-tree.c (emft_tree_row_activated): New callback to emit
	the "folder-activated" signal which is needed to fix bug #54793.
	(emft_tree_button_press): Handle button1 double-clicks too (also
	for bug #54793).
	(emft_tree_button_press): On right-click, we also want to select
	the folder the user right-clicked on. Fixes bug #54772.

2004-02-27  Jeffrey Stedfast  <fejj@ximian.com>

	* em-mailer-prefs.c (em_mailer_prefs_construct): Fixed some
	console warnings from my last commit.

	* em-folder-view.c (emfv_setting_notify): If
	gconf_entry_get_value() returns NULL, then it means the key was
	unset or something. Don't use g_return_if_fail() for that.

	First of the lockdown fixes...

	* em-composer-prefs.c (em_composer_prefs_construct): Same as
	below.

	* em-mailer-prefs.c (em_mailer_prefs_construct): Respect
	locked-down keys by disabling their sensitivity to the user.
	(settings_changed): Don't re-enable check_incoming_imap if the key
	is locked.

2004-02-26  Rodney Dawes  <dobey@ximian.com>

	* em-format-html-display.c (efhd_attachment_button): Create the
	arrows in these widgets as GTK_SHADOW_NONE, since the default arrow
	type in GTK+ 2.x is flat triangle arrows, and shadow types are
	generally ignored for arrows anyway, and so we don't look ugly with
	themes that handle shadow types on arrows correctly

2004-02-26  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #54352

	* em-message-browser.c (emmb_class_init): Set update_message_style
	to FALSE.

	* em-folder-view.c (emfv_setting_notify): Only update message
	display style if our subclass wants us to.
	(emfv_class_init): Set update_message_style to TRUE.
	(emfv_view_mode): Don't save the gconf key unless our class allows
	us to.

2004-02-26  Jeffrey Stedfast  <fejj@ximian.com>

	* em-utils.c (em_utils_folder_name_from_uri): Make sure url->path
	is non-NULL before setting folder_name to url->path + 1. Could
	possibly fix bug #54853.

2004-02-25  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (efhd_attachment_button): Protect
	against using NULL pixbufs. Gets rid of a lot of console warning
	spewage on my system.

	* em-folder-view.c (emfv_list_key_press): Removed Delete/KP_Delete
	from here. Now handled via the bonobo-ui menu accels. Fixes bug #53504.

2004-02-25  Radek Doulik  <rodo@ximian.com>

	* mail-session.c (main_get_filter_driver): set seen flag for junk
	messages

	* em-folder-view.c (emfv_popup_mark_junk): do not set DELETED

2004-02-24  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (construct): Removed Apply button. As
	discussed on IRC, UI doesn't feel we should have an Apply button
	here.

2004-02-24  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-editor.c (construct): Need to listen for changes to
	S/MIME options, the signature option menu, and any extra
	provider-specific config options. Fixes bug #54036.

	* em-folder-view.c (emfv_popup_mark_junk): Set the SEEN flag as
	well.
	(emfv_list_key_press): Removed the skip-to-next-message logic as
	this was already being handled in emfv_popup_delete(). Fixes bug
	#54471.
	(emfv_enable_menus): Re-enable MessageDelete here. Fixes bug
	#54770.

	* em-utils.c (em_utils_folder_is_drafts): Use the new
	camel_store_folder_uri_equal() function.
	(em_utils_folder_is_sent): Same.

2004-02-23  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #54057

	* em-utils.c (em_utils_folder_is_sent): Use provider->url_equal()
	rather than camel_store_uri_cmp() since that function did not do
	anything close to what it claimed to do. Also use
	em_uri_to_camel() here on the account sent_folder_uri.
	(em_utils_folder_is_drafts): Same.

2004-02-23  Jeffrey Stedfast  <fejj@ximian.com>

	* em-message-browser.c (emmb_list_message_selected): Protect
	against NULL uids.
	(emmb_set_message): Same.

	* em-format-quote.c (emfq_format_message): Print the headers when
	forwarding inline/quoted. Fixes bug #53916.

	* em-folder-tree.c (tree_drag_motion): We want UID_LISTs to drop
	with the MOVE action by default. Fixes a common complaint from
	IRC.

2004-02-23  Not Zed  <NotZed@Ximian.com>

	* em-format.c (emf_multipart_signed): check mps->protocol != NULL
	before dereferencing it.  See #54406.

2004-02-20  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_list_key_press): Delete key should always
	delete, never undelete (bug #53215). Also fixes a bug where
	uids->len was being accessed after uids had been free'd.

	Fix for bug #53997

	* em-folder-view.c (emfv_list_message_selected): Ref the emfv
	before spawning the async event.
	(emfv_list_done_message_selected): Check emfv->preview !=
	NULL. Also unref the emfv when done.

2004-02-20  Dan Winship  <danw@ximian.com>

	* mail-component.c (set_prop): Remove the debug message here.

2004-02-20  Not Zed  <NotZed@Ximian.com>

	* mail-vfolder.c (mail_vfolder_add_uri): fix for vfolder-rule api
	changes.

	* mail-folder-cache.c (unset_folder_info, setup_folder)
	(rename_folders): switch the sense of the no select checks.  TEST!

2004-02-19  Chris Toshok  <toshok@ximian.com>

	* em-format.c (emf_application_xpkcs7mime): wrap code with
	ENABLE_SMIME instead of HAVE_NSS.
	(emf_multipart_signed): same.
	(type_builtin_table): same.

2004-02-19  Rodney Dawes  <dobey@ximian.com>

	* em-folder-tree.c (emft_save_state): Revert previous change, doh

2004-02-19  Rodney Dawes  <dobey@ximian.com>

	* em-folder-tree.c (emft_save_state): Don't set the timeout id to 0
	and then immediately return FALSE, which tries to remove the timeout

2004-02-19  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (get_receive_type): 
	* mail-config.c (mail_config_get_account_by_source_url) 
	(mail_config_get_account_by_transport_url): 
	* mail-component.c (mail_component_load_store_by_uri): 
	* mail-account-gui.c (mail_account_gui_setup) 
	(mail_account_gui_save): 
	* em-utils.c (em_utils_empty_trash, em_uri_from_camel): 
	* em-folder-tree-model.c (account_changed):
	* em-folder-selector.c (em_folder_selector_get_selected_uri): fix
	camel provider api changes.

2004-02-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-composer-prefs.c (sig_fill_list): Changed the name to not
	imply we are working with a GtkCList widget (since we are using a
	GtkTreeView).

	* em-folder-tree.c (emft_tree_button_press): Pass flags to
	em_popup_target_new_folder() instead of just an isstore arg.
	(emft_tree_button_press): Fake the fi flags for vTrash/vJunk so
	that em-popup.c can disable the delete flag for these.

	* em-popup.c (em_popup_target_new_folder): Instead of taking an
	isstore argument, take a flags argument so that our caller can
	give us hints about the selected folder/store. Also fixed a logic
	bug from my previous commit.

2004-02-12  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_tree_button_press): Updated for em-popup
	API change (altho currently passes a dummy value).

	* em-popup.c (em_popup_target_new_folder): Check for vTrash/vJunk
	by checking the CAMEL_FOLDER_VIRTUAL info flags bit. (perhaps this
	flag should be renamed to SPECIAL? VIRTUAL might not have been a
	good name). Also changed to check flags & CAMEL_FOLDER_NOSELECT
	rather than checking the uri string for a noselect param.

	* mail-folder-cache.c (unset_folder_info): Instead of checking for
	";noselect" in the uri, check for a CAMEL_FOLDER_NOSELECT flag on
	mfi->flags.
	(setup_folder): Copy the fi->flags to mfi->flags here.
	(rename_folders): Same.
	(setup_folder): Check fi->flags for CAMEL_FOLDER_NOSELECT here
	instead.
	(rename_folders): Same. Also gets rid of a FIXME.

2004-02-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	Revert change from yesterday.
	(efhd_xpkcs7mime_button): Use the icon from the table.

2004-02-18  Not Zed  <NotZed@Ximian.com>

	** See bug #54492.
	
	* em-folder-tree.c (emft_popup_copy_folder_selected): check the
	store flags, not the fragment presence to find out if we use the
	fragment as the path.

2004-02-17  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #54060 (except for the "don't let users copy/move
	messages to Outbox" bit).

	* em-folder-tree.c (emft_drop_target): Rearranged a little. We can
	check for special dest folders right away. Also added a check for
	the default local folders (Drafts/Inbox/Outbox/Sent) since we
	don't want to be able to move them anywhere else (copying is ok).
	(emft_popup_copy_folder_selected): Don't allow moving any of the
	default local folders to be consistant with drag&drop changes.
	(emft_popup_rename_folder): Don't allow the user to rename a
	default local folder.
	(emft_popup_delete_folder): Don't allow deletion of special local
	folders.

	* mail-component.c (mail_component_peek_local_store): New function
	to peek the local store.

2004-02-17  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	Display an alternate description based on the trust value if we
	have a trust to work with.

	* em-folder-browser.c (emfb_hide_deleted): Set the hide_deleted
	bool on EMFolderView.

	* em-folder-view.c (emfv_popup_delete): Fix Sarfraaz Ahmed's fix
	to only jump to the previous message if hide_deleted is
	set. Otherwise his fix gets extremely irritating.
	(emfv_list_key_press): Same.

2004-02-17  Not Zed  <NotZed@Ximian.com>

	** See bug #53914.

	* em-utils.c (guess_account): do some extra checks, message
	source, and source folder.
	(guess_account_folder): helper to guess account based on folder.

	** See bug #54200.

	* em-popup.c (em_popup_target_new_select): add
	EM_POPUP_SELECT_FOLDER - to find out if we have a folder at
	all.  Handle getting a NULL folder passed in.

	* em-folder-view.c (em_folder_view_get_popup_target): Added
	EM_FOLDER_VIEW_SELECT_FOLDER - to detect when we dont have a
	folder set on the emfolderview.

	* em-folder-browser.c (emfb_mark_all_read): if we don't have a
	folder, dont try and run.
	(emfb_enable_map[]): Disable a bunch of stuff we have no
	folder set.

	* importers/pine-importer.c (import_contact): fix for the
	weird-arsed e-contact list api.  and fix a small memleak.

2004-02-13  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_drop_folder): Make sure the drop-target
	folder doesn't already contain a folder named identical to the one
	we are dropping by using the new CAMEL_STORE_FOLDER_EXCL
	flag. Fixes bug #53810.

2004-02-13  Radek Doulik  <rodo@ximian.com>

	* evolution-mail.schemas.in.in: added defaults for composer
	width/height

2004-02-13  Sarfraaz Ahmed <asarfraaz@novell.com>

	* em-folder-view.c (emfv_popup_delete): added the code to get
	the previous mail in a list, if get_next_mail fails. This is a
	fix for #54195
	(emfv_list_key_press): Same as above

2004-02-13  Not Zed  <NotZed@Ximian.com>

	* importers/netscape-importer.c: use mail-importer to import the
	mail tree, fix the account stuff to talk directly to mail config.
	Added cancel button.  etc.  This is completely untested apart from
	compiling with no warnings.

	* importers/mail-importer.c (import_mbox_import): dont re-use the
	exception for syncing.

	* importers/evolution-outlook-importer.c: major reworking.  Some
	platform fixes, runs in another thread, simpler/cleaner main loop.
	This is completely untested apart from compiling with no warnings.

	* importers/evolution-mbox-importer.c (support_format_fn): we dont
	want to check the From_ line case insensitive!
	(create_control_fn): implement this weird api.

2004-02-12  Not Zed  <NotZed@Ximian.com>

	* importers/elm-importer.c: rewrote all importing stuff.

	* importers/mail-importer.c (mail_importer_import_folders_sync):
	split out into a recursive function & entry.  Now handles mozilla
	format stuff with a flag.
	(import_mbox_import): made the cameloperation properly
	save/restore multiple registrations.

2004-02-12  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (pipe_to_sa_with_error): use
	g_find_program_in_path to avoid fork in case program is not
	available

2004-02-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (mail_control_new): Disable the
	bonobo-ui-component statusbar when using the EMFolderBrowser
	outside of the mail component. This prevents the Connector
	component from having 2 status bars.

	* em-popup.c: #include <libgnomevfs/gnome-vfs-mime.h>
	(em_popup_create_menu): Wrap item->label with _() so
	that the strings get translated properly.

2004-02-11  Christian Neumair  <chris@gnome-de.org>

	* em-folder-tree-model.c (sort_cb): "On this Computer" -> "On This
	Computer".

	* mail-component.c (mc_setup_local_store): Ditto.

2004-02-11  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-print.c: Same.

	* em-junk-filter.c: #include <config.h>

	* em-popup.c: Add license & config.h

2004-02-11  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): if spamc is not
	available, try /usr/sbin/spamc

2004-02-10  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): try to check if system
	wide spamd has --local parameter set according to our setting
	(em_junk_sa_test_spamd): in case we were unable to start our own
	spamd, try to run it from /usr/sbin before giving up

2004-02-11  Not Zed  <NotZed@Ximian.com>

	* importers/mail-importer.c (mail_importer_import_folders_sync):
	call the right recursive function, oops.

	* importers/mail-importer.h: don't include camel-operation.h, but
	fix up the forward decl usage.

2004-02-11  JP Rosevear <jpr@ximian.com>

	* importers/mail-importer.h: include camel-operation.h

2004-02-11  Not Zed  <NotZed@Ximian.com>

	* importers/pine-importer.c: Basically rewrote this, the import
	tasks run in another thread.  It tells you more about what's going
	on, and its cancellable.
	(pine_store_settings): changed the meaning of the settings
	slightly, if set it means we've processed them already.

	* mail-component-factory.c (factory): hook in importer factory
	callback.

2004-02-10  Not Zed  <NotZed@Ximian.com>

	* importers/*-importer.c: removed module init, just provide a new
	method.  Updates for api changes.

	* Makefile.am: link mail importers in directly.

	* mail-importer.c: changed to do stuff in-memory with linked
	stuff, moved to importers/.

	* importers/GNOME_Evolution_Mail_Importers.server.in.in: merge all
	importer .server info's here, point them all to the mailer
	factory.  Removed the others.

	* importers/Makefile.am: remove Mailer.idl stuff.  Move all
	importers to a single library.

2004-02-09  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (tree_drag_data_delete): merged in code from
	em_folder_tree_model_drag_data_delete.
	(tree_drag_data_get): similar.
	(tree_drag_data_received): similar.
	(drag_text_uri_list): removed, use em_utils_selection_set_urilist
	in tree_drag_data_get instead.
	(em_folder_tree_enable_drag_and_drop): merged in
	em_folder_tree_model_set_drag_drop_types.
	(tree_drag_motion): merge in drop_possible, handle qualifiers, and
	return the right type.
	(em_folder_tree_model_row_drop_target): rename to
	emft_drop_target, and make private.  Beefed up substantially,
	handles illogical drops, dropping on to special folders and
	properly handling vfolder uri's (at least within the same tree
	instance).

	* em-folder-tree-model.c: Moved all of the DND stuff to
	em-folder-tree, where it belongs, made it all static.  Should
	allow for some sharing of code too.

	* em-format-quote.c (emfq_format_message): just print the \n after
	the credits in the same printf, rather than adding an else.  Add a
	<br> too, otherwise it has no effect.

2004-02-06  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html.c (efh_format_headers): Make private (only
	EMFormatHTMLQuote used it and that class is no longer in use).
	(efh_format_message): Updated for above change.

	* em-format-quote.c (emfq_format_message): Always write a \n after
	the credits line.

	* em-subscribe-editor.c (sub_folderinfo_get): Set the NO_VIRTUAL
	flag bit for get_folder_info(). Fixes bug #51887.

2004-02-06  Radek Doulik  <rodo@ximian.com>

	* em-folder-view.c (emfv_popup_mark_nojunk): move to the next
	message after mark not junk as well

	* em-junk-filter.c (em_junk_sa_test_spamd): split into
	spamassassin and spamd tests
	(em_junk_sa_is_available): test spamd only if spamd usage enabled
	(pipe_to_sa_with_error): extended pipe_to_sa, last added parametr
	specifies return value if an error occured
	(em_junk_sa_check_junk): don't use /bin/sh -c when running
	spamassassin, it's not needed and we need to avoid getting 126,127
	exit codes from the shell
	(em_junk_sa_check_junk): pass 0 rv_err to pipe_to_sa_with_error to
	avoid false positives in case someone removes/uninstalls SA while
	evolution runs

2004-02-06  Not Zed  <NotZed@Ximian.com>

	** See bug #53258.

	* em-format-html-display.c (efhd_find_handler): force any bonobo
	handler types to always be inline, even attachments.

	* em-format.c (em_format_is_inline): use handler flags for special
	cases, removing all hard-coded types.

	* em-format.h (EMFormatHandler): add a flags field, so far a flag
	to set default inline viewing of the content.

2004-02-06  Not Zed  <NotZed@Ximian.com>

	* em-folder-properties.c: include string.h to kill warning.

	** See bug #53627.
	
	* em-folder-view.c (emfv_popup_mark_junk): changed to work like
	delete does, jumping to the next message if required, and marking
	things immediately, then queuing up the junk marking job if
	required.

	* mail-ops.c (mail_mark_junk): ugh, this stuff totally can't go
	accessing messagelist from another thread!!!!  Changed so this
	code only does the junk reporting, not setting flags.  UGH!  It
	should be doing this implictly on the folder when you set the
	flags, or at least when you sync the folder!!!  Changed ot use the
	queued thread.

	* message-list.c (find_next_undeleted): changed to find
	next-unhidden, i.e. junk as well as deleted, if we're in
	hide-deleted mode.
	(build_tree): always call find_next_undeleted if we have a cursor.
	(build_flat): same.

2004-02-05  Rodney Dawes  <dobey@ximian.com>

	* em-message-browser.c (emmb_list_message_selected): Grab focus on
	the HTML widget when we display

	Fixes #52942

2004-02-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-message-browser.c (emmb_list_message_selected): Set the new
	title.
	(em_message_browser_window_new): Connect to the message_selected
	signal in the message-list widget. Fixes bug #52232.

	* em-folder-tree-model.c (em_folder_tree_model_row_drop_target):
	Now takes a GdkContext arg... will need this later when we want to
	re-enable dnd of vfolders.

	* em-folder-browser.c (emfb_set_folder): Always set the
	search_state, even if it is NULL (NULL means default/unset state).

	* em-folder-view.c (emfv_mail_next_flagged): Pass TRUE as
	wraparound (to both be consistant with prev_flagged and to fix bug
	#48681.

2004-02-05  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_copy_folders__copy): sync the from folder
	if we're going to delete it, otherwise we can't because its not
	empty.  See #53815.

2004-02-05  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree-model.c
	(em_folder_tree_model_drag_data_received): hmm, another well
	tested bit of code ... if you launch another thread you gotta copy
	the selection since it wont hang around until we're done with it.
	So copy/parse the selection data into appropriate structures.
	(drop_folder): just take the async message as an argument, rather
	than copying half of it to the stack.
	(drop_text_uri_list, drop_uid_list): replace most args with the
	thread message.
	(drop_message_rfc822): removed, now trivial.
	(emftm_drag_data_received_async__drop): change for changed args,
	and fix a memleak.
	(emftm_drag_data_received_async__free): fixed for changed
	structure.

	* em-folder-tree.c (em_folder_tree_create_folder): call abort
	before we unref, aid debugging if we hit it.

	* mail-vfolder.c (uri_is_spethal): check for vfolder/vtrash
	folders.  Based on name check and store options.

2004-02-04  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (em_folder_tree_model_row_drop_target):
	Don't allow dropping into a vfolder (store). Fixes bug #53757.

2004-02-04  Not Zed  <NotZed@Ximian.com>

	** See bug #53683.

	* mail-ops.c (mail_sync_store): new async op to call
	CamelStore::sync.

	* mail-component.c (impl_requestQuit): implement, check to see if
	we can quit, or have open or unsent messages (and are in online
	mode).
	(impl_quit): implement.  Trigger off a sync of all open stores,
	and return FALSE until its done.
	(impl_upgradeFromVersion): fixed the signature to match the idl,
	killed that warning at last.

	** See bug #53832.

	* em-folder-browser.c (emfb_folder_properties): only show this if
	we have a uri set.  Strictly, the menu item shouldn't be
	activated.

	** See bug #53131.
	
	* em-folder-browser.c (em_folder_browser_show_preview): copy the
	message list's cursor_uid before calling set_message, since it can
	get freed during setting the message.

2004-02-03  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (tree_drag_data_received): Modified
	slightly. The model now calls gtk_drag_finish() for us when it is
	done.

	* em-folder-tree-model.c
	(em_folder_tree_model_drag_data_received): Make this perform camel
	operations in another thread so we don't block.
	(em_folder_tree_model_drag_data_get): Updated args to be
	consistant with drag_data_received.

2004-02-03  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c: handle the sa prefs here, have own gconf
	client with sa dir added

	* mail-session.c: removed sa prefs

2004-02-02  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #52941

	* em-message-browser.c (em_message_browser_window_new): Set window
	size based on previous size; load from gconf if necessary.
	(window_size_allocate): Save window size changes.

2004-02-02  Not Zed  <NotZed@Ximian.com>

	** See bug #53549.

	* em-folder-selector.c: Fix handling a parent path of "/".

	* mail-ops.c (mark_junk_mark): removed the really innacurate cut and
	paste comment.  This has nothing to do with filter_folder.

	** See bug #52994.

	* em-folder-properties.c (em_folder_properties_show): redirect
	vFolder uri's to the vFolder editor.

	** See bug #53502.

	* em-folder-browser.c (emfb_folder_properties): implement.

	* em-folder-tree.c (emft_popup_properties): fixed for change
	below.

	* em-folder-properties.[ch]: Moved the folder properties window
	from em-folder-tree.c to its own file.

2004-02-02  Not Zed  <NotZed@Ximian.com>

	** See bug #53559.

	* em-folder-tree.c (folder_tree_new): set CAN_FOCUS flag on the
	folder tree content widget.

	* em-folder-selector.c (em_folder_selector_construct): Don't wrap
	the folder tree in a scrolled window.  Its already in one ????.
	(em_folder_selector_construct): dont set can_focus on the folder
	tree.

2004-02-01  Bill Zhu <bill.zhu@sun.com>

	Fixes for bug #53530

	* em-utils.c (em_utils_redirect_message): Removed the duplicate 
	adding of attachments

2004-01-30  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes for bug #53348

	* mail-account-gui.c (mail_account_gui_save): Only add the new
	store to the mail-component if the mail-component doesn't already
	know about it (ie. only if we are adding a new account).

	* em-folder-tree-model.c (em_folder_tree_model_add_store): Hash
	our store-info based on account here.
	(em_folder_tree_model_init): Listen for
	account_changed/account_removed signals.
	(em_folder_tree_model_finalize): Disconnect above handlers.
	(account_changed): Tear down the account store node and replace it
	with the new store (assuming it belongs in the tree after the
	changes).
	(account_removed): Remove the account store from the tree.

2004-01-30  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_tree_row_expanded): Get recursive folder
	listing (needed or folders that have as-of-yet-unloaded-subfolders
	that contain unread mail will not be bolded). Fixes bug #51045.

	Fix for bug #53195.

	* em-folder-browser.c (emfb_set_folder): Restore search_state.
	(emfb_search_search_activated): Save search_state.

2004-01-30  Not Zed  <NotZed@Ximian.com>

	** See bug #53549, partial fix.

	* em-folder-selector.c (emfs_create_name_activate): only emit the
	ok response if the ok button would be active (i.e. entered a valid
	path).

	** See bug #52992.

	* message-list.c (message_list_hide_clear): save the hide state
	after its been cleared, so any popup windows inherit it.
	(message_list_hide_uids): same.

	** See bug #53123.

	* em-folder-tree-model.c (drop_folder): changed to take store and
	dest folder as arg, to handle the case of the parent folder being
	"" properly.
	(em_folder_tree_model_drag_data_received): special case dropping a
	folder, and don't allow dropping to "" for any other types.

2004-01-30  Not Zed  <NotZed@Ximian.com>

	** See bug #53558 (plus other fixes/cleanups)

	* em-format.c (emf_format_secure): default implementation, handle
	output of inner part, but dont output any sign/encrypt info.
	(emf_multipart_signed, emf_multipart_encrypted): replaced with
	implementations from em-format-html.c, which now call
	em_format_format_secure to output guts.
	(emf_class_init): hook-up virtual method format_secure.

	* em-format.[ch]: add a virtual method for outputing secured
	parts.  Moved all validity stuff from em-format-html.[ch] to here.

	* mail-component.c (impl_createControls): set the session
	interactive too.

	* em-format-html-display.c: make smime stuff dependent on
	HAVE_NSS.
	(efhd_multipart_signed, efhd_application_xpkcs7mime): removed, now
	handled by root class.
	(efhd_output_secure): renamed to efhd_format_secure, and use
	EMFormat::format_secure to kick off.
	(efhd_class_init): setup format_secure virtual method.

	* em-format-html.c (efh_multipart_encrypted): We need to handle
	this here so we can properly keep track of the ciphervalidity
	stuff.  Also do it directly using the context, not
	multipartencrypted part.
	(efh_multipart_signed): with unsupported signature format, format
	as multipart/mixed, not as an attachment.
	(efh_multipart_signed): make the smime stuff optional.
	(efh_multipart_signed, efh_multipart_encrypted): Moved to
	em-format.c.
	(efh_application_xpkcs7mime): moved to em-format.c
	(efh_output_secure): renamed to efh_format_secure, linked into
	virtual method.  call parent class to do the validation foo then
	output the info if needed.
	(efh_format_message): fixed access to validity stuff to parent
	object.
	(efh_class_init): hook up format_secure virtual method.
	(*): removed some now-unused headers.

2004-01-29  Nicel KM  <mnicel@novell.com>

	* mail-component.c: removed CAMEL_PROVIDER_IS_EXTERNAL check
	* mail-account-gui.c: likewise
	* mail-offline-handler.c: likewise	

2004-01-29  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_attachment_button): check the
	snooped type for the icon/etc.
	(efhd_format_attachment): save the snooped type in the
	attach_puri.

	* em-format-html.c (efh_text_plain): If we had a snooped type, use
	that as the base type, rather than octet-stream, which will cause
	an attachment in attachment loop.

	* em-format.c (em_format_part_as): save the current snooped mime
	type in a stack if we had any.

2004-01-29  Not Zed  <NotZed@Ximian.com>

	** See bug #53320 and probably others

	* message-list.c (message_list_set_folder): NULL out
	message_list->folder when we clear it so it isn't left for another
	free when we switch again.

2004-01-29  Not Zed  <NotZed@Ximian.com>

	** See bug #52190.

	* message-list.c: Added folder/folder uri to the data stored for
	primary/secondary selection, uses a struct to store the data now.
	This is needed so when you cut/copy messages, and paste them, it
	doesn't end up 'pasting' the messages from the current folder, but
	from the one where the copy/cut took place.
	(clear_selection): helper to free data inside selection struct.

2004-01-29  Not Zed  <NotZed@Ximian.com>

	** See bug #53506.

	* mail-tools.c (mail_tools_folder_to_url): use a camelurl to do
	this properly, and handle fragment folder-paths.

	* em-composer-utils.c (em_utils_composer_send_cb): removed
	outbox_folder local, not necessary.

2004-01-28  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (em_folder_tree_model_add_store): If the
	store is already in the model, remove it and then re-add it. Fixes
	bug #53422.

2004-01-28  Jeffrey Stedfast  <fejj@ximian.com>

	And thus completes the fixes for bug #52766.

	* em-folder-tree.c (tree_drag_drop): Don't call
	gtk_drag_get_data() manually here or we end up getting 2
	drag-data-received callbacks which is Not Good (tm).

	* em-folder-tree-model.c (drop_folder): Now takes a moved argument
	to specify whether or not the contents were moved (the move
	argument is just a hint).
	(drop_uid_list): Same.
	(em_folder_tree_model_drag_data_received): Updated for the above
	api changes.

2004-01-28  Not Zed  <NotZed@Ximian.com>

	** See bug #53179

	* mail-tools.c (mail_tool_get_local_movemail_path): Fix the
	movemail path.

	* mail-component.c (load_accounts): hack alert!
	* mail-send-recv.c (get_receive_type): hack alert!  hardcode mbox:
	to be a movemail source.

2004-01-28  Not Zed  <NotZed@Ximian.com>

	* mail-send-recv.c (setup_send_data): ref folder from
	mail_component_get_folder.

	* mail-ops.c (fetch_mail_fetch): ref the folder we get from
	mail_component_get_folder since it doesn't ref it.

2004-01-27  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (cp): Removed unneeded debug printfs.

	* em-folder-tree.c (tree_drag_data_received): Use
	gtk_tree_view_get_dest_row_at_pos() instead of
	gtk_tree_view_get_path_at_pos() since this is what Nautilus
	uses. Unfortunately, it still gives us back the wrong GtkTreePath
	so it looks to me like Gtk+ is borked. Apparently you need the
	latest and greatest gtk+-2.3.x cvs snapshot for this to work.

	* em-migrate.c (em_migrate_imap_caches_1_4): Copy the imap cache
	into the right place. Duh.

2004-01-27  Not Zed  <NotZed@Ximian.com>

	** See bug #53084 and others.
	
	* em-migrate.c (em_migrate): remove the vfolder_revert hack.

	* em-composer-utils.c (ask_confirm_for_only_bcc): removed unused
	vars.

	* mail-tools.c (mail_tool_get_local_inbox): removed, handled by
	mail_component_get_folder now.

	* mail-component.c (mail_component_*): Changed the api slightly.
	Using NULL as the component argument automatically implies you
	want the default component.
	(em_uri_from_camel, em_uri_to_camel): moved to em-utils.[ch].  Ok
	so it isn't namespaced right ... *shrug*.
	(mail_component_get_local_inbox): removed.
	(mail_component_get_folder): single entry point for getting
	standard folders.  This is MT-Safe.
	(mail_component_get_folder_uri): single entry point for getting
	standard folder uri's.  This is MT-Safe.
	(add_store): removed, moved to mail_component_add_store.
	(mail_component_load_store_by_uri): call mail_component_add_store
	directly rather than copying its code.
	(default_*_folder*): Removed, use accessor methods instead, fixed
	all callers.
	(setup_local_store): renamed to mc_setup_local_store, use proper
	url encoding too.  make run-once and thread-safe.
	(MailComponentPrivate): Added a lock.
	(mail_control_new): exported properly to kill warnings.
	(mail_component_init): dont setup_local_store or add accounts
	here.
	(impl_createControls): setup local store/accounts here.
	(mail_component_peek): dont setup vfolder storage here.
	(mc_startup): internal function to startup stuff needed for gui
	operation.
	(setup_search_context): make run-once.
	(mail_component_peek_search_context): call setup_search_context
	incase it isn't setup yet.
	(impl_upgradeFromVersion): remove the local store setup hack.

2004-01-27  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree-model.c (folder_renamed): fix the parent-finding
	logic.

2004-01-23  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mail_component_init): add the offline handler
	interface to the component.
	(store_go_online, go_online): removed, handled by the offline
	handler.

	* mail-offline-handler.c (store_go_online): add the store to the
	tree model when we go online.

2004-01-26  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes for bug #53251.

	* mail-account-gui.c (mail_account_gui_new): Convert the account
	drafts/sent folder uris to camel uris.
	(mail_account_gui_save): Convert drafts/sent camel uris into
	mailer uris when setting them on the account. Also, don't compare
	against file: anymore since those uris don't exist anymore.

	* em-migrate.c (em_upgrade_accounts_1_4): Update the drafts/sent
	folder uris.

2004-01-26  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (tree_drag_begin): Set priv->drag_row.

2004-01-26 Aaron Weber <aaron@ximian.com>

	* mail/default/C/Inbox: edited default message

2004-01-26  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_copy_folders__copy): Use FOLDER_INFO_FAST
	bitflag here, since we don't care about unread counts when copying
	folders around.
	(emft_popup_delete_folders): Same.
	(emft_tree_row_expanded): Don't use FOLDER_INFO_FAST here.

2004-01-26  Radek Doulik  <rodo@ximian.com>

	* mail-session.c (main_get_filter_driver): translate DEMAND to
	INCOMING to get the right rules

	* mail-ops.c (mail_filter_on_demand): use FILTER_SOURCE_DEMAND

	Fixes #53266

2004-01-25  Rodney Dawes  <dobey@ximian.com>

	* em-folder-selector.c (em_folder_selector_create_new): Cast the
	name entry to a GtkWidget to avoid a compiler warning
	* em-folder-tree.c (emft_popup_new_folder): Grab focus on the name
	entry when we show the dialog (#53089)

	Fixes #53089

2004-01-23  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (em_folder_tree_model_get_type): Removed
	the drag & drop interfaces, apparently these aren't good enough
	for what we need. Gotta implement this all the Hard Way (tm).
	(em_folder_tree_model_drag_data_received): Helper function called
	by the drag_data_received signal callback in em-folder-tree.c
	(em_folder_tree_model_row_drop_possible): Same idea.
	(em_folder_tree_model_row_drop_target): Again.
	(em_folder_tree_model_row_draggable): You get the idea...
	(em_folder_tree_model_drag_data_get): And again.
	(em_folder_tree_model_drag_data_delete): Same.
	(em_folder_tree_model_set_drag_drop_types): Setup the drag & drop
	types on the widget (since the target drag & drop types are now
	internal to the model code rathr than the tree code).

	* em-folder-tree.c (em_folder_tree_enable_drag_and_drop):
	Rewritten. Connect to all the drag & drop signals and implemnent
	them.

2004-01-23  Larry Ewing  <lewing@ximian.com>

	* mail-component-factory.c (factory): add the control id to the
	factory.

2004-01-23  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (upgrade_xml_uris_1_4): Handle where the file: url
	is roken (ie, points to a location out of the evolution
	namespace).

2004-01-23  Rodney Dawes  <dobey@ximian.com>

	* em-folder-selector.c: Set the mnemonic widget for "Folder _name:"

	Fixes #53088

2004-01-23  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c: use mail_session_get_sa_daemon_port

	* em-mailer-prefs.c (em_mailer_prefs_construct): added
	check_incoming_imap
	(em_mailer_prefs_apply): ditto
	(settings_changed): set check_incoming_imap sensitivity by
	check_incoming state

	* mail-session.c: add sa_daemon_port
	(mail_session_init): init sa_daemon_port and check_junk_for_imap
	(mail_session_check_junk_notify): watch for sa_daemon_port and
	check_junk_for_imap
	(mail_session_get_sa_daemon_port): new wrapper
	(mail_session_set_sa_daemon_port): ditto

2004-01-22  Jeffrey Stedfast  <fejj@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): Oops, when calling
	spamassassin rather than spamc, we need to invoke /bin/sh -c
	since spamassassin is a shell script.
	(em_junk_sa_check_junk): Same.

	Fixes bug #53175.

	* em-junk-filter.c (pipe_to_sa): Don't need an argc (we don't even
	seem to use it??).
	(em_junk_sa_test_spamd_running): Don't invoke /bin/sh.
	(em_junk_sa_test_spamd): Simplified, also don't invoke /bin/sh.
	(em_junk_sa_check_junk): Cleaned up/simplified. Also don't invoke
	/bin/sh.
	(em_junk_sa_report_junk): Same.
	(em_junk_sa_report_notjunk): Same.
	(em_junk_sa_commit_reports): Same.

2004-01-22 Gary Ekker <gekker@novell.com>

	** See bug #53051
	
	* em-subscribe-editor.c (subscribe_set_store): fix typo in label

2004-01-22  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_test_spamd): uncomment system wide
	spamd test

2004-01-20  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c: lock report calls by em_junk_sa_report_lock
	mutex

2004-01-21  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_1_4): Migrate the ETree expanded state
	files as well as the GalView files.

	* message-list.c: s/hide_save_state/save_hide_state/g and
	s/hide_load_state/load_hide_state/g to be more consistant with the
	other state saving function names.

2004-01-21  Not Zed  <NotZed@Ximian.com>

	* em-migrate.c (cp_r): use camel_mkdir(0777) rather than 0777 &
	st.st_mode which isn't set anyway.
	(cp): use simple 0666 for the mode open, and then chmod after.
	(cp): check the return code of close, not just fsync.
	(cp): dont use fd[0] and fd[1] when we really just want simple
	variables, rename to readfd and writefd.

	** See bug #53159.

	* em-format.c (emf_message_rfc822): removed incorrect comment,
	this is not a fallback.

	* em-format-html.c (efh_text_plain): check the content-type of the
	containee object, not the holder.

	** See bug #52979.

	* em-format-html.c: take out text/x-patch and put in text/* for a
	text/plain fallback handler instead.

	* em-format-html-display.c (efhd_find_handler): allow the bonobo
	handlers to override the builtin ones.

2004-01-20  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_imap_caches_1_4): New function to
	migrate the imap cache.
	(em_migrate_1_4): Migrate the IMAP cache. Fixes bug #52985.
	(em_migrate_1_4): Copy over the searches.xml file. Fixes bug
	#52980.

	* mail-session.c (request_password): Changed the logic of the
	visibility of the passwd text so that we hid ethe passwd if the
	flags have the SECRET bit set.

2004-01-20  Not Zed  <NotZed@Ximian.com>

	** See Bug #52817.
	
	* mail-session.c (request_password, do_get_pass, get_password):
	Fix for api changes to camel_session_get_password.
	(request_password): if we have a STATIC password, don't show any
	'remember' checkbox.

2004-01-20  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (EMFolderView): Make displayed_uid public.

	* em-folder-browser.c (em_folder_browser_show_preview): use
	em_folder_view_set_message rather than message_list_select_uid.
	When clearing, clear view->displayed_uid too.

2004-01-20  Not Zed  <NotZed@Ximian.com>

	** See bug #52965.

	* mail-component.c (mail_component_init): removed an epfixme, it
	already is an object.
	(impl_upgradeFromVersion): call mail_note_store after running the
	upgrade for local folders.

	* em-migrate.c (em_migrate): revert the vfolders.xml after we've
	imported them.

	* mail-vfolder.c (vfolder_revert): new api to re-load the vfolders
	file.

	** See bug #52885.

	* em-folder-browser.c (emfb_create_view_menus): unref the view
	instance/menu's rather than asserting, if they exist.
	(emfb_set_folder): call create_view_menu's rather than
	create_view_instance, so the view menu's are properly setup.
	(emfb_set_folder): call superclass first.

	** See bug #53028.

	* message-list.c (on_selection_changed_cmd): emit the
	cursor_activated if more than 1 item is selected also.

2004-01-20  Not Zed  <NotZed@Ximian.com>

	** See bug #52990.

	* mail-component.c (mail_component_init): re-enable auto-send-recv
	setup.

	** See bug #52989.

	* message-list.c (hide_load_state): clear the hidden table if
	setup, before loading.

2004-01-19  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (MAIL_CONFIG_RC_DIR): path to gtkhtml's rc file
	(config_write_style): use MAIL_CONFIG_RC_DIR
	(mail_config_init): ditto

	see http://bugzilla.ximian.com/show_bug.cgi?id=52969

2004-01-19  Not Zed  <NotZed@Ximian.com>

	* mail-ops.c (add_vjunk_info, add_vtrash_info): removed this like
	i asked radek to ages ago, just call the parent directly.
	(add_vtrash_or_vjunk_info): renamed to something saner.
	add_special_info.
	(add_special_info): removed the 'unread count' parameter & return
	the added info.

	** See bug #52854.

	* em-folder-tree.c (emft_tree_button_press): setup a FOLDER target
	for the popup menu.

	* em-popup.c (em_popup_target_free): implement free for
	TARGET_FOLDER, changed the target options somewhat.
	(em_popup_target_new_folder): implement folder selection target.
	Total Hack(tm) alert.
	(emp_standard_menu_factory): removed the stupid
	g_assert_if_not_reached() call.

	* message-list.c (message_list_destroy): NULL out the uid_nodemap
	when we destroy it.

2004-01-19  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_folder_expunge): get the toplevel
	widget here too, similar to bug 52161.

	** See bug #52956

	* em-composer-prefs.c (sig_edit_cb): The
	fileentry_add_script_script widget is a GnomeFileEntry not a
	GtkEntry.
	(sig_add_script_response): use get_full_path rather than snooping
	the gtkentry.  Also, don't close/quit the script dialogue on a bad
	name.

2004-01-19  Not Zed  <NotZed@Ximian.com>

	* em-migrate.c (em_upgrade_pop_uid_caches_1_4): if we can't open
	the pop3 cache dir, because it doesn't exist, it is not an error.

	** See bug #52983.

	* mail-component.c (em_uri_from_camel, em_uri_to_camel): Handle
	vfolder: uri's properly.  And make sure local uri's are properly
	encoded.
	(mail_component_get_folder_from_evomail_uri)
	(mail_component_evomail_uri_from_folder): removed, no longer used.
	(em_uri_from_camel): don't leak the camelurl.
	(d): disable debug

	* mail-vfolder.c (vfolder_load_storage): move the vfolder storage
	location to ~/.evolution/mail/vfolder rather than
	~/.evolution/mail (this is currently unused anyway).
	(uri_is_ignore): short-circuit exit if we find a match.
	(mail_vfolder_add_uri): dont exit immediately if we have a vfolder
	uri, but don't add it to local/remove either.
	(mail_vfolder_delete_uri): remove any uri from the local/remote
	source list while we're at it.

2004-01-19  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_on_url_cb): properly decode the mailto
	url rather than treating it as a simple string.

	* em-format-html.c (efh_format_address): if we have a name part,
	add it to the mailto part.  As per rfc2368.  So it isn't lost for
	clicking/etc.

2004-01-16  JP Rosevear <jpr@ximian.com>

	* em-format-html-display.c (efhd_bonobo_object): pass in an
	exception to use

2004-01-16  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html.c (efh_format_address): Dump a struct
	_camel_header_address to an html string.
	(efh_format_header): Use efh_format_address() and set the
	EM_FORMAT_HTML_HEADER_HTML bit on the flags so we don't re-convert
	our html string into html.

	* mail-vfolder.c (mail_vfolder_rename_uri): s/g_fre/g_free/

	* em-utils.c (guess_account): Change 'tmp' to not be const - fixes
	a compile warning.
	(em_utils_expunge_folder): Cast parent to a GtkWindow.
	(em_utils_empty_trash): Same.

	* em-migrate.c (cp): Oops, still need to stat() the src file so we
	can report what percentage of the file has been completed so far
	and also so we don't quit copying until we've copied the whole
	file.

	* message-list.c (message_list_set_folder): Move
	'message_list->folder = folder;' out of the uri compare if-block
	and move it into the if-block that tests that folder != NULL.
	(regen_list_regen): Abort if the regen folder is not the same as
	the ml->folder.

2004-01-16  Not Zed  <NotZed@Ximian.com>

	* mail-folder-cache.c (storeinfo_find_folder_info): change this to
	check the store using the provider url_cmp and just lookup the
	folder name directly.  folder_compare can't be used for uri's,
	this stuff was so broken, my fault :(

	** See bug #52467.

	* em-folder-tree-model.c (sort_cb): handle null path (root?).

	* mail-vfolder.c (mail_vfolder_add_uri): map uri to euri before
	processing.
	(rule_changed): map uri to camel uri before looking up.
	(mail_vfolder_delete_uri): handle as euri internally.
	(mail_vfolder_rename_uri): "

	* mail-autofilter.c (vfolder_rule_from_message): map camel uri to
	euri before setting as vfolder source.

2004-01-16  Not Zed  <NotZed@Ximian.com>

	* default/C/Inbox: 
	* default/C/Makefile.am: 
	* default/Makefile.am: Startup files/folders.

	* em-migrate.c (emm_setup_initial): initial implementation of
	startup setup.

	** See bug #52896.

	* em-format-html-display.c (efhd_html_button_press_event): do this
	based on get_object_at rather than get_point_at, so we get the
	offset properly.

2004-01-15  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vfolder.c: Make vfolder_store 'global'.

	* em-folder-tree-model.c (sort_cb): Fix bug #12600 by not sorting
	VFolders (ie. show them in the same order they appear in the
	editor).

	Fixes bug #52888
	
	* em-folder-tree-model.c (sort_cb): New sort function for the
	folder-tree.
	(em_folder_tree_model_init): Set the default sort func.
	(em_folder_tree_model_new): Set the default sort column.

	* em-folder-browser.c (emfb_list_built): Don't select the first
	unread mesg in the case where no mesg was previously
	selected. Fixes bug #52887 until we are able to add a user
	preference (for 2.2?).

	* em-migrate.c (cp): Only abort the copy if the dest folder both
	exists and contains data. Fixes bug #52880.
	(em_migrate): Abort if config.xmldb cannot be loaded. Fixes bug
	#52886.

2004-01-15  Rodrigo Moya <rodrigo@ximian.com>

	* em-folder-browser.c: removed ForgetPasswords verb.
	(emfb_forget_passwords): removed.

2004-01-15  Not Zed  <NotZed@Ximian.com>

	** See bug #52891.

	* em-format-html.c (em_format_html_get_type): protect against http
	cache not being able to be created.

	** See bug #52878.

	* em-folder-view.c (emfv_finalise): unhook message_changed too.
	(emfv_set_folder): hook/unhook message_changed too.
	(emfv_message_changed): implement, proxy to folder_changed.

2004-01-15  Not Zed  <NotZed@Ximian.com>

	** See bugs #51609 and #43515.

	* em-format-html-display.c (efhd_format_prefix): output flag for
	followup details above the message.
	(efhd_write_image): added to output icon data.

	* em-format-html.c (efh_format_do): call format_prefix before
	outputting the message in normal display mode.

	* em-format.c (emf_format_prefix): method called to format data
	before the first message output.  Default impl == noop.

2004-01-14  Jeremy Katz  <katzj@redhat.com>

	* evolution-mail.schemas.in.in: Add a description for 
	/apps/evolution/mail/junk/sa/local_only.

2004-01-14  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c: Split out the remapping code into
	e-util/e-bconf-map.[c,h] to be shared among components.

2004-01-13  Ross Burton  <ross@burtonini.com>

	* em-folder-browser.c (emfb_empty_trash):
	Pass the parent window, fixing a crasher.  Bug #52161.

2004-01-14  Not Zed  <NotZed@Ximian.com>

	** See bug 51660.
	
	* em-format-html-quote.c (efhq_multipart_related): setup part_id
	appropriately.

	* em-format-html-display.c (efhd_output_secure): use part_id in
	classid, and add .signed to part_id for subpart.
	(efhd_bonobo_unknown): use part_id in classid.
	(efhd_format_attachment): use part_id in classid's.

	* em-format-html.c (efh_multipart_related)
	(emfh_multipart_related_check): setup part_id for each subpart.
	(efh_output_secure): as above, and use the part_id for the
	classid.
	(em_format_html_add_pobject): use part_id for a generated classid.
	(efh_text_plain): setup pseudo-parts into part_id.

	* em-format.c (emf_format_clone): setup the part_id base, folder +
	uid.
	(emf_finalise): free the part_id gstring.
	(emf_init): allocate the part_id gstring.
	(em_format_add_puri): build the cid from the part_id rather than
	an arbitrary number, so it is more persistent.  Also save the
	part_id in the puri for multipart/related use.
	(emf_multipart_mixed, emf_multipart_alternative)
	(emf_multipart_appledouble, emf_multipart_encrypted)
	(emf_multipart_related, emf_multipart_signed): Set the part_id for
	each subpart.
	(emf_clear_puri_node): free part_id.

2004-01-13  Not Zed  <NotZed@Ximian.com>

	** See bug 51660.

	* em-format-html-print.c (em_format_html_print_print): dont take
	message, get the message from the source formatter.

	* em-format.c (emf_format_clone): Added folder and uid parameters,
	changed camelmedium to a mimemessage.

	* em-format-html-display.c (efhd_attachment_button): check the
	icon image cache and if the image is there use it.

	* em-icon-stream.c (em_icon_stream_get_image): api to lookup
	finished images in cache.
	(em_icon_stream_new): add a cache key arg.
	(emis_sync_close): store the image in the cache once its
	completed.

2004-01-13  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate): Handle upgrading from 1.0.x and 1.2.x
	(code basically moved verbatim from e_config_upgrade).

	* mail-component.c (impl_upgradeFromVersion): Move all the
	major/minor/revision logic into em_migrate().

2004-01-12  Meilof Veeningen  <meilof@wanadoo.nl>

	* em-composer-utils.c: support for posting both to mail and to
	(multiple) folders

	* em-folder-browser.c: use em_utils_post_to_folder (works with NNTP)

	* em-folder-selection-button.[ch]: added multiple selection mode

	* em-folder-selector.[ch]: idem

	* em-folder-tree.[ch]: added multiple selection mode, no longer show
	disabled accounts

	* em-utils.c: various changes to allow posting to (multiple) folders

	* em-subscribe-editor.c: double-clicking a node in the editor updates
	it directly

	* mail-ops.c: for appending messages, set the "X-Mailer" header

2004-01-12  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_check_junk): use
	mail_session_get_sa_use_daemon

	* mail-session.c: added SA prefs
	(mail_session_get_sa_local_only): new helper method
	(mail_session_set_sa_local_only): ditto
	(mail_session_get_sa_use_daemon): ditto
	(mail_session_set_sa_use_daemon): ditto
	(mail_session_check_junk_notify): fix the key comparison
	(mail_session_init): add gconf dir so that we get notified

	* mail-config.glade: added SA preferences

	* em-mailer-prefs.c (em_mailer_prefs_construct): added more junk
	prefs
	(em_mailer_prefs_apply): ditto

	* em-junk-filter.c: use preferences

2004-01-12  Larry Ewing  <lewing@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: fix up the controls factory
	location.

	* mail-component.c (mail_control_new): add new interface for
	getting a mail control with a folder_uri property bag.
	(get_prop): pbag get method.
	(set_prop): pbag set method.

2004-01-11  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (cp): Don't O_TRUNC the dest file, instead use
	O_EXCL and don't do anything if the dest file already exists (this
	way we don't re-migrate an mbox or corrupt any summary/ibex/meta
	files).

2004-01-12  Not Zed  <NotZed@Ximian.com>

	** See bug 52737.

	* em-format-html.c (efh_text_plain): treat text/* as inline
	content from the made-up multipart.

2004-01-09  Not Zed  <NotZed@Ximian.com>

	** See bug 52696.
	
	* mail-component.c (setup_search_context): move the searches to
	~/.evolution/mail/searches.xml (migration?).
	(setup_search_context): fix a merge error,
	vfoldertypes.xml->searchtypes.xml since it includes the system
	searches now.

2004-01-09  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (emft_popup_properties_got_folder): add total +
	unread counts to properties page.

	* em-utils.c (filter_editor_response):
	* mail-vfolder.c (vfolder_editor_response): change for rule editor
	changes, ACCEPT->OK.

2004-01-09  Not Zed  <NotZed@Ximian.com>

	* em-format.c (em_format_format_text): keep the windows charset
	filter around until we're done since if we set it up we reference
	its memory.  Causes warnings and breaks message display.

	** See bug #52637.
	
	* em-inline-filter.c (em_inline_filter_new): added a content-type
	paramter for the base content type.
	(em_inline_filter_finalize): free base content type.
	(emif_types[]): Added 'plain' parameter, indicates type needs
	plain parameters set on content type.
	(emif_add_part): inherit the full base type if it is set, for
	plain parts.

	* em-format-html.c (efh_text_plain): pass the part's content-type
	to the inline filter.

2004-01-08  Not Zed  <NotZed@Ximian.com>

	** See bug #50786
	
	* GNOME_Evolution_Mail.server.in.in: Remove :: from startup wizard
	iid, and put the mail wizard into the right factory.

	* mail-component.c (impl_requestCreateItem, impl_handleURI): 
	* em-folder-browser.c (emfb_mail_compose): check we have an
	account before trying to send mail.

2004-01-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (mail_component_init): Don't migrate stuff here
	anymore.

	* mail-ops.c (uid_cachename_hack): Removed a hack that checked for
	the really old uid cache location and make the uid cache live in a
	better location (why have mail/pop/<account> and
	mail/pop3/cache-<account>? simply put the cache file in
	mail/pop/<account>/uid-cache).

	* em-migrate.c (em_migrate_dir): When copying over mbox folders,
	don't abort if we fail to copy over a summary file (big
	whoop). Also, if indexing was turned on in the evolution 1.4
	version of the folder, turn on indexing for that folder in the
	migrated mbox folder as well.
	(em_migrate_pop_uid_caches): Migrate the pop3 uid-cache
	files. Fixes bug #52464.
	(em_migrate): Call em_migrate_pop_uid_caches().

	* em-format-html.c (efh_format_address): Removed.
	(efh_format_header): Handle address formatting a little
	differently to address dwmw's complaints. Also now handles other
	headers such as Resent-* and Sender as well.

2004-01-07  Radek Doulik  <rodo@ximian.com>

	* em-message-browser.c (emmb_init): as below

	* em-folder-browser.c (emfb_init): always show vertical scrollbar,
	we do the same for message list and it avoids ugly flicker

2004-01-06  Jeffrey Stedfast  <fejj@ximian.com>

	* em-message-browser.c (emmb_set_message): Protect against a NULL
	message-info. Afaik, this can only happen if the message has since
	been removed? Might be a larger problem here... Anyways, fixes the
	crash in bug #52297.

2004-01-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (folder_renamed_cb): Clone the
	CamelRenameInfo and ref the store before emitting the async event.
	(folder_deleted_cb): Same idea but for CamelFolderInfo's.
	(folder_created_cb): Here too.
	(folder_subscribed_cb): Same.
	(folder_unsubscribed_cb): And here.
	(folder_renamed): Split out from folder_rename_cb(), free the
	CamelRenameInfo and unref the store when done.
	(folder_unsubscribed): Same idea.
	(folder_subscribed): Same.

2004-01-05  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c: add NULL at the end of argv for execvp (poited
	out by Frank Solensky, thanks)

2004-01-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_list_message_selected): Check that the
	folder isn't NULL (ie. no folder is selected). Fixes bug #52207.

	* message-list.c (message_list_set_folder): Remove the
	cursor-activated idle callback.

	* mail-send-recv.c (build_dialog): Set the send/recv dialog to
	non-modal. Fixes bug #50127.

	* em-folder-tree-model.c (folder_subscribed_cb): If we aren't in
	the main thread, proxy it over to the main thread.
	(folder_unsubscribed_cb): Same.
	(folder_created_cb): Here too.
	(folder_deleted_cb): And here.
	(folder_renamed_cb): Again here.

	* em-folder-view.c (emfv_set_folder_uri): Pass mail_thread_queued
	to mail_get_folder() instead of mail_thread_new so that we
	eliminate a race when switching folders in the UI.

2004-01-05  Not Zed  <NotZed@Ximian.com>

	** See bug #50996.

	* em-format-html-display.c (efhd_find_handler): implement override
	for unknown types, try bonobo handlers.
	(efhd_bonobo_unknown): formathandler for bonobo objects.

	* em-format.c (em_format_find_handler): make virtual, rename to
	emf_find_handler.

2004-01-04  ERDI Gergo  <cactus@cactus.rulez.org>

	* em-folder-view.c (emfv_on_url_cb): Emit a hover-url signal when
	the user mouses over a URL, ...
	(emfv_hover_url_impl): ... and use BonoboUI to change the status
	bar message...
	(em_folder_view_set_statusbar): ... unless we are asked not to, ...

	* mail-component.c (impl_createControls): ... like in the case of
	the mail component, ...
	(view_hover_url_cb): ... that uses the ActivityHandler to do the
	same

	Add these together, and #127536 is neatly solved.

2004-01-04  David Woodhouse  <dwmw2@infradead.org>

	* em-format-html-display.c: Mail warning grammar typo fix.

2003-12-22  David Moore  <davmre@bellsouth.net>

	* em-popup.c (emp_part_popup_set_background): Implemented; sets an 
	image attachment as the GNOME wallpaper.

	* em-utils.c (emu_save_part_done): Created a prototype at the top
	of the file.
	(em_utils_save_part_to_file): Added; save a message part to a
	specified file on disk.
 
2003-12-18  Rodney Dawes  <dobey@ximian.com>

	* em-message-browser.c (emmb_init): Merge in
	evolution-mail-message-display.xml first, since it is the parent UI
	XML, really fixes bug #49949

2003-12-16  JP Rosevear  <jpr@ximian.com>

	* em-format-html-display.c: #ifdef out certain code pieces if
	s/mime isn't supported

2003-12-14  JP Rosevear <jpr@ximian.com>

	* em-folder-tree.c (emft_tree_row_collapsed): Fix erroneous
	function call

	Fixes #52120
	
2003-12-12  Not Zed  <NotZed@Ximian.com>

	* mail-config.c (config_write_style): put the style in .evolution.

	** See bug #52023.

	* message-list.c (message_list_select_uid): noop if we've been
	destroyed (foldre == NULL).

	** See bug #52108.

	* em-format.c (em_format_is_attachment): also recognise
	application/pkcs7-mime for mailers who like to make up their own
	standards.

	* em-format-html.c (type_builtin_table[]): *
	em-format-html-display.c (type_builtin_table[]): make recognise
	application/pkcs7-mime too.

2003-12-11  Chris Toshok  <toshok@ximian.com>

	* Makefile.am (INCLUDES): get the build moving again.  add
	CERT_UI_CFLAGS here for the time being.

2003-12-11  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #1717.

	* em-folder-browser.c (emfb_list_built): If we have a uid to
	select, select that instead of selecting the first unread.
	(emfb_set_folder): CamelObject::meta_get() actually returns a
	strdup'd buffer, so we need to free it. Get the last selected uid
	and set that up as the uid to select when the message-list
	finishes building.
	(emfb_list_message_selected): Save the selected uid.
	(emfb_init): Connect to the message-list's message_selected signal
	so that we can save selected state (don't want to do this in
	EMFolderView or MessageList because we don't want the state to be
	saved for the EMMessageBrowser).

2003-12-11  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c: Shorten the namespace of some internal
	functions to just emft.
	(emft_popup_delete_rec): Don't delete the contents of a folder if
	it is a vFolder. Fixes bug #52029.

	* em-mailer-prefs.c (em_mailer_prefs_construct): Use newv() here
	and pass an array of GTypes - makes it simpler to change the order
	of columns later and/or add new columns if we need to. Also makes
	the line shorter :-)

2003-12-11  Grahame Bowland  <grahame@angrygoats.net>

	* em-format-html.c (efh_format_header): display 
	x-evolution-mailer pseudo header irrespective of 
	xmailer_mask. This is now handled by a header 
	configuration dialog.

	* mail-config.glade: add tab to mail configuration 
	dialog to allow custom headers to be specified for 
	display.

	* em-mailer-prefs.h: modify struct _EMMailerPrefs to 
	add widgets for custom header tab. Add defines for custom 
	header flags. Add struct EMMailerCustomHeader to describe
	custom headers, and add function 
	em_mailer_custom_headers_from_xml to allow XML from gconf 
	key to be parsed into this structure.

	* em-folder-view.c (emfv_setting_notify): catch changes to 
	custom header gconf key and update mail view to correspond

	* em-mailer-prefs.c (em_mailer_prefs_apply): save custom 
	headers to gconf
	(header_list_enabled_toggled): toggle clicked toggle column
	(add_header): add header to custom header list if valid
	(remove_header): remove selected custom header
	(is_valid_header): return true if passed header is valid, 
	otherwise false
	(entry_header_changed):	call add_header_update_sensitivity
	(em_mailer_prefs_construct): initialise header selection tab. 
	Load gconf data for header selection dialog.
	(em_mailer_custom_header_to_xml): load a header structure 
	from XML document structure
	(em_mailer_custom_header_from_xml): load a header 
	structure from a string containing valid XML. if any failure, 
	the header.name is set to NULL.
	(header_list_row_selected): call 
	remove_header_update_sensitivity
	(remove_header_update_sensitivity): set the sensitivity of 
	the remove button to FALSE if the list is empty or nothing 
	is selected. Otherwise, set it to TRUE.
	(add_header_update_sensitivity): set the sensitivity of the 
	the add button to FALSE if the entry box is empty, contains 
	a duplicate header, or contains an invalid header. Otherwise, 
	set it to TRUE.

	* evolution-mail.schemas.in.in: add mail/display/headers 

2003-12-10  Larry Ewing  <lewing@ximian.com>

	* em-format-html.c: add text/x-patch as a plain type.
	(efh_text_enriched): add table around the enriched part so it
	matches html and text modes.

2003-12-10  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_dir): Modified to simply copy mbox
	files from one place to another (and the summary files) rather
	than going thru camel so as to bypass the need for parsing MIME.

2003-12-10  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (get_local_store): Fixed a leak.

	* mail-component.c (impl_upgradeFromVersion): Implemented.

	* em-folder-tree.c (em_folder_tree_set_selected): Add INFO_FAST
	here as we don't need it to get unread counts.
	(tree_row_expanded): Here too.

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	Check CAMEL_FOLDER_NOCHILDREN.

2003-12-10  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #51045

	* mail-folder-cache.c (real_flush_updates): Update the unread
	count in the model if the folder got new mail.

	* em-folder-selection.c (em_select_folder): Updated.

	* em-folder-selection-button.c
	(em_folder_selection_button_clicked): Updated.

	* em-folder-tree-model.c (em_folder_tree_model_set_unread_count):
	New function to update the unread count for a folder.

	* mail-component.c (mail_component_peek_tree_model): Don't ref the
	model. Also renamed s/get/peek/

2003-12-10  Not Zed  <NotZed@Ximian.com>

	* em-folder-tree.c (em_folder_tree_get_folder_info__got): check
	m->fi != NULL before dereferencing it.

2003-12-10  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_multipart_signed):
	* em-format-html.c (efh_multipart_signed): 
	* em-format.c (emf_multipart_signed): treat
	application/pkcs7-signature as application/x-pkcs-signature.
	Stupud non-rfc-compliant mailers from apple.  Bug #51750.

	* em-folder-selection.c (em_select_folder): rewritten to get rid
	of hte old crap that should've been gotten rid of before.  Bug
	#51602.
	(em_folder_selection_run_dialog_uri): removed.
	(em_folder_selection_run_dialog): removed.  this file is gutted
	and should probably be removed.

	* em-folder-selector.h: use a POSITIVE value for the response
	value, gtk uses -ative ones.  Bug #51752.

	* Makefile.am (INCLUDES): added smime/lib and smime/gui to
	includes.

	* em-folder-tree.c (emft_popup_rename_folder): removed unused 'why',
	why not?

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	setup a table of buttons to view any certs we have.

	* em-folder-browser.c (emfb_activate): separeate view_menu
	unreffing from view_instance.  fixes a runtime warning.

	** See bug #51718.

	* mail-component.c (em_uri_to_camel): handle an e-uri which has an
	account uid which isn't in user@host format.

2003-12-09  Not Zed  <NotZed@Ximian.com>

	** See bug #51899.

	* em-folder-tree-model.c (em_folder_tree_model_set_folder_info):
	CAMEL_FOLDER_CHILDREN is only advisory, some servers don't give it
	to you.

2003-12-06  JP Rosevear <jpr@ximian.com>

	* Makefile.am: Remove hard coded disable deprecated flags
	
2003-12-05  Rodney Dawes  <dobey@ximian.com>

	* em-folder-tree.c (render_display_name): Remove the extra || unread
	check in the conditional in the g_object_set () call

2003-12-05  Rodney Dawes  <dobey@ximian.com>

	Fixes bug #51482
	
	* em-folder-tree.c (render_display_name): Don't hardcode colors
	for the folder tree, instead use bold for unread, as in 1.4

2003-12-05  Radek Doulik  <rodo@ximian.com>

	* em-html-stream.c (emhs_sync_flush): use new gtk_html_flush
	method instead of forcing processing of all gtk events

2003-12-04  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (em_folder_tree_model_remove_folders):
	Make sure folder_path is non-NULL ("Loading..." nodes will have a
	NULL path). Fixes bug #51731.

2003-12-04  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (empty_trash_empty): Get the proper local folders
	store uri (it's not file:/ anymore). Fixes bug #51618.

2003-12-04  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #51605.

	* em-folder-selector.c (emfs_response): Handle creating a new
	folder (pop up a create-folder-selector dialog).

	* em-folder-tree.c (emft_popup_new_folder_response): Moved all the
	logic into em_folder_tree_create_folder().
	(em_folder_tree_create_folder): New function to create a folder.

2003-12-04  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (pipe_to_sa): add new err_retval parameter,
	which specifies which value to return if something went wrong
	(like failed to exec, ...). update all calls by that. actual junk
	check has err_retval = 0 to avoid marking false spam - non-zero
	retval means junk.

	* em-folder-view.c: set junk toolbar buttons pixmaps

	* mail-session.c: monitor gconf key
	/apps/evolution/mail/junk/check_incoming and keep session junk
	flag uptodate

	* em-mailer-prefs.c (em_mailer_prefs_construct): added junk
	preferences

2003-12-03  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (uri_to_evname): Updated to add use mail subdirs.
	(mail_config_uri_renamed): Updated cachenames[]
	(mail_config_folder_to_cachename): Fixed to use the correct path.

	* em-folder-browser.c (emfb_create_view_menus): Updated the
	galview path to point to the evo-1.5 location.
	(emfb_set_folder): Update the galview view_instance.
	(emfb_create_view_instance): Split out from
	emfb_create_view_menus()
	(emfb_create_view_menus): Reduced code, call
	emfb_create_view_instance().

	* em-folder-selector.c (emfs_create_name_activate): Emit the OK
	response, not the CREATE_NEW response. Also,
	g_signal_emit_by_name() does not take a GQuark detail argument, so
	don't pass one. Fixes bug #51661.

2003-12-03  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_set_folder): Sync the folder before
	replacing it with the new folder.

	* em-folder-tree.c (em_folder_tree_set_selected): Need to prepend
	a "/" to path if the path is the url fragment. Also fixed to
	select the store node if path == "/".
	(emft_popup_rename_folder): Set oldpath and newpath to the proper
	values. Fixes bug #51656.

	* em-folder-selector.c (em_folder_selector_get_selected_uri):
	Fixed a FIXME by using the CamelProvider url flags to determine if
	the url used url->fragment or url->path as the folder path.
	(em_folder_selector_get_selected_path): Don't allow path strings
	to start with "//".

2003-12-03  JP Rosevear <jpr@ximian.com>

	* em-folder-tree.c (em_folder_tree_destroy): remove the source
	before saving 

2003-12-03  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (em_folder_tree_save_state): Set the
	save_state_id to 0 or we will never get a chance to run again.

2003-12-03  Ettore Perazzoli  <ettore@ximian.com>

	* mail-vfolder.c: Do not #include "evolution-shell-component.h".

	* Makefile.am (libevolution_mail_la_SOURCES): Don't compile
	mail-importer.[ch] for now.

	* mail-component-factory.c: Do not #include
	<evolution-shell-client.h>.
	* mail-config.c: Likewise.

	* mail-vfolder.h: Do not #include <evolution-storage.h> or
	<evolution-shell-component.h>.

	* mail.h: Do not #include <evolution-storage.h>.

	* mail-ops.h: Do not #include <evolution-storage.h>.
	(mail_scan_subfolders): Remove prototype.
	(mail_update_subfolders): Likewise.

2003-12-03  JP Rosevear <jpr@ximian.com>

	* em-folder-tree.c (em_folder_tree_destroy): save the state
	immediately if there is a timeout set
	(em_folder_tree_save_state): be true GSourceFunc and just return
	FALSE to remove the source

2003-12-03  Not Zed  <NotZed@Ximian.com>

	* mail-autofilter.c (rule_match_thread): changed to setup the rule
	part properly, it could never have worked.  Bug #51601.

	* em-popup.c (emp_uri_popup_address_add): implement.

	* em-folder-view.c (emfv_popup_add_sender): implement.
	(emfv_add_sender_addressbook): hook up to above func.

	* em-utils.c (em_utils_add_address): implementation to add an
	email address to the addressbook.
	(emu_add_address_cb): callback required for funny api.  Bug
	#51321.

2003-12-02  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (drop_uid_list): Moved here.
	(drop_folder): Moved here.
	(import_message_rfc822): Moved here.
	(drop_message_rfc822): Moved here.
	(drop_text_uri_list): Moved here.
	(model_drag_data_received): Moved the logic from em-folder-tree.c
	into here.
	(model_row_drop_possible): Same.
	(model_row_draggable): Same.
	(drag_text_uri_list): Moved here.
	(model_drag_data_get): Moved logic here.
	(model_drag_data_delete): Moved logic here.

	* em-folder-tree.c (drag_data_get_cb): Pass the full_name to
	camel_store_get_folder() rather than the path.
	(drag_data_received_cb): Same.
	(drop_uid_list): Removed.
	(drop_folder): Removed.
	(import_message_rfc822): Removed.
	(drop_message_rfc822): Removed.
	(drop_text_uri_list): Removed.
	(drag_data_received_cb): Removed.
	(row_drop_possible_cb): Removed.
	(row_draggable_cb): Removed.
	(drag_text_uri_list): Removed.
	(drag_data_get_cb): Removed.
	(drag_data_delete_cb): Removed.
	(em_folder_tree_enable_drag_and_drop): Don't connect to any of the
	drag & drop signals, they don't exist anymore.

	* mail-component.c (impl_createControls): Enable drag-and-drop.

	* em-folder-tree.c (em_folder_tree_new_with_model): Connect to the
	loading row signal.
	(loading_row_cb): Expand the path if needed.
	(em_folder_tree_destroy): Disconnect from the loading-row signal.
	(em_folder_tree_enable_drag_and_drop): New function to enable
	drag-and-drop.
	(em_folder_tree_new): Remove drag-and-drop setup code.

	* em-folder-tree-model.c (em_folder_tree_model_class_init): Define
	the loading-row signal.
	(em_folder_tree_model_set_folder_info): emit the loading-row signal.

2003-12-02  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (em_folder_tree_new): Fixed to pass the
	evolution dir into em_folder_tree_model_new().
	(model_save_state): Removed.
	(em_folder_tree_save_state): Moved all the saving logic into
	em_folder_tree_model_save_expanded().

	* em-folder-tree-model.c (em_folder_tree_model_new): Load the
	expanded state off disk.
	(em_folder_tree_model_save_expanded): New function to save
	expanded state.
	(em_folder_tree_model_get_expanded): new function to get if a node
	should be expanded.
	(em_folder_tree_model_set_expanded): new function to set the
	expanded state of a node.

	* mail-component.c (mail_component_init): Pass the evo dir to
	em_folder_tree_model_new() which now requires it.

2003-12-02  Rodney Dawes  <dobey@ximian.com>

	* Makefile.am: Version the schemas
	* evolution-mail.schemas: Removed
	* evolution-mail.schemas.in.in: Added

2003-12-02  Not Zed  <NotZed@Ximian.com>

	* mail-config-druid.c (mail_config_druid_new): moved the
	gtk_widget_show_all to before we add the pages, otherwise it can
	override per-page logic.  Bug #50790.

	* message-list.c (message_list_create_extras): setup another image
	(followup completed) to flag status list.
	(states_pixmaps[]): added flag_for_followup_done.
	(ml_tree_value_at): return 0,1 or 2 for completed icon.  also use
	the real ints, these shouldn't have been true/false.  Bug #43514.

	* evolution-mail.schemas: Added empty_trash prompt key.

	* em-utils.c (em_utils_prompt_user): changed to take the gconf
	'prompt again' key directly.  Fixed callers.
	(em_utils_expunge_folder): prompt the user with an expunge
	specific message.
	(em_utils_empty_trash): have an empty-trash specific message for
	prompting confirm.
	(emu_confirm_expunge): removed, no longer needed.  Bug #38613.
	(em_utils_expunge_folder): remove most line feeds, let the label
	wrap them.
	(em_utils_empty_trash): ditto.

	* em-subscribe-editor.c (sub_folder_subscribed): update the ui
	selection state after we're done.  maybe we should listen on the
	model but this is easier.  Bug #50861.

	* em-message-browser.c (emmb_activate): hook up our own verb list.
	(emmb_message_verbs[], emmb_close): implement the close verb.
	Bug #51558.

	* em-format-html-display.c (efhd_attachment_popup): duh, actually
	add the menu list we create.  Bug #49902.

	* em-format.c (d): turn off debug, committed by accident.

2003-12-01  Ettore Perazzoli  <ettore@ximian.com>

	* mail-mt.c (do_op_status): Use data->activity_id, not local
	activity_id.

2003-12-01  Ettore Perazzoli  <ettore@ximian.com>

	* mail-mt.c (struct _mail_msg_priv): Remove member "activity".
	(mail_operation_status): Un-#if 0 the code.

	* mail-component.c (struct _MailComponentPrivate): New member
	activity_handler.
	(mail_component_init): Initialize.
	(impl_dispose): Unref.
	(mail_component_peek_activity_handler): New.
	(impl_createControls): Create an ETaskBar, attach it to the
	ActivityHandler, and return it to the caller as the statusbar
	control.

2003-12-01  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (impl_createControls): Pass a label for the
	status bar control for now.

2003-12-01  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_signature_run_script): Use fcntl() to
	set FD_CLOEXEC on each fd rather than close()ing it. Apparently
	Linux's older pthread implementations use sockets and so this
	fouls threading up. GO LINUX! GO!

2003-12-01  Rodney Dawes  <dobey@ximian.com>

	* GNOME_Evlution_Mail.server.in.in:
	* em-account-prefs.c:
	* em-composer-prefs.c:
	* em-mailer-prefs.h:
	* mail-component-factory.c:
	* mail-config-factory.c:
	* mail-font-prefs.h:
	* importers/*.server.in.in:
	* importers/elm-importer.c:
	* importers/evolution-mbox-importer.c:
	* importers/evolution-outlook-importer.c:
	* importers/netscape-importer.c:
	* importers/pine-importer.c: Use BASE_VERSION for repo_ids and OAFIIDs

2003-12-01  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (em_folder_tree_get_folder_info__got): Updated
	to call em_folder_tree_model_set_folder_info().
	(folder_subscribed_cb): Removed.
	(folder_unsubscribed_cb): Removed.
	(folder_created_cb): Removed.
	(folder_deleted_cb): Removed.
	(folder_renamed_cb): Removed.

	* em-folder-tree-model.c (em_folder_tree_store_set_folder_info):
	New function to replace tree_store_set_folder_info() which had
	been in em-folder-tree.c
	(em_folder_tree_model_remove_uri): Made private.
	(em_folder_tree_model_remove_store_info): Made private.
	(em_folder_tree_model_remove_folders): New function to replace
	remove_folders() from em-folder-tree.c
	(em_folder_tree_model_new): No longer takes any args.

	* em-folder-tree.c (em_folder_tree_new): Updated.

	* mail-component.c (add_store): Add the store to the model rather
	than the treeview.
	(impl_createControls): create a new treeview based on the
	already-instantiated model.
	(mail_component_init): Create a new tree model.
	(mail_component_remove_store): Remove the store from the model
	directly.
	(mail_component_get_tree_model): Updated.

	* em-folder-tree.c (folder_unsubscribed_cb): Call
	em_folder_tree_model_remove_folders() rather than the deprecated
	internal remove_folders() function.
	(folder_renamed_cb): Same.
	(em_folder_tree_remove_store): Removed.
	(em_folder_tree_add_store): Removed.
	(remove_folders): Removed.

2003-12-01  Jeffrey Stedfast  <fejj@ximian.com>

	* em-composer-utils.c (composer_get_message): rfc2047 encode the
	Organization header value.

	* em-folder-tree.c (em_folder_tree_get_folder_info__got): Make
	sure our parent folder hasn't been unsubscribed or else we get a
	segfault here if it has.

03-11-28  Dave Camp  <dave@ximian.com>

	* em-folder-tree.c (render_pixbuf): Set the pixbuf renderer
	invisible for stores.

2003-11-25  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_get_account_by_uid): New function.

	* em-folder-tree.c (tree_store_set_folder_info): Expand the tree
	node if the saved state tells us it was expanded the previous
	session.
	(em_folder_tree_load_state): Load the saved state.
	(em_folder_tree_add_store): Conditionally expand the store node.
	(em_folder_tree_new_with_model): Expand all the nodes that should
	be expanded.

2003-12-01  Radek Doulik  <rodo@ximian.com>

	* em-folder-tree.c (render_pixbuf): use CAMEL_VTRASH_NAME,
	CAMEL_VJUNK_NAME

2003-11-28  Radek Doulik  <rodo@ximian.com>

	* em-folder-tree.c (render_pixbuf): added junk icon to folder
	icons

2003-12-01  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_edit_cut, emfb_edit_copy)
	(emfb_edit_paste): override the em-folder-view impl, and handle
	the search bar properly.  For #48746.

	* mail-security.glade: added some padding to the security details
	frames.

	* em-format-html-display.c (efhd_xpkcs7mime_validity_clicked):
	some cosmetic layout changes.

2003-11-27  Charles Zhang  <charles.zhang@sun.com>

	* mail-account-editor.c (construct): connect "changed" signal.
	(mail_account_editor_changed): change signal handler.
	Fixes bug #48998.

2003-11-30  Ettore Perazzoli  <ettore@ximian.com>

	* mail-offline-handler.c: Remove all the syncFolder stuff since
	it's not in the Component interface anymore.

	* mail-mt.c: Remove declaration for global_shell_client.  #if 0
	all the code that uses that.

	* mail-component-factory.c: Remove declaration for
	global_shell_client.

	* mail-vfolder.c: Remove declaration for global_shell_client.

2003-11-26  JP Rosevear  <jpr@ximian.com>

	* Makefile.am: turn on deprecated Gtk stuff

2003-11-24  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (em_folder_tree_save_state): New function to
	save tree expanded state.
	(em_folder_tree_queue_save_state): New function to queue saving of
	the expanded state.
	(em_folder_tree_construct): Connect to the row-collapsed signal.
	(tree_row_collapsed): Queue a save-state.
	(tree_row_expanded): Queue a save state.
	(em_folder_tree_get_folder_info__got): Queue a save-state.

2003-11-25  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (em_folder_view_print): set session on print
	formatter for signatures to work.

	* em-message-browser.c (emmb_destroy): kill warning.

	* em-format-html.c (efh_output_secure): same as
	efhd_output_secure, output the security bar, but for
	printing/plain html.
	(efh_application_xpkcs7mime): use output_secure.
	(em_format_html_multipart_signed_sign): removed, output_secure
	does what this did.

	* em-format-html-display.c (smime_sign_table,
	smime_encrypt_table): Added a short description for the mail
	display.
	(efhd_xpkcs7mime_button): only good/bad signature at this point,
	if only encrypted, then display 'bad' icon.
	(efhd_output_secure): output the security bar/button and handle
	multi-level enveloping properly.
	(efhd_application_xpkcs7mime): just call output_secure to do
	the security bar.
	(efhd_multipart_signed): same.
	(efhd_signature_button): removed, no longer used.
	(efhd_signature_check): removed, no longer used.

2003-11-24  Radek Doulik  <rodo@ximian.com>

	* em-format-html.c (efh_text_plain): use new colors
	(efh_text_html): ditto

	* em-format-html-display.c (efhd_gtkhtml_realise): set new colors
	according to style

	* em-format-html.c (efh_init): init new colors

	* em-format-html.h: added frame and content colors

	* em-format.c (emf_multipart_mixed): do not use horizonal rule,
	attachment content is now inside simple frame

	* em-format-html.c (efh_text_plain): add 6 points around text
	plain content and frame it
	(efh_text_html): frame text/html
	(efh_format_do): fix body tag, set bgcolor
	(em_format_html_format_headers): do not put headers into own
	table, content body is framed now instead
	(efh_format_message): update for headers/body changes

	* em-format-html-display.c (efhd_format_attachment): put
	additional vertical space around attachment button

2003-11-22  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree-model.c (model_drag_data_received)
	(model_row_drop_possible, model_row_draggable)
	(model_drag_data_get, model_drag_data_delete): Swap the retval
	varargs value to the last argument instead of the first.

2003-11-20  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config.c (mail_config_uri_deleted): Removed call to
	mail_tool_delete_meta_data(). Fixes bug #51236.

	* mail-component.c (impl_handleURI): Implemented.
	(mail_component_class_init): Overload the handleURI method.

2003-11-20  Jeffrey Stedfast  <fejj@ximian.com>

	Fixes bug #51012.

	* em-folder-tree.c (emft_popup_rename_folder): Fixed a FIXME to
	not use the OS-specific g_path_*() stuff.
	(em_folder_tree_set_selected): For the case where the tree has
	already loaded enough subfolders to include the path we need to
	select, exopand the nodes to that path as well. For the case that
	the tree hasn't loaded enough of the folder nodes, load them and
	then have the node selected/expanded to.

2003-11-19  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-selector.c (emfs_create_name_activate): Emit the
	response signal with the RESPONSE_NEW value.
	(emfs_create_name_changed): Sanity check the entry text and set OK
	sensitivity.
	(folder_selected_cb): If there is an entry widget, then call
	name_changed() to decide sensitivity, else set OK to be sensitive.

	* em-utils.c (em_utils_selection_set_urilist): Same.

	* em-format-html-display.c (efhd_drag_data_get): Same as below.

	* em-folder-tree.c (drag_text_uri_list): Terminate each url of a
	text/uri-list with a \r\n.

2003-11-19  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Add an
	"evolution:uri_schemas" attribute.

2003-11-19  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (em_uri_to_camel): if we're setting the
	fragment, strip leading /'s.

	* mail-tools.c (mail_tool_get_meta_data)
	(mail_tool_delete_meta_data, meta_data_key): old stuff killed.
	(mail_tool_uri_to_folder): handle email: uri's specially.  this is
	a bit of a hack, the filter callbacks should manage this itself
	since filters are the only bits which use those uri's.

2003-11-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_dir): Don't leak the message objects.

	* em-folder-tree.c (em_copy_folders): Execute asynchronously by
	queueing the copy in another thread.
	(em_copy_folders__copy): Moved the original logic here.

2003-11-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (tree_row_expanded): Queue the
	camel_store_get_folder_info() call in another thread.
	(em_folder_tree_get_folder_info__got): Moved all the logic of
	tree_row_expanded here.

2003-11-17  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (tree_row_expanded): Fixed to check fi->child
	as well (since mbox does it right).
	(emft_popup_new_folder_response): Fixed to subscribe to the
	correct folder.
	(emft_popup_delete_folders): Fixed to use the full_name rather
	than the path.

	* em-folder-selection-button.c (set_contents): Fixed to not
	include leading '/' in the folder name in the label.

	* em-folder-tree.c (emft_popup_new_folder_response): Implemented
	error reporting via gtk dialogs.
	(emft_popup_copy_folder_selected): Same.

2003-11-17  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_popup_new_folder_response): Use a
	folder_name rather than a path as the name argument to
	camel_store_create_folder(), fixes creation of IMAP folders.

2003-11-17  Not Zed  <NotZed@Ximian.com>

	* em-folder-selection-button.c (set_contents): handle an
	unparsable url without crashing.

	* mail-tools.c (mail_tool_get_local_inbox): thin wrapper on
	mail_component_get_local_inbox.

	* mail-component.c (mail_component_get_local_inbox): helper to get
	the default local inbox.

	* mail-ops.c (fetch_mail_fetch): if we can't get the inbox, make
	sure we still unref the filter driver here by using hte same exit
	code.  Fixes a crash.

2003-11-14  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-tree.c (emft_popup_new_folder_response): We can't use
	a uri to do a lookup of a store-info on the store_hash, we have to
	get a CamelStore first.
	(row_draggable_cb): validate the iter before using it.
	(row_drop_possible_cb): Same.
	(drag_data_received_cb): Here too.
	(drag_data_get_cb): Same.
	(drag_data_delete_cb): Again here.
	(tree_store_set_folder_info): Recursively add nodes if fi->child
	is non-NULL rather than adding a dummy node.
	(folder_renamed_cb): Implemented.

2003-11-14  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-mt.c (set_stop): Removed most of the code. This is
	basically now a nop. Need to somehow get the uic and fix this.

	* folder-browser-factory.[c,h]: Removed.

	* mail-component.c (folder_selected_cb): Don't create a new view
	anymore, simply set the new folder uri on the folder browser. This
	makes the mailer use a lot less memory than in 1.x
	(view_control_activate_cb): Moved here from
	folder-browser-factory.c
	(impl_createControls): Connect to the activate signal on the view
	control.

2003-11-14  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-selection.c (folder_selected_cb): Only set OK to
	sensitive if the selected node is not a store node.

	* em-folder-tree-model.c: Moved the store_hash and uri_hash from
	EMFolderTreePrivate into here instead.

	* em-folder-tree.c: Updated for above changes.

2003-11-14  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_popup_move): Updated.
	(emfv_popup_copy): Updated.

	* em-folder-tree.c (emft_popup_copy): Updated.
	(emft_popup_move): Updated.

	* em-folder-selection.c (create_dialog): New convenience function
	to construct the dialog contents for all three public functions.
	(em_folder_selection_run_dialog): Now longer takes a caption arg.
	(em_folder_selection_run_dialog_uri): Same.
	(em_select_folder): Here too.

2003-11-13  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (mail_component_get_tree_model): Use
	em_folder_tree_get_model() since an emft is not a GtkTreeView.

	* em-folder-tree.c (em_folder_tree_get_model): New function to get
	the tree model.

2003-11-13  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-selection.c: Rewritten to use EMFolderTRee.

	* mail-vfolder.c (vfolder_load_storage): Updated for function name
	changes in mail-component.c

	* mail-offline-handler.c: Updated for function name changes in
	mail-component.c

	* mail-account-gui.c (add_new_store): Fixed to not use EStorage.
	(mail_account_gui_save): Updated for function name changes.

	* em-account-prefs.c (account_delete_clicked): Updated for
	function name changes.
	(account_able_clicked): Same.
	(account_able_toggled): Same.

	* mail-component.c: Renamed mail_component_*storage*() functions
	to mail_component_*store*() since we are no longer dealing with
	storages, but instead with CamelStore's.
	(create_view_widget): If the user selects a store node, don't try
	to open it as a folder.

2003-11-13  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (impl_sendAndReceive): New, implementation for
	Evolution.Component.sendAndReceive.
	(mail_component_class_init): Install.

2003-11-13  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vfolder.c (context_rule_removed): Modified to not use
	EStorage* functions. I don't even think it *needs* to remove the
	folder from the mail-component, the mail-component should just
	pick it up automagically via CamelStore events.

	* em-folder-tree.[c,h]: New folder-tree widget that replaces the
	shell's folder-tree widget.

	* em-folder-tree-model.[c,h]: New source files subclassing
	GtkTreeStore for handling the mess that is drag&drop.

	* em-folder-selection-button.c: Ported to use EMFolderTree.

	* em-folder-selection.c: Ported to use EMFolderTree.

	* em-folder-selector.c: Ported to use EMFolderTree.

	* mail-component.c: Ported to use EMFolderTree.

	* mail-offline-handler.c (storage_go_online): Updated to not pass
	a storage argument.

	* mail-folder-cache.c: Removed storage stuff.

	* mail-send-recv.c (receive_update_got_store): Don't do EStorage*
	stuff anymore.

2003-11-13  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (impl__get_userCreatableItems): New,
	implementation for the Component.userCreatableItems attribute.
	(impl_requestCreateItem): New, implementation for the
	Component.requestCreateItem() method.
	(mail_component_class_init): Install.

2003-11-13  Radek Doulik  <rodo@ximian.com>

	* em-junk-filter.c (em_junk_sa_is_available): new helper function,
	use it before any call to spamassassin, spamc and sa-learn
	(em_junk_sa_test_spamd): first test if spamassassin is available
	(em_junk_sa_test_spamd): rename em_junk_sa_spamd_tested to
	em_junk_sa_tested, always set em_junk_sa_tested

	* mail-folder-cache.c (folder_changed): don't call
	CAMEL_IS_VJUNK_FOLDER, it was added by mistake

2003-11-13  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (em_format_html_add_pobject): use malloc0 for
	the pobject memory.

2003-11-12  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c (smime_sign_key_select)
	(smime_encrypt_key_select, smime_encrypt_key_selected)
	(smime_sign_key_selected): implement the key selector popup using
	e-cert-selector.

2003-11-11  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_application_xpkcs7mime): output icons of
	the status.
	(em_format_html_add_pobject): Changed to take a size specificier,
	return the pobject, and re-ordered args to be more consistent with
	puri stuff.
	(em_format_html_remove_pobject): handle the free callback if set.

	* em-format.c (emf_application_xpkcs7mime): moved this to
	em-format-html since it needs to do icon stuff.

	* mail-security.glade: new glade file for security related stuff.

	* mail-config.glade: removed the message security dialogue, it
	gets opened automatically by the config code :(

2003-11-10  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Set an
	"evolution:component_alias" property with a value of "mail".

2003-11-10  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (em_format_html_multipart_signed_sign): changed
	for cipher context api changes.
	* em-format.c (emf_multipart_signed): ditto.

2003-11-07  Not Zed  <NotZed@Ximian.com>

	* mail-config.glade: added security_information_dialog (probably
	temporarily in this file).

	* em-format.c (em_format_is_attachment): also treat pkcs7-mime as
	non-attachment.
	(emf_application_xpkcs7mime): no longer need to worry about
	scanning the part.

2003-11-07  Dan Winship  <danw@ximian.com>

	* message-list.c: Don't #include e-name-western.h, since the code
	that uses it is commented out, and we want to remove the local
	copy, but we don't want to make the mailer depend on the e-d-s
	copy if it's not even going to be using it.

2003-11-07  JP Rosevear <jpr@ximian.com>

	* Makefile.am: build the marshall files right at the beginning

2003-11-11  Not Zed  <NotZed@Ximian.com>

	* mail-security.glade: new glade file for security related stuff.

	* mail-config.glade: removed the message security dialogue, it
	gets opened automatically by the config code :(

2003-11-10  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Set an
	"evolution:component_alias" property with a value of "mail".

2003-11-10  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (em_format_html_multipart_signed_sign): changed
	for cipher context api changes.
	* em-format.c (emf_multipart_signed): ditto.

2003-11-07  Not Zed  <NotZed@Ximian.com>

	* mail-config.glade: added security_information_dialog (probably
	temporarily in this file).

	* em-format.c (em_format_is_attachment): also treat pkcs7-mime as
	non-attachment.
	(emf_application_xpkcs7mime): no longer need to worry about
	scanning the part.

2003-11-07  Dan Winship  <danw@ximian.com>

	* message-list.c: Don't #include e-name-western.h, since the code
	that uses it is commented out, and we want to remove the local
	copy, but we don't want to make the mailer depend on the e-d-s
	copy if it's not even going to be using it.

2003-11-07  JP Rosevear <jpr@ximian.com>

	* Makefile.am: Make sure the marshal files are listed above other
	sources

2003-11-06  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.c (em_migrate_filter_file): Call em_migrate_uri()
	instead of em_uri_from_camel().
	(em_migrate_uri): Special-case file: uri's by converting them into
	email://local@local/ uri's since these folders will have been
	migrated to the newer mbox tree structure.

2003-11-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-vfolder.c (mail_vfolder_delete_uri): User vfolder rules
	should be in ${evolution_dir}/mail/vfolders.xml rather than
	${evolution_dir}/vfolders.xml
	(mail_vfolder_rename_uri): Same.
	(store_folder_deleted): Here too.
	(store_folder_renamed): And here.
	(vfolder_load_storage): Again here.
	(vfolder_editor_response): Same.
	(edit_rule_response): And here.
	(new_rule_clicked): Here too.

	* mail-session.c (main_get_filter_driver): User filter rules
	should be in ${evolution_dir}/mail/filters.xml rather than
	${evolution_dir}/filters.xml

	* mail-autofilter.c (filter_gui_add_from_message): Same.
	(mail_filter_rename_uri): And here.
	(mail_filter_delete_uri): Here too.

	* em-utils.c (filter_editor_response): Again here.
	(em_utils_edit_filters): Same.

	* em-migrate.c (em_migrate_filter_file): Same (also for
	vfolders.xml)

2003-11-05  Jeffrey Stedfast  <fejj@ximian.com>

	* em-migrate.[c,h]: New source files to migrate from the old mail
	directory to the new mail directory.

	* mail-component.c (mail_component_init): Changed to use
	~/.evolution and added code to migrate the old mail folders over
	if ~/.evolution/mail does not yet exist.

2003-11-03  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Use "evolution2:config_item"
	properties for the config item instead of "evolution:config_item"
	ones.

2003-11-01  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c: setup filter-on-thread and vfolder-on-thread.

	* mail-autofilter.c (rule_from_message): handle AUTO_THREAD
	(rule_match_thread): new function to setup a filter on a msgid

2003-10-31  Not Zed  <NotZed@Ximian.com>

	* mail-config.glade: Rearranged smime config slightly, and added
	encrypt key preference.

	* mail-account-gui.c (mail_account_gui_save,
	mail_account_gui_new): enable smime always if have_nss.  Added new
	options in glade file and handle changed names.
	(smime_changed, smime_sign_key_select, smime_sign_key_clear)
	(smime_encrypt_key_select, smime_encrypt_key_clear): Add a bunch
	of mostly dummy UI behaviour management stuff.

2003-10-30  Not Zed  <NotZed@Ximian.com>

	* em-format.c (em_format_is_inline): show application/x-pkcs7-mime
	inline always by default.

2003-10-30  Not Zed  <NotZed@Ximian.com>

	* em-format.c (emf_multipart_signed): handle
	application/x-pkcs7-signature.

2003-10-29  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (em_format_html_multipart_signed_sign): handle
	application/x-pkcs7-signature.

	* em-format.c (emf_application_xpkcs7mime): Handle
	application/x-pkcs7-mime.

2003-10-29  Jeffrey Stedfast  <fejj@ximian.com>

	* em-account-prefs.h: Changed the OAFIID.

	* em-composer-prefs.h: Changed the OAFIID.

	* em-mailer-prefs.h: Changed the OAFIID.

	* GNOME_Evolution_Mail.server.in.in: Changed OAFIIDs for the prefs
	controls.

2003-10-29  Jeffrey Stedfast  <fejj@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Nuked the MailConfig
	interface stuff.

	* Mailer.idl: Removed. None of the interfaces are needed/used
	anymore.

	* folder-info.[c,h]: Removed. The summary was the only thing that
	needed/used this code and it has been nuked into oblivion, so
	these interfaces are no longer needed.

	* mail-config.c: Removed old crufty CORBA interface snot that is
	no longer needed or used.

2003-10-27  Jeffrey Stedfast  <fejj@ximian.com>

	* Fixes bug #49816

	* em-popup.c (emp_part_popup_reply_sender): No need to pass a
	parent window arg anymore.
	(emp_part_popup_reply_list): Same.
	(emp_part_popup_reply_all): Here too.
	(emp_part_popup_forward): Same.
	(emp_uri_popup_address_send): Here too.

	* em-folder-browser.c (emfb_mail_compose): No need to pass a
	parent window arg anymore.
	(emfb_mail_post): Same.

	* em-folder-view.c (emfv_message_reply): Don't pass a parent
	window argument anymore.
	(emfv_popup_forward): Same.
	(emfv_popup_resend): Same here.
	(em_folder_view_open_selected): Same.
	(emfv_message_forward_attached): Here too.
	(emfv_message_forward_inline): And here.
	(emfv_message_forward_quoted): Same.
	(emfv_message_redirect): Here too.
	(emfv_message_post_reply): And here.
	(emfv_format_link_clicked): ANd finally here.

	* em-utils.c (create_new_composer): Don't set_transient_for()
	anymore.
	(em_utils_compose_new_message): No longer takes a parent window
	argument.
	(em_utils_forward_attached): No longer takes a parent window arg.
	(em_utils_forward_inline): Same.
	(em_utils_forward_quoted): Same.
	(em_utils_forward_message): Same.
	(em_utils_forward_messages): Here too.
	(redirect_get_composer): Don't set_transient_for() here either.
	(em_utils_redirect_message): No longer takes a parent window arg.
	(em_utils_redirect_message_by_uid): Same.
	(reply_get_composer): Don't set_transient_for() here.
	(em_utils_reply_to_message): No longer takes a parent window arg.
	(em_utils_reply_to_message_by_uid): Same.
	(post_reply_to_message): Don't set_transient_for() here.
	(em_utils_post_reply_to_message_by_uid): No longer takes a parent
	window arg.
	(em_utils_compose_new_message_with_mailto): Don't
	set_transient_for() here.
	(em_utils_post_to_url): Same.
	(em_utils_edit_message): No longer takes a parent window arg.
	(em_utils_edit_messages): Same.

2003-10-24  Jeffrey Stedfast  <fejj@ximian.com>

	* em-account-prefs.[c,h]: Re-Namespaced mail-accounts.c

	* em-composer-prefs.[c,h]: Re-Namespaced mail-composer-prefs.c

	* em-mailer-prefs.[c,h]: Re-Namespaced mail-preferences.c

	* mail-accounts.[c,h]: Removed.

	* mail-composer-prefs.[c,h]: Removed.

	* mail-preferences.[c,h]: Removed.

	* mail-account-editor.c: Updated.

	* mail-account-gui.c: Updated.

	* mail-config-factory.c: Updated.

	* mail-component-factory.c: Updated.

2003-10-22  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Add an
	"evolution:button_icon" attribute.

2003-10-22  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Add an
	"evolution:button_sort_order" attribute.

2003-10-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (parse_uid_list): Removed, use
	em_utils_selection_get_uidlist() instead.
	(drop_uid_list): Use em_utils_selection_get_uidlist() to parse the
	x-uid-list selection data and use mail_tool_uri_to_folder()
	directly since we have the uri (originally we expected the first
	component of the selection data to be the e-storage-set-view
	folder path rather than the uri).
	(folder_receive_drop_cb): Call gtk_drag_finish() here.

	* message-list.c: s/x-evolution-message/x-uid-list/

	* em-utils.c: Same.

2003-10-22  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (impl_createControls): Use
	e_storage_browser_peek_widget_scrolled() to retrieve the scrolled
	window that the EStorageSetView is contained in.

2003-10-22  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Add an
	"evolution:button_label" attribute to the Component for use in the
	shell.

2003-10-22  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (em_copy_folders): handle destination of ""
	properly.
	(emc_popup_copy_folder_selected): handle url->path properly, strip
	leading /.
	(em_copy_folders): if we just created a new folder on a
	subscribable store, subscribe to it.
	(em_copy_folders): handle nonselectable folders specially.

2003-10-21  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c (drag_text_uri_list, folder_dragged_cb)
	(drop_uid_list, drop_folder, import_message_rfc822)
	(drop_message_rfc822, drop_text_uri_list, folder_receive_drop_cb):
	New functions to handle drag & drop to/from the folder tree.
	(impl_createControls): Setup drag & drop support.

	* em-format.c (emf_multipart_mixed): Put an <hr> between parts of
	a multipart.

2003-10-21  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (emc_popup_properties): implement.
	(emc_popup_properties_got_folder): builds dynamic
	folder-properties dialogue.
	(emc_popup_properties_response): set the properties on the folder
	on an ok response.
	(emc_popup_properties_free): free the properties working data.

	* mail-folder-cache.c (unset_folder_info): unhook from the right
	function for message_changed.

2003-10-20  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (emc_popup_new_folder): pass the right object
	to set_selected().  Fixes a new real bug.  Undid reformatting.

2003-10-17  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-component.c: General compile fixes.
	(emc_popup_new_folder): Fixed to not shadow a parameter. Fixes a
	real bug.

	* mail-component.h: Added some prototypes.

2003-10-13  Not Zed  <NotZed@Ximian.com>

	* em-popup.c (em_popup_create_menu_once): only hookup target free
	if we have a target set.

	* mail-component.c (load_accounts): removed debug i accidentally
	left in.
	(emc_tree_right_click): handle right-click context menu, using an
	EMPopup table.
	(emc_popup_*): setup empty popup handlers.

2003-10-13  Not Zed  <NotZed@Ximian.com>

	* em-folder-selection.c (em_select_folder): asynchornous folder
	selection call.
	(emfs_folder_selected): callback for folder selected.

	* em-folder-view.c (emfv_popup_move): implement.
	(emfv_popup_copy): "
	(emfv_popup_move_cb): async folder select callback to run it.

2003-10-10  Not Zed  <NotZed@Ximian.com>

	* mail-account-gui.c
	(mail_account_gui_folder_selector_button_new): use
	em_folder_selection_button.
	(mail_account_gui_new): "
	(folder_selected): "

	* em-folder-selection-button.c: Make this use camel uri's rather
	than camelfolders.
	(set_selection): removed, redundant.
	(impl_dispose): removed, not needed.

	* em-folder-selection-button.h: change the selected signal not to
	actually return the selection, which must get retrieved later.

	* mail-component.c (em_uri_from_camel): create an evo mail uri
	from a camel one.
	(em_uri_to_camel): the reverse.

	* mail-signature-editor.c (mail_signature_editor): up the version
	of the gtkhtml editor.

2003-10-09  Not Zed  <NotZed@Ximian.com>

	* em-folder-selection-button.c (set_selection): always set
	selected_folder, otherwise we don't unset it properly.

	* em-folder-selection.c (em_folder_selection_run_dialog): fix a
	small memleak.
	(em_folder_selection_run_dialog_uri): do the same as run_dialog
	but take, and return physical uri's.

	* mail-component-factory.c (factory): removed some fixme's, and
	re-hookedup the composer.

2003-10-09  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* em-icon-stream.c (emis_sync_close): Use
	gnome-thumbnail_scale_down_pixbuf if available, for better
	performance.

2003-10-08  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c: Add a hide_mask to the
	create-rule-from-message bars so that we don't segfault when we
	right click with a multi-selection.

2003-10-08  Chris Toshok  <toshok@ximian.com>

	* em-utils.c (em_utils_camel_address_to_destination): EDestination
	=> EABDestination, and e_destination => eab_destination.
	(reply_get_composer): same.
	(post_reply_to_message): same.

	* em-composer-utils.c (ask_confirm_for_unwanted_html_mail)
	EDestination => EABDestination, and e_destination =>
	eab_destination.
	(composer_get_message):same.

2003-10-08  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (mail_component_peek): setup vfolders once we
	hve the component, since its setup will call mail_component_peek,
	fun recursion.

2003-10-08  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (setup_local_folder): removed.
	(setup_local_store): setup various needed globals properly.
	(setup_account_storages): renamed to load_accounts.
	(go_online): turn on interactivity as well as onlinedness.

	* GNOME_Evolution_Mail.server.in.in: point the preferences pages
	to the right factory.

2003-10-07  Not Zed  <NotZed@Ximian.com>

	* mail-component.[ch]: Fix copyrights.

2003-10-06  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-config-druid.c (identity_prepare): Fixed.

	* mail-ops.c (fetch_mail_fetch): Always save the uid cache no
	matter what.

2003-10-03  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* mail-config-druid.c (identity_prepare), (config_wizard_new):
	Convert real name to UTF-8 if needed.

2003-10-03  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_set_folder): Disable the selection of
	the first unread message for now. This is actually annoying the
	fuck out of me, Radek, and a few other people.

2003-10-02  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (add_storage): Add the storage to the hash
	after we've initialised it.
	(mail_component_evomail_uri_from_folder): hardcode "local" account
	pseudo-id for local folders.
	(mail_component_get_folder_from_evomail_uri): handle the "local"
	account case.

2003-10-02  Not Zed  <NotZed@Ximian.com>

	* mail-component.c (setup_local_store): use mbox:/path rather than
	mbox:///path - the mbox code is 'wrong', but this is easier to
	fix.  fixes local unread counts.  maybe the provider url-compare
	should address this too.

2003-10-02  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>

	* mail-config-druid.c: Fix for 40917 "Backspace shouldn't
	highlight the whole remaining string in Setup Assistant".
	(identity_changed): Removed repeated focussing per keystroke.
	functions
	(source_changed): Same.
	(transport_changed): Here too.
	(management_changed): And here.
	(identity_prepare): Removed the initial highlighting for Full
	Name, also the unneeded intial grab_focus.

2003-10-02  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_format_timeout): zero out last_part if
	we're clearing.  Uh, this fixes, but shouldn't, part of #49034.
	The problem is the 'last part' logic is based on the address,
	which can quite easily be repeated for different messages.

	* em-folder-view.c (emfv_list_message_selected): reverted jeff's
	patch for #48618, use a much simpler method.

	* em-message-browser.c (emmb_destroy): hook onto destroy handler,
	we need to destroy the messagelist ourselves, since we dont attach
	it to any parent window.

2003-10-01  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_init): turn off blocking writes.
	(efh_format_timeout): don't do a htmlbegin on the page yet, it'll
	be handled by em-html-stream when it has data, to reduce flicker.
	(efh_format_do): close the main gtkhtml stream as soon as we're
	done writing the body.  any sub-jobs should be using frames etc.
	(efh_text_plain): dont write a table around the text, try to
	reduce flickering.  layout may be out now though.

	* em-html-stream.c (emhs_sync_write): if we have no html_stream
	yet, begin a new one.

2003-09-30  Rodney Dawes  <dobey@ximian.com>

	* em-format-html-print.c: Use "Sans Regular" instead of "Helvetica"
	Fixes bug #47878
	
2003-09-30  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_init): remove gconf stuff.
	(em_format_html_set_xmailer_mask): new method to set the xmailer mask.

	* em-folder-view.c (emfv_display_keys[]): Added charset key to
	monitor/retrieve, and xmailer_mask.
	(emfv_setting_notify): Monitor charset setting, pass onto the
	formatter, as well as xmailer_mask.

	* mail-preferences.c (mail_preferences_construct): use the new
	charset key.
	(mail_preferences_apply): use the new charset key.

	* evolution-mail.schemas: Moved the mail/format/charset to
	mail/display/charset.  1. it makes more sense, and 2. it makes
	notification update easier in em-folder-view.c

	* em-format.c (emf_init): remove the gconf charset stuff, for bug
	#48791, and also actually fixes the fixme that jeff thought he
	fixed.
	(em_format_format_text): use default charset as fallback.
	(em_format_set_default_charset): New method to set the default charset.
	(gconf_charset_changed): removed.

2003-09-29  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format.c (emf_init): Oops, put the arguments in the right order.

2003-09-29  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c: New member local_store in
	MailComponentPrivate.
	(impl_dispose): Unref.
	(mail_component_load_storage_by_uri): Return the CamelStore.
	(setup_local_folder): New.
	(setup_local_store): New.
	(mail_component_init): Call it.
	(mail_component_peek_storage_set): New.
	(mail_component_get_folder_from_evomail_uri): New.
	(mail_component_evomail_uri_from_folder): New.

	* em-folder-selection-button.c: New.
	* em-folder-selection-button.h: New.

	* em-folder-selection.c: New.
	* em-folder-selection.h: New.

	* em-marshal.list: Add NONE:POINTER.

2003-09-25  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (mail_account_gui_save): Allow any file: uri
	to point to a sent or drafts folder.

2003-09-25  Rodney Dawes  <dobey@ximian.com>

	* mail-send-recv.c: Make the dialog more HIG-compliant by fixing
	widget alignment/spacing issues, and removing separators

2003-09-24  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-preferences.c (mail_preferences_construct): Same as below.

	* mail-composer-prefs.c (mail_composer_prefs_construct): gconf can
	return empty string if the charset has not been set, so if the
	charset string is empty, default the charset to the user's locale
	charset. Partial fix for bug #47638.

2003-09-23  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (add_storage): Remove unused arg "uri".
	(mail_component_add_store): Likewise.
	(add_storage): Don't set the "Connecting..." node.
	(mail_component_init): Set up local store at
	~/.evolution/mail/local.

	* evolution-mbox-upgrade.c (get_local_store): Remove a double
	xmlFree() that was causing it to crash.


2003-09-23  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (add_storage): Note the new store.

	* mail-component-factory.c: Don't include "mail-callbacks.h"
	anymore.

	* em-format-html.c (em_format_html_get_type): Get the base
	directory with mail_component_peek_base_directory().
	* em-utils.c (filter_editor_response): Likewise.
	(em_utils_edit_filters): Likewise.

	* em-folder-browser.c (emfb_init): Get the search context through
	mail_component_peek_search_context().

2003-09-23  Jeffrey Stedfast  <fejj@ximian.com>

	* evolution-mbox-upgrade.c (get_local_store): Don't xmlFree (name)
	until after we've g_strdup'd it.
	(em_migrate_dir): If the metadata file doesn't exist, don't even
	bother trying subfolers (the shell just ignores them so we should
	too).

2003-09-23  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #48791 (and also fixes a FIXME)

	* em-format.c (emf_init): Setup a gconf listener for changes to
	the charset setting.
	(gconf_charset_changed): Update the cached gconf charset value.
	(emf_finalise): Free the EMFormatPrivate data, unref the gconf
	client, disconnect the charset notify id, and free the cached
	gconf charset value.
	(em_format_format_text): Use the cached gconf charset value.

2003-09-22  Not Zed  <NotZed@Ximian.com>

	** See bug #32996
	
	* mail-folder-cache.c (real_flush_updates): don't just pass TRUE
	to the 'can work offline' parameter of new shell folder.

	** See bug #39410
	
	* mail-ops.c (prep_offline_do): sync all messages, not just
	unread or flagged ones.

2003-09-22  Not Zed  <NotZed@Ximian.com>

	* em-popup.c (emp_uri_popup_link_copy): removed, moved to
	em-folder-view, for now, it has access to an invisible.

	* em-folder-view.c (emfv_setting_notify): honour the load_http
	setting, at least the all setting.
	(emfv_format_popup_event): setup the popup menu item for copy link
	location here.

2003-09-22  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-preferences.c (mail_preferences_construct): Connect to
	"value-changed" rather than "changed" for spin buttons.

2003-09-21  Not Zed  <NotZed@Ximian.com>

	* mail-session.c (ms_thread_msg_new): implement, we hook into the
	mail progress reporting stuff by overriding the CamelOperation
	member with one from a dummy mail_msg.
	(ms_thread_msg_free): handle freeing.

	* mail-mt.c (mail_msg_free): mute the camel-operaiton when we free
	it so we no longer get updates.

2003-09-19  Jeffrey Stedfast  <fejj@ximian.com>

	* em-message-browser.c (emmb_set_message): Set the window title to
	be that of the message subject. Fixes bug #48617.

2003-09-19  Jeffrey Stedfast  <fejj@ximian.com>

	Fix for bug #48618.

	* em-folder-view.c (emfv_list_message_selected): See if we have
	already loaded the message uid that has just been selected, if so
	- don't bother re-loading it.
	(emfv_list_done_message_selected): Update loaded_uid and
	loading_uid.

2003-09-18  Radek Doulik  <rodo@ximian.com>

	* em-format-html.c (efh_init): use gtkhtml's blocking

2003-09-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-inline-filter.c: updated for CamelTransferEncoding namespace
	changes

	* em-inline-filter.h: updated for CamelTransferEncoding namespace
	changes

	* mail-ops.c: updated for CamelTransferEncoding namespace changes

2003-09-18  Jeffrey Stedfast  <fejj@ximian.com>

	* component-factory.c: updated for camel namespace changes

	* em-folder-view.c: updated for camel namespace changes

	* em-format-html-display.c: updated for camel namespace changes

	* em-format-html-quote.c: updated for camel namespace changes

	* em-format.c: updated for camel namespace changes

	* em-popup.c: updated for camel namespace changes

	* em-utils.c: updated for camel namespace changes

	* mail-autofilter.c: updated for camel namespace changes

	* mail-ops.c: updated for camel namespace changes

	* mail-session.c: updated for camel namespace changes

	* message-list.c: updated for camel namespace changes

	* message-tag-followup.c: updated for camel namespace changes

	* importers/evolution-mbox-importer.c: updated for camel namespace
	changes

2003-09-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-popup.c (emp_standard_menu_factory): Don't forget to
	initialise/increment 'i' when using it as an object id in the
	for-loop.

	* em-format.c (em_format_format_text): Initialise charset to NULL
	or it may be used uninitialised. Also include
	gnome-vfs-mime-handlers.h for gnome_vfs_mime_type_get_description().

	* Makefile.am: Added $(MARSHALL_GENERATED) to $(BUILT_SOURCES) so
	that em-marshal.[c,h] were autogenerated.

2003-09-17  Not Zed  <NotZed@Ximian.com>

	* folder-browser.c, folder-browser.h, folder-browser-ui.c
	folder-browser-ui.h, mail-callbacks.c, mail-callbacks.h
	mail-display.c, mail-display.h, mail-display-stream.c
	mail-display-stream.h, mail-format.c, mail-format.h
	mail-identify.c, mail-search.c, mail-search.h message-browser.c,
	message-browser.h, subscribe-dialog.c subscribe-dialog.h,
	mail-font-prefs.c, mail-font-prefs.h: cvs removed.

	* Makefile.am: Removed mail-font-prefs.[ch], hasn't been built for
	ages.

	* em-*.c: killed a bunch of printfs.

	* em-format-html-display.c (efhd_html_button_press_event): update
	for html object api chagnes.

	** Merge in mail-refactor-2 branch.

2003-09-17  Jeffrey Stedfast  <fejj@ximian.com>

	* evolution-mbox-upgrade.c: New source file to migrate from the
	old mbox structure to the new mbox structure.

2003-09-08  Ettore Perazzoli  <ettore@ximian.com>

	* mail-folder-cache.c (mail_note_store): Allow NULL storage in
	precondition.

	* mail-component.c (mail_component_init): Remove debugging
	message.

2003-08-22  Not Zed  <NotZed@Ximian.com>

	* mail-format.c (write_date): translate the local time format.

2003-08-20  David Woodhouse  <dwmw2@infradead.org>

	* mail-format.c (write_date): Use e_utf8_strftime() to generate
	localised time; avoid gratuitous extra translation and array of
	day names, and the autoconf magic which made Not Zed dislike the
	inclusion of the timezone name.

2003-08-18  Ettore Perazzoli  <ettore@ximian.com>

	* GNOME_Evolution_Mail.server.in.in: Rename
	GNOME_Evolution_Mail_Component2 to
	GNOME_Evolution_Mail_Component_2 and GNOME_Evolution_Mail_Factory2
	to GNOME_Evolution_Mail_Factory_2.
	* mail-component-factory.c: Update accordingly.

2003-08-18  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-session.c (main_get_filter_driver): Removed the
	new-mail-notification mess.

	* mail-folder-cache.c (notify_idle_cb): New idle callback to alert
	the user about new mail.
	(notify_type_changed): New function to intercept user changes to
	his/her notification settings changes.
	(real_flush_updates): Initialise new mail notification if not yet
	initialised and setup an idle callback if none is already set.
	(update_1folder): Now takes an additional argument `new' which
	states whether or not the fodler got any new mail so that we may
	handle notify the user (if needed).
	(folder_changed): Pass in the number of new messages received.

2003-08-19  Not Zed  <NotZed@Ximian.com>

	* mail-callbacks.c (mail_generate_reply): Added a comment for
	translators.

2003-08-19  David Woodhouse  <dwmw2@infradead.org>

	* mail-callbacks.c (mail_generate_reply): Add a timezone offset to
	the attribution string.

2003-08-19  Not Zed  <NotZed@Ximian.com>

	* mail-format.c (write_date): Added translation for day and
	localtime strings.  Also removed the tz_zone stuff, and just use
	'localtime' always.

2003-08-15  David Woodhouse  <dwmw2@infradead.org>

	* mail-format.c (write_date): Show date in localtime too.

2003-08-19  Harry Lu  <harry.lu@sun.com>

	** For #45348

	* mail-display.c (mail_display_render): Change "%P" to "%p" so 
	that strftime() can work under solaris.

2003-08-14  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-ops.c (mail_send_message): Don't abort at the first failure
	after sending (filtering, appending to Sent, syncing). Instead,
	keep a running tab of exceptions and then set a culmulative
	exception at the end to report to our caller. Also, if we fail to
	append to the account Sent folder, try again with the local Sent
	folder. Fixes bug #46512.

2003-08-13  Suresh Chandrasekharan <suresh.chandrasekharan@sun.com>
	
	* e-searching-tokenizer.c (searcher_next_token): Fix for 45818 (
	i18n mail messages search only produces '[?]'). Now multibyte
	character selection works correctly. But due to associated gtkhtml
	bug, the find button functionallity for multibyte characters is
	broken.

2003-08-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-tools.h: Removed unused function prototype.

2003-08-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-session.c (remove_timeout): Removed.
	(register_timeout): Removed.

2003-08-09  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (storage_go_online): Pass NULL for the
	operation pointer to mail_note_store(), to sync with Michael's
	changes.

2003-08-05  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_multipart_encrypted): Updated for
	CamelMimePart::content_type changes.

	* mail-ops.c (save_part_save): Use
	camel_data_wrapper_decode_to_stream() here.

	* mail-display.c (drag_data_get_cb): Updated for
	CamelMimePart::content_type changes.
	(do_attachment_header): Same.

2003-07-31  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (mail_format_raw_message): Updated to pass FALSE
	as the 'decode' param to
	mail_format_data_wrapper_write_to_stream().
	(mail_format_data_wrapper_write_to_stream): Now takes a boolean
	arg telling whether to decode or not. Also reworked the charset
	logic now that camel doesn't handle this for us any longer.
	(mail_format_get_data_wrapper_text): Updated.
	(handle_text_plain): Same.
	(handle_text_enriched): Here too.

	* mail-display.c (do_attachment_header): Call decode_to_stream
	here instead of write_to_stream.
	(do_external_viewer): Same.
	(on_url_requested): Same. Also updated for
	mail_format_data_wrapper_write_to_stream().
	(try_part_urls): Call decode_to_stream.
	(drag_data_get_cb): Same.

2003-08-05  Not Zed  <NotZed@Ximian.com>

	** See bug #32732

	* message-list.c (mail_regen_list): use thread_new.

	* mail-local.c (reconfigure_response): use thread_new.

	* mail-display.c (stream_write_or_redisplay_when_loaded): use
	thread_new.

	* mail-config.c (mail_config_check_service): use thread_new rather
	than queue.

	* mail-callbacks.c (view_msg): change to use mail_get_messages(),
	fixes FIXME.
	(do_view_messages): handle get_messages callback.
	(do_view_message): removed.

	* mail-ops.c (mail_get_folderinfo): Use a new thread thread
	semantic.
	(mail_save_part): "
	(mail_store_set_offline): "
	(mail_sync_folder): use queued_slow thread queue.
	(mail_expunge_folder): "
	(mail_empty_trash): "

	** See bug #47224.  Hook onto clicked rather than button_pressed,
	so that dnd works.
	
	* mail-display.c (inline_toggle): toggle a part inline.
	(button_press): change back to only handle button clicked events,
	renamed to inline_button_clicked.
	(do_attachment_header): hook onto clicked rather than
	button_press_event, and move key_press_event to
	inline_button_pressed.
	(do_signature): Same.
	(inline_button_pressed): handle inline button key press event
	explicitly.

2003-07-29  Not Zed  <NotZed@Ximian.com>

	* mail-folder-cache.c (mail_note_store): add a CamelOperation for
	overriding status handler.

	* mail-send-recv.c (receive_update_got_store): Pass our own cancel
	handle to get_folderinfo and mail_note_store.
	(mail_send_receive, mail_receive_uri): Same for get_store.

	* mail-ops.c (mail_get_store, mail_get_folderinfo): Add a
	CamelOperation argument, for overriding the status handler.  Fixed
	most calles to pass NULL to use the default.

2003-09-15  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_activate): remove warning about folder
	not being loaded yet - it basically never is.

	* em-popup.c (emp_standard_menu_factory): dont setup any global
	select menu's yet.  they're all handled by folderview atm.

2003-09-11  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (efh_finalise, efh_format_timeout): Use a
	proper hash free func, otherwise it dont work.

2003-09-11  Not Zed  <NotZed@Ximian.com>

	* em-inline-filter.[ch]: A new class which implements an inline
	snooper via a mime filter, so it is fully streamable.  contents
	merely passes through the filter.

	* em-format-html.c (efh_finalise): free text substitute parts
	table.
	(efh_text_plain): transform a text part into a multipart, scanning
	for inline data.  Keep the multipart around for redraws.
	(efh_format_timeout): clear the text substitute parts table.

2003-09-10  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_init): hook onto realise so we
	get the real theme-applied style.
	(efhd_gtkhtml_realise): get the theme data for colour defaults.
	Tweak the colour selection to make it work better with dark
	themes.

	* em-format-quote.c (emfq_format_source): we need to implement
	this.
	(emfq_format_error): we need not to call parent, it doesn't
	implement it.

	* message-list.c (message_list_select_uid): don't emit
	changedhere, let it go through the table cursor change.

	* em-folder-browser.c (em_folder_browser_show_preview): use
	folderview.preview_active for this state.
	(em_folder_browser_show_preview): clear the current message when
	we turn off the message view, and load the current one when turn it on.

	* em-folder-view.c (emfv_destroy): zero out preview + list.
	(emfv_list_message_selected): check preview_active before doing
	anything.
	(emfv_edit_cut):
	(emfv_edit_copy): only run if preview active.

	* em-format-html.c (efh_format_do): output the proper html
	headers, etc.

2003-09-10  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-account-gui.c (mail_account_gui_save): Allow the user to
	select any fodler for his/her Drafts and Sent folders. Fixes bug
	#45412.

2003-09-09  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (forward_non_attached): implement forward quoted.

	* em-format-quote.[ch]: New class, em-format-html-quote wont cut
	it.  Sigh.

	* em-format-html-quote.c (efhq_base_init): move type init stuff
	here.
	(efhq_complete): remove, this is a signal.
	(efhq_multipart_related): we need to override the base class, we
	don't want to output any attachment html.

	* em-format-html-print.c (efhp_base_init): move builtin type init
	to here.

	* em-format-html.c (efh_init): get xmailer mask from gconf (sigh).
	(efh_format_header): inmplement most of xmailer mask thing.
	rupert icon not done yet, probably needs to be done as part of
	em-format-html-display, sigh.
	(type_builtin_table[]): add image/svg to supported image formats.
	(efhd_base_init): move type init to here.
	(efh_text_enriched): write to the filtered_stream, not stream.

	* em-format.c (em_format_format_text): oops, actually use any
	supplied charset.
	(emf_base_init): move hashtable init into base_init, so we get a
	new copy for each derived class too.

	* mail-send-recv.c (build_dialogue): use an eclippedlabel for
	status.  Fixed all uses.

2003-09-08  Not Zed  <NotZed@Ximian.com>

	* em-format-html.h (EMFormatHTML): added a simple_headers option,
	only output headers in basic format.  Added hide_headers option,
	to disable all header output.

	* em-format-html-quote.c (efhq_format_message): blockquote the
	contnet, thats how you cite it!
	(efhq_init): turn on simple headers for html output.
	(efhq_format_message): output headers and part directly, bypassing
	parent format_message.
	(efhq_format_message): implement hide_headers.

	* em-format-html.c (efh_busy): implement busy.
	(efh_format_message): implement simple_headers option.
	(efh_format_text_header): implement simple_headers option.
	(efh_format_message): move the header formatting stuff into
	exported em_format_html_format_headers.
	(efh_format_message): only output headers if not hidden.

	* em-format.c (emf_busy): base implementation of a new virtual
	method, returns TRUE if the object is still busy
	rendering/downloading stuff.

	* em-utils.c (em_utils_message_to_html): renamed from
	em_utils_quote_message.  Also make sure the html conversion is
	complete before getting the data.
	(em_utils_part_to_html): similar, but for parts.
	(composer_set_body): put in David Woodhouse's timezone in
	attribution patch.
	(composer_set_body): we want to quote the part (content), we don't
	want message headers.
	(em_utils_message_to_html): add a 'show headers' argument.

	* folder-browser-factory.c (control_activate): removed.
	(control_deactivate): removed.

	* mail-identify.c: 
	* folder-browser.[ch], folder-browser-ui.[ch]: 
	* mail-callbacks.[ch], mail-search.[ch]:
	* mail-display.[ch], mail-format.[ch], mail-display-stream.[ch]:
	* message-browser.[ch]: Removed, fixed all users.

	* component-factory.c (factory): change callbacks to em_utils
	ones.
	(configure_folder_popup): comment out some of the reconfigure
	stuff.  Wont have it in 1.6?
	(handle_external_uri_cb): use em_utils stuff.
	(user_create_new_item_cb): "
	(owner_unset_cb): "

	* em-composer-utils.c (composer_send_cb): rename to
	em_utils_composer_send_cb, and export, sigh, needed for factory.
	(composer_save_draft_cb): Same.

2003-09-05  Not Zed  <NotZed@Ximian.com>

	* em-format.c (type_builtin_table[]): Add a fallback multipart/*
	for other types (e.g. multipart/report)
	(em_format_fallback_handler): fix some bad logic.

	* em-folder-browser.c: track the pane size if the user changes it.
	(emfb_set_folder): Added a bit of a mess that will select the
	first unread message the first time you visit a folder.
	(emfb_destroy): impelment.  clear up outstanding signal handlers.
	(emfb_list_built): Select the first unread message.  this isn't
	entirely reliable as yet, and not configurable at all.

	* em-format-html-display.c (em_format_html_display_set_animate)
	(em_format_html_display_set_caret_mode): guess? :)
	(efhd_attachment_button): dont desensitise the button, just dont
	hook onto it, otherwise it looks fugly.

	* em-folder-view.c (emfv_list_done_message_selected): dont lookup
	gconf values every time.  use g_timeout_add rather than
	gtk_timeout, remove fixme's.
	(emfv_setting_notify): listner for gconf changes, reflect
	internally.
	(emfv_setting_setup): setup listner for gconf, and read initial
	settings.
	(emfv_activate): use local copy of settings rather than snooping
	gconf.
	(emfv_caret_mode): propagate caret-mode to display

	* em-format-html-quote.c (efhq_format_message): remove gconf
	stuff, our parent already has citation colour.

	* em-format-html.c (efh_format_timeout): remove gconf stuff.
	(em_format_html_set_load_http, em_format_html_set_mark_citations):
	set options on formatter, re-renders if required.
	(type_builtin_table[]): text/* should go to text/plain, not
	text/enriched.

2003-09-04  Not Zed  <NotZed@Ximian.com>

	* em-utils.c (confirm_expunge): rename it to emu_confirm_expunge
	and remove leading whitespace before function.
	(em_utils_expunge_folder): we want to expunge the folder, not
	empty the trash.  Jeff didn't even run this once ...

	* em-popup.c: Lots of new features, 'global' popup menu's on a
	per-selection type, via factories, popup selections (targets), a
	standard factory for many menu items.
	(emp_apps_open_in): duh, fix uri using logic
	(emp_standard_menu_factory): only add apps to app list if
	!requires_terminal.

	* em-format-html-display.c (efhd_open_in, efhd_popup_free_items):
	moved to em-popup.c
	(efhd_popup_save_attachment, efhd_popup_save_message) 
	(efhd_popup_reply_sender, efhd_popup_reply_list) 
	(efhd_popup_reply_all, efhd_popup_forward): (re)moved to em-popup.c
	(efhd_attachment_popup): use enew popu stuff.
	(efhd_attachment_button): Scale the icons for mime-type icons.

	* em-folder-view.c (em_folder_view_disable_mask): removed
	... moved to em-popup.
	(em_folder_view_get_popup_target): new method, get the selection
	target for the folder view.
	(emfv_html_popup_saveas, emfv_html_popup_link_open)
	(emfv_html_popup_link_copy, emfv_html_popup_address_send)
	(emfv_html_popup_address_add, emfv_format_popup_free_items): moved
	to em-popup.c
	(emfv_format_popup_event): use new popup stuff.
	(emfv_popup): use new popup stuff, but still just use all local
	menu's.

2003-09-03  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_format_popup_event): implement, a popup
	menu for right-clicking on links and images.
	(emfv_html_popup_link_copy): implement.
	(emfv_init): setup an invisible for selection stuff.
	(emfv_destroy): free invisible

	* em-utils.c (em_utils_get_proxy_uri): utility to get the current
	system proxy setting.
	(emu_set_proxy): implementation.

	* em-camel-stream.[ch]: removed.

	* em-format-html.c (efh_url_requested, efh_format_timeout): use
	em_html_stream rather than em_camel_stream.
	(emfh_gethttp): set the system proxy on the new stream.
	(emfh_multipart_related_check): use puri rather than purin inside
	the loop - duh.
	(emfh_multipart_related_check): removed 'unrelated part' warning,
	they can be (and normally are) added by the callbacks.

	* em-format-html.h (EMFormatHTMLJob): s/estream/stream/

	* em-html-stream.[ch]: New subclass of emsyncstream, replacement
	for em-camel-stream.

2003-09-04  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_folder_expunge): Call
	em_utils_expunge_folder instead.

	* em-utils.c (em_utils_expunge_folder): New function.
	(confirm_expunge): Make private.

2003-09-04  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_folder_expunge): Confirm hat the user
	wants to expunge.
	(emfb_empty_trash): Implemented.

	* em-utils.c (em_utils_prompt_user): Make public (used to be
	e_question).
	(em_utils_confirm_expunge): New function to confirm that the user
	wants to expunge.
	(em_utils_empty_trash): New function to empty all Trash folders.

	* em-composer-utils.c: Get rid of e_question and use em-utils'
	em_utils_prompt_user() function instead.

	* em-format-html-quote.[c,h]: New formatter for quoting
	replies/forwards/etc.

	* em-utils.c (em_utils_quote_message): New function.
	(composer_set_body): Use the new em_utils_quote_message()
	function.
	(em_utils_temp_save_part): Only g_free mfilename if it was
	malloc'd.

	* mail-tools.c (mail_tool_quote_message): Removed.
	(mail_tool_forward_message): Removed.

2003-09-03  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format.c (em_format_class_remove_handler): New function to
	remove a mime-type handler from a class.

	* em-format-html.c (efh_init): Set the CITATION bit for the
	default html flags.

	* em-format-html-display.c: Fixed some compiler warnings by adding
	appropriate includes.
	(efhd_multipart_signed): Don't write "inlined signature...".

2003-09-03  Not Zed  <NotZed@Ximian.com>

	* em-icon-stream.[ch]: New subclass of emsyncstream, write camel
	stream one side, creates an icon on the other.

	* em-sync-stream.[ch]: New file, an abstract class for creating
	write-any-thread-act-gui-thread stuff.  'em-camel-stream' will
	subclass this.

	* em-format-html-display.c (efhd_attachment_button): setup a job
	to write out an icon if the type is an image type, otherwise try
	and get the icon directly.  no caching yet.  the system icons
	aren't scaled properly either.
	(efhd_write_icon_job): async job to write out image content.

2003-09-02  Not Zed  <NotZed@Ximian.com>

	* em-format-html.c (emfh_new_job): renamed to
	em_format_html_job_new and made public.
	(emfh_queue_job): renamed to em_format_html_job_queue, and made
	public.

	* em-format-html.h: Made EMFormatHTMLJob a public structure.

2003-09-02  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.h (struct _EMFolderView): track the uicomponent
	while we're activated.

	* em-message-browser.c (em_message_browser_window_new): kill
	warning.
	(emmb_init, emmb_finalise): kill printf

	* em-format-html.c (efh_format_header): Converted code from head
	from David Woodhouse <dwmw2@infradead.org>'s timezone display
	patch.
	(efh_format_text_header): support new flag, HEADER_HTML - header
	alredy in html format.

	* em-format-html-print.c (em_format_html_print_print): only ref
	print_config if != NULL.

	* em-folder-browser.c (emfb_tree_key_press): handle
	space/backspace in messagelist to scroll the message view.
	(emfb_create_view_menus): setup view menu's, this should probably
	live in message-list.
	(emfb_init): setup the folderbrowser enable map into the list.
	(emfb_enable_map): folder browser enable map

	* em-utils.c (em_utils_adjustment_page): new helper to scroll an
	adjustment up/down 1 page.

	* em-folder-view.c (emfv_list_double_click): implement, open
	window.
	(emfv_list_key_press): implement keybinding overrides.  Enhance
	delete key to undelete if everything is already deleted.
	(emfv_build_enable_mask): separate out enable mask creation.
	(emfv_popup): use above to get mask.
	(emfv_enable_menus): enable/sensitize menus, use the same disable
	mask system as used for the popups.
	(emfv_destroy): change to use g_source_remove on seen_id.
	(emfv_finalise): free up folders, clean up async event thing.
	(emfv_init): setup an async event handler
	(emfv_set_folder): handle hook/unhook of folder_changed events.
	(emfv_folder_changed): proxy folder changed to main thread, ignore
	the details of what changed.
	(emfv_gui_folder_changed): update the menu's to reflect any folder
	changes.
	(emfv_build_disable_mask): added CAN_THREADED.
	(em_folder_view_disable_mask): make public (rename from
	emfv_build_disable_mask).
	(emfv_enable_menus): changed to work on a list of arrays of
	enablers, so they can be subclassed.
	(emfv_init): add our enable map to the ui.
	(em_folder_view_disable_mask): added support for can hidden (there
	are hidden messages).

2003-09-01  Not Zed  <NotZed@Ximian.com>

	* em-popup.c: New, simple menu-merging popup menu implementation.
	NOTE: should be temporary, but needs something that has similar
	merging facilities.

	* em-folder-view.c (emfv_popup*): added popup callbacks, implement
	a popup menu, using em_popup.
	(emfv_message_*): replaced a whole bunch of one-line, or simple
	functions with macro's to map to the popup implementation.
	(emfv_tools_vfolder*, emfv_tools_filter*): map to popup
	equivalents.
	(emfv_init): drop printf

	* em-format-html-display.c (efhd_attachment_popup): use the
	em_popup stuff to build a dynamic menu.

	* em-utils.c (em_utils_temp_save_part): change assignment order ot
	kill warning.
	(emu_get_save_filesel): handle null/empty name by appending / to
	the filename.

2003-08-30  Not Zed  <NotZed@Ximian.com>

	* mail-search.glade: forgot to add this yesterday.

	* em-utils.h: don't include stuff we dont need to.

	* em-folder-view.c (emfv_message_forward): just call
	em_utils_forward_messages.
	
	* em-format-html-display.c (em_format_html_display_search):
	removed unused.
	(efhd_drag_data_get): cleanup, use em_utils_temp_save_part.
	(efhd_attachment_popup): quick hack, setup a bunch more menu
	items, for forwarding inline messages, hook up saving parts, and
	messages, and hook up the 'open in' menu.
	(efhd_open_in): implement.

	* em-utils.c (em_utils_save_message): Renamed to
	em_utils_save_part.
	(em_utils_filesel_prompt): removed, it just makes things more
	complex than having a single response handler.
	(em_utils_save_part): move dialog stuff here, it also creates a
	name based on the type of part its given.
	(emu_get_save_filesel): new method to create a fileselector with
	standard options.
	(emu_save_part_response): handle file selector response for save
	part.
	(can_save): renamed to emu_can_save
	(em_utils_save_messages): use get_save_filesel
	(emu_can_save): handle the path="" case
	(em_utils_save_part): Add a prompt argument.
	(filesel_ok_cb): removed.
	(emu_update_save_path): update the gconf save_dir setting.
	(em_utils_forward_messages): helper to forward using default
	style.
	(forward_non_attached): remove uids argument.
	(em_utils_forward_message): helper to forward a message using the
	default forward style.
	(forward_non_attached): removed folder argument.
	(em_utils_temp_save_part): helper to save a part to a temporary
	file, e.g. for dnd, app launch, etc.

2003-08-29  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c: set 'outgoing' properly.

	* em-folder-browser.c (emfb_tools_subscriptions): enforce a single
	instance of the subscribe editor.
	(emfb_subscribe_editor_destroy): clear subscribe editor handle.

2003-08-29  Not Zed  <NotZed@Ximian.com>

	* em-camel-stream.c (em_camel_stream_new): Added some optional
	logging code.
	(stream_close): and here.
	(stream_write): and here.

	* em-folder-browser.c (emfb_init): remove fixme about search bar,
	its there now.  also fixme's about dnd/selection, they are handled
	in lower-level widgets.
	(em_folder_browser_show_preview): dont exit if show preview set,
	but only if it hasn't changed.
	(emfb_view_hide_selected, emfb_view_show_all) 
	(emfb_view_hide_read): removed some spurious printfs.

	* Makefile.am (glade_DATA): Added mail-search.glade.  FIXME:
	should all glade files be merged into 1?

	* em-format-html-display.c (efhd_format_clone): remove search
	match count code from here - wont be finished rendering at this
	point anyway.
	(em_format_html_display_search): new api for running an
	interactive search popup.
	(efhd_update_matches, efhd_update_search)
	(efhd_search_entry_activate, efhd_search_case_toggled)
	(efhd_search_response): helpers/callbacks for search popup.
	(efhd_class_init): hook into complete signal on EMFormat.
	(efhd_complete): complete rendering handler, update match count.

	* em-folder-view.c: removed fixme about api's - yes, do need two
	set_folder api's.
	(emfv_edit_cut, emfv_edit_copy): removed printfs
	(emfv_edit_paste): removed commented call to html_paste, we never
	want to do that.

2003-08-29  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_message_mark_unread): If there is a
	mark-as-read timeout handler registered, unregister it here.
	(emfv_tools_filter_mlist): Implemented.
	(emfv_tools_filter_recipient): Implemented.
	(emfv_tools_filter_sender): Implemented.
	(emfv_tools_filter_subject): Implemented.
	(emfv_tools_vfolder_mlist): Implemented.
	(emfv_tools_vfolder_recipient): Implemented.
	(emfv_tools_vfolder_sender): Implemented.
	(emfv_tools_vfolder_subject): Implemented.

2003-08-28  Not Zed  <NotZed@Ximian.com>

	* em-folder-browser.c (emfb_search_menu_activated)
	(emfb_search_config_search, emfb_search_search_activated)
	(emfb_search__query_changed): Implement search-bar callbacks.
	(emfb_init): setup search bar.

2003-08-28  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_message_reply): common reply code entry
	point, also implement simple reply-to-highlighted text (currently
	disabled).
	(emfv_activate): disable resend message on non-sent folders.
	(emfv_message_reply_all, emfv_message_reply_list)
	(emfv_message_reply_sender): use message_reply for common code.
	(em_folder_view_open_selected): in drafts or outbox, edit the
	message instead.
	(emfv_activate): force a sync on deactivate.

	* em-utils.c (em_utils_selection_get_mailbox): get mailbox
	(message/rfc822?) selection data.
	(em_utils_read_messages_from_stream): helper to move stuff from a
	mbox stream to a folder.
	(em_utils_folder_is_drafts, em_utils_folder_is_sent)
	(em_utils_folder_is_outbox): from folder browser helpers for
	customising the user experience.

	* message-list.c (message_list_construct): hook onto dnd stufd.
	(ml_tree_drag_data_get): implement drag sending.
	(ml_tree_drag_data_received): implement drag recieving.

	* em-format-html-display.c (efhd_drag_data_get): implemented.
	(efhd_drag_data_delete): implemented.
	(efhd_attachment_button): setup dnd callbacks.

2003-08-28  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_destroy): override the destroy method for
	GtkObject - unregister the mark-as-seen timeout if one is
	currently registered.
	(emfv_list_done_message_selected): Add the mark-as-seen timeout
	functionality here.
	(emfv_format_link_clicked): Implemented.

2003-08-27  Jeffrey Stedfast  <fejj@ximian.com>

	* em-utils.c (get_reply_list): Implemented.

2003-08-27  Not Zed  <NotZed@Ximian.com>

	* em-message-browser.c (emmb_activate): disable Edit->Paste menu
	always.

	* em-folder-browser.c (emfb_edit_paste): do a message-list paste,
	not a html one.
	(emfb_edit_cut, emfb_edit_copy, emfb_edit_paste): Moved to folder-view.

	* message-list.c (message_list_paste): trigger a paste action.
	(message_list_set_folder): added a uri argument, and save it
	internally, fixed all callers.
	(message_list_finalise): free the folder uri.

	* em-utils.c (em_utils_selection_set_mailbox): New helper to set
	the current selection as text in a berkely mailbox format.
	(em_utils_write_messages): helper to write stuff to a stream in
	mbox format.

2003-08-27  Not Zed  <NotZed@Ximian.com>

	* message-list.c (on_selection_changed_cmd): own/deown the primary
	selection when it changes.
	(message_list_init): init private data and invisible for
	selection.
	(message_list_destroy): free invisible.
	(message_list_finalise): free private data.
	(get_selected_cb): removed.
	(message_list_copy): new method to do copy and cut.  cut/copy to
	the clipboard.
	(ml_selection_clear_event): clear the right selection when
	requested.
	(message_list_has_primary_selection): helper to find out if the
	message-list has the selection.  is there a gtk way for this?

2003-08-26  Not Zed  <NotZed@Ximian.com>

	* mail-local.c (mlf_meta_set, mlf_meta_get): proxy meta-data stuff
	to subservient folder.

2003-08-23  Not Zed  <NotZed@Ximian.com>

	* em-folder-view.c (emfv_init): init preview here always.

2003-08-25  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (em_folder_view_print): Use
	e_dialog_set_transient_for().
	(emfv_message_delete): Fixed a FIXME.

	* em-folder-browser.c (emfb_edit_cut): Implemented.
	(emfb_edit_copy): Implemented.
	(emfb_edit_paste): Implemented.

	* em-format-html-display.c (em_format_html_display_cut): New function.
	(em_format_html_display_copy): New.
	(em_format_html_display_paste): New.

2003-08-25  Jeffrey Stedfast  <fejj@ximian.com>

	* em-utils.c (em_utils_flag_for_followup): Use
	e_dialog_set_transient_for().
	(em_utils_filesel_prompt): Same.
	(post_reply_to_message): Here too.
	(em_utils_edit_filters): Same.
	(create_new_composer): And here.
	(em_utils_compose_new_message_with_mailto): Here too.
	(em_utils_post_to_url): "
	(redirect_get_composer): Same.
	(reply_get_composer): Again...

	* em-folder-browser.c (emfb_tools_filters): Implemented.

	* em-utils.c (em_utils_edit_filters): New function to open the
	filter editor dialog.

2003-08-22  Jeffrey Stedfast  <fejj@ximian.com>

	* em-utils.c (em_utils_flag_for_followup): Implemented.
	(em_utils_flag_for_followup_clear): Implemented.
	(em_utils_flag_for_followup_completed): Implemented.

	* em-folder-view.c (emfv_message_followup_flag): Implemented.
	(emfv_message_followup_clear): Implemented.
	(emfv_message_followup_completed): Implemented.

2003-08-22  Not Zed  <NotZed@Ximian.com>

	* em-camel-stream.c (em_camel_stream_new): now take the gtkhtml
	too, and hook onto it's destroy so we don't try writing anymore
	after its gone.
	(stream_write, stream_flush, stream_close, emcs_gui_received):
	NOOP if the gtkhtml has been destroyed.
	(emcs_gtkhtml_destroy): null out the stream when the gtkhtml gets
	destroyed, it is no longer valid.
	(emcs_gui_received): dont try to soak all outstanding events, it
	always runs synchronous anyway, just get one and exit.

	* em-format-html.c (efh_gtkhtml_destroy): if the gtkhtml gets
	destroyed, abort any pending timeouts/processing.
	(efh_format_source): fixed implementation to write out all
	headers.
	(efh_multipart_related, emfh_multipart_related_check): separate
	checking for unused parts into a separate job, which is run after
	previous ones are executed.  keep track of visibility tree level
	in job, etc.

2003-08-22  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-browser.c (emfb_mail_compose): Implemented.
	(emfb_mail_post): Implemented.

	* em-utils.c (em_utils_compose_new_message): New function.
	(em_utils_compose_new_message_with_mailto): New.
	(em_utils_post_to_url): New.

2003-08-21  Not Zed  <NotZed@Ximian.com>

	* subscribe-dialog.glade: removed the text in the progress thing.
	It never showed up anyway and caused weird resizing stuff when the
	progress bar was active.

	* em-subscribe-editor.c: Found the correct version of the new
	subscribe code (on branch, duh!), and integrated it.
	(sub_selection_changed): Sensitise buttons based on selection.

	* em-format-html.c (efh_text_plain, efh_text_enriched)
	(efh_write_text_html): Use format_text for text output.
	(efh_write_image): use explicit image writer.
	(emfh_gethttp): added some progress stuff.
	(efh_format_do): maintain the accessible uri tree during jobs.
	(efh_url_requested): store the current uri accessibility tree node
	in the job, so it can be properly set for sub-jobs.
	(emh_multipart_related): moved here, can't use super-class version
	as it doesn't know about async jobs.
	(type_buildin_table[]): Added image/jpg and image/jpeg for the
	brokenmailers out there and to reduce the whinge.

	* em-format.c (em_format_format_content): For text parts, perform
	default charset/charset snooping/decoding.  No longer closes the
	stream once complete.
	(emf_write_related): close stream ourselves.

2003-08-21  Jeffrey Stedfast  <fejj@ximian.com>

	* em-folder-view.c (emfv_message_forward): Implemented.
	(emfv_message_forward_attached): Implemented.
	(emfv_message_forward_inline): Implemented.
	(emfv_message_forward_quoted): Implemented.
	(emfv_message_redirect): Implemented.
	(emfv_message_post_reply): Implemented.
	(emfv_message_reply_all): Implemented.
	(emfv_message_reply_list): Implemented.
	(emfv_message_reply_sender): Implemented.
	(emfv_message_resend): Implemented.
	(emfv_message_saveas): Implemented.

	* em-composer-utils.c: New source file containing all the composer
	send/draft callback mess.

	* em-utils.c (em_utils_uids_copy): New convenience function to
	copy a list of uids.
	(em_utils_uids_free): New convenience function to free a list of
	uids.
	(em_utils_save_message): New function to save a CamelMimeMessage
	(prompts the user for a location to save).
	(em_utils_save_messages): New function to save a list of messages
	(given a folder and list of uids).
	(em_utils_configure_account): Configure a new account...
	(em_utils_check_user_can_send_mail): Make sure the user has a
	transport setup.
	(em_utils_edit_message): New function to edit a message object.
	(em_utils_edit_messages): New function to open a composer to edit
	each message.
	(em_utils_forward_attached): New function to forward messages as
	an attachment,
	(em_utils_forward_inline): Forward a bunch of messages inline.
	(em_utils_forward_quoted): Forward a bunch of messages quoted.
	(em_utils_redirect_message): Redirect a message object.
	(em_utils_redirect_message_by_uid): Redirect a message given a
	folder and uid.
	(em_utils_reply_to_message): Reply to a message object.
	(em_utils_reply_to_message_by_uid): Reply to a message given a
	folder and uid.
	(em_utils_post_reply_to_message_by_uid): Post a reply to a message
	given a folder and uid.

	* mail-ops.c (filter_folder_free): Use em_utils_uids_free().
	(transfer_messages_free): Same.
	(get_messages_free): Here too.
	(save_messages_free): Same.

2003-08-20  Not Zed  <NotZed@Ximian.com>

	* em-subscribe-editor.[ch]: new widget, a dialog for editing
	subscriptions.

	* em-format-html.c (efh_format_done): emit a complete when done.

	* em-format.c (emf_class_init): Added a 'complete' signal, so that
	printing knows when to print.

	* em-format-html-print.c (em_format_html_print_print): Changed to
	take the message and source formatter too.  Runs an async render
	then prints.

2003-08-19  Not Zed  <NotZed@Ximian.com>

	* em-*.c: stacks more changes, added some bonobo menu setup, and
	implemented the trivial functions.

	* em-message-browser.[ch]: New message browser, inherits from
	em-folder-view.  Basically works.
	
	* message-list.c (message_list_select_uid): if we're selecting
	while still loading, setup a pending select.
	(regen_list_free): Check for a pending select, and select the
	message if we're now idle.

	* em-folder-view.c (em_folder_view_set_message,
	em_folder_view_set_folder): Make virtual macro's.
	(emfv_control_activate): added hook to enable bonobo state when setup.

	* em-format.c (emf_format_clone): base implementation, just clears
	state data.

	* em-format.h: change ::format to ::format_clone.  Make
	em_format_format_clone a macro/virtual method.

	* mail-mt.c (em_channel_setup): new function to setup i/o
	channels, so we can control the recursive flag.  leave off for
	now.
	(mail_msg_init): setup MsgPort channels using above.

	* em-format-html.c (efh_format): serialise/de-recursify formatting
	via a timeout function.
	(efh_format_timeout): keep polling to find out if cancellation is
	complete, then kick off a new render.

2003-08-18  Not Zed  <NotZed@Ximian.com>

	* em-*.c: more updates, incl threaded formatting queue.

2003-08-18  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c (em_format_html_display_zoom_in): New
	method to zoom-in on the gtkhtml contents.
	(em_format_html_display_zoom_out): Same but for zoom-out
	(em_format_html_display_zoom_reset): You get the idea.

2003-08-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (invert_selection): Use
	message_list_invert_selection().
	(select_thread): Use message_list_select_thread().
	(select_all): Use message_list_select_all().

	* message-list.c (message_list_select_all): New function.
	(message_list_select_thread): New function.
	(message_list_invert_selection): New function.

2003-08-12  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-session.c: Synced up with HEAD.

	* component-factory.c:

	* mail-folder-cache.[c,h]:

	* mail-tools.h:

	* mail-ops.[c,h]:

	* mail-send-recv.c:

	* mail-format.[c,h]:

	* mail-display.c:

	* mail-account-gui.c:

	* mail-local.c:

	* mail-offline-handler.c:

	* subscribe-dialog.c:

2003-08-12  Jeffrey Stedfast  <fejj@ximian.com>

	* em-format-html-display.c: Fixed some compiler warnings.

	* em-format.c: Updated for new mime-parser changes made to HEAD.

	* em-folder-view.c: Fixed some compiler warnings.

	* em-format-html.c: Fixed some compiler warnings.

2003-08-06  Not Zed  <NotZed@Ximian.com>

	* em-format-html-display.c (efhd_format_attachment): Added bonobo
	embeddables.

2003-08-01 Harry Lu  <harry.lu@sun.com>

	*Fix for bug #6951

	* mail-display.c (launch_cb): Bypass the new added menu item.
	(save_all_parts_cb): New function. Do the real save-all work.
	(save_all_parts): New function. Get the directory to save to.
	(save_all_cb): New function. The call-back function for the new 
	added menu item.
	(pixmap_press): Add the new menu item "Save All Attachment...".
	(ptr_array_free_notify): A simple wrapper function to free the
	pointer array.
	(do_attachment_header): Save attachment pointer in an array for 
	"Save All Attachment" use.

2003-08-01  Yuedong Du  <yuedong.du@sun.com>

	* message-browser.c (on_key_press): close mail message window
	using 'ESC' key, fix bug #47087

2003-07-28  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.c: Removed smime functions as they were stale.

2003-07-25  Jeffrey Stedfast  <fejj@ximian.com>

	* message-browser.c (message_browser_new): Handle our own Delete
	key presses. Fixes bug #45597.

2003-07-25  Ettore Perazzoli  <ettore@ximian.com>

	* mail-callbacks.c (do_view_message): No need to pass a shell
	argument to message_browser_new() anymore.

	* message-browser.c (message_browser_new): Removed arg shell.  No
	need to pass it to folder_browser_new() either.

	* mail-component.c (create_view_callback): No need to pass a shell
	arg to folder_browser_factory_new_control() anymore.

	* folder-browser-factory.c (folder_browser_factory_new_control):
	Removed arg shell; folder_browser_browser_new() doesn't need it
	anymore.

	* folder-browser.c (folder_browser_destroy): No need to unref
	->shell anymore.
	(folder_browser_new): Removed shell arg.
	(folder_browser_gui_init): Removed a const qualifier that was not
	supposed to be there.

	* folder-browser.h: Removed member shell from struct
	FolderBrowser.

2003-07-25  Ettore Perazzoli  <ettore@ximian.com>

	* folder-browser.c (folder_browser_gui_init): Get the search
	context through mail_component_peek_search_context(), since it's
	no longer a global variable.
	(folder_browser_gui_init): Cleaned up an extra unneeded if()
	statement.

	* mail-component.c: New member search_context in struct
	MailComponentPrivate.
	(mail_component_peek_search_context): New.
	(setup_search_context): New function to initialize the
	search_context, based on the old code in component-factory.c.
	(mail_component_init): Call it here.
	(impl_dispose): Unref the rule_context.

	* mail-component-factory.c: Removed global variable
	search_context.

2003-07-25  Ettore Perazzoli  <ettore@ximian.com>

	* mail-component.c (browser_page_switched_callback): New callback
	for the "page_switched" signal on EStorageBrowser; deactivate the
	previous page, activate the new one.
	(impl_createControls): Connect.

2003-07-24  Ettore Perazzoli  <ettore@ximian.com>

	* mail-mt.c (do_op_status): Pass "evolution-mail" as the ID to
	evolution_activity_client_new().  [This is just a temporary thing
	to avoid the fact that we don't have component-factory.h anymore.
	Eventually we'll just get rid of the activity client stuff.]

	* mail-component-factory.c: Added to the build.  Also, finished
	implementing and moving the factory over from component-factory.c.

	* component-factory.c: Removed from the build.
	* component-factory.h: Removed from the build.

	* mail-component.c: Removed some debugging messages.

2003-07-23  Ettore Perazzoli  <ettore@ximian.com>

	* subscribe-dialog.c: Converted to use EStorages instead of
	EvolutionStorages and the new MailComponent object.

	* mail.h: Nuked a bunch of stuff.  This will go away when I am
	done refactoring.

	* mail-offline-handler.c: Use the new MailComponent object.

	* mail-folder-cache.c, mail-folder-cache.h: Converted to use
	EStorages instead of EvolutionStorages.

	* mail-display.c: Use g_timeout and g_source functions instead of
	gtk_timeout functions.

	* mail-send-recv.c: Use g_timeout and g_source functions instead
	of gtk_timeout functions.
	(receive_update_got_store): Updated for the new mail_note_store().

	* mail-session.c: Use g_timeout and g_source functions instead of
	gtk_timeout functions.

	* mail-config-factory.c (factory): Removed.

	* folder-browser.c (folder_browser_destroy): Use GLib
	timeout/source functions instead of the deprecated GTK ones.
	(done_message_selected): Likewise.
	(folder_browser_gui_init): Protect against fb->search being NULL.

	* mail-account-gui.c (add_new_store): Use new MailComponent object
	and EStorages instead of EvolutionStorages.
	(mail_account_gui_save): Likewise.

	* mail-accounts.c (account_delete_clicked): Use new MailComponent
	object and EStorages instead of EvolutionStorages.
	(account_able_clicked): Likewise.
	(account_able_toggled): Likewise.

	* mail-autofilter.c: Use mail_component_peek_base_directory()
	instead of the evolution_dir global.
	* mail-callbacks.c: Likewise.
	* mail-config.c (uri_to_evname): Likewise.
	(mail_config_get_signature_list): Likewise.
	(delete_unused_signature_file): Likewise.
	* mail-display.c (mail_display_class_init): Likewise.
	* mail-importer.c (mail_importer_make_local_folder): Likewise.
	* mail-local.c (mlf_getv): Likewise.
	* mail-ops.c (uid_cachename_hack): Likewise.
	* mail-summary.c (generate_folder_summaries): Likewise.
	* mail-tools.c (mail_tool_get_local_inbox): Likewise.
	(mail_tools_folder_to_url): Likewise.
	* mail-vfolder.c (mail_vfolder_delete_uri): Likewise.
	(mail_vfolder_rename_uri): Likewise.
	(context_rule_removed): Likewise.
	(store_folder_deleted): Likewise.
	(store_folder_renamed): Likewise.
	(vfolder_load_storage): Likewise.
	(vfolder_editor_response): Likewise.
	(edit_rule_response): Likewise.
	(new_rule_clicked): Likewise.
	(vfolder_gui_add_rule): Likewise.
	* mail-session.c (main_get_filter_driver): Likewise.
	(mail_session_forget_password): Likewise.
	(mail_session_init): Get a base_directory arg.

	* component-factory.c, component-factory.h: Disabled a bunch of
	stuff to get it to compile in the new configuration.  These files
	will eventually go away when I am done refactoring this.

	* Makefile.am: Do not build importers, compile generate
	skels/stubs for Evolution.

	* GNOME_Evolution_Mail.server.in.in: Rename control factory to
	OAFIID:GNOME_Evolution_Mail_Factory2.  Add new component
	GNOME_Evolution_Mail_Component2.

	* mail-component-factory.c: New file implementing the Bonobo
	factory.

	* mail-component.c, mail-component.h: New files implementing the
	new mail component, using the new Evolution::Component IDL.

2003-07-23  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (mail_format_data_wrapper_write_to_stream): Revert
	prior changes.

2003-07-23  Dan Winship  <danw@ximian.com>

	* folder-browser.c (message_list_drag_data_get): Fix type warnings
	(folder_browser_toggle_caret_mode): Remove unused variable.

	* folder-browser-ui.c (basename): remove unused function

	* mail-account-gui.c (mail_account_gui_build_extra_conf): Fix
	warnings

	* mail-callbacks.c (empty_trash): Remove unused variable.

	* mail-display.c: #include gal/widgets/e-gui-utils.h for
	e_auto_kill_popup_menu_on_selection_done

	* mail-importer.c: #include e-util/e-path.h for e_path_to_physical

	* mail-session.c (main_play_sound): don't declare filename to be
	const and then free it.

	* mail-vfolder.c (vfolder_edit_rule, vfolder_gui_add_rule): Fix
	casts

	* message-list.c (build_flat_diff): Fix a typo in the
	non-BROKEN_ETREE code

2003-07-16  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (handle_multipart_encrypted): We don't have
	camel_pgp_mime_is_rfc2015_encrypted() anymore so just look at the
	protocol for now.
	(mail_format_data_wrapper_write_to_stream): Updated for the new
	way camel handles content objects.

2003-07-15  Federico Mena Quintero  <federico@ximian.com>

	* folder-browser.c (message_list_drag_data_received): Handle
	invalid URIs, or more likely, the last empty element in a URI list
	--- g_strsplit() will yield { "uri1", "", NULL }.  Fixes #46398.

	* component-factory.c (destination_folder_handle_drop): Likewise.

2003-07-15  Yuedong Du  <yuedong.du@sun.com>

	* mail-config.c: (config_write_style), (mail_config_init): remove
	the use of caret mode widget style.
	* mail-display.c: (display_notify), (mail_display_new): use new
	gtkhtml api to set caret mode.

2003-07-11  Antonio Xu  <antonio.xu@sun.com>

	* folder-browser-ui.c: Change the EditPaste mask to IS_0MESSAGE so
	that it is always activatable. Fixes bug #46018.

2003-07-04  Maxx Cao  <maxx.cao@sun.com>

	** For bug #41839

	* mail-display.c (do_attachment_header): Attachment buttons made
	accessable with keyboard (focusable). "Inline" button is disabled
	when attachment can't be viewed inline.
	(do_signature): Signature button made accessable with keyboard
	(focusable).
	(button_press): Function changed to an event callback (originally
	gtkbutton signal callback).
	(popup_menu_placement_callback): Function added to place popup
	menu (of attachment) beside button when activated by keyboard.

2003-07-10  Yuedong Du  <yuedong.du@sun.com>

	* evolution-mail.schemas: add a gconf key corresponding to newly 
	introduced caret mode of gtkhtml widget.

	* folder-browser-ui.c: new verb handling, corresponding the new menu
	entry for the caret mode flag. 

	* folder-browser.h: declaration of new verb handler to the menu entry 
	that turn caret mode on/off. The function just set the new introduced
	gconf key.

	* folder-browser.c: ditto

	* mail-config.c: lstione to the new gconf key, and when caret mode 
	flag is set/unset,change the style of gtkhtml widget. see bug
	#44607.

2003-07-09  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-crypto.h: Removed camel-pgp-mime.h, it no longer exists.

	* mail-format.c: Remove camel-pgp-mime.h

2003-07-07  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (mail_generate_reply): Use
	camel_strcase_hash/equal.

	* upgrade-mailer.c: Updated to use the camel-file-utils version of
	mkdir.

2003-07-02  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-tools.c (mail_tool_forward_message): Strip the signature
	from the body text. Fixes bug #45523. While we're here, also fix
	the code to quote exactly the same way as the
	mail_tool_quote_message() function.
	(mail_tool_quote_message): The last arg should not be
	'want_plain', because that arg is for whether or not the body
	should be quoted.

	* folder-browser.c (message_list_drag_data_get): Apply a
	From-filter when dragging as a test/uri-list and
	message/rfc822. Fixes bug #45617. Also free the uids ptrarray for
	the text/uri-list case.

2003-07-01  Dan Winship  <danw@ximian.com>

	* mail-display.c (pixbuf_for_mime_type): Gone
	(pixbuf_gen_idle): Use e_icon_for_mime_type instead.

2003-06-27  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (filter_date): Use the newer utf8 versions of the
	e_strftime*() functions since our format strings are all now in
	UTF-8.

	* mail-display.c (mail_display_render): Use the newer
	e_utf8_strftime_fix_am_pm().

	* mail-callbacks.c (mail_generate_reply): Use e_utf8_strftime(),
	otherwise we can end up with invalid utf-8.

2003-06-25  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): provide hardcoded default
	(red) spell error color

2003-06-24  Jeffrey Stedfast  <fejj@ximian.com>

	Might fix bug #45368 but I wouldn't bet on it.

	* message-browser.c (message_browser_new): Record the signal id
	for folder_loaded.
	(message_browser_folder_loaded): disconnect by id rather than
	searching for the handler. Save the id of the message_list_built
	signal handler.
	(message_browser_message_list_built): Disconnect the handler by
	id.
	(message_browser_destroy): Disconnect the signal handlers by id.

2003-06-20  Not Zed  <NotZed@Ximian.com>

	** See bug #43887

	* mail-format.c (mail_get_message_body): handle text/enriched and
	text/richtext explictly, and dont treat them as text/plain.

2003-06-23  Radek Doulik  <rodo@ximian.com>

	* mail-config.c (config_write_style): add
	EvolutionMailPrintHTMLWidget style assignment

	* mail-callbacks.c (do_mail_print): set printing widget name

2003-06-23  Dan Winship  <danw@ximian.com>

	* message-list.c (on_selection_changed_cmd): Save the idle_id

2003-06-23  Larry Ewing  <lewing@ximian.com>

	* folder-browser.c (do_message_selected): make sure not to strcmp
	a possibly NULL string.

2003-06-19  Not Zed  <NotZed@Ximian.com>

	** See bug #45063

	* folder-browser.c (do_message_selected): dont re-load if the same
	message gets selected again as one we've already shown.  Etree
	sends out selection changed events even when when it hasn't.

2003-06-18  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (hide_save_state): Only save state if we have a
	folder reference. Fixes some warnings about casting a NULL object
	to a CamelFolder.

2003-06-16  Jeffrey Stedfast  <fejj@ximian.com>

	* message-list.c (ml_tree_value_at): Don't display an unread icon
	for a parent message status if it has unread children but has been
	read itself. Instead, show that we have unread children by just
	making the message test bold (which it was already doing, so
	yay... this was easy). Fixes bug #42630.

2003-06-16  Not Zed  <NotZed@Ximian.com>

	** See bug #44609

	* mail-vfolder.c (vfolder_edit_rule): put the ok/cancel buttons in
	the stupid gnome 2 order.

	** See bug #33593

	* message-list.c (on_selection_changed_cmd): also listedn to
	selection changed events, since the etable api has changed.
	(get_selected_cb): helper for above.
	(message_list_construct): hook to selection change signal.

	* mail-callbacks.c (composer_send_queued_cb): Unref the composer
	to match the ref composer_send_cb();

	** See bug #44519

	* message-browser.c (message_browser_message_list_built): We want
	to disconnect from the messagelist, not folderbrowser signal.

2003-06-11  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-format.c (format_mime_part): We only really want to use
	mail_identify_mime_part() if the content-type is
	application/octet-stream - any other type (if it doesn't have a
	handler) should just force the user to save to disk.
	(handle_text_plain): Only pay attention to format=flowed if the
	mime-type is text/plain (handle_text_plain is the generic text
	handler, so we might be processing parts that are not really
	text/plain, thus the format param may have different meaning for
	those other textual types).

2003-06-11  Larry Ewing  <lewing@ximian.com>

	* mail-format.c (mail_lookup_handler): free the application list
	if we are bailing.

	* mail-send-recv.c (free_folder_info): free the info structure as
	well.

2003-06-06  Jeffrey Stedfast  <fejj@ximian.com>

	* message-tag-followup.c (get_week_start_day): Use mail-config's
	gconf client.
	(target_date_new): Same.

	* message-list.c (message_list_set_folder): Use mail-config's
	gconf client.
	(mail_regen_list): Same.

	* mail-tools.c (mail_tool_quote_message): Use mail-config's gconf
	client.
	(mail_tool_forward_message): Same.

	* mail-session.c (main_get_filter_driver): Use mail-config's gconf
	client.

	* mail-preferences.c (mail_preferences_init): Use mail-config's
	gconf client.
	(mail_preferences_finalise): Don't unref the gconf client.

	* mail-format.c (write_headers): Use mail-config's gconf client.
	(mail_format_data_wrapper_write_to_stream): Same.
	(handle_text_plain): And here.

	* mail-display.c (save_data_cb): Use mail-config's gconf client.
	(save_part): Same.
	(on_url_requested): Here too.
	(mail_text_write): And here.
	(mail_display_init): And here.
	(mail_display_destroy): Here too.
	(mail_display_new): Again here.

	* mail-composer-prefs.c (sig_add_cb): Use mail-config's gconf
	client.
	(mail_composer_prefs_construct): Same.

	* mail-callbacks.c (ask_confirm_for_unwanted_html_mail): Use
	mail-config's gconf client.
	(ask_confirm_for_empty_subject): Same.
	(ask_confirm_for_only_bcc): Here too.
	(composer_get_message): And here.
	(create_msg_composer): Again here.
	(mail_generate_reply): Same.
	(forward): And here.
	(transfer_msg_done): "
	(delete_msg): "
	(confirm_expunge): "

	* component-factory.c (owner_unset_cb): Use mail-config's gconf
	client.

	* folder-browser-ui.c (folder_browser_ui_add_message): Use the
	mailer's gconf client.
	(folder_browser_ui_add_list): Same.
	(folder_browser_ui_add_global): Here too.

	* folder-browser.c (save_cursor_pos): Use the mailer's gconf
	client.
	(folder_browser_set_message_preview): Same.
	(folder_browser_toggle_preview): Here too.
	(folder_browser_toggle_threads): And here.
	(folder_browser_toggle_hide_deleted): Here as well.
	(folder_browser_set_message_display_style): And here.
	(fb_resize_cb): Here.
	(paned_realised): And here.
	(done_message_selected): And everywhere...

	* mail-account-gui.c (sig_add_new_signature): Use the mailer gconf
	client.

	* mail-config.c (mail_config_get_gconf_client): New function to
	return the global GConfClient used by the mailer.
	(mail_config_write_on_exit): On exit, free our objects and such.
	(mail_config_signature_run_script): Use config->gconf.

2003-06-04  Jeffrey Stedfast  <fejj@ximian.com>

	* mail-callbacks.c (invert_selection): Get rid of the if-focused
	code, that will always prevent the etree from getting the
	selection inverted because the menu item will always have focus at
	this time. Fix for bug #43972.

2003-06-11  Not Zed  <NotZed@Ximian.com>

	** See bug #22542
	
	* component-factory.c (storage_create_folder): If we're creating a
	folder on a vstore, popup a vFolder editor rather than failing.

2003-06-05  Not Zed  <NotZed@Ximian.com>

	** Part of #42691.
	
	* importers/Makefile.am (BUILT_SOURCES): added server_DATA.

	* Makefile.am (%.server.in): create a proper implicit rule for
	temporary .in file.

2003-06-04  Not Zed  <NotZed@Ximian.com>

	** See bug #43974

	* mail-tools.c (mail_tool_do_movemail): use a proper CamelURL to
	decode the uri, not hacky strcmp stuff.

	* mail-account-gui.c (extract_values): if we have an conf_entry,
	ignore username, hostname, and path ones, as these are handled
	implicitly in the url itself.  Came about because of the fix for
	#42838.

2003-06-03  Federico Mena Quintero  <federico@ximian.com>

	* mail-search.c (mail_search_construct): Put the buttons in HIG
	order; don't replace the label of the stock Find button.  Also,
	add Escape as a keybinding for the Close button (see why GTK+ is
	on crack on b.g.o #74221 and #101293).

